var Li=Object.defineProperty;var ti=Y=>{throw TypeError(Y)};var Oi=(Y,w,W)=>w in Y?Li(Y,w,{enumerable:!0,configurable:!0,writable:!0,value:W}):Y[w]=W;var Le=(Y,w,W)=>Oi(Y,typeof w!="symbol"?w+"":w,W),bs=(Y,w,W)=>w.has(Y)||ti("Cannot "+W);var D=(Y,w,W)=>(bs(Y,w,"read from private field"),W?W.call(Y):w.get(Y)),Ht=(Y,w,W)=>w.has(Y)?ti("Cannot add the same private member more than once"):w instanceof WeakSet?w.add(Y):w.set(Y,W),zt=(Y,w,W,F)=>(bs(Y,w,"write to private field"),F?F.call(Y,W):w.set(Y,W),W),Ft=(Y,w,W)=>(bs(Y,w,"access private method"),W);var Ye=(Y,w,W,F)=>({set _(O){zt(Y,w,O,W)},get _(){return D(Y,w,F)}});(function(){const w=document.createElement("link").relList;if(w&&w.supports&&w.supports("modulepreload"))return;for(const O of document.querySelectorAll('link[rel="modulepreload"]'))F(O);new MutationObserver(O=>{for(const ut of O)if(ut.type==="childList")for(const lt of ut.addedNodes)lt.tagName==="LINK"&&lt.rel==="modulepreload"&&F(lt)}).observe(document,{childList:!0,subtree:!0});function W(O){const ut={};return O.integrity&&(ut.integrity=O.integrity),O.referrerPolicy&&(ut.referrerPolicy=O.referrerPolicy),O.crossOrigin==="use-credentials"?ut.credentials="include":O.crossOrigin==="anonymous"?ut.credentials="omit":ut.credentials="same-origin",ut}function F(O){if(O.ep)return;O.ep=!0;const ut=W(O);fetch(O.href,ut)}})();/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const t$2=globalThis,e$4=t$2.ShadowRoot&&(t$2.ShadyCSS===void 0||t$2.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,s$2=Symbol(),o$4=new WeakMap;let n$3=class{constructor(w,W,F){if(this._$cssResult$=!0,F!==s$2)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=w,this.t=W}get styleSheet(){let w=this.o;const W=this.t;if(e$4&&w===void 0){const F=W!==void 0&&W.length===1;F&&(w=o$4.get(W)),w===void 0&&((this.o=w=new CSSStyleSheet).replaceSync(this.cssText),F&&o$4.set(W,w))}return w}toString(){return this.cssText}};const r$4=Y=>new n$3(typeof Y=="string"?Y:Y+"",void 0,s$2),i$3=(Y,...w)=>{const W=Y.length===1?Y[0]:w.reduce((F,O,ut)=>F+(lt=>{if(lt._$cssResult$===!0)return lt.cssText;if(typeof lt=="number")return lt;throw Error("Value passed to 'css' function must be a 'css' function result: "+lt+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(O)+Y[ut+1],Y[0]);return new n$3(W,Y,s$2)},S$1=(Y,w)=>{if(e$4)Y.adoptedStyleSheets=w.map(W=>W instanceof CSSStyleSheet?W:W.styleSheet);else for(const W of w){const F=document.createElement("style"),O=t$2.litNonce;O!==void 0&&F.setAttribute("nonce",O),F.textContent=W.cssText,Y.appendChild(F)}},c$2=e$4?Y=>Y:Y=>Y instanceof CSSStyleSheet?(w=>{let W="";for(const F of w.cssRules)W+=F.cssText;return r$4(W)})(Y):Y;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:i$2,defineProperty:e$3,getOwnPropertyDescriptor:h$1,getOwnPropertyNames:r$3,getOwnPropertySymbols:o$3,getPrototypeOf:n$2}=Object,a$1=globalThis,c$1=a$1.trustedTypes,l$1=c$1?c$1.emptyScript:"",p$1=a$1.reactiveElementPolyfillSupport,d$1=(Y,w)=>Y,u$1={toAttribute(Y,w){switch(w){case Boolean:Y=Y?l$1:null;break;case Object:case Array:Y=Y==null?Y:JSON.stringify(Y)}return Y},fromAttribute(Y,w){let W=Y;switch(w){case Boolean:W=Y!==null;break;case Number:W=Y===null?null:Number(Y);break;case Object:case Array:try{W=JSON.parse(Y)}catch{W=null}}return W}},f$1=(Y,w)=>!i$2(Y,w),b={attribute:!0,type:String,converter:u$1,reflect:!1,useDefault:!1,hasChanged:f$1};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),a$1.litPropertyMetadata??(a$1.litPropertyMetadata=new WeakMap);let y$1=class extends HTMLElement{static addInitializer(w){this._$Ei(),(this.l??(this.l=[])).push(w)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(w,W=b){if(W.state&&(W.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(w)&&((W=Object.create(W)).wrapped=!0),this.elementProperties.set(w,W),!W.noAccessor){const F=Symbol(),O=this.getPropertyDescriptor(w,F,W);O!==void 0&&e$3(this.prototype,w,O)}}static getPropertyDescriptor(w,W,F){const{get:O,set:ut}=h$1(this.prototype,w)??{get(){return this[W]},set(lt){this[W]=lt}};return{get:O,set(lt){const Yt=O?.call(this);ut?.call(this,lt),this.requestUpdate(w,Yt,F)},configurable:!0,enumerable:!0}}static getPropertyOptions(w){return this.elementProperties.get(w)??b}static _$Ei(){if(this.hasOwnProperty(d$1("elementProperties")))return;const w=n$2(this);w.finalize(),w.l!==void 0&&(this.l=[...w.l]),this.elementProperties=new Map(w.elementProperties)}static finalize(){if(this.hasOwnProperty(d$1("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(d$1("properties"))){const W=this.properties,F=[...r$3(W),...o$3(W)];for(const O of F)this.createProperty(O,W[O])}const w=this[Symbol.metadata];if(w!==null){const W=litPropertyMetadata.get(w);if(W!==void 0)for(const[F,O]of W)this.elementProperties.set(F,O)}this._$Eh=new Map;for(const[W,F]of this.elementProperties){const O=this._$Eu(W,F);O!==void 0&&this._$Eh.set(O,W)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(w){const W=[];if(Array.isArray(w)){const F=new Set(w.flat(1/0).reverse());for(const O of F)W.unshift(c$2(O))}else w!==void 0&&W.push(c$2(w));return W}static _$Eu(w,W){const F=W.attribute;return F===!1?void 0:typeof F=="string"?F:typeof w=="string"?w.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(w=>this.enableUpdating=w),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(w=>w(this))}addController(w){(this._$EO??(this._$EO=new Set)).add(w),this.renderRoot!==void 0&&this.isConnected&&w.hostConnected?.()}removeController(w){this._$EO?.delete(w)}_$E_(){const w=new Map,W=this.constructor.elementProperties;for(const F of W.keys())this.hasOwnProperty(F)&&(w.set(F,this[F]),delete this[F]);w.size>0&&(this._$Ep=w)}createRenderRoot(){const w=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return S$1(w,this.constructor.elementStyles),w}connectedCallback(){this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),this._$EO?.forEach(w=>w.hostConnected?.())}enableUpdating(w){}disconnectedCallback(){this._$EO?.forEach(w=>w.hostDisconnected?.())}attributeChangedCallback(w,W,F){this._$AK(w,F)}_$ET(w,W){const F=this.constructor.elementProperties.get(w),O=this.constructor._$Eu(w,F);if(O!==void 0&&F.reflect===!0){const ut=(F.converter?.toAttribute!==void 0?F.converter:u$1).toAttribute(W,F.type);this._$Em=w,ut==null?this.removeAttribute(O):this.setAttribute(O,ut),this._$Em=null}}_$AK(w,W){const F=this.constructor,O=F._$Eh.get(w);if(O!==void 0&&this._$Em!==O){const ut=F.getPropertyOptions(O),lt=typeof ut.converter=="function"?{fromAttribute:ut.converter}:ut.converter?.fromAttribute!==void 0?ut.converter:u$1;this._$Em=O;const Yt=lt.fromAttribute(W,ut.type);this[O]=Yt??this._$Ej?.get(O)??Yt,this._$Em=null}}requestUpdate(w,W,F){if(w!==void 0){const O=this.constructor,ut=this[w];if(F??(F=O.getPropertyOptions(w)),!((F.hasChanged??f$1)(ut,W)||F.useDefault&&F.reflect&&ut===this._$Ej?.get(w)&&!this.hasAttribute(O._$Eu(w,F))))return;this.C(w,W,F)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(w,W,{useDefault:F,reflect:O,wrapped:ut},lt){F&&!(this._$Ej??(this._$Ej=new Map)).has(w)&&(this._$Ej.set(w,lt??W??this[w]),ut!==!0||lt!==void 0)||(this._$AL.has(w)||(this.hasUpdated||F||(W=void 0),this._$AL.set(w,W)),O===!0&&this._$Em!==w&&(this._$Eq??(this._$Eq=new Set)).add(w))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(W){Promise.reject(W)}const w=this.scheduleUpdate();return w!=null&&await w,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[O,ut]of this._$Ep)this[O]=ut;this._$Ep=void 0}const F=this.constructor.elementProperties;if(F.size>0)for(const[O,ut]of F){const{wrapped:lt}=ut,Yt=this[O];lt!==!0||this._$AL.has(O)||Yt===void 0||this.C(O,void 0,ut,Yt)}}let w=!1;const W=this._$AL;try{w=this.shouldUpdate(W),w?(this.willUpdate(W),this._$EO?.forEach(F=>F.hostUpdate?.()),this.update(W)):this._$EM()}catch(F){throw w=!1,this._$EM(),F}w&&this._$AE(W)}willUpdate(w){}_$AE(w){this._$EO?.forEach(W=>W.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(w)),this.updated(w)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(w){return!0}update(w){this._$Eq&&(this._$Eq=this._$Eq.forEach(W=>this._$ET(W,this[W]))),this._$EM()}updated(w){}firstUpdated(w){}};y$1.elementStyles=[],y$1.shadowRootOptions={mode:"open"},y$1[d$1("elementProperties")]=new Map,y$1[d$1("finalized")]=new Map,p$1?.({ReactiveElement:y$1}),(a$1.reactiveElementVersions??(a$1.reactiveElementVersions=[])).push("2.1.1");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const t$1=globalThis,i$1=t$1.trustedTypes,s$1=i$1?i$1.createPolicy("lit-html",{createHTML:Y=>Y}):void 0,e$2="$lit$",h=`lit$${Math.random().toFixed(9).slice(2)}$`,o$2="?"+h,n$1=`<${o$2}>`,r$2=document,l=()=>r$2.createComment(""),c=Y=>Y===null||typeof Y!="object"&&typeof Y!="function",a=Array.isArray,u=Y=>a(Y)||typeof Y?.[Symbol.iterator]=="function",d=`[ 	
\f\r]`,f=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,v=/-->/g,_=/>/g,m=RegExp(`>|${d}(?:([^\\s"'>=/]+)(${d}*=${d}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),p=/'/g,g=/"/g,$=/^(?:script|style|textarea|title)$/i,y=Y=>(w,...W)=>({_$litType$:Y,strings:w,values:W}),x=y(1),T=Symbol.for("lit-noChange"),E=Symbol.for("lit-nothing"),A=new WeakMap,C=r$2.createTreeWalker(r$2,129);function P(Y,w){if(!a(Y)||!Y.hasOwnProperty("raw"))throw Error("invalid template strings array");return s$1!==void 0?s$1.createHTML(w):w}const V=(Y,w)=>{const W=Y.length-1,F=[];let O,ut=w===2?"<svg>":w===3?"<math>":"",lt=f;for(let Yt=0;Yt<W;Yt++){const vt=Y[Yt];let pt,tt,_t=-1,Ct=0;for(;Ct<vt.length&&(lt.lastIndex=Ct,tt=lt.exec(vt),tt!==null);)Ct=lt.lastIndex,lt===f?tt[1]==="!--"?lt=v:tt[1]!==void 0?lt=_:tt[2]!==void 0?($.test(tt[2])&&(O=RegExp("</"+tt[2],"g")),lt=m):tt[3]!==void 0&&(lt=m):lt===m?tt[0]===">"?(lt=O??f,_t=-1):tt[1]===void 0?_t=-2:(_t=lt.lastIndex-tt[2].length,pt=tt[1],lt=tt[3]===void 0?m:tt[3]==='"'?g:p):lt===g||lt===p?lt=m:lt===v||lt===_?lt=f:(lt=m,O=void 0);const at=lt===m&&Y[Yt+1].startsWith("/>")?" ":"";ut+=lt===f?vt+n$1:_t>=0?(F.push(pt),vt.slice(0,_t)+e$2+vt.slice(_t)+h+at):vt+h+(_t===-2?Yt:at)}return[P(Y,ut+(Y[W]||"<?>")+(w===2?"</svg>":w===3?"</math>":"")),F]};class N{constructor({strings:w,_$litType$:W},F){let O;this.parts=[];let ut=0,lt=0;const Yt=w.length-1,vt=this.parts,[pt,tt]=V(w,W);if(this.el=N.createElement(pt,F),C.currentNode=this.el.content,W===2||W===3){const _t=this.el.content.firstChild;_t.replaceWith(..._t.childNodes)}for(;(O=C.nextNode())!==null&&vt.length<Yt;){if(O.nodeType===1){if(O.hasAttributes())for(const _t of O.getAttributeNames())if(_t.endsWith(e$2)){const Ct=tt[lt++],at=O.getAttribute(_t).split(h),ct=/([.?@])?(.*)/.exec(Ct);vt.push({type:1,index:ut,name:ct[2],strings:at,ctor:ct[1]==="."?H:ct[1]==="?"?I:ct[1]==="@"?L:k}),O.removeAttribute(_t)}else _t.startsWith(h)&&(vt.push({type:6,index:ut}),O.removeAttribute(_t));if($.test(O.tagName)){const _t=O.textContent.split(h),Ct=_t.length-1;if(Ct>0){O.textContent=i$1?i$1.emptyScript:"";for(let at=0;at<Ct;at++)O.append(_t[at],l()),C.nextNode(),vt.push({type:2,index:++ut});O.append(_t[Ct],l())}}}else if(O.nodeType===8)if(O.data===o$2)vt.push({type:2,index:ut});else{let _t=-1;for(;(_t=O.data.indexOf(h,_t+1))!==-1;)vt.push({type:7,index:ut}),_t+=h.length-1}ut++}}static createElement(w,W){const F=r$2.createElement("template");return F.innerHTML=w,F}}function S(Y,w,W=Y,F){if(w===T)return w;let O=F!==void 0?W._$Co?.[F]:W._$Cl;const ut=c(w)?void 0:w._$litDirective$;return O?.constructor!==ut&&(O?._$AO?.(!1),ut===void 0?O=void 0:(O=new ut(Y),O._$AT(Y,W,F)),F!==void 0?(W._$Co??(W._$Co=[]))[F]=O:W._$Cl=O),O!==void 0&&(w=S(Y,O._$AS(Y,w.values),O,F)),w}class M{constructor(w,W){this._$AV=[],this._$AN=void 0,this._$AD=w,this._$AM=W}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(w){const{el:{content:W},parts:F}=this._$AD,O=(w?.creationScope??r$2).importNode(W,!0);C.currentNode=O;let ut=C.nextNode(),lt=0,Yt=0,vt=F[0];for(;vt!==void 0;){if(lt===vt.index){let pt;vt.type===2?pt=new R(ut,ut.nextSibling,this,w):vt.type===1?pt=new vt.ctor(ut,vt.name,vt.strings,this,w):vt.type===6&&(pt=new z(ut,this,w)),this._$AV.push(pt),vt=F[++Yt]}lt!==vt?.index&&(ut=C.nextNode(),lt++)}return C.currentNode=r$2,O}p(w){let W=0;for(const F of this._$AV)F!==void 0&&(F.strings!==void 0?(F._$AI(w,F,W),W+=F.strings.length-2):F._$AI(w[W])),W++}}class R{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(w,W,F,O){this.type=2,this._$AH=E,this._$AN=void 0,this._$AA=w,this._$AB=W,this._$AM=F,this.options=O,this._$Cv=O?.isConnected??!0}get parentNode(){let w=this._$AA.parentNode;const W=this._$AM;return W!==void 0&&w?.nodeType===11&&(w=W.parentNode),w}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(w,W=this){w=S(this,w,W),c(w)?w===E||w==null||w===""?(this._$AH!==E&&this._$AR(),this._$AH=E):w!==this._$AH&&w!==T&&this._(w):w._$litType$!==void 0?this.$(w):w.nodeType!==void 0?this.T(w):u(w)?this.k(w):this._(w)}O(w){return this._$AA.parentNode.insertBefore(w,this._$AB)}T(w){this._$AH!==w&&(this._$AR(),this._$AH=this.O(w))}_(w){this._$AH!==E&&c(this._$AH)?this._$AA.nextSibling.data=w:this.T(r$2.createTextNode(w)),this._$AH=w}$(w){const{values:W,_$litType$:F}=w,O=typeof F=="number"?this._$AC(w):(F.el===void 0&&(F.el=N.createElement(P(F.h,F.h[0]),this.options)),F);if(this._$AH?._$AD===O)this._$AH.p(W);else{const ut=new M(O,this),lt=ut.u(this.options);ut.p(W),this.T(lt),this._$AH=ut}}_$AC(w){let W=A.get(w.strings);return W===void 0&&A.set(w.strings,W=new N(w)),W}k(w){a(this._$AH)||(this._$AH=[],this._$AR());const W=this._$AH;let F,O=0;for(const ut of w)O===W.length?W.push(F=new R(this.O(l()),this.O(l()),this,this.options)):F=W[O],F._$AI(ut),O++;O<W.length&&(this._$AR(F&&F._$AB.nextSibling,O),W.length=O)}_$AR(w=this._$AA.nextSibling,W){for(this._$AP?.(!1,!0,W);w!==this._$AB;){const F=w.nextSibling;w.remove(),w=F}}setConnected(w){this._$AM===void 0&&(this._$Cv=w,this._$AP?.(w))}}class k{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(w,W,F,O,ut){this.type=1,this._$AH=E,this._$AN=void 0,this.element=w,this.name=W,this._$AM=O,this.options=ut,F.length>2||F[0]!==""||F[1]!==""?(this._$AH=Array(F.length-1).fill(new String),this.strings=F):this._$AH=E}_$AI(w,W=this,F,O){const ut=this.strings;let lt=!1;if(ut===void 0)w=S(this,w,W,0),lt=!c(w)||w!==this._$AH&&w!==T,lt&&(this._$AH=w);else{const Yt=w;let vt,pt;for(w=ut[0],vt=0;vt<ut.length-1;vt++)pt=S(this,Yt[F+vt],W,vt),pt===T&&(pt=this._$AH[vt]),lt||(lt=!c(pt)||pt!==this._$AH[vt]),pt===E?w=E:w!==E&&(w+=(pt??"")+ut[vt+1]),this._$AH[vt]=pt}lt&&!O&&this.j(w)}j(w){w===E?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,w??"")}}class H extends k{constructor(){super(...arguments),this.type=3}j(w){this.element[this.name]=w===E?void 0:w}}class I extends k{constructor(){super(...arguments),this.type=4}j(w){this.element.toggleAttribute(this.name,!!w&&w!==E)}}class L extends k{constructor(w,W,F,O,ut){super(w,W,F,O,ut),this.type=5}_$AI(w,W=this){if((w=S(this,w,W,0)??E)===T)return;const F=this._$AH,O=w===E&&F!==E||w.capture!==F.capture||w.once!==F.once||w.passive!==F.passive,ut=w!==E&&(F===E||O);O&&this.element.removeEventListener(this.name,this,F),ut&&this.element.addEventListener(this.name,this,w),this._$AH=w}handleEvent(w){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,w):this._$AH.handleEvent(w)}}class z{constructor(w,W,F){this.element=w,this.type=6,this._$AN=void 0,this._$AM=W,this.options=F}get _$AU(){return this._$AM._$AU}_$AI(w){S(this,w)}}const j=t$1.litHtmlPolyfillSupport;j?.(N,R),(t$1.litHtmlVersions??(t$1.litHtmlVersions=[])).push("3.3.1");const B=(Y,w,W)=>{const F=W?.renderBefore??w;let O=F._$litPart$;if(O===void 0){const ut=W?.renderBefore??null;F._$litPart$=O=new R(w.insertBefore(l(),ut),ut,void 0,W??{})}return O._$AI(Y),O};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const s=globalThis;class i extends y$1{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var W;const w=super.createRenderRoot();return(W=this.renderOptions).renderBefore??(W.renderBefore=w.firstChild),w}update(w){const W=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(w),this._$Do=B(W,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return T}}i._$litElement$=!0,i.finalized=!0,s.litElementHydrateSupport?.({LitElement:i});const o$1=s.litElementPolyfillSupport;o$1?.({LitElement:i});(s.litElementVersions??(s.litElementVersions=[])).push("4.2.1");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const t=Y=>(w,W)=>{W!==void 0?W.addInitializer(()=>{customElements.define(Y,w)}):customElements.define(Y,w)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const o={attribute:!0,type:String,converter:u$1,reflect:!1,hasChanged:f$1},r$1=(Y=o,w,W)=>{const{kind:F,metadata:O}=W;let ut=globalThis.litPropertyMetadata.get(O);if(ut===void 0&&globalThis.litPropertyMetadata.set(O,ut=new Map),F==="setter"&&((Y=Object.create(Y)).wrapped=!0),ut.set(W.name,Y),F==="accessor"){const{name:lt}=W;return{set(Yt){const vt=w.get.call(this);w.set.call(this,Yt),this.requestUpdate(lt,vt,Y)},init(Yt){return Yt!==void 0&&this.C(lt,void 0,Y,Yt),Yt}}}if(F==="setter"){const{name:lt}=W;return function(Yt){const vt=this[lt];w.call(this,Yt),this.requestUpdate(lt,vt,Y)}}throw Error("Unsupported decorator location: "+F)};function n(Y){return(w,W)=>typeof W=="object"?r$1(Y,w,W):((F,O,ut)=>{const lt=O.hasOwnProperty(ut);return O.constructor.createProperty(ut,F),lt?Object.getOwnPropertyDescriptor(O,ut):void 0})(Y,w,W)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function r(Y){return n({...Y,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const e$1=(Y,w,W)=>(W.configurable=!0,W.enumerable=!0,Reflect.decorate&&typeof w!="object"&&Object.defineProperty(Y,w,W),W);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function e(Y,w){return(W,F,O)=>{const ut=lt=>lt.renderRoot?.querySelector(Y)??null;return e$1(W,F,{get(){return ut(this)}})}}class ApiError extends Error{constructor(w,W,F){super(w),this.status=W,this.details=F,this.name="ApiError"}}class ApiClient{constructor(){this.baseUrl=""}async createSession(w){const W=new FormData;W.append("file",w);const F=await fetch(`${this.baseUrl}/sessions/new`,{method:"POST",body:W});if(!F.ok)throw new ApiError(`Failed to create session: ${F.statusText}`,F.status);return F.json()}async createSessionFromZotero(w){const W=await fetch(`${this.baseUrl}/sessions/new`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({zotero_key:w})});if(!W.ok)throw new ApiError(`Failed to create session from Zotero: ${W.statusText}`,W.status);return W.json()}async getSession(w){const W=await fetch(`${this.baseUrl}/sessions/${w}`);if(!W.ok)throw new ApiError(`Failed to get session: ${W.statusText}`,W.status);return W.json()}async getOutline(w){const W=await fetch(`${this.baseUrl}/sessions/${w}/outline`);if(!W.ok){if(W.status===404)return[];throw new ApiError(`Failed to get outline: ${W.statusText}`,W.status)}return W.json()}async getConcepts(w){const W=await fetch(`${this.baseUrl}/sessions/${w}/concepts`);if(!W.ok){if(W.status===404)return[];throw new ApiError(`Failed to get concepts: ${W.statusText}`,W.status)}return W.json()}async listSessions(w=50,W=0){const F=await fetch(`${this.baseUrl}/sessions?limit=${w}&offset=${W}`);if(!F.ok)throw new ApiError(`Failed to list sessions: ${F.statusText}`,F.status);return(await F.json()).sessions||[]}async query(w,W){const F=await fetch(`${this.baseUrl}/sessions/${w}/query`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(W)});if(!F.ok){const O=await F.json().catch(()=>({}));throw new ApiError(O.detail||`Query failed: ${F.statusText}`,F.status,O)}return F.json()}async toggleFlag(w,W,F){const O=await fetch(`${this.baseUrl}/sessions/${w}/exchanges/${W}/flag`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({note:F})});if(!O.ok)throw new ApiError(`Failed to toggle flag: ${O.statusText}`,O.status)}async unflag(w,W){const F=await fetch(`${this.baseUrl}/sessions/${w}/exchanges/${W}/flag`,{method:"DELETE"});if(!F.ok)throw new ApiError(`Failed to unflag: ${F.statusText}`,F.status)}async deleteSession(w){const W=await fetch(`${this.baseUrl}/sessions/${w}`,{method:"DELETE"});if(!W.ok)throw new ApiError(`Failed to delete session: ${W.statusText}`,W.status)}async exportSession(w){const W=await fetch(`${this.baseUrl}/sessions/${w}/export`);if(!W.ok)throw new ApiError(`Failed to export session: ${W.statusText}`,W.status);return W.text()}async searchZotero(w,W=20){const F=await fetch(`${this.baseUrl}/zotero/search?query=${encodeURIComponent(w)}&limit=${W}`);if(!F.ok)throw new ApiError(`Zotero search failed: ${F.statusText}`,F.status);return F.json()}async getRecentPapers(w=20){const W=await fetch(`${this.baseUrl}/zotero/recent?limit=${w}`);if(!W.ok)throw new ApiError(`Failed to get recent papers: ${W.statusText}`,W.status);return W.json()}}const api=new ApiClient,STORAGE_KEY="paper-companion-prefs",DEFAULT_PREFERENCES={activeTab:"ask",pdfZoom:1.5,theme:"light"};class SessionStorage{constructor(){this.preferences=this.load()}load(){try{const w=localStorage.getItem(STORAGE_KEY);if(w)return{...DEFAULT_PREFERENCES,...JSON.parse(w)}}catch(w){console.error("Failed to load preferences:",w)}return{...DEFAULT_PREFERENCES}}save(){try{localStorage.setItem(STORAGE_KEY,JSON.stringify(this.preferences))}catch(w){console.error("Failed to save preferences:",w)}}getPreferences(){return{...this.preferences}}getLastSessionId(){return this.preferences.lastSessionId}setLastSessionId(w){this.preferences.lastSessionId=w,this.save()}clearLastSessionId(){this.preferences.lastSessionId=void 0,this.save()}getActiveTab(){return this.preferences.activeTab}setActiveTab(w){this.preferences.activeTab=w,this.save()}getPdfZoom(){return this.preferences.pdfZoom}setPdfZoom(w){this.preferences.pdfZoom=Math.max(.5,Math.min(3,w)),this.save()}getTheme(){return this.preferences.theme}setTheme(w){this.preferences.theme=w,this.save()}reset(){this.preferences={...DEFAULT_PREFERENCES},this.save()}}const sessionStorage=new SessionStorage;function getAugmentedNamespace(Y){if(Y.__esModule)return Y;var w=Y.default;if(typeof w=="function"){var W=function F(){return this instanceof F?Reflect.construct(w,arguments,this.constructor):w.apply(this,arguments)};W.prototype=w.prototype}else W={};return Object.defineProperty(W,"__esModule",{value:!0}),Object.keys(Y).forEach(function(F){var O=Object.getOwnPropertyDescriptor(Y,F);Object.defineProperty(W,F,O.get?O:{enumerable:!0,get:function(){return Y[F]}})}),W}function commonjsRequire(Y){throw new Error('Could not dynamically require "'+Y+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports$1){(function(w,W){module.exports=w.pdfjsLib=W()})(globalThis,()=>(()=>{var __webpack_modules__=[,(Y,w)=>{var Re;Object.defineProperty(w,"__esModule",{value:!0}),w.VerbosityLevel=w.Util=w.UnknownErrorException=w.UnexpectedResponseException=w.TextRenderingMode=w.RenderingIntentFlag=w.PromiseCapability=w.PermissionFlag=w.PasswordResponses=w.PasswordException=w.PageActionEventType=w.OPS=w.MissingPDFException=w.MAX_IMAGE_SIZE_TO_CACHE=w.LINE_FACTOR=w.LINE_DESCENT_FACTOR=w.InvalidPDFException=w.ImageKind=w.IDENTITY_MATRIX=w.FormatError=w.FeatureTest=w.FONT_IDENTITY_MATRIX=w.DocumentActionEventType=w.CMapCompressionType=w.BaseException=w.BASELINE_FACTOR=w.AnnotationType=w.AnnotationReplyType=w.AnnotationPrefix=w.AnnotationMode=w.AnnotationFlag=w.AnnotationFieldFlag=w.AnnotationEditorType=w.AnnotationEditorPrefix=w.AnnotationEditorParamsType=w.AnnotationBorderStyleType=w.AnnotationActionEventType=w.AbortException=void 0,w.assert=xt,w.bytesToString=Jt,w.createValidAbsoluteUrl=Nt,w.getModificationDate=de,w.getUuid=we,w.getVerbosityLevel=Ot,w.info=Bt,w.isArrayBuffer=Lt,w.isArrayEqual=he,w.isNodeJS=void 0,w.normalizeUnicode=be,w.objectFromMap=ae,w.objectSize=ne,w.setVerbosityLevel=Xt,w.shadow=dt,w.string32=se,w.stringToBytes=te,w.stringToPDFString=Zt,w.stringToUTF8String=re,w.unreachable=Vt,w.utf8StringToString=oe,w.warn=Mt;const W=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");w.isNodeJS=W;const F=[1,0,0,1,0,0];w.IDENTITY_MATRIX=F;const O=[.001,0,0,.001,0,0];w.FONT_IDENTITY_MATRIX=O;const ut=1e7;w.MAX_IMAGE_SIZE_TO_CACHE=ut;const lt=1.35;w.LINE_FACTOR=lt;const Yt=.35;w.LINE_DESCENT_FACTOR=Yt;const vt=Yt/lt;w.BASELINE_FACTOR=vt;const pt={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};w.RenderingIntentFlag=pt;const tt={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};w.AnnotationMode=tt;const _t="pdfjs_internal_editor_";w.AnnotationEditorPrefix=_t;const Ct={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};w.AnnotationEditorType=Ct;const at={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};w.AnnotationEditorParamsType=at;const ct={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};w.PermissionFlag=ct;const mt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};w.TextRenderingMode=mt;const st={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};w.ImageKind=st;const Z={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};w.AnnotationType=Z;const nt={GROUP:"Group",REPLY:"R"};w.AnnotationReplyType=nt;const Et={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};w.AnnotationFlag=Et;const ot={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};w.AnnotationFieldFlag=ot;const K={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};w.AnnotationBorderStyleType=K;const q={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};w.AnnotationActionEventType=q;const U={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};w.DocumentActionEventType=U;const rt={O:"PageOpen",C:"PageClose"};w.PageActionEventType=rt;const J={ERRORS:0,WARNINGS:1,INFOS:5};w.VerbosityLevel=J;const Rt={NONE:0,BINARY:1};w.CMapCompressionType=Rt;const Q={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};w.OPS=Q;const ft={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};w.PasswordResponses=ft;let Tt=J.WARNINGS;function Xt(le){Number.isInteger(le)&&(Tt=le)}function Ot(){return Tt}function Bt(le){Tt>=J.INFOS&&console.log(`Info: ${le}`)}function Mt(le){Tt>=J.WARNINGS&&console.log(`Warning: ${le}`)}function Vt(le){throw new Error(le)}function xt(le,Gt){le||Vt(Gt)}function Dt(le){switch(le?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Nt(le,Gt=null,qt=null){if(!le)return null;try{if(qt&&typeof le=="string"&&(qt.addDefaultProtocol&&le.startsWith("www.")&&le.match(/\./g)?.length>=2&&(le=`http://${le}`),qt.tryConvertEncoding))try{le=re(le)}catch{}const me=Gt?new URL(le,Gt):new URL(le);if(Dt(me))return me}catch{}return null}function dt(le,Gt,qt,me=!1){return Object.defineProperty(le,Gt,{value:qt,enumerable:!me,configurable:!0,writable:!1}),qt}const G=function(){function Gt(qt,me){this.constructor===Gt&&Vt("Cannot initialize BaseException."),this.message=qt,this.name=me}return Gt.prototype=new Error,Gt.constructor=Gt,Gt}();w.BaseException=G;class X extends G{constructor(Gt,qt){super(Gt,"PasswordException"),this.code=qt}}w.PasswordException=X;class et extends G{constructor(Gt,qt){super(Gt,"UnknownErrorException"),this.details=qt}}w.UnknownErrorException=et;class bt extends G{constructor(Gt){super(Gt,"InvalidPDFException")}}w.InvalidPDFException=bt;class yt extends G{constructor(Gt){super(Gt,"MissingPDFException")}}w.MissingPDFException=yt;class At extends G{constructor(Gt,qt){super(Gt,"UnexpectedResponseException"),this.status=qt}}w.UnexpectedResponseException=At;class kt extends G{constructor(Gt){super(Gt,"FormatError")}}w.FormatError=kt;class Wt extends G{constructor(Gt){super(Gt,"AbortException")}}w.AbortException=Wt;function Jt(le){(typeof le!="object"||le?.length===void 0)&&Vt("Invalid argument for bytesToString");const Gt=le.length,qt=8192;if(Gt<qt)return String.fromCharCode.apply(null,le);const me=[];for(let Me=0;Me<Gt;Me+=qt){const Te=Math.min(Me+qt,Gt),wt=le.subarray(Me,Te);me.push(String.fromCharCode.apply(null,wt))}return me.join("")}function te(le){typeof le!="string"&&Vt("Invalid argument for stringToBytes");const Gt=le.length,qt=new Uint8Array(Gt);for(let me=0;me<Gt;++me)qt[me]=le.charCodeAt(me)&255;return qt}function se(le){return String.fromCharCode(le>>24&255,le>>16&255,le>>8&255,le&255)}function ne(le){return Object.keys(le).length}function ae(le){const Gt=Object.create(null);for(const[qt,me]of le)Gt[qt]=me;return Gt}function $t(){const le=new Uint8Array(4);return le[0]=1,new Uint32Array(le.buffer,0,1)[0]===1}function Ut(){try{return new Function(""),!0}catch{return!1}}class it{static get isLittleEndian(){return dt(this,"isLittleEndian",$t())}static get isEvalSupported(){return dt(this,"isEvalSupported",Ut())}static get isOffscreenCanvasSupported(){return dt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?dt(this,"platform",{isWin:!1,isMac:!1}):dt(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){return dt(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}w.FeatureTest=it;const St=[...Array(256).keys()].map(le=>le.toString(16).padStart(2,"0"));class It{static makeHexColor(Gt,qt,me){return`#${St[Gt]}${St[qt]}${St[me]}`}static scaleMinMax(Gt,qt){let me;Gt[0]?(Gt[0]<0&&(me=qt[0],qt[0]=qt[1],qt[1]=me),qt[0]*=Gt[0],qt[1]*=Gt[0],Gt[3]<0&&(me=qt[2],qt[2]=qt[3],qt[3]=me),qt[2]*=Gt[3],qt[3]*=Gt[3]):(me=qt[0],qt[0]=qt[2],qt[2]=me,me=qt[1],qt[1]=qt[3],qt[3]=me,Gt[1]<0&&(me=qt[2],qt[2]=qt[3],qt[3]=me),qt[2]*=Gt[1],qt[3]*=Gt[1],Gt[2]<0&&(me=qt[0],qt[0]=qt[1],qt[1]=me),qt[0]*=Gt[2],qt[1]*=Gt[2]),qt[0]+=Gt[4],qt[1]+=Gt[4],qt[2]+=Gt[5],qt[3]+=Gt[5]}static transform(Gt,qt){return[Gt[0]*qt[0]+Gt[2]*qt[1],Gt[1]*qt[0]+Gt[3]*qt[1],Gt[0]*qt[2]+Gt[2]*qt[3],Gt[1]*qt[2]+Gt[3]*qt[3],Gt[0]*qt[4]+Gt[2]*qt[5]+Gt[4],Gt[1]*qt[4]+Gt[3]*qt[5]+Gt[5]]}static applyTransform(Gt,qt){const me=Gt[0]*qt[0]+Gt[1]*qt[2]+qt[4],Me=Gt[0]*qt[1]+Gt[1]*qt[3]+qt[5];return[me,Me]}static applyInverseTransform(Gt,qt){const me=qt[0]*qt[3]-qt[1]*qt[2],Me=(Gt[0]*qt[3]-Gt[1]*qt[2]+qt[2]*qt[5]-qt[4]*qt[3])/me,Te=(-Gt[0]*qt[1]+Gt[1]*qt[0]+qt[4]*qt[1]-qt[5]*qt[0])/me;return[Me,Te]}static getAxialAlignedBoundingBox(Gt,qt){const me=this.applyTransform(Gt,qt),Me=this.applyTransform(Gt.slice(2,4),qt),Te=this.applyTransform([Gt[0],Gt[3]],qt),wt=this.applyTransform([Gt[2],Gt[1]],qt);return[Math.min(me[0],Me[0],Te[0],wt[0]),Math.min(me[1],Me[1],Te[1],wt[1]),Math.max(me[0],Me[0],Te[0],wt[0]),Math.max(me[1],Me[1],Te[1],wt[1])]}static inverseTransform(Gt){const qt=Gt[0]*Gt[3]-Gt[1]*Gt[2];return[Gt[3]/qt,-Gt[1]/qt,-Gt[2]/qt,Gt[0]/qt,(Gt[2]*Gt[5]-Gt[4]*Gt[3])/qt,(Gt[4]*Gt[1]-Gt[5]*Gt[0])/qt]}static singularValueDecompose2dScale(Gt){const qt=[Gt[0],Gt[2],Gt[1],Gt[3]],me=Gt[0]*qt[0]+Gt[1]*qt[2],Me=Gt[0]*qt[1]+Gt[1]*qt[3],Te=Gt[2]*qt[0]+Gt[3]*qt[2],wt=Gt[2]*qt[1]+Gt[3]*qt[3],ie=(me+wt)/2,ue=Math.sqrt((me+wt)**2-4*(me*wt-Te*Me))/2,ye=ie+ue||1,Ae=ie-ue||1;return[Math.sqrt(ye),Math.sqrt(Ae)]}static normalizeRect(Gt){const qt=Gt.slice(0);return Gt[0]>Gt[2]&&(qt[0]=Gt[2],qt[2]=Gt[0]),Gt[1]>Gt[3]&&(qt[1]=Gt[3],qt[3]=Gt[1]),qt}static intersect(Gt,qt){const me=Math.max(Math.min(Gt[0],Gt[2]),Math.min(qt[0],qt[2])),Me=Math.min(Math.max(Gt[0],Gt[2]),Math.max(qt[0],qt[2]));if(me>Me)return null;const Te=Math.max(Math.min(Gt[1],Gt[3]),Math.min(qt[1],qt[3])),wt=Math.min(Math.max(Gt[1],Gt[3]),Math.max(qt[1],qt[3]));return Te>wt?null:[me,Te,Me,wt]}static bezierBoundingBox(Gt,qt,me,Me,Te,wt,ie,ue){const ye=[],Ae=[[],[]];let ge,gt,ht,Pt,Kt,Qt,ee,ce;for(let fe=0;fe<2;++fe){if(fe===0?(gt=6*Gt-12*me+6*Te,ge=-3*Gt+9*me-9*Te+3*ie,ht=3*me-3*Gt):(gt=6*qt-12*Me+6*wt,ge=-3*qt+9*Me-9*wt+3*ue,ht=3*Me-3*qt),Math.abs(ge)<1e-12){if(Math.abs(gt)<1e-12)continue;Pt=-ht/gt,0<Pt&&Pt<1&&ye.push(Pt);continue}ee=gt*gt-4*ht*ge,ce=Math.sqrt(ee),!(ee<0)&&(Kt=(-gt+ce)/(2*ge),0<Kt&&Kt<1&&ye.push(Kt),Qt=(-gt-ce)/(2*ge),0<Qt&&Qt<1&&ye.push(Qt))}let pe=ye.length,Se;const ve=pe;for(;pe--;)Pt=ye[pe],Se=1-Pt,Ae[0][pe]=Se*Se*Se*Gt+3*Se*Se*Pt*me+3*Se*Pt*Pt*Te+Pt*Pt*Pt*ie,Ae[1][pe]=Se*Se*Se*qt+3*Se*Se*Pt*Me+3*Se*Pt*Pt*wt+Pt*Pt*Pt*ue;return Ae[0][ve]=Gt,Ae[1][ve]=qt,Ae[0][ve+1]=ie,Ae[1][ve+1]=ue,Ae[0].length=Ae[1].length=ve+2,[Math.min(...Ae[0]),Math.min(...Ae[1]),Math.max(...Ae[0]),Math.max(...Ae[1])]}}w.Util=It;const jt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function Zt(le){if(le[0]>="ï"){let qt;if(le[0]==="þ"&&le[1]==="ÿ"?qt="utf-16be":le[0]==="ÿ"&&le[1]==="þ"?qt="utf-16le":le[0]==="ï"&&le[1]==="»"&&le[2]==="¿"&&(qt="utf-8"),qt)try{const me=new TextDecoder(qt,{fatal:!0}),Me=te(le);return me.decode(Me)}catch(me){Mt(`stringToPDFString: "${me}".`)}}const Gt=[];for(let qt=0,me=le.length;qt<me;qt++){const Me=jt[le.charCodeAt(qt)];Gt.push(Me?String.fromCharCode(Me):le.charAt(qt))}return Gt.join("")}function re(le){return decodeURIComponent(escape(le))}function oe(le){return unescape(encodeURIComponent(le))}function Lt(le){return typeof le=="object"&&le?.byteLength!==void 0}function he(le,Gt){if(le.length!==Gt.length)return!1;for(let qt=0,me=le.length;qt<me;qt++)if(le[qt]!==Gt[qt])return!1;return!0}function de(le=new Date){return[le.getUTCFullYear().toString(),(le.getUTCMonth()+1).toString().padStart(2,"0"),le.getUTCDate().toString().padStart(2,"0"),le.getUTCHours().toString().padStart(2,"0"),le.getUTCMinutes().toString().padStart(2,"0"),le.getUTCSeconds().toString().padStart(2,"0")].join("")}class Ce{constructor(){Ht(this,Re,!1);this.promise=new Promise((Gt,qt)=>{this.resolve=me=>{zt(this,Re,!0),Gt(me)},this.reject=me=>{zt(this,Re,!0),qt(me)}})}get settled(){return D(this,Re)}}Re=new WeakMap,w.PromiseCapability=Ce;let Ee=null,Fe=null;function be(le){return Ee||(Ee=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Fe=new Map([["ﬅ","ſt"]])),le.replaceAll(Ee,(Gt,qt,me)=>qt?qt.normalize("NFKC"):Fe.get(me))}function we(){if(typeof crypto<"u"&&typeof crypto?.randomUUID=="function")return crypto.randomUUID();const le=new Uint8Array(32);if(typeof crypto<"u"&&typeof crypto?.getRandomValues=="function")crypto.getRandomValues(le);else for(let Gt=0;Gt<32;Gt++)le[Gt]=Math.floor(Math.random()*255);return Jt(le)}const ke="pdfjs_internal_id_";w.AnnotationPrefix=ke},(__unused_webpack_module,exports$1,__w_pdfjs_require__)=>{var Y,W,F,O,He,is,Yt,vt,pt,tt,_t,Ct,at,ct,ns,st,Z,_s,Et,ot;Object.defineProperty(exports$1,"__esModule",{value:!0}),exports$1.RenderTask=exports$1.PDFWorkerUtil=exports$1.PDFWorker=exports$1.PDFPageProxy=exports$1.PDFDocumentProxy=exports$1.PDFDocumentLoadingTask=exports$1.PDFDataRangeTransport=exports$1.LoopbackPort=exports$1.DefaultStandardFontDataFactory=exports$1.DefaultFilterFactory=exports$1.DefaultCanvasFactory=exports$1.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports$1,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports$1.build=void 0,exports$1.getDocument=getDocument,exports$1.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports$1.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports$1.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports$1.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports$1.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(q){if(typeof q=="string"||q instanceof URL?q={url:q}:(0,_util.isArrayBuffer)(q)&&(q={data:q}),typeof q!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!q.url&&!q.data&&!q.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const U=new PDFDocumentLoadingTask,{docId:rt}=U,J=q.url?getUrlProp(q.url):null,Rt=q.data?getDataProp(q.data):null,Q=q.httpHeaders||null,ft=q.withCredentials===!0,Tt=q.password??null,Xt=q.range instanceof PDFDataRangeTransport?q.range:null,Ot=Number.isInteger(q.rangeChunkSize)&&q.rangeChunkSize>0?q.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let Bt=q.worker instanceof PDFWorker?q.worker:null;const Mt=q.verbosity,Vt=typeof q.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(q.docBaseUrl)?q.docBaseUrl:null,xt=typeof q.cMapUrl=="string"?q.cMapUrl:null,Dt=q.cMapPacked!==!1,Nt=q.CMapReaderFactory||DefaultCMapReaderFactory,dt=typeof q.standardFontDataUrl=="string"?q.standardFontDataUrl:null,G=q.StandardFontDataFactory||DefaultStandardFontDataFactory,X=q.stopAtErrors!==!0,et=Number.isInteger(q.maxImageSize)&&q.maxImageSize>-1?q.maxImageSize:-1,bt=q.isEvalSupported!==!1,yt=typeof q.isOffscreenCanvasSupported=="boolean"?q.isOffscreenCanvasSupported:!_util.isNodeJS,At=Number.isInteger(q.canvasMaxAreaInBytes)?q.canvasMaxAreaInBytes:-1,kt=typeof q.disableFontFace=="boolean"?q.disableFontFace:_util.isNodeJS,Wt=q.fontExtraProperties===!0,Jt=q.enableXfa===!0,te=q.ownerDocument||globalThis.document,se=q.disableRange===!0,ne=q.disableStream===!0,ae=q.disableAutoFetch===!0,$t=q.pdfBug===!0,Ut=Xt?Xt.length:q.length??NaN,it=typeof q.useSystemFonts=="boolean"?q.useSystemFonts:!_util.isNodeJS&&!kt,St=typeof q.useWorkerFetch=="boolean"?q.useWorkerFetch:Nt===_display_utils.DOMCMapReaderFactory&&G===_display_utils.DOMStandardFontDataFactory&&xt&&dt&&(0,_display_utils.isValidFetchUrl)(xt,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(dt,document.baseURI),It=q.canvasFactory||new DefaultCanvasFactory({ownerDocument:te}),jt=q.filterFactory||new DefaultFilterFactory({docId:rt,ownerDocument:te}),Zt=null;(0,_util.setVerbosityLevel)(Mt);const re={canvasFactory:It,filterFactory:jt};if(St||(re.cMapReaderFactory=new Nt({baseUrl:xt,isCompressed:Dt}),re.standardFontDataFactory=new G({baseUrl:dt})),!Bt){const he={verbosity:Mt,port:_worker_options.GlobalWorkerOptions.workerPort};Bt=he.port?PDFWorker.fromPort(he):new PDFWorker(he),U._worker=Bt}const oe={docId:rt,apiVersion:"3.11.174",data:Rt,password:Tt,disableAutoFetch:ae,rangeChunkSize:Ot,length:Ut,docBaseUrl:Vt,enableXfa:Jt,evaluatorOptions:{maxImageSize:et,disableFontFace:kt,ignoreErrors:X,isEvalSupported:bt,isOffscreenCanvasSupported:yt,canvasMaxAreaInBytes:At,fontExtraProperties:Wt,useSystemFonts:it,cMapUrl:St?xt:null,standardFontDataUrl:St?dt:null}},Lt={ignoreErrors:X,isEvalSupported:bt,disableFontFace:kt,fontExtraProperties:Wt,enableXfa:Jt,ownerDocument:te,disableAutoFetch:ae,pdfBug:$t,styleElement:Zt};return Bt.promise.then(function(){if(U.destroyed)throw new Error("Loading aborted");const he=_fetchDocument(Bt,oe),de=new Promise(function(Ce){let Ee;Xt?Ee=new _transport_stream.PDFDataTransportStream({length:Ut,initialData:Xt.initialData,progressiveDone:Xt.progressiveDone,contentDispositionFilename:Xt.contentDispositionFilename,disableRange:se,disableStream:ne},Xt):Rt||(Ee=(be=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(be):(0,_display_utils.isValidFetchUrl)(be.url)?new _displayFetch_stream.PDFFetchStream(be):new _displayNetwork.PDFNetworkStream(be))({url:J,length:Ut,httpHeaders:Q,withCredentials:ft,rangeChunkSize:Ot,disableRange:se,disableStream:ne})),Ce(Ee)});return Promise.all([he,de]).then(function([Ce,Ee]){if(U.destroyed)throw new Error("Loading aborted");const Fe=new _message_handler.MessageHandler(rt,Ce,Bt.port),be=new WorkerTransport(Fe,U,Ee,Lt,re);U._transport=be,Fe.send("Ready",null)})}).catch(U._capability.reject),U}async function _fetchDocument(q,U){if(q.destroyed)throw new Error("Worker was destroyed");const rt=await q.messageHandler.sendWithPromise("GetDocRequest",U,U.data?[U.data.buffer]:null);if(q.destroyed)throw new Error("Worker was destroyed");return rt}function getUrlProp(q){if(q instanceof URL)return q.href;try{return new URL(q,window.location).href}catch{if(_util.isNodeJS&&typeof q=="string")return q}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(q){if(_util.isNodeJS&&typeof Buffer<"u"&&q instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(q instanceof Uint8Array&&q.byteLength===q.buffer.byteLength)return q;if(typeof q=="string")return(0,_util.stringToBytes)(q);if(typeof q=="object"&&!isNaN(q?.length)||(0,_util.isArrayBuffer)(q))return new Uint8Array(q);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const w=class w{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${Ye(w,Y)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(U){throw this._worker?.port&&delete this._worker._pendingDestroy,U}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};Y=new WeakMap,Ht(w,Y,0);let PDFDocumentLoadingTask=w;exports$1.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(U,rt,J=!1,Rt=null){this.length=U,this.initialData=rt,this.progressiveDone=J,this.contentDispositionFilename=Rt,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(U){this._rangeListeners.push(U)}addProgressListener(U){this._progressListeners.push(U)}addProgressiveReadListener(U){this._progressiveReadListeners.push(U)}addProgressiveDoneListener(U){this._progressiveDoneListeners.push(U)}onDataRange(U,rt){for(const J of this._rangeListeners)J(U,rt)}onDataProgress(U,rt){this._readyCapability.promise.then(()=>{for(const J of this._progressListeners)J(U,rt)})}onDataProgressiveRead(U){this._readyCapability.promise.then(()=>{for(const rt of this._progressiveReadListeners)rt(U)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const U of this._progressiveDoneListeners)U()})}transportReady(){this._readyCapability.resolve()}requestDataRange(U,rt){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports$1.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(U,rt){this._pdfInfo=U,this._transport=rt,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(J=>{if(!J)return J;const Rt=[];for(const Q in J)Rt.push(...J[Q]);return Rt}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(U){return this._transport.getPage(U)}getPageIndex(U){return this._transport.getPageIndex(U)}getDestinations(){return this._transport.getDestinations()}getDestination(U){return this._transport.getDestination(U)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(U=!1){return this._transport.startCleanup(U||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports$1.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(U,rt,J,Rt=!1){Ht(this,O);Ht(this,W,null);Ht(this,F,!1);this._pageIndex=U,this._pageInfo=rt,this._transport=J,this._stats=Rt?new _display_utils.StatTimer:null,this._pdfBug=Rt,this.commonObjs=J.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:U,rotation:rt=this.rotate,offsetX:J=0,offsetY:Rt=0,dontFlip:Q=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:U,rotation:rt,offsetX:J,offsetY:Rt,dontFlip:Q})}getAnnotations({intent:U="display"}={}){const rt=this._transport.getRenderingIntent(U);return this._transport.getAnnotations(this._pageIndex,rt.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:U,viewport:rt,intent:J="display",annotationMode:Rt=_util.AnnotationMode.ENABLE,transform:Q=null,background:ft=null,optionalContentConfigPromise:Tt=null,annotationCanvasMap:Xt=null,pageColors:Ot=null,printAnnotationStorage:Bt=null}){this._stats?.time("Overall");const Mt=this._transport.getRenderingIntent(J,Rt,Bt);zt(this,F,!1),Ft(this,O,is).call(this),Tt||(Tt=this._transport.getOptionalContentConfig());let Vt=this._intentStates.get(Mt.cacheKey);Vt||(Vt=Object.create(null),this._intentStates.set(Mt.cacheKey,Vt)),Vt.streamReaderCancelTimeout&&(clearTimeout(Vt.streamReaderCancelTimeout),Vt.streamReaderCancelTimeout=null);const xt=!!(Mt.renderingIntent&_util.RenderingIntentFlag.PRINT);Vt.displayReadyCapability||(Vt.displayReadyCapability=new _util.PromiseCapability,Vt.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(Mt));const Dt=G=>{Vt.renderTasks.delete(Nt),(this._maybeCleanupAfterRender||xt)&&zt(this,F,!0),Ft(this,O,He).call(this,!xt),G?(Nt.capability.reject(G),this._abortOperatorList({intentState:Vt,reason:G instanceof Error?G:new Error(G)})):Nt.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},Nt=new InternalRenderTask({callback:Dt,params:{canvasContext:U,viewport:rt,transform:Q,background:ft},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:Xt,operatorList:Vt.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!xt,pdfBug:this._pdfBug,pageColors:Ot});(Vt.renderTasks||(Vt.renderTasks=new Set)).add(Nt);const dt=Nt.task;return Promise.all([Vt.displayReadyCapability.promise,Tt]).then(([G,X])=>{if(this.destroyed){Dt();return}this._stats?.time("Rendering"),Nt.initializeGraphics({transparency:G,optionalContentConfig:X}),Nt.operatorListChanged()}).catch(Dt),dt}getOperatorList({intent:U="display",annotationMode:rt=_util.AnnotationMode.ENABLE,printAnnotationStorage:J=null}={}){function Rt(){ft.operatorList.lastChunk&&(ft.opListReadCapability.resolve(ft.operatorList),ft.renderTasks.delete(Tt))}const Q=this._transport.getRenderingIntent(U,rt,J,!0);let ft=this._intentStates.get(Q.cacheKey);ft||(ft=Object.create(null),this._intentStates.set(Q.cacheKey,ft));let Tt;return ft.opListReadCapability||(Tt=Object.create(null),Tt.operatorListChanged=Rt,ft.opListReadCapability=new _util.PromiseCapability,(ft.renderTasks||(ft.renderTasks=new Set)).add(Tt),ft.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(Q)),ft.opListReadCapability.promise}streamTextContent({includeMarkedContent:U=!1,disableNormalization:rt=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:U===!0,disableNormalization:rt===!0},{highWaterMark:100,size(Rt){return Rt.items.length}})}getTextContent(U={}){if(this._transport._htmlForXfa)return this.getXfa().then(J=>_xfa_text.XfaText.textContent(J));const rt=this.streamTextContent(U);return new Promise(function(J,Rt){function Q(){ft.read().then(function({value:Xt,done:Ot}){if(Ot){J(Tt);return}Object.assign(Tt.styles,Xt.styles),Tt.items.push(...Xt.items),Q()},Rt)}const ft=rt.getReader(),Tt={items:[],styles:Object.create(null)};Q()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const U=[];for(const rt of this._intentStates.values())if(this._abortOperatorList({intentState:rt,reason:new Error("Page was destroyed."),force:!0}),!rt.opListReadCapability)for(const J of rt.renderTasks)U.push(J.completed),J.cancel();return this.objs.clear(),zt(this,F,!1),Ft(this,O,is).call(this),Promise.all(U)}cleanup(U=!1){zt(this,F,!0);const rt=Ft(this,O,He).call(this,!1);return U&&rt&&this._stats&&(this._stats=new _display_utils.StatTimer),rt}_startRenderPage(U,rt){const J=this._intentStates.get(rt);J&&(this._stats?.timeEnd("Page Request"),J.displayReadyCapability?.resolve(U))}_renderPageChunk(U,rt){for(let J=0,Rt=U.length;J<Rt;J++)rt.operatorList.fnArray.push(U.fnArray[J]),rt.operatorList.argsArray.push(U.argsArray[J]);rt.operatorList.lastChunk=U.lastChunk,rt.operatorList.separateAnnots=U.separateAnnots;for(const J of rt.renderTasks)J.operatorListChanged();U.lastChunk&&Ft(this,O,He).call(this,!0)}_pumpOperatorList({renderingIntent:U,cacheKey:rt,annotationStorageSerializable:J}){const{map:Rt,transfers:Q}=J,Tt=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:U,cacheKey:rt,annotationStorage:Rt},Q).getReader(),Xt=this._intentStates.get(rt);Xt.streamReader=Tt;const Ot=()=>{Tt.read().then(({value:Bt,done:Mt})=>{if(Mt){Xt.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(Bt,Xt),Ot())},Bt=>{if(Xt.streamReader=null,!this._transport.destroyed){if(Xt.operatorList){Xt.operatorList.lastChunk=!0;for(const Mt of Xt.renderTasks)Mt.operatorListChanged();Ft(this,O,He).call(this,!0)}if(Xt.displayReadyCapability)Xt.displayReadyCapability.reject(Bt);else if(Xt.opListReadCapability)Xt.opListReadCapability.reject(Bt);else throw Bt}})};Ot()}_abortOperatorList({intentState:U,reason:rt,force:J=!1}){if(U.streamReader){if(U.streamReaderCancelTimeout&&(clearTimeout(U.streamReaderCancelTimeout),U.streamReaderCancelTimeout=null),!J){if(U.renderTasks.size>0)return;if(rt instanceof _display_utils.RenderingCancelledException){let Rt=RENDERING_CANCELLED_TIMEOUT;rt.extraDelay>0&&rt.extraDelay<1e3&&(Rt+=rt.extraDelay),U.streamReaderCancelTimeout=setTimeout(()=>{U.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:U,reason:rt,force:!0})},Rt);return}}if(U.streamReader.cancel(new _util.AbortException(rt.message)).catch(()=>{}),U.streamReader=null,!this._transport.destroyed){for(const[Rt,Q]of this._intentStates)if(Q===U){this._intentStates.delete(Rt);break}this.cleanup()}}}get stats(){return this._stats}}W=new WeakMap,F=new WeakMap,O=new WeakSet,He=function(U=!1){if(Ft(this,O,is).call(this),!D(this,F)||this.destroyed)return!1;if(U)return zt(this,W,setTimeout(()=>{zt(this,W,null),Ft(this,O,He).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:rt,operatorList:J}of this._intentStates.values())if(rt.size>0||!J.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),zt(this,F,!1),!0},is=function(){D(this,W)&&(clearTimeout(D(this,W)),zt(this,W,null))},exports$1.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){Ht(this,Yt,new Set);Ht(this,vt,Promise.resolve())}postMessage(U,rt){const J={data:structuredClone(U,rt?{transfer:rt}:null)};D(this,vt).then(()=>{for(const Rt of D(this,Yt))Rt.call(this,J)})}addEventListener(U,rt){D(this,Yt).add(rt)}removeEventListener(U,rt){D(this,Yt).delete(rt)}terminate(){D(this,Yt).clear()}}Yt=new WeakMap,vt=new WeakMap,exports$1.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports$1.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const q=document?.currentScript?.src;q&&(PDFWorkerUtil.fallbackWorkerSrc=q.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(q,U){let rt;try{if(rt=new URL(q),!rt.origin||rt.origin==="null")return!1}catch{return!1}const J=new URL(U,rt);return rt.origin===J.origin},PDFWorkerUtil.createCDNWrapper=function(q){const U=`importScripts("${q}");`;return URL.createObjectURL(new Blob([U]))}}const _PDFWorker=class _PDFWorker{constructor({name:q=null,port:U=null,verbosity:rt=(0,_util.getVerbosityLevel)()}={}){if(this.name=q,this.destroyed=!1,this.verbosity=rt,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,U){if(D(_PDFWorker,pt)?.has(U))throw new Error("Cannot use more than one PDFWorker per port.");(D(_PDFWorker,pt)||zt(_PDFWorker,pt,new WeakMap)).set(U,this),this._initializeFromPort(U);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(q){this._port=q,this._messageHandler=new _message_handler.MessageHandler("main","worker",q),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:q}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,q)||(q=PDFWorkerUtil.createCDNWrapper(new URL(q,window.location).href));const U=new Worker(q),rt=new _message_handler.MessageHandler("main","worker",U),J=()=>{U.removeEventListener("error",Rt),rt.destroy(),U.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},Rt=()=>{this._webWorker||J()};U.addEventListener("error",Rt),rt.on("test",ft=>{if(U.removeEventListener("error",Rt),this.destroyed){J();return}ft?(this._messageHandler=rt,this._port=U,this._webWorker=U,this._readyCapability.resolve(),rt.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),rt.destroy(),U.terminate())}),rt.on("ready",ft=>{if(U.removeEventListener("error",Rt),this.destroyed){J();return}try{Q()}catch{this._setupFakeWorker()}});const Q=()=>{const ft=new Uint8Array;rt.send("test",ft,[ft.buffer])};Q();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(q=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const U=new LoopbackPort;this._port=U;const rt=`fake${PDFWorkerUtil.fakeWorkerId++}`,J=new _message_handler.MessageHandler(rt+"_worker",rt,U);q.setup(J,U);const Rt=new _message_handler.MessageHandler(rt,rt+"_worker",U);this._messageHandler=Rt,this._readyCapability.resolve(),Rt.send("configure",{verbosity:this.verbosity})}).catch(q=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${q.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),D(_PDFWorker,pt)?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(q){if(!q?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const U=D(this,pt)?.get(q.port);if(U){if(U._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return U}return new _PDFWorker(q)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};pt=new WeakMap,Ht(_PDFWorker,pt);let PDFWorker=_PDFWorker;exports$1.PDFWorker=PDFWorker;class WorkerTransport{constructor(U,rt,J,Rt,Q){Ht(this,ct);Ht(this,tt,new Map);Ht(this,_t,new Map);Ht(this,Ct,new Map);Ht(this,at,null);this.messageHandler=U,this.loadingTask=rt,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:Rt.ownerDocument,styleElement:Rt.styleElement}),this._params=Rt,this.canvasFactory=Q.canvasFactory,this.filterFactory=Q.filterFactory,this.cMapReaderFactory=Q.cMapReaderFactory,this.standardFontDataFactory=Q.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=J,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(U,rt=_util.AnnotationMode.ENABLE,J=null,Rt=!1){let Q=_util.RenderingIntentFlag.DISPLAY,ft=_annotation_storage.SerializableEmpty;switch(U){case"any":Q=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":Q=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${U}`)}switch(rt){case _util.AnnotationMode.DISABLE:Q+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:Q+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:Q+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,ft=(Q&_util.RenderingIntentFlag.PRINT&&J instanceof _annotation_storage.PrintAnnotationStorage?J:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${rt}`)}return Rt&&(Q+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:Q,cacheKey:`${Q}_${ft.hash}`,annotationStorageSerializable:ft}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,D(this,at)?.reject(new Error("Worker was destroyed during onPassword callback"));const U=[];for(const J of D(this,_t).values())U.push(J._destroy());D(this,_t).clear(),D(this,Ct).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const rt=this.messageHandler.sendWithPromise("Terminate",null);return U.push(rt),Promise.all(U).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),D(this,tt).clear(),this.filterFactory.destroy(),this._networkStream?.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:U,loadingTask:rt}=this;U.on("GetReader",(J,Rt)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=Q=>{this._lastProgress={loaded:Q.loaded,total:Q.total}},Rt.onPull=()=>{this._fullReader.read().then(function({value:Q,done:ft}){if(ft){Rt.close();return}(0,_util.assert)(Q instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),Rt.enqueue(new Uint8Array(Q),1,[Q])}).catch(Q=>{Rt.error(Q)})},Rt.onCancel=Q=>{this._fullReader.cancel(Q),Rt.ready.catch(ft=>{if(!this.destroyed)throw ft})}}),U.on("ReaderHeadersReady",J=>{const Rt=new _util.PromiseCapability,Q=this._fullReader;return Q.headersReady.then(()=>{(!Q.isStreamingSupported||!Q.isRangeSupported)&&(this._lastProgress&&rt.onProgress?.(this._lastProgress),Q.onProgress=ft=>{rt.onProgress?.({loaded:ft.loaded,total:ft.total})}),Rt.resolve({isStreamingSupported:Q.isStreamingSupported,isRangeSupported:Q.isRangeSupported,contentLength:Q.contentLength})},Rt.reject),Rt.promise}),U.on("GetRangeReader",(J,Rt)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const Q=this._networkStream.getRangeReader(J.begin,J.end);if(!Q){Rt.close();return}Rt.onPull=()=>{Q.read().then(function({value:ft,done:Tt}){if(Tt){Rt.close();return}(0,_util.assert)(ft instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),Rt.enqueue(new Uint8Array(ft),1,[ft])}).catch(ft=>{Rt.error(ft)})},Rt.onCancel=ft=>{Q.cancel(ft),Rt.ready.catch(Tt=>{if(!this.destroyed)throw Tt})}}),U.on("GetDoc",({pdfInfo:J})=>{this._numPages=J.numPages,this._htmlForXfa=J.htmlForXfa,delete J.htmlForXfa,rt._capability.resolve(new PDFDocumentProxy(J,this))}),U.on("DocException",function(J){let Rt;switch(J.name){case"PasswordException":Rt=new _util.PasswordException(J.message,J.code);break;case"InvalidPDFException":Rt=new _util.InvalidPDFException(J.message);break;case"MissingPDFException":Rt=new _util.MissingPDFException(J.message);break;case"UnexpectedResponseException":Rt=new _util.UnexpectedResponseException(J.message,J.status);break;case"UnknownErrorException":Rt=new _util.UnknownErrorException(J.message,J.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}rt._capability.reject(Rt)}),U.on("PasswordRequest",J=>{if(zt(this,at,new _util.PromiseCapability),rt.onPassword){const Rt=Q=>{Q instanceof Error?D(this,at).reject(Q):D(this,at).resolve({password:Q})};try{rt.onPassword(Rt,J.code)}catch(Q){D(this,at).reject(Q)}}else D(this,at).reject(new _util.PasswordException(J.message,J.code));return D(this,at).promise}),U.on("DataLoaded",J=>{rt.onProgress?.({loaded:J.length,total:J.length}),this.downloadInfoCapability.resolve(J)}),U.on("StartRenderPage",J=>{if(this.destroyed)return;D(this,_t).get(J.pageIndex)._startRenderPage(J.transparency,J.cacheKey)}),U.on("commonobj",([J,Rt,Q])=>{if(!this.destroyed&&!this.commonObjs.has(J))switch(Rt){case"Font":const ft=this._params;if("error"in Q){const Ot=Q.error;(0,_util.warn)(`Error during font loading: ${Ot}`),this.commonObjs.resolve(J,Ot);break}const Tt=ft.pdfBug&&globalThis.FontInspector?.enabled?(Ot,Bt)=>globalThis.FontInspector.fontAdded(Ot,Bt):null,Xt=new _font_loader.FontFaceObject(Q,{isEvalSupported:ft.isEvalSupported,disableFontFace:ft.disableFontFace,ignoreErrors:ft.ignoreErrors,inspectFont:Tt});this.fontLoader.bind(Xt).catch(Ot=>U.sendWithPromise("FontFallback",{id:J})).finally(()=>{!ft.fontExtraProperties&&Xt.data&&(Xt.data=null),this.commonObjs.resolve(J,Xt)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(J,Q);break;default:throw new Error(`Got unknown common object type ${Rt}`)}}),U.on("obj",([J,Rt,Q,ft])=>{if(this.destroyed)return;const Tt=D(this,_t).get(Rt);if(!Tt.objs.has(J))switch(Q){case"Image":if(Tt.objs.resolve(J,ft),ft){let Xt;if(ft.bitmap){const{width:Ot,height:Bt}=ft;Xt=Ot*Bt*4}else Xt=ft.data?.length||0;Xt>_util.MAX_IMAGE_SIZE_TO_CACHE&&(Tt._maybeCleanupAfterRender=!0)}break;case"Pattern":Tt.objs.resolve(J,ft);break;default:throw new Error(`Got unknown object type ${Q}`)}}),U.on("DocProgress",J=>{this.destroyed||rt.onProgress?.({loaded:J.loaded,total:J.total})}),U.on("FetchBuiltInCMap",J=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(J):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),U.on("FetchStandardFontData",J=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(J):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:U,transfers:rt}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:U,filename:this._fullReader?.filename??null},rt).finally(()=>{this.annotationStorage.resetModified()})}getPage(U){if(!Number.isInteger(U)||U<=0||U>this._numPages)return Promise.reject(new Error("Invalid page request."));const rt=U-1,J=D(this,Ct).get(rt);if(J)return J;const Rt=this.messageHandler.sendWithPromise("GetPage",{pageIndex:rt}).then(Q=>{if(this.destroyed)throw new Error("Transport destroyed");const ft=new PDFPageProxy(rt,Q,this,this._params.pdfBug);return D(this,_t).set(rt,ft),ft});return D(this,Ct).set(rt,Rt),Rt}getPageIndex(U){return typeof U!="object"||U===null||!Number.isInteger(U.num)||U.num<0||!Number.isInteger(U.gen)||U.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:U.num,gen:U.gen})}getAnnotations(U,rt){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:U,intent:rt})}getFieldObjects(){return Ft(this,ct,ns).call(this,"GetFieldObjects")}hasJSActions(){return Ft(this,ct,ns).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(U){return typeof U!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:U})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return Ft(this,ct,ns).call(this,"GetDocJSActions")}getPageJSActions(U){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:U})}getStructTree(U){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:U})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(U=>new _optional_content_config.OptionalContentConfig(U))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const U="GetMetadata",rt=D(this,tt).get(U);if(rt)return rt;const J=this.messageHandler.sendWithPromise(U,null).then(Rt=>({info:Rt[0],metadata:Rt[1]?new _metadata.Metadata(Rt[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return D(this,tt).set(U,J),J}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(U=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const rt of D(this,_t).values())if(!rt.cleanup())throw new Error(`startCleanup: Page ${rt.pageNumber} is currently rendering.`);this.commonObjs.clear(),U||this.fontLoader.clear(),D(this,tt).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:U,enableXfa:rt}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:U,enableXfa:rt})}}tt=new WeakMap,_t=new WeakMap,Ct=new WeakMap,at=new WeakMap,ct=new WeakSet,ns=function(U,rt=null){const J=D(this,tt).get(U);if(J)return J;const Rt=this.messageHandler.sendWithPromise(U,rt);return D(this,tt).set(U,Rt),Rt};class PDFObjects{constructor(){Ht(this,Z);Ht(this,st,Object.create(null))}get(U,rt=null){if(rt){const Rt=Ft(this,Z,_s).call(this,U);return Rt.capability.promise.then(()=>rt(Rt.data)),null}const J=D(this,st)[U];if(!J?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${U}.`);return J.data}has(U){return D(this,st)[U]?.capability.settled||!1}resolve(U,rt=null){const J=Ft(this,Z,_s).call(this,U);J.data=rt,J.capability.resolve()}clear(){for(const U in D(this,st)){const{data:rt}=D(this,st)[U];rt?.bitmap?.close()}zt(this,st,Object.create(null))}}st=new WeakMap,Z=new WeakSet,_s=function(U){var rt;return(rt=D(this,st))[U]||(rt[U]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(U){Ht(this,Et,null);zt(this,Et,U),this.onContinue=null}get promise(){return D(this,Et).capability.promise}cancel(U=0){D(this,Et).cancel(null,U)}get separateAnnots(){const{separateAnnots:U}=D(this,Et).operatorList;if(!U)return!1;const{annotationCanvasMap:rt}=D(this,Et);return U.form||U.canvas&&rt?.size>0}}Et=new WeakMap,exports$1.RenderTask=RenderTask;const K=class K{constructor({callback:U,params:rt,objs:J,commonObjs:Rt,annotationCanvasMap:Q,operatorList:ft,pageIndex:Tt,canvasFactory:Xt,filterFactory:Ot,useRequestAnimationFrame:Bt=!1,pdfBug:Mt=!1,pageColors:Vt=null}){this.callback=U,this.params=rt,this.objs=J,this.commonObjs=Rt,this.annotationCanvasMap=Q,this.operatorListIdx=null,this.operatorList=ft,this._pageIndex=Tt,this.canvasFactory=Xt,this.filterFactory=Ot,this._pdfBug=Mt,this.pageColors=Vt,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=Bt===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=rt.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:U=!1,optionalContentConfig:rt}){if(this.cancelled)return;if(this._canvas){if(D(K,ot).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");D(K,ot).add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:J,viewport:Rt,transform:Q,background:ft}=this.params;this.gfx=new _canvas.CanvasGraphics(J,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:rt},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:Q,viewport:Rt,transparency:U,background:ft}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(U=null,rt=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),D(K,ot).delete(this._canvas),this.callback(U||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,rt))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),D(K,ot).delete(this._canvas),this.callback())))}};ot=new WeakMap,Ht(K,ot,new WeakSet);let InternalRenderTask=K;const version="3.11.174";exports$1.version=version;const build="ce8716743";exports$1.build=build},(Y,w,W)=>{var pt,tt,_t,ei,at;Object.defineProperty(w,"__esModule",{value:!0}),w.SerializableEmpty=w.PrintAnnotationStorage=w.AnnotationStorage=void 0;var F=W(1),O=W(4),ut=W(8);const lt=Object.freeze({map:null,hash:"",transfers:void 0});w.SerializableEmpty=lt;class Yt{constructor(){Ht(this,_t);Ht(this,pt,!1);Ht(this,tt,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(mt,st){const Z=D(this,tt).get(mt);return Z===void 0?st:Object.assign(st,Z)}getRawValue(mt){return D(this,tt).get(mt)}remove(mt){if(D(this,tt).delete(mt),D(this,tt).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const st of D(this,tt).values())if(st instanceof O.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(mt,st){const Z=D(this,tt).get(mt);let nt=!1;if(Z!==void 0)for(const[Et,ot]of Object.entries(st))Z[Et]!==ot&&(nt=!0,Z[Et]=ot);else nt=!0,D(this,tt).set(mt,st);nt&&Ft(this,_t,ei).call(this),st instanceof O.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(st.constructor._type)}has(mt){return D(this,tt).has(mt)}getAll(){return D(this,tt).size>0?(0,F.objectFromMap)(D(this,tt)):null}setAll(mt){for(const[st,Z]of Object.entries(mt))this.setValue(st,Z)}get size(){return D(this,tt).size}resetModified(){D(this,pt)&&(zt(this,pt,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new vt(this)}get serializable(){if(D(this,tt).size===0)return lt;const mt=new Map,st=new ut.MurmurHash3_64,Z=[],nt=Object.create(null);let Et=!1;for(const[ot,K]of D(this,tt)){const q=K instanceof O.AnnotationEditor?K.serialize(!1,nt):K;q&&(mt.set(ot,q),st.update(`${ot}:${JSON.stringify(q)}`),Et||(Et=!!q.bitmap))}if(Et)for(const ot of mt.values())ot.bitmap&&Z.push(ot.bitmap);return mt.size>0?{map:mt,hash:st.hexdigest(),transfers:Z}:lt}}pt=new WeakMap,tt=new WeakMap,_t=new WeakSet,ei=function(){D(this,pt)||(zt(this,pt,!0),typeof this.onSetModified=="function"&&this.onSetModified())},w.AnnotationStorage=Yt;class vt extends Yt{constructor(st){super();Ht(this,at);const{map:Z,hash:nt,transfers:Et}=st.serializable,ot=structuredClone(Z,Et?{transfer:Et}:null);zt(this,at,{map:ot,hash:nt,transfers:Et})}get print(){(0,F.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return D(this,at)}}at=new WeakMap,w.PrintAnnotationStorage=vt},(Y,w,W)=>{var vt,pt,tt,_t,Ct,at,ct,mt,st,Z,nt,Et,ot,K,q,ys,vs,J,As,Ss,si,ii,ni,xs,ri;Object.defineProperty(w,"__esModule",{value:!0}),w.AnnotationEditor=void 0;var F=W(5),O=W(1),ut=W(6);const Mt=class Mt{constructor(xt){Ht(this,q);Ht(this,vt,"");Ht(this,pt,!1);Ht(this,tt,null);Ht(this,_t,null);Ht(this,Ct,null);Ht(this,at,!1);Ht(this,ct,null);Ht(this,mt,this.focusin.bind(this));Ht(this,st,this.focusout.bind(this));Ht(this,Z,!1);Ht(this,nt,!1);Ht(this,Et,!1);Le(this,"_initialOptions",Object.create(null));Le(this,"_uiManager",null);Le(this,"_focusEventsAllowed",!0);Le(this,"_l10nPromise",null);Ht(this,ot,!1);Ht(this,K,Mt._zIndex++);this.constructor===Mt&&(0,O.unreachable)("Cannot initialize AnnotationEditor."),this.parent=xt.parent,this.id=xt.id,this.width=this.height=null,this.pageIndex=xt.parent.pageIndex,this.name=xt.name,this.div=null,this._uiManager=xt.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=xt.isCentered,this._structTreeParentId=null;const{rotation:Dt,rawDims:{pageWidth:Nt,pageHeight:dt,pageX:G,pageY:X}}=this.parent.viewport;this.rotation=Dt,this.pageRotation=(360+Dt-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[Nt,dt],this.pageTranslation=[G,X];const[et,bt]=this.parentDimensions;this.x=xt.x/et,this.y=xt.y/bt,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,O.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(xt){const Dt=new Yt({id:xt.parent.getNextId(),parent:xt.parent,uiManager:xt._uiManager});Dt.annotationElementId=xt.annotationElementId,Dt.deleted=!0,Dt._uiManager.addToAnnotationStorage(Dt)}static initialize(xt,Dt=null){if(Mt._l10nPromise||(Mt._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(dt=>[dt,xt.get(dt)]))),Dt?.strings)for(const dt of Dt.strings)Mt._l10nPromise.set(dt,xt.get(dt));if(Mt._borderLineWidth!==-1)return;const Nt=getComputedStyle(document.documentElement);Mt._borderLineWidth=parseFloat(Nt.getPropertyValue("--outline-width"))||0}static updateDefaultParams(xt,Dt){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(xt){return!1}static paste(xt,Dt){(0,O.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return D(this,ot)}set _isDraggable(xt){zt(this,ot,xt),this.div?.classList.toggle("draggable",xt)}center(){const[xt,Dt]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*Dt/(xt*2),this.y+=this.width*xt/(Dt*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*Dt/(xt*2),this.y-=this.width*xt/(Dt*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(xt){this._uiManager.addCommands(xt)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=D(this,K)}setParent(xt){xt!==null&&(this.pageIndex=xt.pageIndex,this.pageDimensions=xt.pageDimensions),this.parent=xt}focusin(xt){this._focusEventsAllowed&&(D(this,Z)?zt(this,Z,!1):this.parent.setSelected(this))}focusout(xt){!this._focusEventsAllowed||!this.isAttachedToDOM||xt.relatedTarget?.closest(`#${this.id}`)||(xt.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(xt,Dt,Nt,dt){const[G,X]=this.parentDimensions;[Nt,dt]=this.screenToPageTranslation(Nt,dt),this.x=(xt+Nt)/G,this.y=(Dt+dt)/X,this.fixAndSetPosition()}translate(xt,Dt){Ft(this,q,ys).call(this,this.parentDimensions,xt,Dt)}translateInPage(xt,Dt){Ft(this,q,ys).call(this,this.pageDimensions,xt,Dt),this.div.scrollIntoView({block:"nearest"})}drag(xt,Dt){const[Nt,dt]=this.parentDimensions;if(this.x+=xt/Nt,this.y+=Dt/dt,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:yt,y:At}=this.div.getBoundingClientRect();this.parent.findNewParent(this,yt,At)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:G,y:X}=this;const[et,bt]=Ft(this,q,vs).call(this);G+=et,X+=bt,this.div.style.left=`${(100*G).toFixed(2)}%`,this.div.style.top=`${(100*X).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[xt,Dt]=this.pageDimensions;let{x:Nt,y:dt,width:G,height:X}=this;switch(G*=xt,X*=Dt,Nt*=xt,dt*=Dt,this.rotation){case 0:Nt=Math.max(0,Math.min(xt-G,Nt)),dt=Math.max(0,Math.min(Dt-X,dt));break;case 90:Nt=Math.max(0,Math.min(xt-X,Nt)),dt=Math.min(Dt,Math.max(G,dt));break;case 180:Nt=Math.min(xt,Math.max(G,Nt)),dt=Math.min(Dt,Math.max(X,dt));break;case 270:Nt=Math.min(xt,Math.max(X,Nt)),dt=Math.max(0,Math.min(Dt-G,dt));break}this.x=Nt/=xt,this.y=dt/=Dt;const[et,bt]=Ft(this,q,vs).call(this);Nt+=et,dt+=bt;const{style:yt}=this.div;yt.left=`${(100*Nt).toFixed(2)}%`,yt.top=`${(100*dt).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(xt,Dt){var Nt;return Ft(Nt=Mt,J,As).call(Nt,xt,Dt,this.parentRotation)}pageTranslationToScreen(xt,Dt){var Nt;return Ft(Nt=Mt,J,As).call(Nt,xt,Dt,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:xt,pageDimensions:[Dt,Nt]}=this,dt=Dt*xt,G=Nt*xt;return O.FeatureTest.isCSSRoundSupported?[Math.round(dt),Math.round(G)]:[dt,G]}setDims(xt,Dt){const[Nt,dt]=this.parentDimensions;this.div.style.width=`${(100*xt/Nt).toFixed(2)}%`,D(this,at)||(this.div.style.height=`${(100*Dt/dt).toFixed(2)}%`),D(this,tt)?.classList.toggle("small",xt<Mt.SMALL_EDITOR_SIZE||Dt<Mt.SMALL_EDITOR_SIZE)}fixDims(){const{style:xt}=this.div,{height:Dt,width:Nt}=xt,dt=Nt.endsWith("%"),G=!D(this,at)&&Dt.endsWith("%");if(dt&&G)return;const[X,et]=this.parentDimensions;dt||(xt.width=`${(100*parseFloat(Nt)/X).toFixed(2)}%`),!D(this,at)&&!G&&(xt.height=`${(100*parseFloat(Dt)/et).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}async addAltTextButton(){if(D(this,tt))return;const xt=zt(this,tt,document.createElement("button"));xt.className="altText";const Dt=await Mt._l10nPromise.get("editor_alt_text_button_label");xt.textContent=Dt,xt.setAttribute("aria-label",Dt),xt.tabIndex="0",xt.addEventListener("contextmenu",ut.noContextMenu),xt.addEventListener("pointerdown",Nt=>Nt.stopPropagation()),xt.addEventListener("click",Nt=>{Nt.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),xt.addEventListener("keydown",Nt=>{Nt.target===xt&&Nt.key==="Enter"&&(Nt.preventDefault(),this._uiManager.editAltText(this))}),Ft(this,q,xs).call(this),this.div.append(xt),Mt.SMALL_EDITOR_SIZE||(Mt.SMALL_EDITOR_SIZE=Math.min(128,Math.round(xt.getBoundingClientRect().width*1.4)))}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:D(this,vt),decorative:D(this,pt)}}set altTextData({altText:xt,decorative:Dt}){D(this,vt)===xt&&D(this,pt)===Dt||(zt(this,vt,xt),zt(this,pt,Dt),Ft(this,q,xs).call(this))}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",D(this,mt)),this.div.addEventListener("focusout",D(this,st));const[xt,Dt]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*Dt/xt).toFixed(2)}%`,this.div.style.maxHeight=`${(100*xt/Dt).toFixed(2)}%`);const[Nt,dt]=this.getInitialTranslation();return this.translate(Nt,dt),(0,F.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(xt){const{isMac:Dt}=O.FeatureTest.platform;if(xt.button!==0||xt.ctrlKey&&Dt){xt.preventDefault();return}zt(this,Z,!0),Ft(this,q,ri).call(this,xt)}moveInDOM(){this.parent?.moveEditorInDOM(this)}_setParentAndPosition(xt,Dt,Nt){xt.changeParent(this),this.x=Dt,this.y=Nt,this.fixAndSetPosition()}getRect(xt,Dt){const Nt=this.parentScale,[dt,G]=this.pageDimensions,[X,et]=this.pageTranslation,bt=xt/Nt,yt=Dt/Nt,At=this.x*dt,kt=this.y*G,Wt=this.width*dt,Jt=this.height*G;switch(this.rotation){case 0:return[At+bt+X,G-kt-yt-Jt+et,At+bt+Wt+X,G-kt-yt+et];case 90:return[At+yt+X,G-kt+bt+et,At+yt+Jt+X,G-kt+bt+Wt+et];case 180:return[At-bt-Wt+X,G-kt+yt+et,At-bt+X,G-kt+yt+Jt+et];case 270:return[At-yt-Jt+X,G-kt-bt-Wt+et,At-yt+X,G-kt-bt+et];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(xt,Dt){const[Nt,dt,G,X]=xt,et=G-Nt,bt=X-dt;switch(this.rotation){case 0:return[Nt,Dt-X,et,bt];case 90:return[Nt,Dt-dt,bt,et];case 180:return[G,Dt-dt,et,bt];case 270:return[G,Dt-X,bt,et];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){zt(this,Et,!0)}disableEditMode(){zt(this,Et,!1)}isInEditMode(){return D(this,Et)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",D(this,mt)),this.div?.addEventListener("focusout",D(this,st))}serialize(xt=!1,Dt=null){(0,O.unreachable)("An editor must be serializable")}static deserialize(xt,Dt,Nt){const dt=new this.prototype.constructor({parent:Dt,id:Dt.getNextId(),uiManager:Nt});dt.rotation=xt.rotation;const[G,X]=dt.pageDimensions,[et,bt,yt,At]=dt.getRectInCurrentCoords(xt.rect,X);return dt.x=et/G,dt.y=bt/X,dt.width=yt/G,dt.height=At/X,dt}remove(){this.div.removeEventListener("focusin",D(this,mt)),this.div.removeEventListener("focusout",D(this,st)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),D(this,tt)?.remove(),zt(this,tt,null),zt(this,_t,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(Ft(this,q,si).call(this),D(this,ct).classList.remove("hidden"))}select(){this.makeResizable(),this.div?.classList.add("selectedEditor")}unselect(){D(this,ct)?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(xt,Dt){}disableEditing(){D(this,tt)&&(D(this,tt).hidden=!0)}enableEditing(){D(this,tt)&&(D(this,tt).hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return D(this,nt)}set isEditing(xt){zt(this,nt,xt),this.parent&&(xt?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(xt,Dt){zt(this,at,!0);const Nt=xt/Dt,{style:dt}=this.div;dt.aspectRatio=Nt,dt.height="auto"}static get MIN_SIZE(){return 16}};vt=new WeakMap,pt=new WeakMap,tt=new WeakMap,_t=new WeakMap,Ct=new WeakMap,at=new WeakMap,ct=new WeakMap,mt=new WeakMap,st=new WeakMap,Z=new WeakMap,nt=new WeakMap,Et=new WeakMap,ot=new WeakMap,K=new WeakMap,q=new WeakSet,ys=function([xt,Dt],Nt,dt){[Nt,dt]=this.screenToPageTranslation(Nt,dt),this.x+=Nt/xt,this.y+=dt/Dt,this.fixAndSetPosition()},vs=function(){const[xt,Dt]=this.parentDimensions,{_borderLineWidth:Nt}=Mt,dt=Nt/xt,G=Nt/Dt;switch(this.rotation){case 90:return[-dt,G];case 180:return[dt,G];case 270:return[dt,-G];default:return[-dt,-G]}},J=new WeakSet,As=function(xt,Dt,Nt){switch(Nt){case 90:return[Dt,-xt];case 180:return[-xt,-Dt];case 270:return[-Dt,xt];default:return[xt,Dt]}},Ss=function(xt){switch(xt){case 90:{const[Dt,Nt]=this.pageDimensions;return[0,-Dt/Nt,Nt/Dt,0]}case 180:return[-1,0,0,-1];case 270:{const[Dt,Nt]=this.pageDimensions;return[0,Dt/Nt,-Nt/Dt,0]}default:return[1,0,0,1]}},si=function(){if(D(this,ct))return;zt(this,ct,document.createElement("div")),D(this,ct).classList.add("resizers");const xt=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||xt.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const Dt of xt){const Nt=document.createElement("div");D(this,ct).append(Nt),Nt.classList.add("resizer",Dt),Nt.addEventListener("pointerdown",Ft(this,q,ii).bind(this,Dt)),Nt.addEventListener("contextmenu",ut.noContextMenu)}this.div.prepend(D(this,ct))},ii=function(xt,Dt){Dt.preventDefault();const{isMac:Nt}=O.FeatureTest.platform;if(Dt.button!==0||Dt.ctrlKey&&Nt)return;const dt=Ft(this,q,ni).bind(this,xt),G=this._isDraggable;this._isDraggable=!1;const X={passive:!0,capture:!0};window.addEventListener("pointermove",dt,X);const et=this.x,bt=this.y,yt=this.width,At=this.height,kt=this.parent.div.style.cursor,Wt=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(Dt.target).cursor;const Jt=()=>{this._isDraggable=G,window.removeEventListener("pointerup",Jt),window.removeEventListener("blur",Jt),window.removeEventListener("pointermove",dt,X),this.parent.div.style.cursor=kt,this.div.style.cursor=Wt;const te=this.x,se=this.y,ne=this.width,ae=this.height;te===et&&se===bt&&ne===yt&&ae===At||this.addCommands({cmd:()=>{this.width=ne,this.height=ae,this.x=te,this.y=se;const[$t,Ut]=this.parentDimensions;this.setDims($t*ne,Ut*ae),this.fixAndSetPosition()},undo:()=>{this.width=yt,this.height=At,this.x=et,this.y=bt;const[$t,Ut]=this.parentDimensions;this.setDims($t*yt,Ut*At),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",Jt),window.addEventListener("blur",Jt)},ni=function(xt,Dt){const[Nt,dt]=this.parentDimensions,G=this.x,X=this.y,et=this.width,bt=this.height,yt=Mt.MIN_SIZE/Nt,At=Mt.MIN_SIZE/dt,kt=be=>Math.round(be*1e4)/1e4,Wt=Ft(this,q,Ss).call(this,this.rotation),Jt=(be,we)=>[Wt[0]*be+Wt[2]*we,Wt[1]*be+Wt[3]*we],te=Ft(this,q,Ss).call(this,360-this.rotation),se=(be,we)=>[te[0]*be+te[2]*we,te[1]*be+te[3]*we];let ne,ae,$t=!1,Ut=!1;switch(xt){case"topLeft":$t=!0,ne=(be,we)=>[0,0],ae=(be,we)=>[be,we];break;case"topMiddle":ne=(be,we)=>[be/2,0],ae=(be,we)=>[be/2,we];break;case"topRight":$t=!0,ne=(be,we)=>[be,0],ae=(be,we)=>[0,we];break;case"middleRight":Ut=!0,ne=(be,we)=>[be,we/2],ae=(be,we)=>[0,we/2];break;case"bottomRight":$t=!0,ne=(be,we)=>[be,we],ae=(be,we)=>[0,0];break;case"bottomMiddle":ne=(be,we)=>[be/2,we],ae=(be,we)=>[be/2,0];break;case"bottomLeft":$t=!0,ne=(be,we)=>[0,we],ae=(be,we)=>[be,0];break;case"middleLeft":Ut=!0,ne=(be,we)=>[0,we/2],ae=(be,we)=>[be,we/2];break}const it=ne(et,bt),St=ae(et,bt);let It=Jt(...St);const jt=kt(G+It[0]),Zt=kt(X+It[1]);let re=1,oe=1,[Lt,he]=this.screenToPageTranslation(Dt.movementX,Dt.movementY);if([Lt,he]=se(Lt/Nt,he/dt),$t){const be=Math.hypot(et,bt);re=oe=Math.max(Math.min(Math.hypot(St[0]-it[0]-Lt,St[1]-it[1]-he)/be,1/et,1/bt),yt/et,At/bt)}else Ut?re=Math.max(yt,Math.min(1,Math.abs(St[0]-it[0]-Lt)))/et:oe=Math.max(At,Math.min(1,Math.abs(St[1]-it[1]-he)))/bt;const de=kt(et*re),Ce=kt(bt*oe);It=Jt(...ae(de,Ce));const Ee=jt-It[0],Fe=Zt-It[1];this.width=de,this.height=Ce,this.x=Ee,this.y=Fe,this.setDims(Nt*de,dt*Ce),this.fixAndSetPosition()},xs=async function(){const xt=D(this,tt);if(!xt)return;if(!D(this,vt)&&!D(this,pt)){xt.classList.remove("done"),D(this,_t)?.remove();return}Mt._l10nPromise.get("editor_alt_text_edit_button_label").then(Nt=>{xt.setAttribute("aria-label",Nt)});let Dt=D(this,_t);if(!Dt){zt(this,_t,Dt=document.createElement("span")),Dt.className="tooltip",Dt.setAttribute("role","tooltip");const Nt=Dt.id=`alt-text-tooltip-${this.id}`;xt.setAttribute("aria-describedby",Nt);const dt=100;xt.addEventListener("mouseenter",()=>{zt(this,Ct,setTimeout(()=>{zt(this,Ct,null),D(this,_t).classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},dt))}),xt.addEventListener("mouseleave",()=>{clearTimeout(D(this,Ct)),zt(this,Ct,null),D(this,_t)?.classList.remove("show")})}xt.classList.add("done"),Dt.innerText=D(this,pt)?await Mt._l10nPromise.get("editor_alt_text_decorative_tooltip"):D(this,vt),Dt.parentNode||xt.append(Dt)},ri=function(xt){if(!this._isDraggable)return;const Dt=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let Nt,dt;Dt&&(Nt={passive:!0,capture:!0},dt=X=>{const[et,bt]=this.screenToPageTranslation(X.movementX,X.movementY);this._uiManager.dragSelectedEditors(et,bt)},window.addEventListener("pointermove",dt,Nt));const G=()=>{if(window.removeEventListener("pointerup",G),window.removeEventListener("blur",G),Dt&&window.removeEventListener("pointermove",dt,Nt),zt(this,Z,!1),!this._uiManager.endDragSession()){const{isMac:X}=O.FeatureTest.platform;xt.ctrlKey&&!X||xt.shiftKey||xt.metaKey&&X?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",G),window.addEventListener("blur",G)},Ht(Mt,J),Le(Mt,"_borderLineWidth",-1),Le(Mt,"_colorManager",new F.ColorManager),Le(Mt,"_zIndex",1),Le(Mt,"SMALL_EDITOR_SIZE",0);let lt=Mt;w.AnnotationEditor=lt;class Yt extends lt{constructor(xt){super(xt),this.annotationElementId=xt.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(Y,w,W)=>{var at,ct,mt,st,Z,Es,ot,K,q,U,rt,ai,Q,ft,Tt,Xt,Ot,Bt,Mt,Vt,xt,Dt,Nt,dt,G,X,et,bt,yt,At,kt,Wt,Jt,te,se,ne,ae,$t,Ut,it,St,It,jt,Zt,re,oe,Lt,oi,ws,Cs,rs,Ts,Ps,$e,Ke,li,ci,ks,Qe,Ms;Object.defineProperty(w,"__esModule",{value:!0}),w.KeyboardManager=w.CommandManager=w.ColorManager=w.AnnotationEditorUIManager=void 0,w.bindEvents=ut,w.opacityToHex=lt;var F=W(1),O=W(6);function ut(Te,wt,ie){for(const ue of ie)wt.addEventListener(ue,Te[ue].bind(Te))}function lt(Te){return Math.round(Math.min(255,Math.max(1,255*Te))).toString(16).padStart(2,"0")}class Yt{constructor(){Ht(this,at,0)}getId(){return`${F.AnnotationEditorPrefix}${Ye(this,at)._++}`}}at=new WeakMap;const Et=class Et{constructor(){Ht(this,Z);Ht(this,ct,(0,F.getUuid)());Ht(this,mt,0);Ht(this,st,null)}static get _isSVGFittingCanvas(){const wt='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',ue=new OffscreenCanvas(1,3).getContext("2d"),ye=new Image;ye.src=wt;const Ae=ye.decode().then(()=>(ue.drawImage(ye,0,0,1,1,0,0,1,3),new Uint32Array(ue.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,F.shadow)(this,"_isSVGFittingCanvas",Ae)}async getFromFile(wt){const{lastModified:ie,name:ue,size:ye,type:Ae}=wt;return Ft(this,Z,Es).call(this,`${ie}_${ue}_${ye}_${Ae}`,wt)}async getFromUrl(wt){return Ft(this,Z,Es).call(this,wt,wt)}async getFromId(wt){D(this,st)||zt(this,st,new Map);const ie=D(this,st).get(wt);return ie?ie.bitmap?(ie.refCounter+=1,ie):ie.file?this.getFromFile(ie.file):this.getFromUrl(ie.url):null}getSvgUrl(wt){const ie=D(this,st).get(wt);return ie?.isSvg?ie.svgUrl:null}deleteId(wt){D(this,st)||zt(this,st,new Map);const ie=D(this,st).get(wt);ie&&(ie.refCounter-=1,ie.refCounter===0&&(ie.bitmap=null))}isValidId(wt){return wt.startsWith(`image_${D(this,ct)}_`)}};ct=new WeakMap,mt=new WeakMap,st=new WeakMap,Z=new WeakSet,Es=async function(wt,ie){D(this,st)||zt(this,st,new Map);let ue=D(this,st).get(wt);if(ue===null)return null;if(ue?.bitmap)return ue.refCounter+=1,ue;try{ue||(ue={bitmap:null,id:`image_${D(this,ct)}_${Ye(this,mt)._++}`,refCounter:0,isSvg:!1});let ye;if(typeof ie=="string"){ue.url=ie;const Ae=await fetch(ie);if(!Ae.ok)throw new Error(Ae.statusText);ye=await Ae.blob()}else ye=ue.file=ie;if(ye.type==="image/svg+xml"){const Ae=Et._isSVGFittingCanvas,ge=new FileReader,gt=new Image,ht=new Promise((Pt,Kt)=>{gt.onload=()=>{ue.bitmap=gt,ue.isSvg=!0,Pt()},ge.onload=async()=>{const Qt=ue.svgUrl=ge.result;gt.src=await Ae?`${Qt}#svgView(preserveAspectRatio(none))`:Qt},gt.onerror=ge.onerror=Kt});ge.readAsDataURL(ye),await ht}else ue.bitmap=await createImageBitmap(ye);ue.refCounter=1}catch(ye){console.error(ye),ue=null}return D(this,st).set(wt,ue),ue&&D(this,st).set(ue.id,ue),ue};let vt=Et;class pt{constructor(wt=128){Ht(this,ot,[]);Ht(this,K,!1);Ht(this,q);Ht(this,U,-1);zt(this,q,wt)}add({cmd:wt,undo:ie,mustExec:ue,type:ye=NaN,overwriteIfSameType:Ae=!1,keepUndo:ge=!1}){if(ue&&wt(),D(this,K))return;const gt={cmd:wt,undo:ie,type:ye};if(D(this,U)===-1){D(this,ot).length>0&&(D(this,ot).length=0),zt(this,U,0),D(this,ot).push(gt);return}if(Ae&&D(this,ot)[D(this,U)].type===ye){ge&&(gt.undo=D(this,ot)[D(this,U)].undo),D(this,ot)[D(this,U)]=gt;return}const ht=D(this,U)+1;ht===D(this,q)?D(this,ot).splice(0,1):(zt(this,U,ht),ht<D(this,ot).length&&D(this,ot).splice(ht)),D(this,ot).push(gt)}undo(){D(this,U)!==-1&&(zt(this,K,!0),D(this,ot)[D(this,U)].undo(),zt(this,K,!1),zt(this,U,D(this,U)-1))}redo(){D(this,U)<D(this,ot).length-1&&(zt(this,U,D(this,U)+1),zt(this,K,!0),D(this,ot)[D(this,U)].cmd(),zt(this,K,!1))}hasSomethingToUndo(){return D(this,U)!==-1}hasSomethingToRedo(){return D(this,U)<D(this,ot).length-1}destroy(){zt(this,ot,null)}}ot=new WeakMap,K=new WeakMap,q=new WeakMap,U=new WeakMap,w.CommandManager=pt;class tt{constructor(wt){Ht(this,rt);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:ie}=F.FeatureTest.platform;for(const[ue,ye,Ae={}]of wt)for(const ge of ue){const gt=ge.startsWith("mac+");ie&&gt?(this.callbacks.set(ge.slice(4),{callback:ye,options:Ae}),this.allKeys.add(ge.split("+").at(-1))):!ie&&!gt&&(this.callbacks.set(ge,{callback:ye,options:Ae}),this.allKeys.add(ge.split("+").at(-1)))}}exec(wt,ie){if(!this.allKeys.has(ie.key))return;const ue=this.callbacks.get(Ft(this,rt,ai).call(this,ie));if(!ue)return;const{callback:ye,options:{bubbles:Ae=!1,args:ge=[],checker:gt=null}}=ue;gt&&!gt(wt,ie)||(ye.bind(wt,...ge)(),Ae||(ie.stopPropagation(),ie.preventDefault()))}}rt=new WeakSet,ai=function(wt){wt.altKey&&this.buffer.push("alt"),wt.ctrlKey&&this.buffer.push("ctrl"),wt.metaKey&&this.buffer.push("meta"),wt.shiftKey&&this.buffer.push("shift"),this.buffer.push(wt.key);const ie=this.buffer.join("+");return this.buffer.length=0,ie},w.KeyboardManager=tt;const Rt=class Rt{get _colors(){const wt=new Map([["CanvasText",null],["Canvas",null]]);return(0,O.getColorValues)(wt),(0,F.shadow)(this,"_colors",wt)}convert(wt){const ie=(0,O.getRGB)(wt);if(!window.matchMedia("(forced-colors: active)").matches)return ie;for(const[ue,ye]of this._colors)if(ye.every((Ae,ge)=>Ae===ie[ge]))return Rt._colorsMapping.get(ue);return ie}getHexCode(wt){const ie=this._colors.get(wt);return ie?F.Util.makeHexColor(...ie):wt}};Le(Rt,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let _t=Rt;w.ColorManager=_t;const Me=class Me{constructor(wt,ie,ue,ye,Ae,ge){Ht(this,Lt);Ht(this,Q,null);Ht(this,ft,new Map);Ht(this,Tt,new Map);Ht(this,Xt,null);Ht(this,Ot,null);Ht(this,Bt,new pt);Ht(this,Mt,0);Ht(this,Vt,new Set);Ht(this,xt,null);Ht(this,Dt,null);Ht(this,Nt,new Set);Ht(this,dt,null);Ht(this,G,new Yt);Ht(this,X,!1);Ht(this,et,!1);Ht(this,bt,null);Ht(this,yt,F.AnnotationEditorType.NONE);Ht(this,At,new Set);Ht(this,kt,null);Ht(this,Wt,this.blur.bind(this));Ht(this,Jt,this.focus.bind(this));Ht(this,te,this.copy.bind(this));Ht(this,se,this.cut.bind(this));Ht(this,ne,this.paste.bind(this));Ht(this,ae,this.keydown.bind(this));Ht(this,$t,this.onEditingAction.bind(this));Ht(this,Ut,this.onPageChanging.bind(this));Ht(this,it,this.onScaleChanging.bind(this));Ht(this,St,this.onRotationChanging.bind(this));Ht(this,It,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});Ht(this,jt,[0,0]);Ht(this,Zt,null);Ht(this,re,null);Ht(this,oe,null);zt(this,re,wt),zt(this,oe,ie),zt(this,Xt,ue),this._eventBus=ye,this._eventBus._on("editingaction",D(this,$t)),this._eventBus._on("pagechanging",D(this,Ut)),this._eventBus._on("scalechanging",D(this,it)),this._eventBus._on("rotationchanging",D(this,St)),zt(this,Ot,Ae.annotationStorage),zt(this,dt,Ae.filterFactory),zt(this,kt,ge),this.viewParameters={realScale:O.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const wt=Me.prototype,ie=Ae=>{const{activeElement:ge}=document;return ge&&D(Ae,re).contains(ge)&&Ae.hasSomethingToControl()},ue=this.TRANSLATE_SMALL,ye=this.TRANSLATE_BIG;return(0,F.shadow)(this,"_keyboardManager",new tt([[["ctrl+a","mac+meta+a"],wt.selectAll],[["ctrl+z","mac+meta+z"],wt.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],wt.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],wt.delete],[["Escape","mac+Escape"],wt.unselectAll],[["ArrowLeft","mac+ArrowLeft"],wt.translateSelectedEditors,{args:[-ue,0],checker:ie}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],wt.translateSelectedEditors,{args:[-ye,0],checker:ie}],[["ArrowRight","mac+ArrowRight"],wt.translateSelectedEditors,{args:[ue,0],checker:ie}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],wt.translateSelectedEditors,{args:[ye,0],checker:ie}],[["ArrowUp","mac+ArrowUp"],wt.translateSelectedEditors,{args:[0,-ue],checker:ie}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],wt.translateSelectedEditors,{args:[0,-ye],checker:ie}],[["ArrowDown","mac+ArrowDown"],wt.translateSelectedEditors,{args:[0,ue],checker:ie}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],wt.translateSelectedEditors,{args:[0,ye],checker:ie}]]))}destroy(){Ft(this,Lt,rs).call(this),Ft(this,Lt,ws).call(this),this._eventBus._off("editingaction",D(this,$t)),this._eventBus._off("pagechanging",D(this,Ut)),this._eventBus._off("scalechanging",D(this,it)),this._eventBus._off("rotationchanging",D(this,St));for(const wt of D(this,Tt).values())wt.destroy();D(this,Tt).clear(),D(this,ft).clear(),D(this,Nt).clear(),zt(this,Q,null),D(this,At).clear(),D(this,Bt).destroy(),D(this,Xt).destroy()}get hcmFilter(){return(0,F.shadow)(this,"hcmFilter",D(this,kt)?D(this,dt).addHCMFilter(D(this,kt).foreground,D(this,kt).background):"none")}get direction(){return(0,F.shadow)(this,"direction",getComputedStyle(D(this,re)).direction)}editAltText(wt){D(this,Xt)?.editAltText(this,wt)}onPageChanging({pageNumber:wt}){zt(this,Mt,wt-1)}focusMainContainer(){D(this,re).focus()}findParent(wt,ie){for(const ue of D(this,Tt).values()){const{x:ye,y:Ae,width:ge,height:gt}=ue.div.getBoundingClientRect();if(wt>=ye&&wt<=ye+ge&&ie>=Ae&&ie<=Ae+gt)return ue}return null}disableUserSelect(wt=!1){D(this,oe).classList.toggle("noUserSelect",wt)}addShouldRescale(wt){D(this,Nt).add(wt)}removeShouldRescale(wt){D(this,Nt).delete(wt)}onScaleChanging({scale:wt}){this.commitOrRemove(),this.viewParameters.realScale=wt*O.PixelsPerInch.PDF_TO_CSS_UNITS;for(const ie of D(this,Nt))ie.onScaleChanging()}onRotationChanging({pagesRotation:wt}){this.commitOrRemove(),this.viewParameters.rotation=wt}addToAnnotationStorage(wt){!wt.isEmpty()&&D(this,Ot)&&!D(this,Ot).has(wt.id)&&D(this,Ot).setValue(wt.id,wt)}blur(){if(!this.hasSelection)return;const{activeElement:wt}=document;for(const ie of D(this,At))if(ie.div.contains(wt)){zt(this,bt,[ie,wt]),ie._focusEventsAllowed=!1;break}}focus(){if(!D(this,bt))return;const[wt,ie]=D(this,bt);zt(this,bt,null),ie.addEventListener("focusin",()=>{wt._focusEventsAllowed=!0},{once:!0}),ie.focus()}addEditListeners(){Ft(this,Lt,Cs).call(this),Ft(this,Lt,Ts).call(this)}removeEditListeners(){Ft(this,Lt,rs).call(this),Ft(this,Lt,Ps).call(this)}copy(wt){if(wt.preventDefault(),D(this,Q)?.commitOrRemove(),!this.hasSelection)return;const ie=[];for(const ue of D(this,At)){const ye=ue.serialize(!0);ye&&ie.push(ye)}ie.length!==0&&wt.clipboardData.setData("application/pdfjs",JSON.stringify(ie))}cut(wt){this.copy(wt),this.delete()}paste(wt){wt.preventDefault();const{clipboardData:ie}=wt;for(const Ae of ie.items)for(const ge of D(this,Dt))if(ge.isHandlingMimeForPasting(Ae.type)){ge.paste(Ae,this.currentLayer);return}let ue=ie.getData("application/pdfjs");if(!ue)return;try{ue=JSON.parse(ue)}catch(Ae){(0,F.warn)(`paste: "${Ae.message}".`);return}if(!Array.isArray(ue))return;this.unselectAll();const ye=this.currentLayer;try{const Ae=[];for(const ht of ue){const Pt=ye.deserialize(ht);if(!Pt)return;Ae.push(Pt)}const ge=()=>{for(const ht of Ae)Ft(this,Lt,ks).call(this,ht);Ft(this,Lt,Ms).call(this,Ae)},gt=()=>{for(const ht of Ae)ht.remove()};this.addCommands({cmd:ge,undo:gt,mustExec:!0})}catch(Ae){(0,F.warn)(`paste: "${Ae.message}".`)}}keydown(wt){this.getActive()?.shouldGetKeyboardEvents()||Me._keyboardManager.exec(this,wt)}onEditingAction(wt){["undo","redo","delete","selectAll"].includes(wt.name)&&this[wt.name]()}setEditingState(wt){wt?(Ft(this,Lt,oi).call(this),Ft(this,Lt,Cs).call(this),Ft(this,Lt,Ts).call(this),Ft(this,Lt,$e).call(this,{isEditing:D(this,yt)!==F.AnnotationEditorType.NONE,isEmpty:Ft(this,Lt,Qe).call(this),hasSomethingToUndo:D(this,Bt).hasSomethingToUndo(),hasSomethingToRedo:D(this,Bt).hasSomethingToRedo(),hasSelectedEditor:!1})):(Ft(this,Lt,ws).call(this),Ft(this,Lt,rs).call(this),Ft(this,Lt,Ps).call(this),Ft(this,Lt,$e).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(wt){if(!D(this,Dt)){zt(this,Dt,wt);for(const ie of D(this,Dt))Ft(this,Lt,Ke).call(this,ie.defaultPropertiesToUpdate)}}getId(){return D(this,G).getId()}get currentLayer(){return D(this,Tt).get(D(this,Mt))}getLayer(wt){return D(this,Tt).get(wt)}get currentPageIndex(){return D(this,Mt)}addLayer(wt){D(this,Tt).set(wt.pageIndex,wt),D(this,X)?wt.enable():wt.disable()}removeLayer(wt){D(this,Tt).delete(wt.pageIndex)}updateMode(wt,ie=null){if(D(this,yt)!==wt){if(zt(this,yt,wt),wt===F.AnnotationEditorType.NONE){this.setEditingState(!1),Ft(this,Lt,ci).call(this);return}this.setEditingState(!0),Ft(this,Lt,li).call(this),this.unselectAll();for(const ue of D(this,Tt).values())ue.updateMode(wt);if(ie){for(const ue of D(this,ft).values())if(ue.annotationElementId===ie){this.setSelected(ue),ue.enterInEditMode();break}}}}updateToolbar(wt){wt!==D(this,yt)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:wt})}updateParams(wt,ie){if(D(this,Dt)){if(wt===F.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(wt);return}for(const ue of D(this,At))ue.updateParams(wt,ie);for(const ue of D(this,Dt))ue.updateDefaultParams(wt,ie)}}enableWaiting(wt=!1){if(D(this,et)!==wt){zt(this,et,wt);for(const ie of D(this,Tt).values())wt?ie.disableClick():ie.enableClick(),ie.div.classList.toggle("waiting",wt)}}getEditors(wt){const ie=[];for(const ue of D(this,ft).values())ue.pageIndex===wt&&ie.push(ue);return ie}getEditor(wt){return D(this,ft).get(wt)}addEditor(wt){D(this,ft).set(wt.id,wt)}removeEditor(wt){D(this,ft).delete(wt.id),this.unselect(wt),(!wt.annotationElementId||!D(this,Vt).has(wt.annotationElementId))&&D(this,Ot)?.remove(wt.id)}addDeletedAnnotationElement(wt){D(this,Vt).add(wt.annotationElementId),wt.deleted=!0}isDeletedAnnotationElement(wt){return D(this,Vt).has(wt)}removeDeletedAnnotationElement(wt){D(this,Vt).delete(wt.annotationElementId),wt.deleted=!1}setActiveEditor(wt){D(this,Q)!==wt&&(zt(this,Q,wt),wt&&Ft(this,Lt,Ke).call(this,wt.propertiesToUpdate))}toggleSelected(wt){if(D(this,At).has(wt)){D(this,At).delete(wt),wt.unselect(),Ft(this,Lt,$e).call(this,{hasSelectedEditor:this.hasSelection});return}D(this,At).add(wt),wt.select(),Ft(this,Lt,Ke).call(this,wt.propertiesToUpdate),Ft(this,Lt,$e).call(this,{hasSelectedEditor:!0})}setSelected(wt){for(const ie of D(this,At))ie!==wt&&ie.unselect();D(this,At).clear(),D(this,At).add(wt),wt.select(),Ft(this,Lt,Ke).call(this,wt.propertiesToUpdate),Ft(this,Lt,$e).call(this,{hasSelectedEditor:!0})}isSelected(wt){return D(this,At).has(wt)}unselect(wt){wt.unselect(),D(this,At).delete(wt),Ft(this,Lt,$e).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return D(this,At).size!==0}undo(){D(this,Bt).undo(),Ft(this,Lt,$e).call(this,{hasSomethingToUndo:D(this,Bt).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:Ft(this,Lt,Qe).call(this)})}redo(){D(this,Bt).redo(),Ft(this,Lt,$e).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:D(this,Bt).hasSomethingToRedo(),isEmpty:Ft(this,Lt,Qe).call(this)})}addCommands(wt){D(this,Bt).add(wt),Ft(this,Lt,$e).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:Ft(this,Lt,Qe).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const wt=[...D(this,At)],ie=()=>{for(const ye of wt)ye.remove()},ue=()=>{for(const ye of wt)Ft(this,Lt,ks).call(this,ye)};this.addCommands({cmd:ie,undo:ue,mustExec:!0})}commitOrRemove(){D(this,Q)?.commitOrRemove()}hasSomethingToControl(){return D(this,Q)||this.hasSelection}selectAll(){for(const wt of D(this,At))wt.commit();Ft(this,Lt,Ms).call(this,D(this,ft).values())}unselectAll(){if(D(this,Q)){D(this,Q).commitOrRemove();return}if(this.hasSelection){for(const wt of D(this,At))wt.unselect();D(this,At).clear(),Ft(this,Lt,$e).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(wt,ie,ue=!1){if(ue||this.commitOrRemove(),!this.hasSelection)return;D(this,jt)[0]+=wt,D(this,jt)[1]+=ie;const[ye,Ae]=D(this,jt),ge=[...D(this,At)],gt=1e3;D(this,Zt)&&clearTimeout(D(this,Zt)),zt(this,Zt,setTimeout(()=>{zt(this,Zt,null),D(this,jt)[0]=D(this,jt)[1]=0,this.addCommands({cmd:()=>{for(const ht of ge)D(this,ft).has(ht.id)&&ht.translateInPage(ye,Ae)},undo:()=>{for(const ht of ge)D(this,ft).has(ht.id)&&ht.translateInPage(-ye,-Ae)},mustExec:!1})},gt));for(const ht of ge)ht.translateInPage(wt,ie)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),zt(this,xt,new Map);for(const wt of D(this,At))D(this,xt).set(wt,{savedX:wt.x,savedY:wt.y,savedPageIndex:wt.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!D(this,xt))return!1;this.disableUserSelect(!1);const wt=D(this,xt);zt(this,xt,null);let ie=!1;for(const[{x:ye,y:Ae,pageIndex:ge},gt]of wt)gt.newX=ye,gt.newY=Ae,gt.newPageIndex=ge,ie||(ie=ye!==gt.savedX||Ae!==gt.savedY||ge!==gt.savedPageIndex);if(!ie)return!1;const ue=(ye,Ae,ge,gt)=>{if(D(this,ft).has(ye.id)){const ht=D(this,Tt).get(gt);ht?ye._setParentAndPosition(ht,Ae,ge):(ye.pageIndex=gt,ye.x=Ae,ye.y=ge)}};return this.addCommands({cmd:()=>{for(const[ye,{newX:Ae,newY:ge,newPageIndex:gt}]of wt)ue(ye,Ae,ge,gt)},undo:()=>{for(const[ye,{savedX:Ae,savedY:ge,savedPageIndex:gt}]of wt)ue(ye,Ae,ge,gt)},mustExec:!0}),!0}dragSelectedEditors(wt,ie){if(D(this,xt))for(const ue of D(this,xt).keys())ue.drag(wt,ie)}rebuild(wt){if(wt.parent===null){const ie=this.getLayer(wt.pageIndex);ie?(ie.changeParent(wt),ie.addOrRebuild(wt)):(this.addEditor(wt),this.addToAnnotationStorage(wt),wt.rebuild())}else wt.parent.addOrRebuild(wt)}isActive(wt){return D(this,Q)===wt}getActive(){return D(this,Q)}getMode(){return D(this,yt)}get imageManager(){return(0,F.shadow)(this,"imageManager",new vt)}};Q=new WeakMap,ft=new WeakMap,Tt=new WeakMap,Xt=new WeakMap,Ot=new WeakMap,Bt=new WeakMap,Mt=new WeakMap,Vt=new WeakMap,xt=new WeakMap,Dt=new WeakMap,Nt=new WeakMap,dt=new WeakMap,G=new WeakMap,X=new WeakMap,et=new WeakMap,bt=new WeakMap,yt=new WeakMap,At=new WeakMap,kt=new WeakMap,Wt=new WeakMap,Jt=new WeakMap,te=new WeakMap,se=new WeakMap,ne=new WeakMap,ae=new WeakMap,$t=new WeakMap,Ut=new WeakMap,it=new WeakMap,St=new WeakMap,It=new WeakMap,jt=new WeakMap,Zt=new WeakMap,re=new WeakMap,oe=new WeakMap,Lt=new WeakSet,oi=function(){window.addEventListener("focus",D(this,Jt)),window.addEventListener("blur",D(this,Wt))},ws=function(){window.removeEventListener("focus",D(this,Jt)),window.removeEventListener("blur",D(this,Wt))},Cs=function(){window.addEventListener("keydown",D(this,ae),{capture:!0})},rs=function(){window.removeEventListener("keydown",D(this,ae),{capture:!0})},Ts=function(){document.addEventListener("copy",D(this,te)),document.addEventListener("cut",D(this,se)),document.addEventListener("paste",D(this,ne))},Ps=function(){document.removeEventListener("copy",D(this,te)),document.removeEventListener("cut",D(this,se)),document.removeEventListener("paste",D(this,ne))},$e=function(wt){Object.entries(wt).some(([ue,ye])=>D(this,It)[ue]!==ye)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(D(this,It),wt)})},Ke=function(wt){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:wt})},li=function(){if(!D(this,X)){zt(this,X,!0);for(const wt of D(this,Tt).values())wt.enable()}},ci=function(){if(this.unselectAll(),D(this,X)){zt(this,X,!1);for(const wt of D(this,Tt).values())wt.disable()}},ks=function(wt){const ie=D(this,Tt).get(wt.pageIndex);ie?ie.addOrRebuild(wt):this.addEditor(wt)},Qe=function(){if(D(this,ft).size===0)return!0;if(D(this,ft).size===1)for(const wt of D(this,ft).values())return wt.isEmpty();return!1},Ms=function(wt){D(this,At).clear();for(const ie of wt)ie.isEmpty()||(D(this,At).add(ie),ie.select());Ft(this,Lt,$e).call(this,{hasSelectedEditor:!0})},Le(Me,"TRANSLATE_SMALL",1),Le(Me,"TRANSLATE_BIG",10);let Ct=Me;w.AnnotationEditorUIManager=Ct},(Y,w,W)=>{var Mt,Vt,xt,Dt,Nt,dt,G,X,et,bt,yt,At,ze,We,Fs,as,os,Je,Ze;Object.defineProperty(w,"__esModule",{value:!0}),w.StatTimer=w.RenderingCancelledException=w.PixelsPerInch=w.PageViewport=w.PDFDateString=w.DOMStandardFontDataFactory=w.DOMSVGFactory=w.DOMFilterFactory=w.DOMCanvasFactory=w.DOMCMapReaderFactory=void 0,w.deprecated=U,w.getColorValues=ft,w.getCurrentTransform=Tt,w.getCurrentTransformInverse=Xt,w.getFilenameFromUrl=Z,w.getPdfFilenameFromUrl=nt,w.getRGB=Q,w.getXfaPageViewport=Rt,w.isDataScheme=mt,w.isPdfFile=st,w.isValidFetchUrl=ot,w.loadScript=q,w.noContextMenu=K,w.setLayerDimensions=Ot;var F=W(7),O=W(1);const ut="http://www.w3.org/2000/svg",Bt=class Bt{};Le(Bt,"CSS",96),Le(Bt,"PDF",72),Le(Bt,"PDF_TO_CSS_UNITS",Bt.CSS/Bt.PDF);let lt=Bt;w.PixelsPerInch=lt;class Yt extends F.BaseFilterFactory{constructor({docId:it,ownerDocument:St=globalThis.document}={}){super();Ht(this,At);Ht(this,Mt);Ht(this,Vt);Ht(this,xt);Ht(this,Dt);Ht(this,Nt);Ht(this,dt);Ht(this,G);Ht(this,X);Ht(this,et);Ht(this,bt);Ht(this,yt,0);zt(this,xt,it),zt(this,Dt,St)}addFilter(it){if(!it)return"none";let St=D(this,At,ze).get(it);if(St)return St;let It,jt,Zt,re;if(it.length===1){const de=it[0],Ce=new Array(256);for(let Ee=0;Ee<256;Ee++)Ce[Ee]=de[Ee]/255;re=It=jt=Zt=Ce.join(",")}else{const[de,Ce,Ee]=it,Fe=new Array(256),be=new Array(256),we=new Array(256);for(let ke=0;ke<256;ke++)Fe[ke]=de[ke]/255,be[ke]=Ce[ke]/255,we[ke]=Ee[ke]/255;It=Fe.join(","),jt=be.join(","),Zt=we.join(","),re=`${It}${jt}${Zt}`}if(St=D(this,At,ze).get(re),St)return D(this,At,ze).set(it,St),St;const oe=`g_${D(this,xt)}_transfer_map_${Ye(this,yt)._++}`,Lt=`url(#${oe})`;D(this,At,ze).set(it,Lt),D(this,At,ze).set(re,Lt);const he=Ft(this,At,as).call(this,oe);return Ft(this,At,Je).call(this,It,jt,Zt,he),Lt}addHCMFilter(it,St){const It=`${it}-${St}`;if(D(this,dt)===It)return D(this,G);if(zt(this,dt,It),zt(this,G,"none"),D(this,Nt)?.remove(),!it||!St)return D(this,G);const jt=Ft(this,At,Ze).call(this,it);it=O.Util.makeHexColor(...jt);const Zt=Ft(this,At,Ze).call(this,St);if(St=O.Util.makeHexColor(...Zt),D(this,At,We).style.color="",it==="#000000"&&St==="#ffffff"||it===St)return D(this,G);const re=new Array(256);for(let Ce=0;Ce<=255;Ce++){const Ee=Ce/255;re[Ce]=Ee<=.03928?Ee/12.92:((Ee+.055)/1.055)**2.4}const oe=re.join(","),Lt=`g_${D(this,xt)}_hcm_filter`,he=zt(this,X,Ft(this,At,as).call(this,Lt));Ft(this,At,Je).call(this,oe,oe,oe,he),Ft(this,At,Fs).call(this,he);const de=(Ce,Ee)=>{const Fe=jt[Ce]/255,be=Zt[Ce]/255,we=new Array(Ee+1);for(let ke=0;ke<=Ee;ke++)we[ke]=Fe+ke/Ee*(be-Fe);return we.join(",")};return Ft(this,At,Je).call(this,de(0,5),de(1,5),de(2,5),he),zt(this,G,`url(#${Lt})`),D(this,G)}addHighlightHCMFilter(it,St,It,jt){const Zt=`${it}-${St}-${It}-${jt}`;if(D(this,et)===Zt)return D(this,bt);if(zt(this,et,Zt),zt(this,bt,"none"),D(this,X)?.remove(),!it||!St)return D(this,bt);const[re,oe]=[it,St].map(Ft(this,At,Ze).bind(this));let Lt=Math.round(.2126*re[0]+.7152*re[1]+.0722*re[2]),he=Math.round(.2126*oe[0]+.7152*oe[1]+.0722*oe[2]),[de,Ce]=[It,jt].map(Ft(this,At,Ze).bind(this));he<Lt&&([Lt,he,de,Ce]=[he,Lt,Ce,de]),D(this,At,We).style.color="";const Ee=(we,ke,Re)=>{const le=new Array(256),Gt=(he-Lt)/Re,qt=we/255,me=(ke-we)/(255*Re);let Me=0;for(let Te=0;Te<=Re;Te++){const wt=Math.round(Lt+Te*Gt),ie=qt+Te*me;for(let ue=Me;ue<=wt;ue++)le[ue]=ie;Me=wt+1}for(let Te=Me;Te<256;Te++)le[Te]=le[Me-1];return le.join(",")},Fe=`g_${D(this,xt)}_hcm_highlight_filter`,be=zt(this,X,Ft(this,At,as).call(this,Fe));return Ft(this,At,Fs).call(this,be),Ft(this,At,Je).call(this,Ee(de[0],Ce[0],5),Ee(de[1],Ce[1],5),Ee(de[2],Ce[2],5),be),zt(this,bt,`url(#${Fe})`),D(this,bt)}destroy(it=!1){it&&(D(this,G)||D(this,bt))||(D(this,Vt)&&(D(this,Vt).parentNode.parentNode.remove(),zt(this,Vt,null)),D(this,Mt)&&(D(this,Mt).clear(),zt(this,Mt,null)),zt(this,yt,0))}}Mt=new WeakMap,Vt=new WeakMap,xt=new WeakMap,Dt=new WeakMap,Nt=new WeakMap,dt=new WeakMap,G=new WeakMap,X=new WeakMap,et=new WeakMap,bt=new WeakMap,yt=new WeakMap,At=new WeakSet,ze=function(){return D(this,Mt)||zt(this,Mt,new Map)},We=function(){if(!D(this,Vt)){const it=D(this,Dt).createElement("div"),{style:St}=it;St.visibility="hidden",St.contain="strict",St.width=St.height=0,St.position="absolute",St.top=St.left=0,St.zIndex=-1;const It=D(this,Dt).createElementNS(ut,"svg");It.setAttribute("width",0),It.setAttribute("height",0),zt(this,Vt,D(this,Dt).createElementNS(ut,"defs")),it.append(It),It.append(D(this,Vt)),D(this,Dt).body.append(it)}return D(this,Vt)},Fs=function(it){const St=D(this,Dt).createElementNS(ut,"feColorMatrix");St.setAttribute("type","matrix"),St.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),it.append(St)},as=function(it){const St=D(this,Dt).createElementNS(ut,"filter");return St.setAttribute("color-interpolation-filters","sRGB"),St.setAttribute("id",it),D(this,At,We).append(St),St},os=function(it,St,It){const jt=D(this,Dt).createElementNS(ut,St);jt.setAttribute("type","discrete"),jt.setAttribute("tableValues",It),it.append(jt)},Je=function(it,St,It,jt){const Zt=D(this,Dt).createElementNS(ut,"feComponentTransfer");jt.append(Zt),Ft(this,At,os).call(this,Zt,"feFuncR",it),Ft(this,At,os).call(this,Zt,"feFuncG",St),Ft(this,At,os).call(this,Zt,"feFuncB",It)},Ze=function(it){return D(this,At,We).style.color=it,Q(getComputedStyle(D(this,At,We)).getPropertyValue("color"))},w.DOMFilterFactory=Yt;class vt extends F.BaseCanvasFactory{constructor({ownerDocument:Ut=globalThis.document}={}){super(),this._document=Ut}_createCanvas(Ut,it){const St=this._document.createElement("canvas");return St.width=Ut,St.height=it,St}}w.DOMCanvasFactory=vt;async function pt($t,Ut=!1){if(ot($t,document.baseURI)){const it=await fetch($t);if(!it.ok)throw new Error(it.statusText);return Ut?new Uint8Array(await it.arrayBuffer()):(0,O.stringToBytes)(await it.text())}return new Promise((it,St)=>{const It=new XMLHttpRequest;It.open("GET",$t,!0),Ut&&(It.responseType="arraybuffer"),It.onreadystatechange=()=>{if(It.readyState===XMLHttpRequest.DONE){if(It.status===200||It.status===0){let jt;if(Ut&&It.response?jt=new Uint8Array(It.response):!Ut&&It.responseText&&(jt=(0,O.stringToBytes)(It.responseText)),jt){it(jt);return}}St(new Error(It.statusText))}},It.send(null)})}class tt extends F.BaseCMapReaderFactory{_fetchData(Ut,it){return pt(Ut,this.isCompressed).then(St=>({cMapData:St,compressionType:it}))}}w.DOMCMapReaderFactory=tt;class _t extends F.BaseStandardFontDataFactory{_fetchData(Ut){return pt(Ut,!0)}}w.DOMStandardFontDataFactory=_t;class Ct extends F.BaseSVGFactory{_createSVG(Ut){return document.createElementNS(ut,Ut)}}w.DOMSVGFactory=Ct;class at{constructor({viewBox:Ut,scale:it,rotation:St,offsetX:It=0,offsetY:jt=0,dontFlip:Zt=!1}){this.viewBox=Ut,this.scale=it,this.rotation=St,this.offsetX=It,this.offsetY=jt;const re=(Ut[2]+Ut[0])/2,oe=(Ut[3]+Ut[1])/2;let Lt,he,de,Ce;switch(St%=360,St<0&&(St+=360),St){case 180:Lt=-1,he=0,de=0,Ce=1;break;case 90:Lt=0,he=1,de=1,Ce=0;break;case 270:Lt=0,he=-1,de=-1,Ce=0;break;case 0:Lt=1,he=0,de=0,Ce=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}Zt&&(de=-de,Ce=-Ce);let Ee,Fe,be,we;Lt===0?(Ee=Math.abs(oe-Ut[1])*it+It,Fe=Math.abs(re-Ut[0])*it+jt,be=(Ut[3]-Ut[1])*it,we=(Ut[2]-Ut[0])*it):(Ee=Math.abs(re-Ut[0])*it+It,Fe=Math.abs(oe-Ut[1])*it+jt,be=(Ut[2]-Ut[0])*it,we=(Ut[3]-Ut[1])*it),this.transform=[Lt*it,he*it,de*it,Ce*it,Ee-Lt*it*re-de*it*oe,Fe-he*it*re-Ce*it*oe],this.width=be,this.height=we}get rawDims(){const{viewBox:Ut}=this;return(0,O.shadow)(this,"rawDims",{pageWidth:Ut[2]-Ut[0],pageHeight:Ut[3]-Ut[1],pageX:Ut[0],pageY:Ut[1]})}clone({scale:Ut=this.scale,rotation:it=this.rotation,offsetX:St=this.offsetX,offsetY:It=this.offsetY,dontFlip:jt=!1}={}){return new at({viewBox:this.viewBox.slice(),scale:Ut,rotation:it,offsetX:St,offsetY:It,dontFlip:jt})}convertToViewportPoint(Ut,it){return O.Util.applyTransform([Ut,it],this.transform)}convertToViewportRectangle(Ut){const it=O.Util.applyTransform([Ut[0],Ut[1]],this.transform),St=O.Util.applyTransform([Ut[2],Ut[3]],this.transform);return[it[0],it[1],St[0],St[1]]}convertToPdfPoint(Ut,it){return O.Util.applyInverseTransform([Ut,it],this.transform)}}w.PageViewport=at;class ct extends O.BaseException{constructor(Ut,it=0){super(Ut,"RenderingCancelledException"),this.extraDelay=it}}w.RenderingCancelledException=ct;function mt($t){const Ut=$t.length;let it=0;for(;it<Ut&&$t[it].trim()==="";)it++;return $t.substring(it,it+5).toLowerCase()==="data:"}function st($t){return typeof $t=="string"&&/\.pdf$/i.test($t)}function Z($t,Ut=!1){return Ut||([$t]=$t.split(/[#?]/,1)),$t.substring($t.lastIndexOf("/")+1)}function nt($t,Ut="document.pdf"){if(typeof $t!="string")return Ut;if(mt($t))return(0,O.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),Ut;const it=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,St=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,It=it.exec($t);let jt=St.exec(It[1])||St.exec(It[2])||St.exec(It[3]);if(jt&&(jt=jt[0],jt.includes("%")))try{jt=St.exec(decodeURIComponent(jt))[0]}catch{}return jt||Ut}class Et{constructor(){Le(this,"started",Object.create(null));Le(this,"times",[])}time(Ut){Ut in this.started&&(0,O.warn)(`Timer is already running for ${Ut}`),this.started[Ut]=Date.now()}timeEnd(Ut){Ut in this.started||(0,O.warn)(`Timer has not been started for ${Ut}`),this.times.push({name:Ut,start:this.started[Ut],end:Date.now()}),delete this.started[Ut]}toString(){const Ut=[];let it=0;for(const{name:St}of this.times)it=Math.max(St.length,it);for(const{name:St,start:It,end:jt}of this.times)Ut.push(`${St.padEnd(it)} ${jt-It}ms
`);return Ut.join("")}}w.StatTimer=Et;function ot($t,Ut){try{const{protocol:it}=Ut?new URL($t,Ut):new URL($t);return it==="http:"||it==="https:"}catch{return!1}}function K($t){$t.preventDefault()}function q($t,Ut=!1){return new Promise((it,St)=>{const It=document.createElement("script");It.src=$t,It.onload=function(jt){Ut&&It.remove(),it(jt)},It.onerror=function(){St(new Error(`Cannot load script at: ${It.src}`))},(document.head||document.documentElement).append(It)})}function U($t){console.log("Deprecated API usage: "+$t)}let rt;class J{static toDateObject(Ut){if(!Ut||typeof Ut!="string")return null;rt||(rt=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const it=rt.exec(Ut);if(!it)return null;const St=parseInt(it[1],10);let It=parseInt(it[2],10);It=It>=1&&It<=12?It-1:0;let jt=parseInt(it[3],10);jt=jt>=1&&jt<=31?jt:1;let Zt=parseInt(it[4],10);Zt=Zt>=0&&Zt<=23?Zt:0;let re=parseInt(it[5],10);re=re>=0&&re<=59?re:0;let oe=parseInt(it[6],10);oe=oe>=0&&oe<=59?oe:0;const Lt=it[7]||"Z";let he=parseInt(it[8],10);he=he>=0&&he<=23?he:0;let de=parseInt(it[9],10)||0;return de=de>=0&&de<=59?de:0,Lt==="-"?(Zt+=he,re+=de):Lt==="+"&&(Zt-=he,re-=de),new Date(Date.UTC(St,It,jt,Zt,re,oe))}}w.PDFDateString=J;function Rt($t,{scale:Ut=1,rotation:it=0}){const{width:St,height:It}=$t.attributes.style,jt=[0,0,parseInt(St),parseInt(It)];return new at({viewBox:jt,scale:Ut,rotation:it})}function Q($t){if($t.startsWith("#")){const Ut=parseInt($t.slice(1),16);return[(Ut&16711680)>>16,(Ut&65280)>>8,Ut&255]}return $t.startsWith("rgb(")?$t.slice(4,-1).split(",").map(Ut=>parseInt(Ut)):$t.startsWith("rgba(")?$t.slice(5,-1).split(",").map(Ut=>parseInt(Ut)).slice(0,3):((0,O.warn)(`Not a valid color format: "${$t}"`),[0,0,0])}function ft($t){const Ut=document.createElement("span");Ut.style.visibility="hidden",document.body.append(Ut);for(const it of $t.keys()){Ut.style.color=it;const St=window.getComputedStyle(Ut).color;$t.set(it,Q(St))}Ut.remove()}function Tt($t){const{a:Ut,b:it,c:St,d:It,e:jt,f:Zt}=$t.getTransform();return[Ut,it,St,It,jt,Zt]}function Xt($t){const{a:Ut,b:it,c:St,d:It,e:jt,f:Zt}=$t.getTransform().invertSelf();return[Ut,it,St,It,jt,Zt]}function Ot($t,Ut,it=!1,St=!0){if(Ut instanceof at){const{pageWidth:It,pageHeight:jt}=Ut.rawDims,{style:Zt}=$t,re=O.FeatureTest.isCSSRoundSupported,oe=`var(--scale-factor) * ${It}px`,Lt=`var(--scale-factor) * ${jt}px`,he=re?`round(${oe}, 1px)`:`calc(${oe})`,de=re?`round(${Lt}, 1px)`:`calc(${Lt})`;!it||Ut.rotation%180===0?(Zt.width=he,Zt.height=de):(Zt.width=de,Zt.height=he)}St&&$t.setAttribute("data-main-rotation",Ut.rotation)}},(Y,w,W)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.BaseStandardFontDataFactory=w.BaseSVGFactory=w.BaseFilterFactory=w.BaseCanvasFactory=w.BaseCMapReaderFactory=void 0;var F=W(1);class O{constructor(){this.constructor===O&&(0,F.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(tt){return"none"}addHCMFilter(tt,_t){return"none"}addHighlightHCMFilter(tt,_t,Ct,at){return"none"}destroy(tt=!1){}}w.BaseFilterFactory=O;class ut{constructor(){this.constructor===ut&&(0,F.unreachable)("Cannot initialize BaseCanvasFactory.")}create(tt,_t){if(tt<=0||_t<=0)throw new Error("Invalid canvas size");const Ct=this._createCanvas(tt,_t);return{canvas:Ct,context:Ct.getContext("2d")}}reset(tt,_t,Ct){if(!tt.canvas)throw new Error("Canvas is not specified");if(_t<=0||Ct<=0)throw new Error("Invalid canvas size");tt.canvas.width=_t,tt.canvas.height=Ct}destroy(tt){if(!tt.canvas)throw new Error("Canvas is not specified");tt.canvas.width=0,tt.canvas.height=0,tt.canvas=null,tt.context=null}_createCanvas(tt,_t){(0,F.unreachable)("Abstract method `_createCanvas` called.")}}w.BaseCanvasFactory=ut;class lt{constructor({baseUrl:tt=null,isCompressed:_t=!0}){this.constructor===lt&&(0,F.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=tt,this.isCompressed=_t}async fetch({name:tt}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!tt)throw new Error("CMap name must be specified.");const _t=this.baseUrl+tt+(this.isCompressed?".bcmap":""),Ct=this.isCompressed?F.CMapCompressionType.BINARY:F.CMapCompressionType.NONE;return this._fetchData(_t,Ct).catch(at=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${_t}`)})}_fetchData(tt,_t){(0,F.unreachable)("Abstract method `_fetchData` called.")}}w.BaseCMapReaderFactory=lt;class Yt{constructor({baseUrl:tt=null}){this.constructor===Yt&&(0,F.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=tt}async fetch({filename:tt}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!tt)throw new Error("Font filename must be specified.");const _t=`${this.baseUrl}${tt}`;return this._fetchData(_t).catch(Ct=>{throw new Error(`Unable to load font data at: ${_t}`)})}_fetchData(tt){(0,F.unreachable)("Abstract method `_fetchData` called.")}}w.BaseStandardFontDataFactory=Yt;class vt{constructor(){this.constructor===vt&&(0,F.unreachable)("Cannot initialize BaseSVGFactory.")}create(tt,_t,Ct=!1){if(tt<=0||_t<=0)throw new Error("Invalid SVG dimensions");const at=this._createSVG("svg:svg");return at.setAttribute("version","1.1"),Ct||(at.setAttribute("width",`${tt}px`),at.setAttribute("height",`${_t}px`)),at.setAttribute("preserveAspectRatio","none"),at.setAttribute("viewBox",`0 0 ${tt} ${_t}`),at}createElement(tt){if(typeof tt!="string")throw new Error("Invalid SVG element type");return this._createSVG(tt)}_createSVG(tt){(0,F.unreachable)("Abstract method `_createSVG` called.")}}w.BaseSVGFactory=vt},(Y,w,W)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.MurmurHash3_64=void 0;var F=W(1);const O=3285377520,ut=4294901760,lt=65535;class Yt{constructor(pt){this.h1=pt?pt&4294967295:O,this.h2=pt?pt&4294967295:O}update(pt){let tt,_t;if(typeof pt=="string"){tt=new Uint8Array(pt.length*2),_t=0;for(let U=0,rt=pt.length;U<rt;U++){const J=pt.charCodeAt(U);J<=255?tt[_t++]=J:(tt[_t++]=J>>>8,tt[_t++]=J&255)}}else if((0,F.isArrayBuffer)(pt))tt=pt.slice(),_t=tt.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const Ct=_t>>2,at=_t-Ct*4,ct=new Uint32Array(tt.buffer,0,Ct);let mt=0,st=0,Z=this.h1,nt=this.h2;const Et=3432918353,ot=461845907,K=Et&lt,q=ot&lt;for(let U=0;U<Ct;U++)U&1?(mt=ct[U],mt=mt*Et&ut|mt*K&lt,mt=mt<<15|mt>>>17,mt=mt*ot&ut|mt*q&lt,Z^=mt,Z=Z<<13|Z>>>19,Z=Z*5+3864292196):(st=ct[U],st=st*Et&ut|st*K&lt,st=st<<15|st>>>17,st=st*ot&ut|st*q&lt,nt^=st,nt=nt<<13|nt>>>19,nt=nt*5+3864292196);switch(mt=0,at){case 3:mt^=tt[Ct*4+2]<<16;case 2:mt^=tt[Ct*4+1]<<8;case 1:mt^=tt[Ct*4],mt=mt*Et&ut|mt*K&lt,mt=mt<<15|mt>>>17,mt=mt*ot&ut|mt*q&lt,Ct&1?Z^=mt:nt^=mt}this.h1=Z,this.h2=nt}hexdigest(){let pt=this.h1,tt=this.h2;return pt^=tt>>>1,pt=pt*3981806797&ut|pt*36045&lt,tt=tt*4283543511&ut|((tt<<16|pt>>>16)*2950163797&ut)>>>16,pt^=tt>>>1,pt=pt*444984403&ut|pt*60499&lt,tt=tt*3301882366&ut|((tt<<16|pt>>>16)*3120437893&ut)>>>16,pt^=tt>>>1,(pt>>>0).toString(16).padStart(8,"0")+(tt>>>0).toString(16).padStart(8,"0")}}w.MurmurHash3_64=Yt},(Y,w,W)=>{var lt;Object.defineProperty(w,"__esModule",{value:!0}),w.FontLoader=w.FontFaceObject=void 0;var F=W(1);class O{constructor({ownerDocument:vt=globalThis.document,styleElement:pt=null}){Ht(this,lt,new Set);this._document=vt,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(vt){this.nativeFontFaces.add(vt),this._document.fonts.add(vt)}removeNativeFontFace(vt){this.nativeFontFaces.delete(vt),this._document.fonts.delete(vt)}insertRule(vt){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const pt=this.styleElement.sheet;pt.insertRule(vt,pt.cssRules.length)}clear(){for(const vt of this.nativeFontFaces)this._document.fonts.delete(vt);this.nativeFontFaces.clear(),D(this,lt).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(vt){if(!(!vt||D(this,lt).has(vt.loadedName))){if((0,F.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:pt,src:tt,style:_t}=vt,Ct=new FontFace(pt,tt,_t);this.addNativeFontFace(Ct);try{await Ct.load(),D(this,lt).add(pt)}catch{(0,F.warn)(`Cannot load system font: ${vt.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(Ct)}return}(0,F.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(vt){if(vt.attached||vt.missingFile&&!vt.systemFontInfo)return;if(vt.attached=!0,vt.systemFontInfo){await this.loadSystemFont(vt.systemFontInfo);return}if(this.isFontLoadingAPISupported){const tt=vt.createNativeFontFace();if(tt){this.addNativeFontFace(tt);try{await tt.loaded}catch(_t){throw(0,F.warn)(`Failed to load font '${tt.family}': '${_t}'.`),vt.disableFontFace=!0,_t}}return}const pt=vt.createFontFaceRule();if(pt){if(this.insertRule(pt),this.isSyncFontLoadingSupported)return;await new Promise(tt=>{const _t=this._queueLoadingCallback(tt);this._prepareFontLoadEvent(vt,_t)})}}get isFontLoadingAPISupported(){const vt=!!this._document?.fonts;return(0,F.shadow)(this,"isFontLoadingAPISupported",vt)}get isSyncFontLoadingSupported(){let vt=!1;return(F.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(vt=!0),(0,F.shadow)(this,"isSyncFontLoadingSupported",vt)}_queueLoadingCallback(vt){function pt(){for((0,F.assert)(!_t.done,"completeRequest() cannot be called twice."),_t.done=!0;tt.length>0&&tt[0].done;){const Ct=tt.shift();setTimeout(Ct.callback,0)}}const{loadingRequests:tt}=this,_t={done:!1,complete:pt,callback:vt};return tt.push(_t),_t}get _loadTestFont(){const vt=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,F.shadow)(this,"_loadTestFont",vt)}_prepareFontLoadEvent(vt,pt){function tt(Q,ft){return Q.charCodeAt(ft)<<24|Q.charCodeAt(ft+1)<<16|Q.charCodeAt(ft+2)<<8|Q.charCodeAt(ft+3)&255}function _t(Q,ft,Tt,Xt){const Ot=Q.substring(0,ft),Bt=Q.substring(ft+Tt);return Ot+Xt+Bt}let Ct,at;const ct=this._document.createElement("canvas");ct.width=1,ct.height=1;const mt=ct.getContext("2d");let st=0;function Z(Q,ft){if(++st>30){(0,F.warn)("Load test font never loaded."),ft();return}if(mt.font="30px "+Q,mt.fillText(".",0,20),mt.getImageData(0,0,1,1).data[3]>0){ft();return}setTimeout(Z.bind(null,Q,ft))}const nt=`lt${Date.now()}${this.loadTestFontId++}`;let Et=this._loadTestFont;Et=_t(Et,976,nt.length,nt);const K=16,q=1482184792;let U=tt(Et,K);for(Ct=0,at=nt.length-3;Ct<at;Ct+=4)U=U-q+tt(nt,Ct)|0;Ct<nt.length&&(U=U-q+tt(nt+"XXX",Ct)|0),Et=_t(Et,K,4,(0,F.string32)(U));const rt=`url(data:font/opentype;base64,${btoa(Et)});`,J=`@font-face {font-family:"${nt}";src:${rt}}`;this.insertRule(J);const Rt=this._document.createElement("div");Rt.style.visibility="hidden",Rt.style.width=Rt.style.height="10px",Rt.style.position="absolute",Rt.style.top=Rt.style.left="0px";for(const Q of[vt.loadedName,nt]){const ft=this._document.createElement("span");ft.textContent="Hi",ft.style.fontFamily=Q,Rt.append(ft)}this._document.body.append(Rt),Z(nt,()=>{Rt.remove(),pt.complete()})}}lt=new WeakMap,w.FontLoader=O;class ut{constructor(vt,{isEvalSupported:pt=!0,disableFontFace:tt=!1,ignoreErrors:_t=!1,inspectFont:Ct=null}){this.compiledGlyphs=Object.create(null);for(const at in vt)this[at]=vt[at];this.isEvalSupported=pt!==!1,this.disableFontFace=tt===!0,this.ignoreErrors=_t===!0,this._inspectFont=Ct}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let vt;if(!this.cssFontInfo)vt=new FontFace(this.loadedName,this.data,{});else{const pt={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(pt.style=`oblique ${this.cssFontInfo.italicAngle}deg`),vt=new FontFace(this.cssFontInfo.fontFamily,this.data,pt)}return this._inspectFont?.(this),vt}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const vt=(0,F.bytesToString)(this.data),pt=`url(data:${this.mimetype};base64,${btoa(vt)});`;let tt;if(!this.cssFontInfo)tt=`@font-face {font-family:"${this.loadedName}";src:${pt}}`;else{let _t=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(_t+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),tt=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${_t}src:${pt}}`}return this._inspectFont?.(this,pt),tt}getPathGenerator(vt,pt){if(this.compiledGlyphs[pt]!==void 0)return this.compiledGlyphs[pt];let tt;try{tt=vt.get(this.loadedName+"_path_"+pt)}catch(_t){if(!this.ignoreErrors)throw _t;return(0,F.warn)(`getPathGenerator - ignoring character: "${_t}".`),this.compiledGlyphs[pt]=function(Ct,at){}}if(this.isEvalSupported&&F.FeatureTest.isEvalSupported){const _t=[];for(const Ct of tt){const at=Ct.args!==void 0?Ct.args.join(","):"";_t.push("c.",Ct.cmd,"(",at,`);
`)}return this.compiledGlyphs[pt]=new Function("c","size",_t.join(""))}return this.compiledGlyphs[pt]=function(_t,Ct){for(const at of tt)at.cmd==="scale"&&(at.args=[Ct,-Ct]),_t[at.cmd].apply(_t,at.args)}}}w.FontFaceObject=ut},(Y,w,W)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.NodeStandardFontDataFactory=w.NodeFilterFactory=w.NodeCanvasFactory=w.NodeCMapReaderFactory=void 0;var F=W(7);W(1);const O=function(pt){return new Promise((tt,_t)=>{require$$5.readFile(pt,(at,ct)=>{if(at||!ct){_t(new Error(at));return}tt(new Uint8Array(ct))})})};class ut extends F.BaseFilterFactory{}w.NodeFilterFactory=ut;class lt extends F.BaseCanvasFactory{_createCanvas(tt,_t){return require$$5.createCanvas(tt,_t)}}w.NodeCanvasFactory=lt;class Yt extends F.BaseCMapReaderFactory{_fetchData(tt,_t){return O(tt).then(Ct=>({cMapData:Ct,compressionType:_t}))}}w.NodeCMapReaderFactory=Yt;class vt extends F.BaseStandardFontDataFactory{_fetchData(tt){return O(tt)}}w.NodeStandardFontDataFactory=vt},(Y,w,W)=>{var Vt,Rs,Ds;Object.defineProperty(w,"__esModule",{value:!0}),w.CanvasGraphics=void 0;var F=W(1),O=W(6),ut=W(12),lt=W(13);const Yt=16,vt=100,pt=4096,tt=15,_t=10,Ct=1e3,at=16;function ct(dt,G){if(dt._removeMirroring)throw new Error("Context is already forwarding operations.");dt.__originalSave=dt.save,dt.__originalRestore=dt.restore,dt.__originalRotate=dt.rotate,dt.__originalScale=dt.scale,dt.__originalTranslate=dt.translate,dt.__originalTransform=dt.transform,dt.__originalSetTransform=dt.setTransform,dt.__originalResetTransform=dt.resetTransform,dt.__originalClip=dt.clip,dt.__originalMoveTo=dt.moveTo,dt.__originalLineTo=dt.lineTo,dt.__originalBezierCurveTo=dt.bezierCurveTo,dt.__originalRect=dt.rect,dt.__originalClosePath=dt.closePath,dt.__originalBeginPath=dt.beginPath,dt._removeMirroring=()=>{dt.save=dt.__originalSave,dt.restore=dt.__originalRestore,dt.rotate=dt.__originalRotate,dt.scale=dt.__originalScale,dt.translate=dt.__originalTranslate,dt.transform=dt.__originalTransform,dt.setTransform=dt.__originalSetTransform,dt.resetTransform=dt.__originalResetTransform,dt.clip=dt.__originalClip,dt.moveTo=dt.__originalMoveTo,dt.lineTo=dt.__originalLineTo,dt.bezierCurveTo=dt.__originalBezierCurveTo,dt.rect=dt.__originalRect,dt.closePath=dt.__originalClosePath,dt.beginPath=dt.__originalBeginPath,delete dt._removeMirroring},dt.save=function(){G.save(),this.__originalSave()},dt.restore=function(){G.restore(),this.__originalRestore()},dt.translate=function(et,bt){G.translate(et,bt),this.__originalTranslate(et,bt)},dt.scale=function(et,bt){G.scale(et,bt),this.__originalScale(et,bt)},dt.transform=function(et,bt,yt,At,kt,Wt){G.transform(et,bt,yt,At,kt,Wt),this.__originalTransform(et,bt,yt,At,kt,Wt)},dt.setTransform=function(et,bt,yt,At,kt,Wt){G.setTransform(et,bt,yt,At,kt,Wt),this.__originalSetTransform(et,bt,yt,At,kt,Wt)},dt.resetTransform=function(){G.resetTransform(),this.__originalResetTransform()},dt.rotate=function(et){G.rotate(et),this.__originalRotate(et)},dt.clip=function(et){G.clip(et),this.__originalClip(et)},dt.moveTo=function(X,et){G.moveTo(X,et),this.__originalMoveTo(X,et)},dt.lineTo=function(X,et){G.lineTo(X,et),this.__originalLineTo(X,et)},dt.bezierCurveTo=function(X,et,bt,yt,At,kt){G.bezierCurveTo(X,et,bt,yt,At,kt),this.__originalBezierCurveTo(X,et,bt,yt,At,kt)},dt.rect=function(X,et,bt,yt){G.rect(X,et,bt,yt),this.__originalRect(X,et,bt,yt)},dt.closePath=function(){G.closePath(),this.__originalClosePath()},dt.beginPath=function(){G.beginPath(),this.__originalBeginPath()}}class mt{constructor(G){this.canvasFactory=G,this.cache=Object.create(null)}getCanvas(G,X,et){let bt;return this.cache[G]!==void 0?(bt=this.cache[G],this.canvasFactory.reset(bt,X,et)):(bt=this.canvasFactory.create(X,et),this.cache[G]=bt),bt}delete(G){delete this.cache[G]}clear(){for(const G in this.cache){const X=this.cache[G];this.canvasFactory.destroy(X),delete this.cache[G]}}}function st(dt,G,X,et,bt,yt,At,kt,Wt,Jt){const[te,se,ne,ae,$t,Ut]=(0,O.getCurrentTransform)(dt);if(se===0&&ne===0){const It=At*te+$t,jt=Math.round(It),Zt=kt*ae+Ut,re=Math.round(Zt),oe=(At+Wt)*te+$t,Lt=Math.abs(Math.round(oe)-jt)||1,he=(kt+Jt)*ae+Ut,de=Math.abs(Math.round(he)-re)||1;return dt.setTransform(Math.sign(te),0,0,Math.sign(ae),jt,re),dt.drawImage(G,X,et,bt,yt,0,0,Lt,de),dt.setTransform(te,se,ne,ae,$t,Ut),[Lt,de]}if(te===0&&ae===0){const It=kt*ne+$t,jt=Math.round(It),Zt=At*se+Ut,re=Math.round(Zt),oe=(kt+Jt)*ne+$t,Lt=Math.abs(Math.round(oe)-jt)||1,he=(At+Wt)*se+Ut,de=Math.abs(Math.round(he)-re)||1;return dt.setTransform(0,Math.sign(se),Math.sign(ne),0,jt,re),dt.drawImage(G,X,et,bt,yt,0,0,de,Lt),dt.setTransform(te,se,ne,ae,$t,Ut),[de,Lt]}dt.drawImage(G,X,et,bt,yt,At,kt,Wt,Jt);const it=Math.hypot(te,se),St=Math.hypot(ne,ae);return[it*Wt,St*Jt]}function Z(dt){const{width:G,height:X}=dt;if(G>Ct||X>Ct)return null;const et=1e3,bt=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),yt=G+1;let At=new Uint8Array(yt*(X+1)),kt,Wt,Jt;const te=G+7&-8;let se=new Uint8Array(te*X),ne=0;for(const St of dt.data){let It=128;for(;It>0;)se[ne++]=St&It?0:255,It>>=1}let ae=0;for(ne=0,se[ne]!==0&&(At[0]=1,++ae),Wt=1;Wt<G;Wt++)se[ne]!==se[ne+1]&&(At[Wt]=se[ne]?2:1,++ae),ne++;for(se[ne]!==0&&(At[Wt]=2,++ae),kt=1;kt<X;kt++){ne=kt*te,Jt=kt*yt,se[ne-te]!==se[ne]&&(At[Jt]=se[ne]?1:8,++ae);let St=(se[ne]?4:0)+(se[ne-te]?8:0);for(Wt=1;Wt<G;Wt++)St=(St>>2)+(se[ne+1]?4:0)+(se[ne-te+1]?8:0),bt[St]&&(At[Jt+Wt]=bt[St],++ae),ne++;if(se[ne-te]!==se[ne]&&(At[Jt+Wt]=se[ne]?2:4,++ae),ae>et)return null}for(ne=te*(X-1),Jt=kt*yt,se[ne]!==0&&(At[Jt]=8,++ae),Wt=1;Wt<G;Wt++)se[ne]!==se[ne+1]&&(At[Jt+Wt]=se[ne]?4:8,++ae),ne++;if(se[ne]!==0&&(At[Jt+Wt]=4,++ae),ae>et)return null;const $t=new Int32Array([0,yt,-1,0,-yt,0,0,0,1]),Ut=new Path2D;for(kt=0;ae&&kt<=X;kt++){let St=kt*yt;const It=St+G;for(;St<It&&!At[St];)St++;if(St===It)continue;Ut.moveTo(St%yt,kt);const jt=St;let Zt=At[St];do{const re=$t[Zt];do St+=re;while(!At[St]);const oe=At[St];oe!==5&&oe!==10?(Zt=oe,At[St]=0):(Zt=oe&51*Zt>>4,At[St]&=Zt>>2|Zt<<2),Ut.lineTo(St%yt,St/yt|0),At[St]||--ae}while(jt!==St);--kt}return se=null,At=null,function(St){St.save(),St.scale(1/G,-1/X),St.translate(0,-X),St.fill(Ut),St.beginPath(),St.restore()}}class nt{constructor(G,X){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=F.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=F.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=F.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,G,X])}clone(){const G=Object.create(this);return G.clipBox=this.clipBox.slice(),G}setCurrentPoint(G,X){this.x=G,this.y=X}updatePathMinMax(G,X,et){[X,et]=F.Util.applyTransform([X,et],G),this.minX=Math.min(this.minX,X),this.minY=Math.min(this.minY,et),this.maxX=Math.max(this.maxX,X),this.maxY=Math.max(this.maxY,et)}updateRectMinMax(G,X){const et=F.Util.applyTransform(X,G),bt=F.Util.applyTransform(X.slice(2),G);this.minX=Math.min(this.minX,et[0],bt[0]),this.minY=Math.min(this.minY,et[1],bt[1]),this.maxX=Math.max(this.maxX,et[0],bt[0]),this.maxY=Math.max(this.maxY,et[1],bt[1])}updateScalingPathMinMax(G,X){F.Util.scaleMinMax(G,X),this.minX=Math.min(this.minX,X[0]),this.maxX=Math.max(this.maxX,X[1]),this.minY=Math.min(this.minY,X[2]),this.maxY=Math.max(this.maxY,X[3])}updateCurvePathMinMax(G,X,et,bt,yt,At,kt,Wt,Jt,te){const se=F.Util.bezierBoundingBox(X,et,bt,yt,At,kt,Wt,Jt);if(te){te[0]=Math.min(te[0],se[0],se[2]),te[1]=Math.max(te[1],se[0],se[2]),te[2]=Math.min(te[2],se[1],se[3]),te[3]=Math.max(te[3],se[1],se[3]);return}this.updateRectMinMax(G,se)}getPathBoundingBox(G=ut.PathType.FILL,X=null){const et=[this.minX,this.minY,this.maxX,this.maxY];if(G===ut.PathType.STROKE){X||(0,F.unreachable)("Stroke bounding box must include transform.");const bt=F.Util.singularValueDecompose2dScale(X),yt=bt[0]*this.lineWidth/2,At=bt[1]*this.lineWidth/2;et[0]-=yt,et[1]-=At,et[2]+=yt,et[3]+=At}return et}updateClipFromPath(){const G=F.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(G||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(G){this.clipBox=G,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(G=ut.PathType.FILL,X=null){return F.Util.intersect(this.clipBox,this.getPathBoundingBox(G,X))}}function Et(dt,G){if(typeof ImageData<"u"&&G instanceof ImageData){dt.putImageData(G,0,0);return}const X=G.height,et=G.width,bt=X%at,yt=(X-bt)/at,At=bt===0?yt:yt+1,kt=dt.createImageData(et,at);let Wt=0,Jt;const te=G.data,se=kt.data;let ne,ae,$t,Ut;if(G.kind===F.ImageKind.GRAYSCALE_1BPP){const it=te.byteLength,St=new Uint32Array(se.buffer,0,se.byteLength>>2),It=St.length,jt=et+7>>3,Zt=4294967295,re=F.FeatureTest.isLittleEndian?4278190080:255;for(ne=0;ne<At;ne++){for($t=ne<yt?at:bt,Jt=0,ae=0;ae<$t;ae++){const oe=it-Wt;let Lt=0;const he=oe>jt?et:oe*8-7,de=he&-8;let Ce=0,Ee=0;for(;Lt<de;Lt+=8)Ee=te[Wt++],St[Jt++]=Ee&128?Zt:re,St[Jt++]=Ee&64?Zt:re,St[Jt++]=Ee&32?Zt:re,St[Jt++]=Ee&16?Zt:re,St[Jt++]=Ee&8?Zt:re,St[Jt++]=Ee&4?Zt:re,St[Jt++]=Ee&2?Zt:re,St[Jt++]=Ee&1?Zt:re;for(;Lt<he;Lt++)Ce===0&&(Ee=te[Wt++],Ce=128),St[Jt++]=Ee&Ce?Zt:re,Ce>>=1}for(;Jt<It;)St[Jt++]=0;dt.putImageData(kt,0,ne*at)}}else if(G.kind===F.ImageKind.RGBA_32BPP){for(ae=0,Ut=et*at*4,ne=0;ne<yt;ne++)se.set(te.subarray(Wt,Wt+Ut)),Wt+=Ut,dt.putImageData(kt,0,ae),ae+=at;ne<At&&(Ut=et*bt*4,se.set(te.subarray(Wt,Wt+Ut)),dt.putImageData(kt,0,ae))}else if(G.kind===F.ImageKind.RGB_24BPP)for($t=at,Ut=et*$t,ne=0;ne<At;ne++){for(ne>=yt&&($t=bt,Ut=et*$t),Jt=0,ae=Ut;ae--;)se[Jt++]=te[Wt++],se[Jt++]=te[Wt++],se[Jt++]=te[Wt++],se[Jt++]=255;dt.putImageData(kt,0,ne*at)}else throw new Error(`bad image kind: ${G.kind}`)}function ot(dt,G){if(G.bitmap){dt.drawImage(G.bitmap,0,0);return}const X=G.height,et=G.width,bt=X%at,yt=(X-bt)/at,At=bt===0?yt:yt+1,kt=dt.createImageData(et,at);let Wt=0;const Jt=G.data,te=kt.data;for(let se=0;se<At;se++){const ne=se<yt?at:bt;({srcPos:Wt}=(0,lt.convertBlackAndWhiteToRGBA)({src:Jt,srcPos:Wt,dest:te,width:et,height:ne,nonBlackColor:0})),dt.putImageData(kt,0,se*at)}}function K(dt,G){const X=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const et of X)dt[et]!==void 0&&(G[et]=dt[et]);dt.setLineDash!==void 0&&(G.setLineDash(dt.getLineDash()),G.lineDashOffset=dt.lineDashOffset)}function q(dt){if(dt.strokeStyle=dt.fillStyle="#000000",dt.fillRule="nonzero",dt.globalAlpha=1,dt.lineWidth=1,dt.lineCap="butt",dt.lineJoin="miter",dt.miterLimit=10,dt.globalCompositeOperation="source-over",dt.font="10px sans-serif",dt.setLineDash!==void 0&&(dt.setLineDash([]),dt.lineDashOffset=0),!F.isNodeJS){const{filter:G}=dt;G!=="none"&&G!==""&&(dt.filter="none")}}function U(dt,G,X,et){const bt=dt.length;for(let yt=3;yt<bt;yt+=4){const At=dt[yt];if(At===0)dt[yt-3]=G,dt[yt-2]=X,dt[yt-1]=et;else if(At<255){const kt=255-At;dt[yt-3]=dt[yt-3]*At+G*kt>>8,dt[yt-2]=dt[yt-2]*At+X*kt>>8,dt[yt-1]=dt[yt-1]*At+et*kt>>8}}}function rt(dt,G,X){const et=dt.length,bt=1/255;for(let yt=3;yt<et;yt+=4){const At=X?X[dt[yt]]:dt[yt];G[yt]=G[yt]*At*bt|0}}function J(dt,G,X){const et=dt.length;for(let bt=3;bt<et;bt+=4){const yt=dt[bt-3]*77+dt[bt-2]*152+dt[bt-1]*28;G[bt]=X?G[bt]*X[yt>>8]>>8:G[bt]*yt>>16}}function Rt(dt,G,X,et,bt,yt,At,kt,Wt,Jt,te){const se=!!yt,ne=se?yt[0]:0,ae=se?yt[1]:0,$t=se?yt[2]:0,Ut=bt==="Luminosity"?J:rt,St=Math.min(et,Math.ceil(1048576/X));for(let It=0;It<et;It+=St){const jt=Math.min(St,et-It),Zt=dt.getImageData(kt-Jt,It+(Wt-te),X,jt),re=G.getImageData(kt,It+Wt,X,jt);se&&U(Zt.data,ne,ae,$t),Ut(Zt.data,re.data,At),G.putImageData(re,kt,It+Wt)}}function Q(dt,G,X,et){const bt=et[0],yt=et[1],At=et[2]-bt,kt=et[3]-yt;At===0||kt===0||(Rt(G.context,X,At,kt,G.subtype,G.backdrop,G.transferMap,bt,yt,G.offsetX,G.offsetY),dt.save(),dt.globalAlpha=1,dt.globalCompositeOperation="source-over",dt.setTransform(1,0,0,1,0,0),dt.drawImage(X.canvas,0,0),dt.restore())}function ft(dt,G){const X=F.Util.singularValueDecompose2dScale(dt);X[0]=Math.fround(X[0]),X[1]=Math.fround(X[1]);const et=Math.fround((globalThis.devicePixelRatio||1)*O.PixelsPerInch.PDF_TO_CSS_UNITS);return G!==void 0?G:X[0]<=et||X[1]<=et}const Tt=["butt","round","square"],Xt=["miter","round","bevel"],Ot={},Bt={},Nt=class Nt{constructor(G,X,et,bt,yt,{optionalContentConfig:At,markedContentStack:kt=null},Wt,Jt){Ht(this,Vt);this.ctx=G,this.current=new nt(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=X,this.objs=et,this.canvasFactory=bt,this.filterFactory=yt,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=kt||[],this.optionalContentConfig=At,this.cachedCanvases=new mt(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=Wt,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=Jt,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(G,X=null){return typeof G=="string"?G.startsWith("g_")?this.commonObjs.get(G):this.objs.get(G):X}beginDrawing({transform:G,viewport:X,transparency:et=!1,background:bt=null}){const yt=this.ctx.canvas.width,At=this.ctx.canvas.height,kt=this.ctx.fillStyle;if(this.ctx.fillStyle=bt||"#ffffff",this.ctx.fillRect(0,0,yt,At),this.ctx.fillStyle=kt,et){const Wt=this.cachedCanvases.getCanvas("transparent",yt,At);this.compositeCtx=this.ctx,this.transparentCanvas=Wt.canvas,this.ctx=Wt.context,this.ctx.save(),this.ctx.transform(...(0,O.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),q(this.ctx),G&&(this.ctx.transform(...G),this.outputScaleX=G[0],this.outputScaleY=G[0]),this.ctx.transform(...X.transform),this.viewportScale=X.scale,this.baseTransform=(0,O.getCurrentTransform)(this.ctx)}executeOperatorList(G,X,et,bt){const yt=G.argsArray,At=G.fnArray;let kt=X||0;const Wt=yt.length;if(Wt===kt)return kt;const Jt=Wt-kt>_t&&typeof et=="function",te=Jt?Date.now()+tt:0;let se=0;const ne=this.commonObjs,ae=this.objs;let $t;for(;;){if(bt!==void 0&&kt===bt.nextBreakPoint)return bt.breakIt(kt,et),kt;if($t=At[kt],$t!==F.OPS.dependency)this[$t].apply(this,yt[kt]);else for(const Ut of yt[kt]){const it=Ut.startsWith("g_")?ne:ae;if(!it.has(Ut))return it.get(Ut,et),kt}if(kt++,kt===Wt)return kt;if(Jt&&++se>_t){if(Date.now()>te)return et(),kt;se=0}}}endDrawing(){Ft(this,Vt,Rs).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const G of this._cachedBitmapsMap.values()){for(const X of G.values())typeof HTMLCanvasElement<"u"&&X instanceof HTMLCanvasElement&&(X.width=X.height=0);G.clear()}this._cachedBitmapsMap.clear(),Ft(this,Vt,Ds).call(this)}_scaleImage(G,X){const et=G.width,bt=G.height;let yt=Math.max(Math.hypot(X[0],X[1]),1),At=Math.max(Math.hypot(X[2],X[3]),1),kt=et,Wt=bt,Jt="prescale1",te,se;for(;yt>2&&kt>1||At>2&&Wt>1;){let ne=kt,ae=Wt;yt>2&&kt>1&&(ne=kt>=16384?Math.floor(kt/2)-1||1:Math.ceil(kt/2),yt/=kt/ne),At>2&&Wt>1&&(ae=Wt>=16384?Math.floor(Wt/2)-1||1:Math.ceil(Wt)/2,At/=Wt/ae),te=this.cachedCanvases.getCanvas(Jt,ne,ae),se=te.context,se.clearRect(0,0,ne,ae),se.drawImage(G,0,0,kt,Wt,0,0,ne,ae),G=te.canvas,kt=ne,Wt=ae,Jt=Jt==="prescale1"?"prescale2":"prescale1"}return{img:G,paintWidth:kt,paintHeight:Wt}}_createMaskCanvas(G){const X=this.ctx,{width:et,height:bt}=G,yt=this.current.fillColor,At=this.current.patternFill,kt=(0,O.getCurrentTransform)(X);let Wt,Jt,te,se;if((G.bitmap||G.data)&&G.count>1){const Lt=G.bitmap||G.data.buffer;Jt=JSON.stringify(At?kt:[kt.slice(0,4),yt]),Wt=this._cachedBitmapsMap.get(Lt),Wt||(Wt=new Map,this._cachedBitmapsMap.set(Lt,Wt));const he=Wt.get(Jt);if(he&&!At){const de=Math.round(Math.min(kt[0],kt[2])+kt[4]),Ce=Math.round(Math.min(kt[1],kt[3])+kt[5]);return{canvas:he,offsetX:de,offsetY:Ce}}te=he}te||(se=this.cachedCanvases.getCanvas("maskCanvas",et,bt),ot(se.context,G));let ne=F.Util.transform(kt,[1/et,0,0,-1/bt,0,0]);ne=F.Util.transform(ne,[1,0,0,1,0,-bt]);const ae=F.Util.applyTransform([0,0],ne),$t=F.Util.applyTransform([et,bt],ne),Ut=F.Util.normalizeRect([ae[0],ae[1],$t[0],$t[1]]),it=Math.round(Ut[2]-Ut[0])||1,St=Math.round(Ut[3]-Ut[1])||1,It=this.cachedCanvases.getCanvas("fillCanvas",it,St),jt=It.context,Zt=Math.min(ae[0],$t[0]),re=Math.min(ae[1],$t[1]);jt.translate(-Zt,-re),jt.transform(...ne),te||(te=this._scaleImage(se.canvas,(0,O.getCurrentTransformInverse)(jt)),te=te.img,Wt&&At&&Wt.set(Jt,te)),jt.imageSmoothingEnabled=ft((0,O.getCurrentTransform)(jt),G.interpolate),st(jt,te,0,0,te.width,te.height,0,0,et,bt),jt.globalCompositeOperation="source-in";const oe=F.Util.transform((0,O.getCurrentTransformInverse)(jt),[1,0,0,1,-Zt,-re]);return jt.fillStyle=At?yt.getPattern(X,this,oe,ut.PathType.FILL):yt,jt.fillRect(0,0,et,bt),Wt&&!At&&(this.cachedCanvases.delete("fillCanvas"),Wt.set(Jt,It.canvas)),{canvas:It.canvas,offsetX:Math.round(Zt),offsetY:Math.round(re)}}setLineWidth(G){G!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=G,this.ctx.lineWidth=G}setLineCap(G){this.ctx.lineCap=Tt[G]}setLineJoin(G){this.ctx.lineJoin=Xt[G]}setMiterLimit(G){this.ctx.miterLimit=G}setDash(G,X){const et=this.ctx;et.setLineDash!==void 0&&(et.setLineDash(G),et.lineDashOffset=X)}setRenderingIntent(G){}setFlatness(G){}setGState(G){for(const[X,et]of G)switch(X){case"LW":this.setLineWidth(et);break;case"LC":this.setLineCap(et);break;case"LJ":this.setLineJoin(et);break;case"ML":this.setMiterLimit(et);break;case"D":this.setDash(et[0],et[1]);break;case"RI":this.setRenderingIntent(et);break;case"FL":this.setFlatness(et);break;case"Font":this.setFont(et[0],et[1]);break;case"CA":this.current.strokeAlpha=et;break;case"ca":this.current.fillAlpha=et,this.ctx.globalAlpha=et;break;case"BM":this.ctx.globalCompositeOperation=et;break;case"SMask":this.current.activeSMask=et?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(et);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const G=this.inSMaskMode;this.current.activeSMask&&!G?this.beginSMaskMode():!this.current.activeSMask&&G&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const G=this.ctx.canvas.width,X=this.ctx.canvas.height,et="smaskGroupAt"+this.groupLevel,bt=this.cachedCanvases.getCanvas(et,G,X);this.suspendedCtx=this.ctx,this.ctx=bt.context;const yt=this.ctx;yt.setTransform(...(0,O.getCurrentTransform)(this.suspendedCtx)),K(this.suspendedCtx,yt),ct(yt,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),K(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(G){if(!this.current.activeSMask)return;G?(G[0]=Math.floor(G[0]),G[1]=Math.floor(G[1]),G[2]=Math.ceil(G[2]),G[3]=Math.ceil(G[3])):G=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const X=this.current.activeSMask,et=this.suspendedCtx;Q(et,X,this.ctx,G),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(K(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const G=this.current;this.stateStack.push(G),this.current=G.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),K(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(G,X,et,bt,yt,At){this.ctx.transform(G,X,et,bt,yt,At),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(G,X,et){const bt=this.ctx,yt=this.current;let At=yt.x,kt=yt.y,Wt,Jt;const te=(0,O.getCurrentTransform)(bt),se=te[0]===0&&te[3]===0||te[1]===0&&te[2]===0,ne=se?et.slice(0):null;for(let ae=0,$t=0,Ut=G.length;ae<Ut;ae++)switch(G[ae]|0){case F.OPS.rectangle:At=X[$t++],kt=X[$t++];const it=X[$t++],St=X[$t++],It=At+it,jt=kt+St;bt.moveTo(At,kt),it===0||St===0?bt.lineTo(It,jt):(bt.lineTo(It,kt),bt.lineTo(It,jt),bt.lineTo(At,jt)),se||yt.updateRectMinMax(te,[At,kt,It,jt]),bt.closePath();break;case F.OPS.moveTo:At=X[$t++],kt=X[$t++],bt.moveTo(At,kt),se||yt.updatePathMinMax(te,At,kt);break;case F.OPS.lineTo:At=X[$t++],kt=X[$t++],bt.lineTo(At,kt),se||yt.updatePathMinMax(te,At,kt);break;case F.OPS.curveTo:Wt=At,Jt=kt,At=X[$t+4],kt=X[$t+5],bt.bezierCurveTo(X[$t],X[$t+1],X[$t+2],X[$t+3],At,kt),yt.updateCurvePathMinMax(te,Wt,Jt,X[$t],X[$t+1],X[$t+2],X[$t+3],At,kt,ne),$t+=6;break;case F.OPS.curveTo2:Wt=At,Jt=kt,bt.bezierCurveTo(At,kt,X[$t],X[$t+1],X[$t+2],X[$t+3]),yt.updateCurvePathMinMax(te,Wt,Jt,At,kt,X[$t],X[$t+1],X[$t+2],X[$t+3],ne),At=X[$t+2],kt=X[$t+3],$t+=4;break;case F.OPS.curveTo3:Wt=At,Jt=kt,At=X[$t+2],kt=X[$t+3],bt.bezierCurveTo(X[$t],X[$t+1],At,kt,At,kt),yt.updateCurvePathMinMax(te,Wt,Jt,X[$t],X[$t+1],At,kt,At,kt,ne),$t+=4;break;case F.OPS.closePath:bt.closePath();break}se&&yt.updateScalingPathMinMax(te,ne),yt.setCurrentPoint(At,kt)}closePath(){this.ctx.closePath()}stroke(G=!0){const X=this.ctx,et=this.current.strokeColor;X.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof et=="object"&&et?.getPattern?(X.save(),X.strokeStyle=et.getPattern(X,this,(0,O.getCurrentTransformInverse)(X),ut.PathType.STROKE),this.rescaleAndStroke(!1),X.restore()):this.rescaleAndStroke(!0)),G&&this.consumePath(this.current.getClippedPathBoundingBox()),X.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(G=!0){const X=this.ctx,et=this.current.fillColor,bt=this.current.patternFill;let yt=!1;bt&&(X.save(),X.fillStyle=et.getPattern(X,this,(0,O.getCurrentTransformInverse)(X),ut.PathType.FILL),yt=!0);const At=this.current.getClippedPathBoundingBox();this.contentVisible&&At!==null&&(this.pendingEOFill?(X.fill("evenodd"),this.pendingEOFill=!1):X.fill()),yt&&X.restore(),G&&this.consumePath(At)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Ot}eoClip(){this.pendingClip=Bt}beginText(){this.current.textMatrix=F.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const G=this.pendingTextPaths,X=this.ctx;if(G===void 0){X.beginPath();return}X.save(),X.beginPath();for(const et of G)X.setTransform(...et.transform),X.translate(et.x,et.y),et.addToPath(X,et.fontSize);X.restore(),X.clip(),X.beginPath(),delete this.pendingTextPaths}setCharSpacing(G){this.current.charSpacing=G}setWordSpacing(G){this.current.wordSpacing=G}setHScale(G){this.current.textHScale=G/100}setLeading(G){this.current.leading=-G}setFont(G,X){const et=this.commonObjs.get(G),bt=this.current;if(!et)throw new Error(`Can't find font for ${G}`);if(bt.fontMatrix=et.fontMatrix||F.FONT_IDENTITY_MATRIX,(bt.fontMatrix[0]===0||bt.fontMatrix[3]===0)&&(0,F.warn)("Invalid font matrix for font "+G),X<0?(X=-X,bt.fontDirection=-1):bt.fontDirection=1,this.current.font=et,this.current.fontSize=X,et.isType3Font)return;const yt=et.loadedName||"sans-serif",At=et.systemFontInfo?.css||`"${yt}", ${et.fallbackName}`;let kt="normal";et.black?kt="900":et.bold&&(kt="bold");const Wt=et.italic?"italic":"normal";let Jt=X;X<Yt?Jt=Yt:X>vt&&(Jt=vt),this.current.fontSizeScale=X/Jt,this.ctx.font=`${Wt} ${kt} ${Jt}px ${At}`}setTextRenderingMode(G){this.current.textRenderingMode=G}setTextRise(G){this.current.textRise=G}moveText(G,X){this.current.x=this.current.lineX+=G,this.current.y=this.current.lineY+=X}setLeadingMoveText(G,X){this.setLeading(-X),this.moveText(G,X)}setTextMatrix(G,X,et,bt,yt,At){this.current.textMatrix=[G,X,et,bt,yt,At],this.current.textMatrixScale=Math.hypot(G,X),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(G,X,et,bt){const yt=this.ctx,At=this.current,kt=At.font,Wt=At.textRenderingMode,Jt=At.fontSize/At.fontSizeScale,te=Wt&F.TextRenderingMode.FILL_STROKE_MASK,se=!!(Wt&F.TextRenderingMode.ADD_TO_PATH_FLAG),ne=At.patternFill&&!kt.missingFile;let ae;(kt.disableFontFace||se||ne)&&(ae=kt.getPathGenerator(this.commonObjs,G)),kt.disableFontFace||ne?(yt.save(),yt.translate(X,et),yt.beginPath(),ae(yt,Jt),bt&&yt.setTransform(...bt),(te===F.TextRenderingMode.FILL||te===F.TextRenderingMode.FILL_STROKE)&&yt.fill(),(te===F.TextRenderingMode.STROKE||te===F.TextRenderingMode.FILL_STROKE)&&yt.stroke(),yt.restore()):((te===F.TextRenderingMode.FILL||te===F.TextRenderingMode.FILL_STROKE)&&yt.fillText(G,X,et),(te===F.TextRenderingMode.STROKE||te===F.TextRenderingMode.FILL_STROKE)&&yt.strokeText(G,X,et)),se&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,O.getCurrentTransform)(yt),x:X,y:et,fontSize:Jt,addToPath:ae})}get isFontSubpixelAAEnabled(){const{context:G}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);G.scale(1.5,1),G.fillText("I",0,10);const X=G.getImageData(0,0,10,10).data;let et=!1;for(let bt=3;bt<X.length;bt+=4)if(X[bt]>0&&X[bt]<255){et=!0;break}return(0,F.shadow)(this,"isFontSubpixelAAEnabled",et)}showText(G){const X=this.current,et=X.font;if(et.isType3Font)return this.showType3Text(G);const bt=X.fontSize;if(bt===0)return;const yt=this.ctx,At=X.fontSizeScale,kt=X.charSpacing,Wt=X.wordSpacing,Jt=X.fontDirection,te=X.textHScale*Jt,se=G.length,ne=et.vertical,ae=ne?1:-1,$t=et.defaultVMetrics,Ut=bt*X.fontMatrix[0],it=X.textRenderingMode===F.TextRenderingMode.FILL&&!et.disableFontFace&&!X.patternFill;yt.save(),yt.transform(...X.textMatrix),yt.translate(X.x,X.y+X.textRise),Jt>0?yt.scale(te,-1):yt.scale(te,1);let St;if(X.patternFill){yt.save();const oe=X.fillColor.getPattern(yt,this,(0,O.getCurrentTransformInverse)(yt),ut.PathType.FILL);St=(0,O.getCurrentTransform)(yt),yt.restore(),yt.fillStyle=oe}let It=X.lineWidth;const jt=X.textMatrixScale;if(jt===0||It===0){const oe=X.textRenderingMode&F.TextRenderingMode.FILL_STROKE_MASK;(oe===F.TextRenderingMode.STROKE||oe===F.TextRenderingMode.FILL_STROKE)&&(It=this.getSinglePixelWidth())}else It/=jt;if(At!==1&&(yt.scale(At,At),It/=At),yt.lineWidth=It,et.isInvalidPDFjsFont){const oe=[];let Lt=0;for(const he of G)oe.push(he.unicode),Lt+=he.width;yt.fillText(oe.join(""),0,0),X.x+=Lt*Ut*te,yt.restore(),this.compose();return}let Zt=0,re;for(re=0;re<se;++re){const oe=G[re];if(typeof oe=="number"){Zt+=ae*oe*bt/1e3;continue}let Lt=!1;const he=(oe.isSpace?Wt:0)+kt,de=oe.fontChar,Ce=oe.accent;let Ee,Fe,be=oe.width;if(ne){const ke=oe.vmetric||$t,Re=-(oe.vmetric?ke[1]:be*.5)*Ut,le=ke[2]*Ut;be=ke?-ke[0]:be,Ee=Re/At,Fe=(Zt+le)/At}else Ee=Zt/At,Fe=0;if(et.remeasure&&be>0){const ke=yt.measureText(de).width*1e3/bt*At;if(be<ke&&this.isFontSubpixelAAEnabled){const Re=be/ke;Lt=!0,yt.save(),yt.scale(Re,1),Ee/=Re}else be!==ke&&(Ee+=(be-ke)/2e3*bt/At)}if(this.contentVisible&&(oe.isInFont||et.missingFile)){if(it&&!Ce)yt.fillText(de,Ee,Fe);else if(this.paintChar(de,Ee,Fe,St),Ce){const ke=Ee+bt*Ce.offset.x/At,Re=Fe-bt*Ce.offset.y/At;this.paintChar(Ce.fontChar,ke,Re,St)}}const we=ne?be*Ut-he*Jt:be*Ut+he*Jt;Zt+=we,Lt&&yt.restore()}ne?X.y-=Zt:X.x+=Zt*te,yt.restore(),this.compose()}showType3Text(G){const X=this.ctx,et=this.current,bt=et.font,yt=et.fontSize,At=et.fontDirection,kt=bt.vertical?1:-1,Wt=et.charSpacing,Jt=et.wordSpacing,te=et.textHScale*At,se=et.fontMatrix||F.FONT_IDENTITY_MATRIX,ne=G.length,ae=et.textRenderingMode===F.TextRenderingMode.INVISIBLE;let $t,Ut,it,St;if(!(ae||yt===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,X.save(),X.transform(...et.textMatrix),X.translate(et.x,et.y),X.scale(te,At),$t=0;$t<ne;++$t){if(Ut=G[$t],typeof Ut=="number"){St=kt*Ut*yt/1e3,this.ctx.translate(St,0),et.x+=St*te;continue}const It=(Ut.isSpace?Jt:0)+Wt,jt=bt.charProcOperatorList[Ut.operatorListId];if(!jt){(0,F.warn)(`Type3 character "${Ut.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=Ut,this.save(),X.scale(yt,yt),X.transform(...se),this.executeOperatorList(jt),this.restore()),it=F.Util.applyTransform([Ut.width,0],se)[0]*yt+It,X.translate(it,0),et.x+=it*te}X.restore(),this.processingType3=null}}setCharWidth(G,X){}setCharWidthAndBounds(G,X,et,bt,yt,At){this.ctx.rect(et,bt,yt-et,At-bt),this.ctx.clip(),this.endPath()}getColorN_Pattern(G){let X;if(G[0]==="TilingPattern"){const et=G[1],bt=this.baseTransform||(0,O.getCurrentTransform)(this.ctx),yt={createCanvasGraphics:At=>new Nt(At,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};X=new ut.TilingPattern(G,et,this.ctx,yt,bt)}else X=this._getPattern(G[1],G[2]);return X}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(G,X,et){const bt=F.Util.makeHexColor(G,X,et);this.ctx.strokeStyle=bt,this.current.strokeColor=bt}setFillRGBColor(G,X,et){const bt=F.Util.makeHexColor(G,X,et);this.ctx.fillStyle=bt,this.current.fillColor=bt,this.current.patternFill=!1}_getPattern(G,X=null){let et;return this.cachedPatterns.has(G)?et=this.cachedPatterns.get(G):(et=(0,ut.getShadingPattern)(this.getObject(G)),this.cachedPatterns.set(G,et)),X&&(et.matrix=X),et}shadingFill(G){if(!this.contentVisible)return;const X=this.ctx;this.save();const et=this._getPattern(G);X.fillStyle=et.getPattern(X,this,(0,O.getCurrentTransformInverse)(X),ut.PathType.SHADING);const bt=(0,O.getCurrentTransformInverse)(X);if(bt){const{width:yt,height:At}=X.canvas,[kt,Wt,Jt,te]=F.Util.getAxialAlignedBoundingBox([0,0,yt,At],bt);this.ctx.fillRect(kt,Wt,Jt-kt,te-Wt)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,F.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,F.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(G,X){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(G)&&G.length===6&&this.transform(...G),this.baseTransform=(0,O.getCurrentTransform)(this.ctx),X)){const et=X[2]-X[0],bt=X[3]-X[1];this.ctx.rect(X[0],X[1],et,bt),this.current.updateRectMinMax((0,O.getCurrentTransform)(this.ctx),X),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(G){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const X=this.ctx;G.isolated||(0,F.info)("TODO: Support non-isolated groups."),G.knockout&&(0,F.warn)("Knockout groups not supported.");const et=(0,O.getCurrentTransform)(X);if(G.matrix&&X.transform(...G.matrix),!G.bbox)throw new Error("Bounding box is required.");let bt=F.Util.getAxialAlignedBoundingBox(G.bbox,(0,O.getCurrentTransform)(X));const yt=[0,0,X.canvas.width,X.canvas.height];bt=F.Util.intersect(bt,yt)||[0,0,0,0];const At=Math.floor(bt[0]),kt=Math.floor(bt[1]);let Wt=Math.max(Math.ceil(bt[2])-At,1),Jt=Math.max(Math.ceil(bt[3])-kt,1),te=1,se=1;Wt>pt&&(te=Wt/pt,Wt=pt),Jt>pt&&(se=Jt/pt,Jt=pt),this.current.startNewPathAndClipBox([0,0,Wt,Jt]);let ne="groupAt"+this.groupLevel;G.smask&&(ne+="_smask_"+this.smaskCounter++%2);const ae=this.cachedCanvases.getCanvas(ne,Wt,Jt),$t=ae.context;$t.scale(1/te,1/se),$t.translate(-At,-kt),$t.transform(...et),G.smask?this.smaskStack.push({canvas:ae.canvas,context:$t,offsetX:At,offsetY:kt,scaleX:te,scaleY:se,subtype:G.smask.subtype,backdrop:G.smask.backdrop,transferMap:G.smask.transferMap||null,startTransformInverse:null}):(X.setTransform(1,0,0,1,0,0),X.translate(At,kt),X.scale(te,se),X.save()),K(X,$t),this.ctx=$t,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(X),this.groupLevel++}endGroup(G){if(!this.contentVisible)return;this.groupLevel--;const X=this.ctx,et=this.groupStack.pop();if(this.ctx=et,this.ctx.imageSmoothingEnabled=!1,G.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const bt=(0,O.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...bt);const yt=F.Util.getAxialAlignedBoundingBox([0,0,X.canvas.width,X.canvas.height],bt);this.ctx.drawImage(X.canvas,0,0),this.ctx.restore(),this.compose(yt)}}beginAnnotation(G,X,et,bt,yt){if(Ft(this,Vt,Rs).call(this),q(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(X)&&X.length===4){const At=X[2]-X[0],kt=X[3]-X[1];if(yt&&this.annotationCanvasMap){et=et.slice(),et[4]-=X[0],et[5]-=X[1],X=X.slice(),X[0]=X[1]=0,X[2]=At,X[3]=kt;const[Wt,Jt]=F.Util.singularValueDecompose2dScale((0,O.getCurrentTransform)(this.ctx)),{viewportScale:te}=this,se=Math.ceil(At*this.outputScaleX*te),ne=Math.ceil(kt*this.outputScaleY*te);this.annotationCanvas=this.canvasFactory.create(se,ne);const{canvas:ae,context:$t}=this.annotationCanvas;this.annotationCanvasMap.set(G,ae),this.annotationCanvas.savedCtx=this.ctx,this.ctx=$t,this.ctx.save(),this.ctx.setTransform(Wt,0,0,-Jt,0,kt*Jt),q(this.ctx)}else q(this.ctx),this.ctx.rect(X[0],X[1],At,kt),this.ctx.clip(),this.endPath()}this.current=new nt(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...et),this.transform(...bt)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),Ft(this,Vt,Ds).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(G){if(!this.contentVisible)return;const X=G.count;G=this.getObject(G.data,G),G.count=X;const et=this.ctx,bt=this.processingType3;if(bt&&(bt.compiled===void 0&&(bt.compiled=Z(G)),bt.compiled)){bt.compiled(et);return}const yt=this._createMaskCanvas(G),At=yt.canvas;et.save(),et.setTransform(1,0,0,1,0,0),et.drawImage(At,yt.offsetX,yt.offsetY),et.restore(),this.compose()}paintImageMaskXObjectRepeat(G,X,et=0,bt=0,yt,At){if(!this.contentVisible)return;G=this.getObject(G.data,G);const kt=this.ctx;kt.save();const Wt=(0,O.getCurrentTransform)(kt);kt.transform(X,et,bt,yt,0,0);const Jt=this._createMaskCanvas(G);kt.setTransform(1,0,0,1,Jt.offsetX-Wt[4],Jt.offsetY-Wt[5]);for(let te=0,se=At.length;te<se;te+=2){const ne=F.Util.transform(Wt,[X,et,bt,yt,At[te],At[te+1]]),[ae,$t]=F.Util.applyTransform([0,0],ne);kt.drawImage(Jt.canvas,ae,$t)}kt.restore(),this.compose()}paintImageMaskXObjectGroup(G){if(!this.contentVisible)return;const X=this.ctx,et=this.current.fillColor,bt=this.current.patternFill;for(const yt of G){const{data:At,width:kt,height:Wt,transform:Jt}=yt,te=this.cachedCanvases.getCanvas("maskCanvas",kt,Wt),se=te.context;se.save();const ne=this.getObject(At,yt);ot(se,ne),se.globalCompositeOperation="source-in",se.fillStyle=bt?et.getPattern(se,this,(0,O.getCurrentTransformInverse)(X),ut.PathType.FILL):et,se.fillRect(0,0,kt,Wt),se.restore(),X.save(),X.transform(...Jt),X.scale(1,-1),st(X,te.canvas,0,0,kt,Wt,0,-1,1,1),X.restore()}this.compose()}paintImageXObject(G){if(!this.contentVisible)return;const X=this.getObject(G);if(!X){(0,F.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(X)}paintImageXObjectRepeat(G,X,et,bt){if(!this.contentVisible)return;const yt=this.getObject(G);if(!yt){(0,F.warn)("Dependent image isn't ready yet");return}const At=yt.width,kt=yt.height,Wt=[];for(let Jt=0,te=bt.length;Jt<te;Jt+=2)Wt.push({transform:[X,0,0,et,bt[Jt],bt[Jt+1]],x:0,y:0,w:At,h:kt});this.paintInlineImageXObjectGroup(yt,Wt)}applyTransferMapsToCanvas(G){return this.current.transferMaps!=="none"&&(G.filter=this.current.transferMaps,G.drawImage(G.canvas,0,0),G.filter="none"),G.canvas}applyTransferMapsToBitmap(G){if(this.current.transferMaps==="none")return G.bitmap;const{bitmap:X,width:et,height:bt}=G,yt=this.cachedCanvases.getCanvas("inlineImage",et,bt),At=yt.context;return At.filter=this.current.transferMaps,At.drawImage(X,0,0),At.filter="none",yt.canvas}paintInlineImageXObject(G){if(!this.contentVisible)return;const X=G.width,et=G.height,bt=this.ctx;if(this.save(),!F.isNodeJS){const{filter:kt}=bt;kt!=="none"&&kt!==""&&(bt.filter="none")}bt.scale(1/X,-1/et);let yt;if(G.bitmap)yt=this.applyTransferMapsToBitmap(G);else if(typeof HTMLElement=="function"&&G instanceof HTMLElement||!G.data)yt=G;else{const Wt=this.cachedCanvases.getCanvas("inlineImage",X,et).context;Et(Wt,G),yt=this.applyTransferMapsToCanvas(Wt)}const At=this._scaleImage(yt,(0,O.getCurrentTransformInverse)(bt));bt.imageSmoothingEnabled=ft((0,O.getCurrentTransform)(bt),G.interpolate),st(bt,At.img,0,0,At.paintWidth,At.paintHeight,0,-et,X,et),this.compose(),this.restore()}paintInlineImageXObjectGroup(G,X){if(!this.contentVisible)return;const et=this.ctx;let bt;if(G.bitmap)bt=G.bitmap;else{const yt=G.width,At=G.height,Wt=this.cachedCanvases.getCanvas("inlineImage",yt,At).context;Et(Wt,G),bt=this.applyTransferMapsToCanvas(Wt)}for(const yt of X)et.save(),et.transform(...yt.transform),et.scale(1,-1),st(et,bt,yt.x,yt.y,yt.w,yt.h,0,-1,1,1),et.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(G){}markPointProps(G,X){}beginMarkedContent(G){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(G,X){G==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(X)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(G){const X=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(G);const et=this.ctx;this.pendingClip&&(X||(this.pendingClip===Bt?et.clip("evenodd"):et.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),et.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const G=(0,O.getCurrentTransform)(this.ctx);if(G[1]===0&&G[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(G[0]),Math.abs(G[3]));else{const X=Math.abs(G[0]*G[3]-G[2]*G[1]),et=Math.hypot(G[0],G[2]),bt=Math.hypot(G[1],G[3]);this._cachedGetSinglePixelWidth=Math.max(et,bt)/X}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:G}=this.current,{a:X,b:et,c:bt,d:yt}=this.ctx.getTransform();let At,kt;if(et===0&&bt===0){const Wt=Math.abs(X),Jt=Math.abs(yt);if(Wt===Jt)if(G===0)At=kt=1/Wt;else{const te=Wt*G;At=kt=te<1?1/te:1}else if(G===0)At=1/Wt,kt=1/Jt;else{const te=Wt*G,se=Jt*G;At=te<1?1/te:1,kt=se<1?1/se:1}}else{const Wt=Math.abs(X*yt-et*bt),Jt=Math.hypot(X,et),te=Math.hypot(bt,yt);if(G===0)At=te/Wt,kt=Jt/Wt;else{const se=G*Wt;At=te>se?te/se:1,kt=Jt>se?Jt/se:1}}this._cachedScaleForStroking[0]=At,this._cachedScaleForStroking[1]=kt}return this._cachedScaleForStroking}rescaleAndStroke(G){const{ctx:X}=this,{lineWidth:et}=this.current,[bt,yt]=this.getScaleForStroking();if(X.lineWidth=et||1,bt===1&&yt===1){X.stroke();return}const At=X.getLineDash();if(G&&X.save(),X.scale(bt,yt),At.length>0){const kt=Math.max(bt,yt);X.setLineDash(At.map(Wt=>Wt/kt)),X.lineDashOffset/=kt}X.stroke(),G&&X.restore()}isContentVisible(){for(let G=this.markedContentStack.length-1;G>=0;G--)if(!this.markedContentStack[G].visible)return!1;return!0}};Vt=new WeakSet,Rs=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Ds=function(){if(this.pageColors){const G=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(G!=="none"){const X=this.ctx.filter;this.ctx.filter=G,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=X}}};let Mt=Nt;w.CanvasGraphics=Mt;for(const dt in F.OPS)Mt.prototype[dt]!==void 0&&(Mt.prototype[F.OPS[dt]]=Mt.prototype[dt])},(Y,w,W)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.TilingPattern=w.PathType=void 0,w.getShadingPattern=at;var F=W(1),O=W(6);const ut={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};w.PathType=ut;function lt(Z,nt){if(!nt)return;const Et=nt[2]-nt[0],ot=nt[3]-nt[1],K=new Path2D;K.rect(nt[0],nt[1],Et,ot),Z.clip(K)}class Yt{constructor(){this.constructor===Yt&&(0,F.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,F.unreachable)("Abstract method `getPattern` called.")}}class vt extends Yt{constructor(nt){super(),this._type=nt[1],this._bbox=nt[2],this._colorStops=nt[3],this._p0=nt[4],this._p1=nt[5],this._r0=nt[6],this._r1=nt[7],this.matrix=null}_createGradient(nt){let Et;this._type==="axial"?Et=nt.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(Et=nt.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const ot of this._colorStops)Et.addColorStop(ot[0],ot[1]);return Et}getPattern(nt,Et,ot,K){let q;if(K===ut.STROKE||K===ut.FILL){const U=Et.current.getClippedPathBoundingBox(K,(0,O.getCurrentTransform)(nt))||[0,0,0,0],rt=Math.ceil(U[2]-U[0])||1,J=Math.ceil(U[3]-U[1])||1,Rt=Et.cachedCanvases.getCanvas("pattern",rt,J,!0),Q=Rt.context;Q.clearRect(0,0,Q.canvas.width,Q.canvas.height),Q.beginPath(),Q.rect(0,0,Q.canvas.width,Q.canvas.height),Q.translate(-U[0],-U[1]),ot=F.Util.transform(ot,[1,0,0,1,U[0],U[1]]),Q.transform(...Et.baseTransform),this.matrix&&Q.transform(...this.matrix),lt(Q,this._bbox),Q.fillStyle=this._createGradient(Q),Q.fill(),q=nt.createPattern(Rt.canvas,"no-repeat");const ft=new DOMMatrix(ot);q.setTransform(ft)}else lt(nt,this._bbox),q=this._createGradient(nt);return q}}function pt(Z,nt,Et,ot,K,q,U,rt){const J=nt.coords,Rt=nt.colors,Q=Z.data,ft=Z.width*4;let Tt;J[Et+1]>J[ot+1]&&(Tt=Et,Et=ot,ot=Tt,Tt=q,q=U,U=Tt),J[ot+1]>J[K+1]&&(Tt=ot,ot=K,K=Tt,Tt=U,U=rt,rt=Tt),J[Et+1]>J[ot+1]&&(Tt=Et,Et=ot,ot=Tt,Tt=q,q=U,U=Tt);const Xt=(J[Et]+nt.offsetX)*nt.scaleX,Ot=(J[Et+1]+nt.offsetY)*nt.scaleY,Bt=(J[ot]+nt.offsetX)*nt.scaleX,Mt=(J[ot+1]+nt.offsetY)*nt.scaleY,Vt=(J[K]+nt.offsetX)*nt.scaleX,xt=(J[K+1]+nt.offsetY)*nt.scaleY;if(Ot>=xt)return;const Dt=Rt[q],Nt=Rt[q+1],dt=Rt[q+2],G=Rt[U],X=Rt[U+1],et=Rt[U+2],bt=Rt[rt],yt=Rt[rt+1],At=Rt[rt+2],kt=Math.round(Ot),Wt=Math.round(xt);let Jt,te,se,ne,ae,$t,Ut,it;for(let St=kt;St<=Wt;St++){if(St<Mt){const oe=St<Ot?0:(Ot-St)/(Ot-Mt);Jt=Xt-(Xt-Bt)*oe,te=Dt-(Dt-G)*oe,se=Nt-(Nt-X)*oe,ne=dt-(dt-et)*oe}else{let oe;St>xt?oe=1:Mt===xt?oe=0:oe=(Mt-St)/(Mt-xt),Jt=Bt-(Bt-Vt)*oe,te=G-(G-bt)*oe,se=X-(X-yt)*oe,ne=et-(et-At)*oe}let It;St<Ot?It=0:St>xt?It=1:It=(Ot-St)/(Ot-xt),ae=Xt-(Xt-Vt)*It,$t=Dt-(Dt-bt)*It,Ut=Nt-(Nt-yt)*It,it=dt-(dt-At)*It;const jt=Math.round(Math.min(Jt,ae)),Zt=Math.round(Math.max(Jt,ae));let re=ft*St+jt*4;for(let oe=jt;oe<=Zt;oe++)It=(Jt-oe)/(Jt-ae),It<0?It=0:It>1&&(It=1),Q[re++]=te-(te-$t)*It|0,Q[re++]=se-(se-Ut)*It|0,Q[re++]=ne-(ne-it)*It|0,Q[re++]=255}}function tt(Z,nt,Et){const ot=nt.coords,K=nt.colors;let q,U;switch(nt.type){case"lattice":const rt=nt.verticesPerRow,J=Math.floor(ot.length/rt)-1,Rt=rt-1;for(q=0;q<J;q++){let Q=q*rt;for(let ft=0;ft<Rt;ft++,Q++)pt(Z,Et,ot[Q],ot[Q+1],ot[Q+rt],K[Q],K[Q+1],K[Q+rt]),pt(Z,Et,ot[Q+rt+1],ot[Q+1],ot[Q+rt],K[Q+rt+1],K[Q+1],K[Q+rt])}break;case"triangles":for(q=0,U=ot.length;q<U;q+=3)pt(Z,Et,ot[q],ot[q+1],ot[q+2],K[q],K[q+1],K[q+2]);break;default:throw new Error("illegal figure")}}class _t extends Yt{constructor(nt){super(),this._coords=nt[2],this._colors=nt[3],this._figures=nt[4],this._bounds=nt[5],this._bbox=nt[7],this._background=nt[8],this.matrix=null}_createMeshCanvas(nt,Et,ot){const rt=Math.floor(this._bounds[0]),J=Math.floor(this._bounds[1]),Rt=Math.ceil(this._bounds[2])-rt,Q=Math.ceil(this._bounds[3])-J,ft=Math.min(Math.ceil(Math.abs(Rt*nt[0]*1.1)),3e3),Tt=Math.min(Math.ceil(Math.abs(Q*nt[1]*1.1)),3e3),Xt=Rt/ft,Ot=Q/Tt,Bt={coords:this._coords,colors:this._colors,offsetX:-rt,offsetY:-J,scaleX:1/Xt,scaleY:1/Ot},Mt=ft+2*2,Vt=Tt+2*2,xt=ot.getCanvas("mesh",Mt,Vt,!1),Dt=xt.context,Nt=Dt.createImageData(ft,Tt);if(Et){const G=Nt.data;for(let X=0,et=G.length;X<et;X+=4)G[X]=Et[0],G[X+1]=Et[1],G[X+2]=Et[2],G[X+3]=255}for(const G of this._figures)tt(Nt,G,Bt);return Dt.putImageData(Nt,2,2),{canvas:xt.canvas,offsetX:rt-2*Xt,offsetY:J-2*Ot,scaleX:Xt,scaleY:Ot}}getPattern(nt,Et,ot,K){lt(nt,this._bbox);let q;if(K===ut.SHADING)q=F.Util.singularValueDecompose2dScale((0,O.getCurrentTransform)(nt));else if(q=F.Util.singularValueDecompose2dScale(Et.baseTransform),this.matrix){const rt=F.Util.singularValueDecompose2dScale(this.matrix);q=[q[0]*rt[0],q[1]*rt[1]]}const U=this._createMeshCanvas(q,K===ut.SHADING?null:this._background,Et.cachedCanvases);return K!==ut.SHADING&&(nt.setTransform(...Et.baseTransform),this.matrix&&nt.transform(...this.matrix)),nt.translate(U.offsetX,U.offsetY),nt.scale(U.scaleX,U.scaleY),nt.createPattern(U.canvas,"no-repeat")}}class Ct extends Yt{getPattern(){return"hotpink"}}function at(Z){switch(Z[0]){case"RadialAxial":return new vt(Z);case"Mesh":return new _t(Z);case"Dummy":return new Ct}throw new Error(`Unknown IR type: ${Z[0]}`)}const ct={COLORED:1,UNCOLORED:2},st=class st{constructor(nt,Et,ot,K,q){this.operatorList=nt[2],this.matrix=nt[3]||[1,0,0,1,0,0],this.bbox=nt[4],this.xstep=nt[5],this.ystep=nt[6],this.paintType=nt[7],this.tilingType=nt[8],this.color=Et,this.ctx=ot,this.canvasGraphicsFactory=K,this.baseTransform=q}createPatternCanvas(nt){const Et=this.operatorList,ot=this.bbox,K=this.xstep,q=this.ystep,U=this.paintType,rt=this.tilingType,J=this.color,Rt=this.canvasGraphicsFactory;(0,F.info)("TilingType: "+rt);const Q=ot[0],ft=ot[1],Tt=ot[2],Xt=ot[3],Ot=F.Util.singularValueDecompose2dScale(this.matrix),Bt=F.Util.singularValueDecompose2dScale(this.baseTransform),Mt=[Ot[0]*Bt[0],Ot[1]*Bt[1]],Vt=this.getSizeAndScale(K,this.ctx.canvas.width,Mt[0]),xt=this.getSizeAndScale(q,this.ctx.canvas.height,Mt[1]),Dt=nt.cachedCanvases.getCanvas("pattern",Vt.size,xt.size,!0),Nt=Dt.context,dt=Rt.createCanvasGraphics(Nt);dt.groupLevel=nt.groupLevel,this.setFillAndStrokeStyleToContext(dt,U,J);let G=Q,X=ft,et=Tt,bt=Xt;return Q<0&&(G=0,et+=Math.abs(Q)),ft<0&&(X=0,bt+=Math.abs(ft)),Nt.translate(-(Vt.scale*G),-(xt.scale*X)),dt.transform(Vt.scale,0,0,xt.scale,0,0),Nt.save(),this.clipBbox(dt,G,X,et,bt),dt.baseTransform=(0,O.getCurrentTransform)(dt.ctx),dt.executeOperatorList(Et),dt.endDrawing(),{canvas:Dt.canvas,scaleX:Vt.scale,scaleY:xt.scale,offsetX:G,offsetY:X}}getSizeAndScale(nt,Et,ot){nt=Math.abs(nt);const K=Math.max(st.MAX_PATTERN_SIZE,Et);let q=Math.ceil(nt*ot);return q>=K?q=K:ot=q/nt,{scale:ot,size:q}}clipBbox(nt,Et,ot,K,q){const U=K-Et,rt=q-ot;nt.ctx.rect(Et,ot,U,rt),nt.current.updateRectMinMax((0,O.getCurrentTransform)(nt.ctx),[Et,ot,K,q]),nt.clip(),nt.endPath()}setFillAndStrokeStyleToContext(nt,Et,ot){const K=nt.ctx,q=nt.current;switch(Et){case ct.COLORED:const U=this.ctx;K.fillStyle=U.fillStyle,K.strokeStyle=U.strokeStyle,q.fillColor=U.fillStyle,q.strokeColor=U.strokeStyle;break;case ct.UNCOLORED:const rt=F.Util.makeHexColor(ot[0],ot[1],ot[2]);K.fillStyle=rt,K.strokeStyle=rt,q.fillColor=rt,q.strokeColor=rt;break;default:throw new F.FormatError(`Unsupported paint type: ${Et}`)}}getPattern(nt,Et,ot,K){let q=ot;K!==ut.SHADING&&(q=F.Util.transform(q,Et.baseTransform),this.matrix&&(q=F.Util.transform(q,this.matrix)));const U=this.createPatternCanvas(Et);let rt=new DOMMatrix(q);rt=rt.translate(U.offsetX,U.offsetY),rt=rt.scale(1/U.scaleX,1/U.scaleY);const J=nt.createPattern(U.canvas,"repeat");return J.setTransform(rt),J}};Le(st,"MAX_PATTERN_SIZE",3e3);let mt=st;w.TilingPattern=mt},(Y,w,W)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.convertBlackAndWhiteToRGBA=ut,w.convertToRGBA=O,w.grayToRGBA=Yt;var F=W(1);function O(vt){switch(vt.kind){case F.ImageKind.GRAYSCALE_1BPP:return ut(vt);case F.ImageKind.RGB_24BPP:return lt(vt)}return null}function ut({src:vt,srcPos:pt=0,dest:tt,width:_t,height:Ct,nonBlackColor:at=4294967295,inverseDecode:ct=!1}){const mt=F.FeatureTest.isLittleEndian?4278190080:255,[st,Z]=ct?[at,mt]:[mt,at],nt=_t>>3,Et=_t&7,ot=vt.length;tt=new Uint32Array(tt.buffer);let K=0;for(let q=0;q<Ct;q++){for(const rt=pt+nt;pt<rt;pt++){const J=pt<ot?vt[pt]:255;tt[K++]=J&128?Z:st,tt[K++]=J&64?Z:st,tt[K++]=J&32?Z:st,tt[K++]=J&16?Z:st,tt[K++]=J&8?Z:st,tt[K++]=J&4?Z:st,tt[K++]=J&2?Z:st,tt[K++]=J&1?Z:st}if(Et===0)continue;const U=pt<ot?vt[pt++]:255;for(let rt=0;rt<Et;rt++)tt[K++]=U&1<<7-rt?Z:st}return{srcPos:pt,destPos:K}}function lt({src:vt,srcPos:pt=0,dest:tt,destPos:_t=0,width:Ct,height:at}){let ct=0;const mt=vt.length>>2,st=new Uint32Array(vt.buffer,pt,mt);if(F.FeatureTest.isLittleEndian){for(;ct<mt-2;ct+=3,_t+=4){const Z=st[ct],nt=st[ct+1],Et=st[ct+2];tt[_t]=Z|4278190080,tt[_t+1]=Z>>>24|nt<<8|4278190080,tt[_t+2]=nt>>>16|Et<<16|4278190080,tt[_t+3]=Et>>>8|4278190080}for(let Z=ct*4,nt=vt.length;Z<nt;Z+=3)tt[_t++]=vt[Z]|vt[Z+1]<<8|vt[Z+2]<<16|4278190080}else{for(;ct<mt-2;ct+=3,_t+=4){const Z=st[ct],nt=st[ct+1],Et=st[ct+2];tt[_t]=Z|255,tt[_t+1]=Z<<24|nt>>>8|255,tt[_t+2]=nt<<16|Et>>>16|255,tt[_t+3]=Et<<8|255}for(let Z=ct*4,nt=vt.length;Z<nt;Z+=3)tt[_t++]=vt[Z]<<24|vt[Z+1]<<16|vt[Z+2]<<8|255}return{srcPos:pt,destPos:_t}}function Yt(vt,pt){if(F.FeatureTest.isLittleEndian)for(let tt=0,_t=vt.length;tt<_t;tt++)pt[tt]=vt[tt]*65793|4278190080;else for(let tt=0,_t=vt.length;tt<_t;tt++)pt[tt]=vt[tt]*16843008|255}},(Y,w)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.GlobalWorkerOptions=void 0;const W=Object.create(null);w.GlobalWorkerOptions=W,W.workerPort=null,W.workerSrc=""},(Y,w,W)=>{var vt,hi,di,ls;Object.defineProperty(w,"__esModule",{value:!0}),w.MessageHandler=void 0;var F=W(1);const O={DATA:1,ERROR:2},ut={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function lt(Ct){switch(Ct instanceof Error||typeof Ct=="object"&&Ct!==null||(0,F.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),Ct.name){case"AbortException":return new F.AbortException(Ct.message);case"MissingPDFException":return new F.MissingPDFException(Ct.message);case"PasswordException":return new F.PasswordException(Ct.message,Ct.code);case"UnexpectedResponseException":return new F.UnexpectedResponseException(Ct.message,Ct.status);case"UnknownErrorException":return new F.UnknownErrorException(Ct.message,Ct.details);default:return new F.UnknownErrorException(Ct.message,Ct.toString())}}class Yt{constructor(at,ct,mt){Ht(this,vt);this.sourceName=at,this.targetName=ct,this.comObj=mt,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=st=>{const Z=st.data;if(Z.targetName!==this.sourceName)return;if(Z.stream){Ft(this,vt,di).call(this,Z);return}if(Z.callback){const Et=Z.callbackId,ot=this.callbackCapabilities[Et];if(!ot)throw new Error(`Cannot resolve callback ${Et}`);if(delete this.callbackCapabilities[Et],Z.callback===O.DATA)ot.resolve(Z.data);else if(Z.callback===O.ERROR)ot.reject(lt(Z.reason));else throw new Error("Unexpected callback case");return}const nt=this.actionHandler[Z.action];if(!nt)throw new Error(`Unknown action from worker: ${Z.action}`);if(Z.callbackId){const Et=this.sourceName,ot=Z.sourceName;new Promise(function(K){K(nt(Z.data))}).then(function(K){mt.postMessage({sourceName:Et,targetName:ot,callback:O.DATA,callbackId:Z.callbackId,data:K})},function(K){mt.postMessage({sourceName:Et,targetName:ot,callback:O.ERROR,callbackId:Z.callbackId,reason:lt(K)})});return}if(Z.streamId){Ft(this,vt,hi).call(this,Z);return}nt(Z.data)},mt.addEventListener("message",this._onComObjOnMessage)}on(at,ct){const mt=this.actionHandler;if(mt[at])throw new Error(`There is already an actionName called "${at}"`);mt[at]=ct}send(at,ct,mt){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:at,data:ct},mt)}sendWithPromise(at,ct,mt){const st=this.callbackId++,Z=new F.PromiseCapability;this.callbackCapabilities[st]=Z;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:at,callbackId:st,data:ct},mt)}catch(nt){Z.reject(nt)}return Z.promise}sendWithStream(at,ct,mt,st){const Z=this.streamId++,nt=this.sourceName,Et=this.targetName,ot=this.comObj;return new ReadableStream({start:K=>{const q=new F.PromiseCapability;return this.streamControllers[Z]={controller:K,startCall:q,pullCall:null,cancelCall:null,isClosed:!1},ot.postMessage({sourceName:nt,targetName:Et,action:at,streamId:Z,data:ct,desiredSize:K.desiredSize},st),q.promise},pull:K=>{const q=new F.PromiseCapability;return this.streamControllers[Z].pullCall=q,ot.postMessage({sourceName:nt,targetName:Et,stream:ut.PULL,streamId:Z,desiredSize:K.desiredSize}),q.promise},cancel:K=>{(0,F.assert)(K instanceof Error,"cancel must have a valid reason");const q=new F.PromiseCapability;return this.streamControllers[Z].cancelCall=q,this.streamControllers[Z].isClosed=!0,ot.postMessage({sourceName:nt,targetName:Et,stream:ut.CANCEL,streamId:Z,reason:lt(K)}),q.promise}},mt)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}vt=new WeakSet,hi=function(at){const ct=at.streamId,mt=this.sourceName,st=at.sourceName,Z=this.comObj,nt=this,Et=this.actionHandler[at.action],ot={enqueue(K,q=1,U){if(this.isCancelled)return;const rt=this.desiredSize;this.desiredSize-=q,rt>0&&this.desiredSize<=0&&(this.sinkCapability=new F.PromiseCapability,this.ready=this.sinkCapability.promise),Z.postMessage({sourceName:mt,targetName:st,stream:ut.ENQUEUE,streamId:ct,chunk:K},U)},close(){this.isCancelled||(this.isCancelled=!0,Z.postMessage({sourceName:mt,targetName:st,stream:ut.CLOSE,streamId:ct}),delete nt.streamSinks[ct])},error(K){(0,F.assert)(K instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,Z.postMessage({sourceName:mt,targetName:st,stream:ut.ERROR,streamId:ct,reason:lt(K)}))},sinkCapability:new F.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:at.desiredSize,ready:null};ot.sinkCapability.resolve(),ot.ready=ot.sinkCapability.promise,this.streamSinks[ct]=ot,new Promise(function(K){K(Et(at.data,ot))}).then(function(){Z.postMessage({sourceName:mt,targetName:st,stream:ut.START_COMPLETE,streamId:ct,success:!0})},function(K){Z.postMessage({sourceName:mt,targetName:st,stream:ut.START_COMPLETE,streamId:ct,reason:lt(K)})})},di=function(at){const ct=at.streamId,mt=this.sourceName,st=at.sourceName,Z=this.comObj,nt=this.streamControllers[ct],Et=this.streamSinks[ct];switch(at.stream){case ut.START_COMPLETE:at.success?nt.startCall.resolve():nt.startCall.reject(lt(at.reason));break;case ut.PULL_COMPLETE:at.success?nt.pullCall.resolve():nt.pullCall.reject(lt(at.reason));break;case ut.PULL:if(!Et){Z.postMessage({sourceName:mt,targetName:st,stream:ut.PULL_COMPLETE,streamId:ct,success:!0});break}Et.desiredSize<=0&&at.desiredSize>0&&Et.sinkCapability.resolve(),Et.desiredSize=at.desiredSize,new Promise(function(ot){ot(Et.onPull?.())}).then(function(){Z.postMessage({sourceName:mt,targetName:st,stream:ut.PULL_COMPLETE,streamId:ct,success:!0})},function(ot){Z.postMessage({sourceName:mt,targetName:st,stream:ut.PULL_COMPLETE,streamId:ct,reason:lt(ot)})});break;case ut.ENQUEUE:if((0,F.assert)(nt,"enqueue should have stream controller"),nt.isClosed)break;nt.controller.enqueue(at.chunk);break;case ut.CLOSE:if((0,F.assert)(nt,"close should have stream controller"),nt.isClosed)break;nt.isClosed=!0,nt.controller.close(),Ft(this,vt,ls).call(this,nt,ct);break;case ut.ERROR:(0,F.assert)(nt,"error should have stream controller"),nt.controller.error(lt(at.reason)),Ft(this,vt,ls).call(this,nt,ct);break;case ut.CANCEL_COMPLETE:at.success?nt.cancelCall.resolve():nt.cancelCall.reject(lt(at.reason)),Ft(this,vt,ls).call(this,nt,ct);break;case ut.CANCEL:if(!Et)break;new Promise(function(ot){ot(Et.onCancel?.(lt(at.reason)))}).then(function(){Z.postMessage({sourceName:mt,targetName:st,stream:ut.CANCEL_COMPLETE,streamId:ct,success:!0})},function(ot){Z.postMessage({sourceName:mt,targetName:st,stream:ut.CANCEL_COMPLETE,streamId:ct,reason:lt(ot)})}),Et.sinkCapability.reject(lt(at.reason)),Et.isCancelled=!0,delete this.streamSinks[ct];break;default:throw new Error("Unexpected stream case")}},ls=async function(at,ct){await Promise.allSettled([at.startCall?.promise,at.pullCall?.promise,at.cancelCall?.promise]),delete this.streamControllers[ct]},w.MessageHandler=Yt},(Y,w,W)=>{var ut,lt;Object.defineProperty(w,"__esModule",{value:!0}),w.Metadata=void 0;var F=W(1);class O{constructor({parsedData:vt,rawData:pt}){Ht(this,ut);Ht(this,lt);zt(this,ut,vt),zt(this,lt,pt)}getRaw(){return D(this,lt)}get(vt){return D(this,ut).get(vt)??null}getAll(){return(0,F.objectFromMap)(D(this,ut))}has(vt){return D(this,ut).has(vt)}}ut=new WeakMap,lt=new WeakMap,w.Metadata=O},(Y,w,W)=>{var vt,pt,tt,_t,Ct,at,Is;Object.defineProperty(w,"__esModule",{value:!0}),w.OptionalContentConfig=void 0;var F=W(1),O=W(8);const ut=Symbol("INTERNAL");class lt{constructor(st,Z){Ht(this,vt,!0);this.name=st,this.intent=Z}get visible(){return D(this,vt)}_setVisible(st,Z){st!==ut&&(0,F.unreachable)("Internal method `_setVisible` called."),zt(this,vt,Z)}}vt=new WeakMap;class Yt{constructor(st){Ht(this,at);Ht(this,pt,null);Ht(this,tt,new Map);Ht(this,_t,null);Ht(this,Ct,null);if(this.name=null,this.creator=null,st!==null){this.name=st.name,this.creator=st.creator,zt(this,Ct,st.order);for(const Z of st.groups)D(this,tt).set(Z.id,new lt(Z.name,Z.intent));if(st.baseState==="OFF")for(const Z of D(this,tt).values())Z._setVisible(ut,!1);for(const Z of st.on)D(this,tt).get(Z)._setVisible(ut,!0);for(const Z of st.off)D(this,tt).get(Z)._setVisible(ut,!1);zt(this,_t,this.getHash())}}isVisible(st){if(D(this,tt).size===0)return!0;if(!st)return(0,F.warn)("Optional content group not defined."),!0;if(st.type==="OCG")return D(this,tt).has(st.id)?D(this,tt).get(st.id).visible:((0,F.warn)(`Optional content group not found: ${st.id}`),!0);if(st.type==="OCMD"){if(st.expression)return Ft(this,at,Is).call(this,st.expression);if(!st.policy||st.policy==="AnyOn"){for(const Z of st.ids){if(!D(this,tt).has(Z))return(0,F.warn)(`Optional content group not found: ${Z}`),!0;if(D(this,tt).get(Z).visible)return!0}return!1}else if(st.policy==="AllOn"){for(const Z of st.ids){if(!D(this,tt).has(Z))return(0,F.warn)(`Optional content group not found: ${Z}`),!0;if(!D(this,tt).get(Z).visible)return!1}return!0}else if(st.policy==="AnyOff"){for(const Z of st.ids){if(!D(this,tt).has(Z))return(0,F.warn)(`Optional content group not found: ${Z}`),!0;if(!D(this,tt).get(Z).visible)return!0}return!1}else if(st.policy==="AllOff"){for(const Z of st.ids){if(!D(this,tt).has(Z))return(0,F.warn)(`Optional content group not found: ${Z}`),!0;if(D(this,tt).get(Z).visible)return!1}return!0}return(0,F.warn)(`Unknown optional content policy ${st.policy}.`),!0}return(0,F.warn)(`Unknown group type ${st.type}.`),!0}setVisibility(st,Z=!0){if(!D(this,tt).has(st)){(0,F.warn)(`Optional content group not found: ${st}`);return}D(this,tt).get(st)._setVisible(ut,!!Z),zt(this,pt,null)}get hasInitialVisibility(){return D(this,_t)===null||this.getHash()===D(this,_t)}getOrder(){return D(this,tt).size?D(this,Ct)?D(this,Ct).slice():[...D(this,tt).keys()]:null}getGroups(){return D(this,tt).size>0?(0,F.objectFromMap)(D(this,tt)):null}getGroup(st){return D(this,tt).get(st)||null}getHash(){if(D(this,pt)!==null)return D(this,pt);const st=new O.MurmurHash3_64;for(const[Z,nt]of D(this,tt))st.update(`${Z}:${nt.visible}`);return zt(this,pt,st.hexdigest())}}pt=new WeakMap,tt=new WeakMap,_t=new WeakMap,Ct=new WeakMap,at=new WeakSet,Is=function(st){const Z=st.length;if(Z<2)return!0;const nt=st[0];for(let Et=1;Et<Z;Et++){const ot=st[Et];let K;if(Array.isArray(ot))K=Ft(this,at,Is).call(this,ot);else if(D(this,tt).has(ot))K=D(this,tt).get(ot).visible;else return(0,F.warn)(`Optional content group not found: ${ot}`),!0;switch(nt){case"And":if(!K)return!1;break;case"Or":if(K)return!0;break;case"Not":return!K;default:return!0}}return nt==="And"},w.OptionalContentConfig=Yt},(Y,w,W)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.PDFDataTransportStream=void 0;var F=W(1),O=W(6);class ut{constructor({length:pt,initialData:tt,progressiveDone:_t=!1,contentDispositionFilename:Ct=null,disableRange:at=!1,disableStream:ct=!1},mt){if((0,F.assert)(mt,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=_t,this._contentDispositionFilename=Ct,tt?.length>0){const st=tt instanceof Uint8Array&&tt.byteLength===tt.buffer.byteLength?tt.buffer:new Uint8Array(tt).buffer;this._queuedChunks.push(st)}this._pdfDataRangeTransport=mt,this._isStreamingSupported=!ct,this._isRangeSupported=!at,this._contentLength=pt,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((st,Z)=>{this._onReceiveData({begin:st,chunk:Z})}),this._pdfDataRangeTransport.addProgressListener((st,Z)=>{this._onProgress({loaded:st,total:Z})}),this._pdfDataRangeTransport.addProgressiveReadListener(st=>{this._onReceiveData({chunk:st})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:pt,chunk:tt}){const _t=tt instanceof Uint8Array&&tt.byteLength===tt.buffer.byteLength?tt.buffer:new Uint8Array(tt).buffer;if(pt===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(_t):this._queuedChunks.push(_t);else{const Ct=this._rangeReaders.some(function(at){return at._begin!==pt?!1:(at._enqueue(_t),!0)});(0,F.assert)(Ct,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(pt){pt.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:pt.loaded}):this._fullRequestReader?.onProgress?.({loaded:pt.loaded,total:pt.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(pt){const tt=this._rangeReaders.indexOf(pt);tt>=0&&this._rangeReaders.splice(tt,1)}getFullReader(){(0,F.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const pt=this._queuedChunks;return this._queuedChunks=null,new lt(this,pt,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(pt,tt){if(tt<=this._progressiveDataLength)return null;const _t=new Yt(this,pt,tt);return this._pdfDataRangeTransport.requestDataRange(pt,tt),this._rangeReaders.push(_t),_t}cancelAllRequests(pt){this._fullRequestReader?.cancel(pt);for(const tt of this._rangeReaders.slice(0))tt.cancel(pt);this._pdfDataRangeTransport.abort()}}w.PDFDataTransportStream=ut;class lt{constructor(pt,tt,_t=!1,Ct=null){this._stream=pt,this._done=_t||!1,this._filename=(0,O.isPdfFile)(Ct)?Ct:null,this._queuedChunks=tt||[],this._loaded=0;for(const at of this._queuedChunks)this._loaded+=at.byteLength;this._requests=[],this._headersReady=Promise.resolve(),pt._fullRequestReader=this,this.onProgress=null}_enqueue(pt){this._done||(this._requests.length>0?this._requests.shift().resolve({value:pt,done:!1}):this._queuedChunks.push(pt),this._loaded+=pt.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const pt=new F.PromiseCapability;return this._requests.push(pt),pt.promise}cancel(pt){this._done=!0;for(const tt of this._requests)tt.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Yt{constructor(pt,tt,_t){this._stream=pt,this._begin=tt,this._end=_t,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(pt){if(!this._done){if(this._requests.length===0)this._queuedChunk=pt;else{this._requests.shift().resolve({value:pt,done:!1});for(const _t of this._requests)_t.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const tt=this._queuedChunk;return this._queuedChunk=null,{value:tt,done:!1}}if(this._done)return{value:void 0,done:!0};const pt=new F.PromiseCapability;return this._requests.push(pt),pt.promise}cancel(pt){this._done=!0;for(const tt of this._requests)tt.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(Y,w,W)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.PDFFetchStream=void 0;var F=W(1),O=W(20);function ut(_t,Ct,at){return{method:"GET",headers:_t,signal:at.signal,mode:"cors",credentials:Ct?"include":"same-origin",redirect:"follow"}}function lt(_t){const Ct=new Headers;for(const at in _t){const ct=_t[at];ct!==void 0&&Ct.append(at,ct)}return Ct}function Yt(_t){return _t instanceof Uint8Array?_t.buffer:_t instanceof ArrayBuffer?_t:((0,F.warn)(`getArrayBuffer - unexpected data format: ${_t}`),new Uint8Array(_t).buffer)}class vt{constructor(Ct){this.source=Ct,this.isHttp=/^https?:/i.test(Ct.url),this.httpHeaders=this.isHttp&&Ct.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,F.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new pt(this),this._fullRequestReader}getRangeReader(Ct,at){if(at<=this._progressiveDataLength)return null;const ct=new tt(this,Ct,at);return this._rangeRequestReaders.push(ct),ct}cancelAllRequests(Ct){this._fullRequestReader?.cancel(Ct);for(const at of this._rangeRequestReaders.slice(0))at.cancel(Ct)}}w.PDFFetchStream=vt;class pt{constructor(Ct){this._stream=Ct,this._reader=null,this._loaded=0,this._filename=null;const at=Ct.source;this._withCredentials=at.withCredentials||!1,this._contentLength=at.length,this._headersCapability=new F.PromiseCapability,this._disableRange=at.disableRange||!1,this._rangeChunkSize=at.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!at.disableStream,this._isRangeSupported=!at.disableRange,this._headers=lt(this._stream.httpHeaders);const ct=at.url;fetch(ct,ut(this._headers,this._withCredentials,this._abortController)).then(mt=>{if(!(0,O.validateResponseStatus)(mt.status))throw(0,O.createResponseStatusError)(mt.status,ct);this._reader=mt.body.getReader(),this._headersCapability.resolve();const st=Et=>mt.headers.get(Et),{allowRangeRequests:Z,suggestedLength:nt}=(0,O.validateRangeRequestCapabilities)({getResponseHeader:st,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=Z,this._contentLength=nt||this._contentLength,this._filename=(0,O.extractFilenameFromHeader)(st),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new F.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:Ct,done:at}=await this._reader.read();return at?{value:Ct,done:at}:(this._loaded+=Ct.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Yt(Ct),done:!1})}cancel(Ct){this._reader?.cancel(Ct),this._abortController.abort()}}class tt{constructor(Ct,at,ct){this._stream=Ct,this._reader=null,this._loaded=0;const mt=Ct.source;this._withCredentials=mt.withCredentials||!1,this._readCapability=new F.PromiseCapability,this._isStreamingSupported=!mt.disableStream,this._abortController=new AbortController,this._headers=lt(this._stream.httpHeaders),this._headers.append("Range",`bytes=${at}-${ct-1}`);const st=mt.url;fetch(st,ut(this._headers,this._withCredentials,this._abortController)).then(Z=>{if(!(0,O.validateResponseStatus)(Z.status))throw(0,O.createResponseStatusError)(Z.status,st);this._readCapability.resolve(),this._reader=Z.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:Ct,done:at}=await this._reader.read();return at?{value:Ct,done:at}:(this._loaded+=Ct.byteLength,this.onProgress?.({loaded:this._loaded}),{value:Yt(Ct),done:!1})}cancel(Ct){this._reader?.cancel(Ct),this._abortController.abort()}}},(Y,w,W)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.createResponseStatusError=vt,w.extractFilenameFromHeader=Yt,w.validateRangeRequestCapabilities=lt,w.validateResponseStatus=pt;var F=W(1),O=W(21),ut=W(6);function lt({getResponseHeader:tt,isHttp:_t,rangeChunkSize:Ct,disableRange:at}){const ct={allowRangeRequests:!1,suggestedLength:void 0},mt=parseInt(tt("Content-Length"),10);return!Number.isInteger(mt)||(ct.suggestedLength=mt,mt<=2*Ct)||at||!_t||tt("Accept-Ranges")!=="bytes"||(tt("Content-Encoding")||"identity")!=="identity"||(ct.allowRangeRequests=!0),ct}function Yt(tt){const _t=tt("Content-Disposition");if(_t){let Ct=(0,O.getFilenameFromContentDispositionHeader)(_t);if(Ct.includes("%"))try{Ct=decodeURIComponent(Ct)}catch{}if((0,ut.isPdfFile)(Ct))return Ct}return null}function vt(tt,_t){return tt===404||tt===0&&_t.startsWith("file:")?new F.MissingPDFException('Missing PDF "'+_t+'".'):new F.UnexpectedResponseException(`Unexpected server response (${tt}) while retrieving PDF "${_t}".`,tt)}function pt(tt){return tt===200||tt===206}},(Y,w,W)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.getFilenameFromContentDispositionHeader=O;var F=W(1);function O(ut){let lt=!0,Yt=vt("filename\\*","i").exec(ut);if(Yt){Yt=Yt[1];let mt=Ct(Yt);return mt=unescape(mt),mt=at(mt),mt=ct(mt),tt(mt)}if(Yt=_t(ut),Yt){const mt=ct(Yt);return tt(mt)}if(Yt=vt("filename","i").exec(ut),Yt){Yt=Yt[1];let mt=Ct(Yt);return mt=ct(mt),tt(mt)}function vt(mt,st){return new RegExp("(?:^|;)\\s*"+mt+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',st)}function pt(mt,st){if(mt){if(!/^[\x00-\xFF]+$/.test(st))return st;try{const Z=new TextDecoder(mt,{fatal:!0}),nt=(0,F.stringToBytes)(st);st=Z.decode(nt),lt=!1}catch{}}return st}function tt(mt){return lt&&/[\x80-\xff]/.test(mt)&&(mt=pt("utf-8",mt),lt&&(mt=pt("iso-8859-1",mt))),mt}function _t(mt){const st=[];let Z;const nt=vt("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(Z=nt.exec(mt))!==null;){let[,ot,K,q]=Z;if(ot=parseInt(ot,10),ot in st){if(ot===0)break;continue}st[ot]=[K,q]}const Et=[];for(let ot=0;ot<st.length&&ot in st;++ot){let[K,q]=st[ot];q=Ct(q),K&&(q=unescape(q),ot===0&&(q=at(q))),Et.push(q)}return Et.join("")}function Ct(mt){if(mt.startsWith('"')){const st=mt.slice(1).split('\\"');for(let Z=0;Z<st.length;++Z){const nt=st[Z].indexOf('"');nt!==-1&&(st[Z]=st[Z].slice(0,nt),st.length=Z+1),st[Z]=st[Z].replaceAll(/\\(.)/g,"$1")}mt=st.join('"')}return mt}function at(mt){const st=mt.indexOf("'");if(st===-1)return mt;const Z=mt.slice(0,st),Et=mt.slice(st+1).replace(/^[^']*'/,"");return pt(Z,Et)}function ct(mt){return!mt.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(mt)?mt:mt.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(st,Z,nt,Et){if(nt==="q"||nt==="Q")return Et=Et.replaceAll("_"," "),Et=Et.replaceAll(/=([0-9a-fA-F]{2})/g,function(ot,K){return String.fromCharCode(parseInt(K,16))}),pt(Z,Et);try{Et=atob(Et)}catch{}return pt(Z,Et)})}return""}},(Y,w,W)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.PDFNetworkStream=void 0;var F=W(1),O=W(20);const ut=200,lt=206;function Yt(Ct){const at=Ct.response;return typeof at!="string"?at:(0,F.stringToBytes)(at).buffer}class vt{constructor(at,ct={}){this.url=at,this.isHttp=/^https?:/i.test(at),this.httpHeaders=this.isHttp&&ct.httpHeaders||Object.create(null),this.withCredentials=ct.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(at,ct,mt){const st={begin:at,end:ct};for(const Z in mt)st[Z]=mt[Z];return this.request(st)}requestFull(at){return this.request(at)}request(at){const ct=new XMLHttpRequest,mt=this.currXhrId++,st=this.pendingRequests[mt]={xhr:ct};ct.open("GET",this.url),ct.withCredentials=this.withCredentials;for(const Z in this.httpHeaders){const nt=this.httpHeaders[Z];nt!==void 0&&ct.setRequestHeader(Z,nt)}return this.isHttp&&"begin"in at&&"end"in at?(ct.setRequestHeader("Range",`bytes=${at.begin}-${at.end-1}`),st.expectedStatus=lt):st.expectedStatus=ut,ct.responseType="arraybuffer",at.onError&&(ct.onerror=function(Z){at.onError(ct.status)}),ct.onreadystatechange=this.onStateChange.bind(this,mt),ct.onprogress=this.onProgress.bind(this,mt),st.onHeadersReceived=at.onHeadersReceived,st.onDone=at.onDone,st.onError=at.onError,st.onProgress=at.onProgress,ct.send(null),mt}onProgress(at,ct){const mt=this.pendingRequests[at];mt&&mt.onProgress?.(ct)}onStateChange(at,ct){const mt=this.pendingRequests[at];if(!mt)return;const st=mt.xhr;if(st.readyState>=2&&mt.onHeadersReceived&&(mt.onHeadersReceived(),delete mt.onHeadersReceived),st.readyState!==4||!(at in this.pendingRequests))return;if(delete this.pendingRequests[at],st.status===0&&this.isHttp){mt.onError?.(st.status);return}const Z=st.status||ut;if(!(Z===ut&&mt.expectedStatus===lt)&&Z!==mt.expectedStatus){mt.onError?.(st.status);return}const Et=Yt(st);if(Z===lt){const ot=st.getResponseHeader("Content-Range"),K=/bytes (\d+)-(\d+)\/(\d+)/.exec(ot);mt.onDone({begin:parseInt(K[1],10),chunk:Et})}else Et?mt.onDone({begin:0,chunk:Et}):mt.onError?.(st.status)}getRequestXhr(at){return this.pendingRequests[at].xhr}isPendingRequest(at){return at in this.pendingRequests}abortRequest(at){const ct=this.pendingRequests[at].xhr;delete this.pendingRequests[at],ct.abort()}}class pt{constructor(at){this._source=at,this._manager=new vt(at.url,{httpHeaders:at.httpHeaders,withCredentials:at.withCredentials}),this._rangeChunkSize=at.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(at){const ct=this._rangeRequestReaders.indexOf(at);ct>=0&&this._rangeRequestReaders.splice(ct,1)}getFullReader(){return(0,F.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new tt(this._manager,this._source),this._fullRequestReader}getRangeReader(at,ct){const mt=new _t(this._manager,at,ct);return mt.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(mt),mt}cancelAllRequests(at){this._fullRequestReader?.cancel(at);for(const ct of this._rangeRequestReaders.slice(0))ct.cancel(at)}}w.PDFNetworkStream=pt;class tt{constructor(at,ct){this._manager=at;const mt={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=ct.url,this._fullRequestId=at.requestFull(mt),this._headersReceivedCapability=new F.PromiseCapability,this._disableRange=ct.disableRange||!1,this._contentLength=ct.length,this._rangeChunkSize=ct.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const at=this._fullRequestId,ct=this._manager.getRequestXhr(at),mt=nt=>ct.getResponseHeader(nt),{allowRangeRequests:st,suggestedLength:Z}=(0,O.validateRangeRequestCapabilities)({getResponseHeader:mt,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});st&&(this._isRangeSupported=!0),this._contentLength=Z||this._contentLength,this._filename=(0,O.extractFilenameFromHeader)(mt),this._isRangeSupported&&this._manager.abortRequest(at),this._headersReceivedCapability.resolve()}_onDone(at){if(at&&(this._requests.length>0?this._requests.shift().resolve({value:at.chunk,done:!1}):this._cachedChunks.push(at.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const ct of this._requests)ct.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(at){this._storedError=(0,O.createResponseStatusError)(at,this._url),this._headersReceivedCapability.reject(this._storedError);for(const ct of this._requests)ct.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(at){this.onProgress?.({loaded:at.loaded,total:at.lengthComputable?at.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const at=new F.PromiseCapability;return this._requests.push(at),at.promise}cancel(at){this._done=!0,this._headersReceivedCapability.reject(at);for(const ct of this._requests)ct.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class _t{constructor(at,ct,mt){this._manager=at;const st={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=at.url,this._requestId=at.requestRange(ct,mt,st),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(at){const ct=at.chunk;this._requests.length>0?this._requests.shift().resolve({value:ct,done:!1}):this._queuedChunk=ct,this._done=!0;for(const mt of this._requests)mt.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(at){this._storedError=(0,O.createResponseStatusError)(at,this._url);for(const ct of this._requests)ct.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(at){this.isStreamingSupported||this.onProgress?.({loaded:at.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const ct=this._queuedChunk;return this._queuedChunk=null,{value:ct,done:!1}}if(this._done)return{value:void 0,done:!0};const at=new F.PromiseCapability;return this._requests.push(at),at.promise}cancel(at){this._done=!0;for(const ct of this._requests)ct.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(Y,w,W)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.PDFNodeStream=void 0;var F=W(1),O=W(20);const ut=/^file:\/\/\/[a-zA-Z]:\//;function lt(mt){const st=require$$5,Z=st.parse(mt);return Z.protocol==="file:"||Z.host?Z:/^[a-z]:[/\\]/i.test(mt)?st.parse(`file:///${mt}`):(Z.host||(Z.protocol="file:"),Z)}class Yt{constructor(st){this.source=st,this.url=lt(st.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&st.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,F.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new at(this):new _t(this),this._fullRequestReader}getRangeReader(st,Z){if(Z<=this._progressiveDataLength)return null;const nt=this.isFsUrl?new ct(this,st,Z):new Ct(this,st,Z);return this._rangeRequestReaders.push(nt),nt}cancelAllRequests(st){this._fullRequestReader?.cancel(st);for(const Z of this._rangeRequestReaders.slice(0))Z.cancel(st)}}w.PDFNodeStream=Yt;class vt{constructor(st){this._url=st.url,this._done=!1,this._storedError=null,this.onProgress=null;const Z=st.source;this._contentLength=Z.length,this._loaded=0,this._filename=null,this._disableRange=Z.disableRange||!1,this._rangeChunkSize=Z.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!Z.disableStream,this._isRangeSupported=!Z.disableRange,this._readableStream=null,this._readCapability=new F.PromiseCapability,this._headersCapability=new F.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const st=this._readableStream.read();return st===null?(this._readCapability=new F.PromiseCapability,this.read()):(this._loaded+=st.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(st).buffer,done:!1})}cancel(st){if(!this._readableStream){this._error(st);return}this._readableStream.destroy(st)}_error(st){this._storedError=st,this._readCapability.resolve()}_setReadableStream(st){this._readableStream=st,st.on("readable",()=>{this._readCapability.resolve()}),st.on("end",()=>{st.destroy(),this._done=!0,this._readCapability.resolve()}),st.on("error",Z=>{this._error(Z)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new F.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class pt{constructor(st){this._url=st.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new F.PromiseCapability;const Z=st.source;this._isStreamingSupported=!Z.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const st=this._readableStream.read();return st===null?(this._readCapability=new F.PromiseCapability,this.read()):(this._loaded+=st.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(st).buffer,done:!1})}cancel(st){if(!this._readableStream){this._error(st);return}this._readableStream.destroy(st)}_error(st){this._storedError=st,this._readCapability.resolve()}_setReadableStream(st){this._readableStream=st,st.on("readable",()=>{this._readCapability.resolve()}),st.on("end",()=>{st.destroy(),this._done=!0,this._readCapability.resolve()}),st.on("error",Z=>{this._error(Z)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function tt(mt,st){return{protocol:mt.protocol,auth:mt.auth,host:mt.hostname,port:mt.port,path:mt.path,method:"GET",headers:st}}class _t extends vt{constructor(st){super(st);const Z=nt=>{if(nt.statusCode===404){const q=new F.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=q,this._headersCapability.reject(q);return}this._headersCapability.resolve(),this._setReadableStream(nt);const Et=q=>this._readableStream.headers[q.toLowerCase()],{allowRangeRequests:ot,suggestedLength:K}=(0,O.validateRangeRequestCapabilities)({getResponseHeader:Et,isHttp:st.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=ot,this._contentLength=K||this._contentLength,this._filename=(0,O.extractFilenameFromHeader)(Et)};if(this._request=null,this._url.protocol==="http:"){const nt=require$$5;this._request=nt.request(tt(this._url,st.httpHeaders),Z)}else{const nt=require$$5;this._request=nt.request(tt(this._url,st.httpHeaders),Z)}this._request.on("error",nt=>{this._storedError=nt,this._headersCapability.reject(nt)}),this._request.end()}}class Ct extends pt{constructor(st,Z,nt){super(st),this._httpHeaders={};for(const ot in st.httpHeaders){const K=st.httpHeaders[ot];K!==void 0&&(this._httpHeaders[ot]=K)}this._httpHeaders.Range=`bytes=${Z}-${nt-1}`;const Et=ot=>{if(ot.statusCode===404){const K=new F.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=K;return}this._setReadableStream(ot)};if(this._request=null,this._url.protocol==="http:"){const ot=require$$5;this._request=ot.request(tt(this._url,this._httpHeaders),Et)}else{const ot=require$$5;this._request=ot.request(tt(this._url,this._httpHeaders),Et)}this._request.on("error",ot=>{this._storedError=ot}),this._request.end()}}class at extends vt{constructor(st){super(st);let Z=decodeURIComponent(this._url.path);ut.test(this._url.href)&&(Z=Z.replace(/^\//,""));const nt=require$$5;nt.lstat(Z,(Et,ot)=>{if(Et){Et.code==="ENOENT"&&(Et=new F.MissingPDFException(`Missing PDF "${Z}".`)),this._storedError=Et,this._headersCapability.reject(Et);return}this._contentLength=ot.size,this._setReadableStream(nt.createReadStream(Z)),this._headersCapability.resolve()})}}class ct extends pt{constructor(st,Z,nt){super(st);let Et=decodeURIComponent(this._url.path);ut.test(this._url.href)&&(Et=Et.replace(/^\//,""));const ot=require$$5;this._setReadableStream(ot.createReadStream(Et,{start:Z,end:nt-1}))}}},(Y,w,W)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.SVGGraphics=void 0;var F=W(6),O=W(1);const ut={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},lt="http://www.w3.org/XML/1998/namespace",Yt="http://www.w3.org/1999/xlink",vt=["butt","round","square"],pt=["miter","round","bevel"],tt=function(ot,K="",q=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!q)return URL.createObjectURL(new Blob([ot],{type:K}));const U="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let rt=`data:${K};base64,`;for(let J=0,Rt=ot.length;J<Rt;J+=3){const Q=ot[J]&255,ft=ot[J+1]&255,Tt=ot[J+2]&255,Xt=Q>>2,Ot=(Q&3)<<4|ft>>4,Bt=J+1<Rt?(ft&15)<<2|Tt>>6:64,Mt=J+2<Rt?Tt&63:64;rt+=U[Xt]+U[Ot]+U[Bt]+U[Mt]}return rt},_t=function(){const ot=new Uint8Array([137,80,78,71,13,10,26,10]),K=12,q=new Int32Array(256);for(let Tt=0;Tt<256;Tt++){let Xt=Tt;for(let Ot=0;Ot<8;Ot++)Xt=Xt&1?3988292384^Xt>>1&2147483647:Xt>>1&2147483647;q[Tt]=Xt}function U(Tt,Xt,Ot){let Bt=-1;for(let Mt=Xt;Mt<Ot;Mt++){const Vt=(Bt^Tt[Mt])&255,xt=q[Vt];Bt=Bt>>>8^xt}return Bt^-1}function rt(Tt,Xt,Ot,Bt){let Mt=Bt;const Vt=Xt.length;Ot[Mt]=Vt>>24&255,Ot[Mt+1]=Vt>>16&255,Ot[Mt+2]=Vt>>8&255,Ot[Mt+3]=Vt&255,Mt+=4,Ot[Mt]=Tt.charCodeAt(0)&255,Ot[Mt+1]=Tt.charCodeAt(1)&255,Ot[Mt+2]=Tt.charCodeAt(2)&255,Ot[Mt+3]=Tt.charCodeAt(3)&255,Mt+=4,Ot.set(Xt,Mt),Mt+=Xt.length;const xt=U(Ot,Bt+4,Mt);Ot[Mt]=xt>>24&255,Ot[Mt+1]=xt>>16&255,Ot[Mt+2]=xt>>8&255,Ot[Mt+3]=xt&255}function J(Tt,Xt,Ot){let Bt=1,Mt=0;for(let Vt=Xt;Vt<Ot;++Vt)Bt=(Bt+(Tt[Vt]&255))%65521,Mt=(Mt+Bt)%65521;return Mt<<16|Bt}function Rt(Tt){if(!O.isNodeJS)return Q(Tt);try{const Xt=parseInt(process.versions.node)>=8?Tt:Buffer.from(Tt),Ot=require$$5.deflateSync(Xt,{level:9});return Ot instanceof Uint8Array?Ot:new Uint8Array(Ot)}catch(Xt){(0,O.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+Xt)}return Q(Tt)}function Q(Tt){let Xt=Tt.length;const Ot=65535,Bt=Math.ceil(Xt/Ot),Mt=new Uint8Array(2+Xt+Bt*5+4);let Vt=0;Mt[Vt++]=120,Mt[Vt++]=156;let xt=0;for(;Xt>Ot;)Mt[Vt++]=0,Mt[Vt++]=255,Mt[Vt++]=255,Mt[Vt++]=0,Mt[Vt++]=0,Mt.set(Tt.subarray(xt,xt+Ot),Vt),Vt+=Ot,xt+=Ot,Xt-=Ot;Mt[Vt++]=1,Mt[Vt++]=Xt&255,Mt[Vt++]=Xt>>8&255,Mt[Vt++]=~Xt&65535&255,Mt[Vt++]=(~Xt&65535)>>8&255,Mt.set(Tt.subarray(xt),Vt),Vt+=Tt.length-xt;const Dt=J(Tt,0,Tt.length);return Mt[Vt++]=Dt>>24&255,Mt[Vt++]=Dt>>16&255,Mt[Vt++]=Dt>>8&255,Mt[Vt++]=Dt&255,Mt}function ft(Tt,Xt,Ot,Bt){const Mt=Tt.width,Vt=Tt.height;let xt,Dt,Nt;const dt=Tt.data;switch(Xt){case O.ImageKind.GRAYSCALE_1BPP:Dt=0,xt=1,Nt=Mt+7>>3;break;case O.ImageKind.RGB_24BPP:Dt=2,xt=8,Nt=Mt*3;break;case O.ImageKind.RGBA_32BPP:Dt=6,xt=8,Nt=Mt*4;break;default:throw new Error("invalid format")}const G=new Uint8Array((1+Nt)*Vt);let X=0,et=0;for(let Jt=0;Jt<Vt;++Jt)G[X++]=0,G.set(dt.subarray(et,et+Nt),X),et+=Nt,X+=Nt;if(Xt===O.ImageKind.GRAYSCALE_1BPP&&Bt){X=0;for(let Jt=0;Jt<Vt;Jt++){X++;for(let te=0;te<Nt;te++)G[X++]^=255}}const bt=new Uint8Array([Mt>>24&255,Mt>>16&255,Mt>>8&255,Mt&255,Vt>>24&255,Vt>>16&255,Vt>>8&255,Vt&255,xt,Dt,0,0,0]),yt=Rt(G),At=ot.length+K*3+bt.length+yt.length,kt=new Uint8Array(At);let Wt=0;return kt.set(ot,Wt),Wt+=ot.length,rt("IHDR",bt,kt,Wt),Wt+=K+bt.length,rt("IDATA",yt,kt,Wt),Wt+=K+yt.length,rt("IEND",new Uint8Array(0),kt,Wt),tt(kt,"image/png",Ot)}return function(Xt,Ot,Bt){const Mt=Xt.kind===void 0?O.ImageKind.GRAYSCALE_1BPP:Xt.kind;return ft(Xt,Mt,Ot,Bt)}}();class Ct{constructor(){this.fontSizeScale=1,this.fontWeight=ut.fontWeight,this.fontSize=0,this.textMatrix=O.IDENTITY_MATRIX,this.fontMatrix=O.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=O.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=ut.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(K,q){this.x=K,this.y=q}}function at(ot){let K=[];const q=[];for(const U of ot){if(U.fn==="save"){K.push({fnId:92,fn:"group",items:[]}),q.push(K),K=K.at(-1).items;continue}U.fn==="restore"?K=q.pop():K.push(U)}return K}function ct(ot){if(Number.isInteger(ot))return ot.toString();const K=ot.toFixed(10);let q=K.length-1;if(K[q]!=="0")return K;do q--;while(K[q]==="0");return K.substring(0,K[q]==="."?q:q+1)}function mt(ot){if(ot[4]===0&&ot[5]===0){if(ot[1]===0&&ot[2]===0)return ot[0]===1&&ot[3]===1?"":`scale(${ct(ot[0])} ${ct(ot[3])})`;if(ot[0]===ot[3]&&ot[1]===-ot[2]){const K=Math.acos(ot[0])*180/Math.PI;return`rotate(${ct(K)})`}}else if(ot[0]===1&&ot[1]===0&&ot[2]===0&&ot[3]===1)return`translate(${ct(ot[4])} ${ct(ot[5])})`;return`matrix(${ct(ot[0])} ${ct(ot[1])} ${ct(ot[2])} ${ct(ot[3])} ${ct(ot[4])} ${ct(ot[5])})`}let st=0,Z=0,nt=0;class Et{constructor(K,q,U=!1){(0,F.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new F.DOMSVGFactory,this.current=new Ct,this.transformMatrix=O.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=K,this.objs=q,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!U,this._operatorIdMapping=[];for(const rt in O.OPS)this._operatorIdMapping[O.OPS[rt]]=rt}getObject(K,q=null){return typeof K=="string"?K.startsWith("g_")?this.commonObjs.get(K):this.objs.get(K):q}save(){this.transformStack.push(this.transformMatrix);const K=this.current;this.extraStack.push(K),this.current=K.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(K){this.save(),this.executeOpTree(K),this.restore()}loadDependencies(K){const q=K.fnArray,U=K.argsArray;for(let rt=0,J=q.length;rt<J;rt++)if(q[rt]===O.OPS.dependency)for(const Rt of U[rt]){const Q=Rt.startsWith("g_")?this.commonObjs:this.objs,ft=new Promise(Tt=>{Q.get(Rt,Tt)});this.current.dependencies.push(ft)}return Promise.all(this.current.dependencies)}transform(K,q,U,rt,J,Rt){const Q=[K,q,U,rt,J,Rt];this.transformMatrix=O.Util.transform(this.transformMatrix,Q),this.tgrp=null}getSVG(K,q){this.viewport=q;const U=this._initialize(q);return this.loadDependencies(K).then(()=>(this.transformMatrix=O.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(K)),U))}convertOpList(K){const q=this._operatorIdMapping,U=K.argsArray,rt=K.fnArray,J=[];for(let Rt=0,Q=rt.length;Rt<Q;Rt++){const ft=rt[Rt];J.push({fnId:ft,fn:q[ft],args:U[Rt]})}return at(J)}executeOpTree(K){for(const q of K){const U=q.fn,rt=q.fnId,J=q.args;switch(rt|0){case O.OPS.beginText:this.beginText();break;case O.OPS.dependency:break;case O.OPS.setLeading:this.setLeading(J);break;case O.OPS.setLeadingMoveText:this.setLeadingMoveText(J[0],J[1]);break;case O.OPS.setFont:this.setFont(J);break;case O.OPS.showText:this.showText(J[0]);break;case O.OPS.showSpacedText:this.showText(J[0]);break;case O.OPS.endText:this.endText();break;case O.OPS.moveText:this.moveText(J[0],J[1]);break;case O.OPS.setCharSpacing:this.setCharSpacing(J[0]);break;case O.OPS.setWordSpacing:this.setWordSpacing(J[0]);break;case O.OPS.setHScale:this.setHScale(J[0]);break;case O.OPS.setTextMatrix:this.setTextMatrix(J[0],J[1],J[2],J[3],J[4],J[5]);break;case O.OPS.setTextRise:this.setTextRise(J[0]);break;case O.OPS.setTextRenderingMode:this.setTextRenderingMode(J[0]);break;case O.OPS.setLineWidth:this.setLineWidth(J[0]);break;case O.OPS.setLineJoin:this.setLineJoin(J[0]);break;case O.OPS.setLineCap:this.setLineCap(J[0]);break;case O.OPS.setMiterLimit:this.setMiterLimit(J[0]);break;case O.OPS.setFillRGBColor:this.setFillRGBColor(J[0],J[1],J[2]);break;case O.OPS.setStrokeRGBColor:this.setStrokeRGBColor(J[0],J[1],J[2]);break;case O.OPS.setStrokeColorN:this.setStrokeColorN(J);break;case O.OPS.setFillColorN:this.setFillColorN(J);break;case O.OPS.shadingFill:this.shadingFill(J[0]);break;case O.OPS.setDash:this.setDash(J[0],J[1]);break;case O.OPS.setRenderingIntent:this.setRenderingIntent(J[0]);break;case O.OPS.setFlatness:this.setFlatness(J[0]);break;case O.OPS.setGState:this.setGState(J[0]);break;case O.OPS.fill:this.fill();break;case O.OPS.eoFill:this.eoFill();break;case O.OPS.stroke:this.stroke();break;case O.OPS.fillStroke:this.fillStroke();break;case O.OPS.eoFillStroke:this.eoFillStroke();break;case O.OPS.clip:this.clip("nonzero");break;case O.OPS.eoClip:this.clip("evenodd");break;case O.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case O.OPS.paintImageXObject:this.paintImageXObject(J[0]);break;case O.OPS.paintInlineImageXObject:this.paintInlineImageXObject(J[0]);break;case O.OPS.paintImageMaskXObject:this.paintImageMaskXObject(J[0]);break;case O.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(J[0],J[1]);break;case O.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case O.OPS.closePath:this.closePath();break;case O.OPS.closeStroke:this.closeStroke();break;case O.OPS.closeFillStroke:this.closeFillStroke();break;case O.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case O.OPS.nextLine:this.nextLine();break;case O.OPS.transform:this.transform(J[0],J[1],J[2],J[3],J[4],J[5]);break;case O.OPS.constructPath:this.constructPath(J[0],J[1]);break;case O.OPS.endPath:this.endPath();break;case 92:this.group(q.items);break;default:(0,O.warn)(`Unimplemented operator ${U}`);break}}}setWordSpacing(K){this.current.wordSpacing=K}setCharSpacing(K){this.current.charSpacing=K}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(K,q,U,rt,J,Rt){const Q=this.current;Q.textMatrix=Q.lineMatrix=[K,q,U,rt,J,Rt],Q.textMatrixScale=Math.hypot(K,q),Q.x=Q.lineX=0,Q.y=Q.lineY=0,Q.xcoords=[],Q.ycoords=[],Q.tspan=this.svgFactory.createElement("svg:tspan"),Q.tspan.setAttributeNS(null,"font-family",Q.fontFamily),Q.tspan.setAttributeNS(null,"font-size",`${ct(Q.fontSize)}px`),Q.tspan.setAttributeNS(null,"y",ct(-Q.y)),Q.txtElement=this.svgFactory.createElement("svg:text"),Q.txtElement.append(Q.tspan)}beginText(){const K=this.current;K.x=K.lineX=0,K.y=K.lineY=0,K.textMatrix=O.IDENTITY_MATRIX,K.lineMatrix=O.IDENTITY_MATRIX,K.textMatrixScale=1,K.tspan=this.svgFactory.createElement("svg:tspan"),K.txtElement=this.svgFactory.createElement("svg:text"),K.txtgrp=this.svgFactory.createElement("svg:g"),K.xcoords=[],K.ycoords=[]}moveText(K,q){const U=this.current;U.x=U.lineX+=K,U.y=U.lineY+=q,U.xcoords=[],U.ycoords=[],U.tspan=this.svgFactory.createElement("svg:tspan"),U.tspan.setAttributeNS(null,"font-family",U.fontFamily),U.tspan.setAttributeNS(null,"font-size",`${ct(U.fontSize)}px`),U.tspan.setAttributeNS(null,"y",ct(-U.y))}showText(K){const q=this.current,U=q.font,rt=q.fontSize;if(rt===0)return;const J=q.fontSizeScale,Rt=q.charSpacing,Q=q.wordSpacing,ft=q.fontDirection,Tt=q.textHScale*ft,Xt=U.vertical,Ot=Xt?1:-1,Bt=U.defaultVMetrics,Mt=rt*q.fontMatrix[0];let Vt=0;for(const Nt of K){if(Nt===null){Vt+=ft*Q;continue}else if(typeof Nt=="number"){Vt+=Ot*Nt*rt/1e3;continue}const dt=(Nt.isSpace?Q:0)+Rt,G=Nt.fontChar;let X,et,bt=Nt.width;if(Xt){let At;const kt=Nt.vmetric||Bt;At=Nt.vmetric?kt[1]:bt*.5,At=-At*Mt;const Wt=kt[2]*Mt;bt=kt?-kt[0]:bt,X=At/J,et=(Vt+Wt)/J}else X=Vt/J,et=0;(Nt.isInFont||U.missingFile)&&(q.xcoords.push(q.x+X),Xt&&q.ycoords.push(-q.y+et),q.tspan.textContent+=G);const yt=Xt?bt*Mt-dt*ft:bt*Mt+dt*ft;Vt+=yt}q.tspan.setAttributeNS(null,"x",q.xcoords.map(ct).join(" ")),Xt?q.tspan.setAttributeNS(null,"y",q.ycoords.map(ct).join(" ")):q.tspan.setAttributeNS(null,"y",ct(-q.y)),Xt?q.y-=Vt:q.x+=Vt*Tt,q.tspan.setAttributeNS(null,"font-family",q.fontFamily),q.tspan.setAttributeNS(null,"font-size",`${ct(q.fontSize)}px`),q.fontStyle!==ut.fontStyle&&q.tspan.setAttributeNS(null,"font-style",q.fontStyle),q.fontWeight!==ut.fontWeight&&q.tspan.setAttributeNS(null,"font-weight",q.fontWeight);const xt=q.textRenderingMode&O.TextRenderingMode.FILL_STROKE_MASK;if(xt===O.TextRenderingMode.FILL||xt===O.TextRenderingMode.FILL_STROKE?(q.fillColor!==ut.fillColor&&q.tspan.setAttributeNS(null,"fill",q.fillColor),q.fillAlpha<1&&q.tspan.setAttributeNS(null,"fill-opacity",q.fillAlpha)):q.textRenderingMode===O.TextRenderingMode.ADD_TO_PATH?q.tspan.setAttributeNS(null,"fill","transparent"):q.tspan.setAttributeNS(null,"fill","none"),xt===O.TextRenderingMode.STROKE||xt===O.TextRenderingMode.FILL_STROKE){const Nt=1/(q.textMatrixScale||1);this._setStrokeAttributes(q.tspan,Nt)}let Dt=q.textMatrix;q.textRise!==0&&(Dt=Dt.slice(),Dt[5]+=q.textRise),q.txtElement.setAttributeNS(null,"transform",`${mt(Dt)} scale(${ct(Tt)}, -1)`),q.txtElement.setAttributeNS(lt,"xml:space","preserve"),q.txtElement.append(q.tspan),q.txtgrp.append(q.txtElement),this._ensureTransformGroup().append(q.txtElement)}setLeadingMoveText(K,q){this.setLeading(-q),this.moveText(K,q)}addFontStyle(K){if(!K.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const q=tt(K.data,K.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${K.loadedName}"; src: url(${q}); }
`}setFont(K){const q=this.current,U=this.commonObjs.get(K[0]);let rt=K[1];q.font=U,this.embedFonts&&!U.missingFile&&!this.embeddedFonts[U.loadedName]&&(this.addFontStyle(U),this.embeddedFonts[U.loadedName]=U),q.fontMatrix=U.fontMatrix||O.FONT_IDENTITY_MATRIX;let J="normal";U.black?J="900":U.bold&&(J="bold");const Rt=U.italic?"italic":"normal";rt<0?(rt=-rt,q.fontDirection=-1):q.fontDirection=1,q.fontSize=rt,q.fontFamily=U.loadedName,q.fontWeight=J,q.fontStyle=Rt,q.tspan=this.svgFactory.createElement("svg:tspan"),q.tspan.setAttributeNS(null,"y",ct(-q.y)),q.xcoords=[],q.ycoords=[]}endText(){const K=this.current;K.textRenderingMode&O.TextRenderingMode.ADD_TO_PATH_FLAG&&K.txtElement?.hasChildNodes()&&(K.element=K.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(K){K>0&&(this.current.lineWidth=K)}setLineCap(K){this.current.lineCap=vt[K]}setLineJoin(K){this.current.lineJoin=pt[K]}setMiterLimit(K){this.current.miterLimit=K}setStrokeAlpha(K){this.current.strokeAlpha=K}setStrokeRGBColor(K,q,U){this.current.strokeColor=O.Util.makeHexColor(K,q,U)}setFillAlpha(K){this.current.fillAlpha=K}setFillRGBColor(K,q,U){this.current.fillColor=O.Util.makeHexColor(K,q,U),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(K){this.current.strokeColor=this._makeColorN_Pattern(K)}setFillColorN(K){this.current.fillColor=this._makeColorN_Pattern(K)}shadingFill(K){const{width:q,height:U}=this.viewport,rt=O.Util.inverseTransform(this.transformMatrix),[J,Rt,Q,ft]=O.Util.getAxialAlignedBoundingBox([0,0,q,U],rt),Tt=this.svgFactory.createElement("svg:rect");Tt.setAttributeNS(null,"x",J),Tt.setAttributeNS(null,"y",Rt),Tt.setAttributeNS(null,"width",Q-J),Tt.setAttributeNS(null,"height",ft-Rt),Tt.setAttributeNS(null,"fill",this._makeShadingPattern(K)),this.current.fillAlpha<1&&Tt.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(Tt)}_makeColorN_Pattern(K){return K[0]==="TilingPattern"?this._makeTilingPattern(K):this._makeShadingPattern(K)}_makeTilingPattern(K){const q=K[1],U=K[2],rt=K[3]||O.IDENTITY_MATRIX,[J,Rt,Q,ft]=K[4],Tt=K[5],Xt=K[6],Ot=K[7],Bt=`shading${nt++}`,[Mt,Vt,xt,Dt]=O.Util.normalizeRect([...O.Util.applyTransform([J,Rt],rt),...O.Util.applyTransform([Q,ft],rt)]),[Nt,dt]=O.Util.singularValueDecompose2dScale(rt),G=Tt*Nt,X=Xt*dt,et=this.svgFactory.createElement("svg:pattern");et.setAttributeNS(null,"id",Bt),et.setAttributeNS(null,"patternUnits","userSpaceOnUse"),et.setAttributeNS(null,"width",G),et.setAttributeNS(null,"height",X),et.setAttributeNS(null,"x",`${Mt}`),et.setAttributeNS(null,"y",`${Vt}`);const bt=this.svg,yt=this.transformMatrix,At=this.current.fillColor,kt=this.current.strokeColor,Wt=this.svgFactory.create(xt-Mt,Dt-Vt);if(this.svg=Wt,this.transformMatrix=rt,Ot===2){const Jt=O.Util.makeHexColor(...q);this.current.fillColor=Jt,this.current.strokeColor=Jt}return this.executeOpTree(this.convertOpList(U)),this.svg=bt,this.transformMatrix=yt,this.current.fillColor=At,this.current.strokeColor=kt,et.append(Wt.childNodes[0]),this.defs.append(et),`url(#${Bt})`}_makeShadingPattern(K){switch(typeof K=="string"&&(K=this.objs.get(K)),K[0]){case"RadialAxial":const q=`shading${nt++}`,U=K[3];let rt;switch(K[1]){case"axial":const J=K[4],Rt=K[5];rt=this.svgFactory.createElement("svg:linearGradient"),rt.setAttributeNS(null,"id",q),rt.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),rt.setAttributeNS(null,"x1",J[0]),rt.setAttributeNS(null,"y1",J[1]),rt.setAttributeNS(null,"x2",Rt[0]),rt.setAttributeNS(null,"y2",Rt[1]);break;case"radial":const Q=K[4],ft=K[5],Tt=K[6],Xt=K[7];rt=this.svgFactory.createElement("svg:radialGradient"),rt.setAttributeNS(null,"id",q),rt.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),rt.setAttributeNS(null,"cx",ft[0]),rt.setAttributeNS(null,"cy",ft[1]),rt.setAttributeNS(null,"r",Xt),rt.setAttributeNS(null,"fx",Q[0]),rt.setAttributeNS(null,"fy",Q[1]),rt.setAttributeNS(null,"fr",Tt);break;default:throw new Error(`Unknown RadialAxial type: ${K[1]}`)}for(const J of U){const Rt=this.svgFactory.createElement("svg:stop");Rt.setAttributeNS(null,"offset",J[0]),Rt.setAttributeNS(null,"stop-color",J[1]),rt.append(Rt)}return this.defs.append(rt),`url(#${q})`;case"Mesh":return(0,O.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${K[0]}`)}}setDash(K,q){this.current.dashArray=K,this.current.dashPhase=q}constructPath(K,q){const U=this.current;let rt=U.x,J=U.y,Rt=[],Q=0;for(const ft of K)switch(ft|0){case O.OPS.rectangle:rt=q[Q++],J=q[Q++];const Tt=q[Q++],Xt=q[Q++],Ot=rt+Tt,Bt=J+Xt;Rt.push("M",ct(rt),ct(J),"L",ct(Ot),ct(J),"L",ct(Ot),ct(Bt),"L",ct(rt),ct(Bt),"Z");break;case O.OPS.moveTo:rt=q[Q++],J=q[Q++],Rt.push("M",ct(rt),ct(J));break;case O.OPS.lineTo:rt=q[Q++],J=q[Q++],Rt.push("L",ct(rt),ct(J));break;case O.OPS.curveTo:rt=q[Q+4],J=q[Q+5],Rt.push("C",ct(q[Q]),ct(q[Q+1]),ct(q[Q+2]),ct(q[Q+3]),ct(rt),ct(J)),Q+=6;break;case O.OPS.curveTo2:Rt.push("C",ct(rt),ct(J),ct(q[Q]),ct(q[Q+1]),ct(q[Q+2]),ct(q[Q+3])),rt=q[Q+2],J=q[Q+3],Q+=4;break;case O.OPS.curveTo3:rt=q[Q+2],J=q[Q+3],Rt.push("C",ct(q[Q]),ct(q[Q+1]),ct(rt),ct(J),ct(rt),ct(J)),Q+=4;break;case O.OPS.closePath:Rt.push("Z");break}Rt=Rt.join(" "),U.path&&K.length>0&&K[0]!==O.OPS.rectangle&&K[0]!==O.OPS.moveTo?Rt=U.path.getAttributeNS(null,"d")+Rt:(U.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(U.path)),U.path.setAttributeNS(null,"d",Rt),U.path.setAttributeNS(null,"fill","none"),U.element=U.path,U.setCurrentPoint(rt,J)}endPath(){const K=this.current;if(K.path=null,!this.pendingClip)return;if(!K.element){this.pendingClip=null;return}const q=`clippath${st++}`,U=this.svgFactory.createElement("svg:clipPath");U.setAttributeNS(null,"id",q),U.setAttributeNS(null,"transform",mt(this.transformMatrix));const rt=K.element.cloneNode(!0);if(this.pendingClip==="evenodd"?rt.setAttributeNS(null,"clip-rule","evenodd"):rt.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,U.append(rt),this.defs.append(U),K.activeClipUrl){K.clipGroup=null;for(const J of this.extraStack)J.clipGroup=null;U.setAttributeNS(null,"clip-path",K.activeClipUrl)}K.activeClipUrl=`url(#${q})`,this.tgrp=null}clip(K){this.pendingClip=K}closePath(){const K=this.current;if(K.path){const q=`${K.path.getAttributeNS(null,"d")}Z`;K.path.setAttributeNS(null,"d",q)}}setLeading(K){this.current.leading=-K}setTextRise(K){this.current.textRise=K}setTextRenderingMode(K){this.current.textRenderingMode=K}setHScale(K){this.current.textHScale=K/100}setRenderingIntent(K){}setFlatness(K){}setGState(K){for(const[q,U]of K)switch(q){case"LW":this.setLineWidth(U);break;case"LC":this.setLineCap(U);break;case"LJ":this.setLineJoin(U);break;case"ML":this.setMiterLimit(U);break;case"D":this.setDash(U[0],U[1]);break;case"RI":this.setRenderingIntent(U);break;case"FL":this.setFlatness(U);break;case"Font":this.setFont(U);break;case"CA":this.setStrokeAlpha(U);break;case"ca":this.setFillAlpha(U);break;default:(0,O.warn)(`Unimplemented graphic state operator ${q}`);break}}fill(){const K=this.current;K.element&&(K.element.setAttributeNS(null,"fill",K.fillColor),K.element.setAttributeNS(null,"fill-opacity",K.fillAlpha),this.endPath())}stroke(){const K=this.current;K.element&&(this._setStrokeAttributes(K.element),K.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(K,q=1){const U=this.current;let rt=U.dashArray;q!==1&&rt.length>0&&(rt=rt.map(function(J){return q*J})),K.setAttributeNS(null,"stroke",U.strokeColor),K.setAttributeNS(null,"stroke-opacity",U.strokeAlpha),K.setAttributeNS(null,"stroke-miterlimit",ct(U.miterLimit)),K.setAttributeNS(null,"stroke-linecap",U.lineCap),K.setAttributeNS(null,"stroke-linejoin",U.lineJoin),K.setAttributeNS(null,"stroke-width",ct(q*U.lineWidth)+"px"),K.setAttributeNS(null,"stroke-dasharray",rt.map(ct).join(" ")),K.setAttributeNS(null,"stroke-dashoffset",ct(q*U.dashPhase)+"px")}eoFill(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const K=this.svgFactory.createElement("svg:rect");K.setAttributeNS(null,"x","0"),K.setAttributeNS(null,"y","0"),K.setAttributeNS(null,"width","1px"),K.setAttributeNS(null,"height","1px"),K.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(K)}paintImageXObject(K){const q=this.getObject(K);if(!q){(0,O.warn)(`Dependent image with object ID ${K} is not ready yet`);return}this.paintInlineImageXObject(q)}paintInlineImageXObject(K,q){const U=K.width,rt=K.height,J=_t(K,this.forceDataSchema,!!q),Rt=this.svgFactory.createElement("svg:rect");Rt.setAttributeNS(null,"x","0"),Rt.setAttributeNS(null,"y","0"),Rt.setAttributeNS(null,"width",ct(U)),Rt.setAttributeNS(null,"height",ct(rt)),this.current.element=Rt,this.clip("nonzero");const Q=this.svgFactory.createElement("svg:image");Q.setAttributeNS(Yt,"xlink:href",J),Q.setAttributeNS(null,"x","0"),Q.setAttributeNS(null,"y",ct(-rt)),Q.setAttributeNS(null,"width",ct(U)+"px"),Q.setAttributeNS(null,"height",ct(rt)+"px"),Q.setAttributeNS(null,"transform",`scale(${ct(1/U)} ${ct(-1/rt)})`),q?q.append(Q):this._ensureTransformGroup().append(Q)}paintImageMaskXObject(K){const q=this.getObject(K.data,K);if(q.bitmap){(0,O.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const U=this.current,rt=q.width,J=q.height,Rt=U.fillColor;U.maskId=`mask${Z++}`;const Q=this.svgFactory.createElement("svg:mask");Q.setAttributeNS(null,"id",U.maskId);const ft=this.svgFactory.createElement("svg:rect");ft.setAttributeNS(null,"x","0"),ft.setAttributeNS(null,"y","0"),ft.setAttributeNS(null,"width",ct(rt)),ft.setAttributeNS(null,"height",ct(J)),ft.setAttributeNS(null,"fill",Rt),ft.setAttributeNS(null,"mask",`url(#${U.maskId})`),this.defs.append(Q),this._ensureTransformGroup().append(ft),this.paintInlineImageXObject(q,Q)}paintFormXObjectBegin(K,q){if(Array.isArray(K)&&K.length===6&&this.transform(K[0],K[1],K[2],K[3],K[4],K[5]),q){const U=q[2]-q[0],rt=q[3]-q[1],J=this.svgFactory.createElement("svg:rect");J.setAttributeNS(null,"x",q[0]),J.setAttributeNS(null,"y",q[1]),J.setAttributeNS(null,"width",ct(U)),J.setAttributeNS(null,"height",ct(rt)),this.current.element=J,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(K){const q=this.svgFactory.create(K.width,K.height),U=this.svgFactory.createElement("svg:defs");q.append(U),this.defs=U;const rt=this.svgFactory.createElement("svg:g");return rt.setAttributeNS(null,"transform",mt(K.transform)),q.append(rt),this.svg=rt,q}_ensureClipGroup(){if(!this.current.clipGroup){const K=this.svgFactory.createElement("svg:g");K.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(K),this.current.clipGroup=K}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",mt(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}w.SVGGraphics=Et},(Y,w)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.XfaText=void 0;class W{static textContent(O){const ut=[],lt={items:ut,styles:Object.create(null)};function Yt(vt){if(!vt)return;let pt=null;const tt=vt.name;if(tt==="#text")pt=vt.value;else if(W.shouldBuildText(tt))vt?.attributes?.textContent?pt=vt.attributes.textContent:vt.value&&(pt=vt.value);else return;if(pt!==null&&ut.push({str:pt}),!!vt.children)for(const _t of vt.children)Yt(_t)}return Yt(O),lt}static shouldBuildText(O){return!(O==="textarea"||O==="input"||O==="option"||O==="select")}}w.XfaText=W},(Y,w,W)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.TextLayerRenderTask=void 0,w.renderTextLayer=mt,w.updateTextLayer=st;var F=W(1),O=W(6);const ut=1e5,lt=30,Yt=.8,vt=new Map;function pt(Z,nt){let Et;if(nt&&F.FeatureTest.isOffscreenCanvasSupported)Et=new OffscreenCanvas(Z,Z).getContext("2d",{alpha:!1});else{const ot=document.createElement("canvas");ot.width=ot.height=Z,Et=ot.getContext("2d",{alpha:!1})}return Et}function tt(Z,nt){const Et=vt.get(Z);if(Et)return Et;const ot=pt(lt,nt);ot.font=`${lt}px ${Z}`;const K=ot.measureText("");let q=K.fontBoundingBoxAscent,U=Math.abs(K.fontBoundingBoxDescent);if(q){const J=q/(q+U);return vt.set(Z,J),ot.canvas.width=ot.canvas.height=0,J}ot.strokeStyle="red",ot.clearRect(0,0,lt,lt),ot.strokeText("g",0,0);let rt=ot.getImageData(0,0,lt,lt).data;U=0;for(let J=rt.length-1-3;J>=0;J-=4)if(rt[J]>0){U=Math.ceil(J/4/lt);break}ot.clearRect(0,0,lt,lt),ot.strokeText("A",0,lt),rt=ot.getImageData(0,0,lt,lt).data,q=0;for(let J=0,Rt=rt.length;J<Rt;J+=4)if(rt[J]>0){q=lt-Math.floor(J/4/lt);break}if(ot.canvas.width=ot.canvas.height=0,q){const J=q/(q+U);return vt.set(Z,J),J}return vt.set(Z,Yt),Yt}function _t(Z,nt,Et){const ot=document.createElement("span"),K={angle:0,canvasWidth:0,hasText:nt.str!=="",hasEOL:nt.hasEOL,fontSize:0};Z._textDivs.push(ot);const q=F.Util.transform(Z._transform,nt.transform);let U=Math.atan2(q[1],q[0]);const rt=Et[nt.fontName];rt.vertical&&(U+=Math.PI/2);const J=Math.hypot(q[2],q[3]),Rt=J*tt(rt.fontFamily,Z._isOffscreenCanvasSupported);let Q,ft;U===0?(Q=q[4],ft=q[5]-Rt):(Q=q[4]+Rt*Math.sin(U),ft=q[5]-Rt*Math.cos(U));const Tt="calc(var(--scale-factor)*",Xt=ot.style;Z._container===Z._rootContainer?(Xt.left=`${(100*Q/Z._pageWidth).toFixed(2)}%`,Xt.top=`${(100*ft/Z._pageHeight).toFixed(2)}%`):(Xt.left=`${Tt}${Q.toFixed(2)}px)`,Xt.top=`${Tt}${ft.toFixed(2)}px)`),Xt.fontSize=`${Tt}${J.toFixed(2)}px)`,Xt.fontFamily=rt.fontFamily,K.fontSize=J,ot.setAttribute("role","presentation"),ot.textContent=nt.str,ot.dir=nt.dir,Z._fontInspectorEnabled&&(ot.dataset.fontName=nt.fontName),U!==0&&(K.angle=U*(180/Math.PI));let Ot=!1;if(nt.str.length>1)Ot=!0;else if(nt.str!==" "&&nt.transform[0]!==nt.transform[3]){const Bt=Math.abs(nt.transform[0]),Mt=Math.abs(nt.transform[3]);Bt!==Mt&&Math.max(Bt,Mt)/Math.min(Bt,Mt)>1.5&&(Ot=!0)}Ot&&(K.canvasWidth=rt.vertical?nt.height:nt.width),Z._textDivProperties.set(ot,K),Z._isReadableStream&&Z._layoutText(ot)}function Ct(Z){const{div:nt,scale:Et,properties:ot,ctx:K,prevFontSize:q,prevFontFamily:U}=Z,{style:rt}=nt;let J="";if(ot.canvasWidth!==0&&ot.hasText){const{fontFamily:Rt}=rt,{canvasWidth:Q,fontSize:ft}=ot;(q!==ft||U!==Rt)&&(K.font=`${ft*Et}px ${Rt}`,Z.prevFontSize=ft,Z.prevFontFamily=Rt);const{width:Tt}=K.measureText(nt.textContent);Tt>0&&(J=`scaleX(${Q*Et/Tt})`)}ot.angle!==0&&(J=`rotate(${ot.angle}deg) ${J}`),J.length>0&&(rt.transform=J)}function at(Z){if(Z._canceled)return;const nt=Z._textDivs,Et=Z._capability;if(nt.length>ut){Et.resolve();return}if(!Z._isReadableStream)for(const K of nt)Z._layoutText(K);Et.resolve()}class ct{constructor({textContentSource:nt,container:Et,viewport:ot,textDivs:K,textDivProperties:q,textContentItemsStr:U,isOffscreenCanvasSupported:rt}){this._textContentSource=nt,this._isReadableStream=nt instanceof ReadableStream,this._container=this._rootContainer=Et,this._textDivs=K||[],this._textContentItemsStr=U||[],this._isOffscreenCanvasSupported=rt,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=q||new WeakMap,this._canceled=!1,this._capability=new F.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:ot.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:pt(0,rt)};const{pageWidth:J,pageHeight:Rt,pageX:Q,pageY:ft}=ot.rawDims;this._transform=[1,0,0,-1,-Q,ft+Rt],this._pageWidth=J,this._pageHeight=Rt,(0,O.setLayerDimensions)(Et,ot),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new F.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new F.AbortException("TextLayer task cancelled."))}_processItems(nt,Et){for(const ot of nt){if(ot.str===void 0){if(ot.type==="beginMarkedContentProps"||ot.type==="beginMarkedContent"){const K=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),ot.id!==null&&this._container.setAttribute("id",`${ot.id}`),K.append(this._container)}else ot.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(ot.str),_t(this,ot,Et)}}_layoutText(nt){const Et=this._layoutTextParams.properties=this._textDivProperties.get(nt);if(this._layoutTextParams.div=nt,Ct(this._layoutTextParams),Et.hasText&&this._container.append(nt),Et.hasEOL){const ot=document.createElement("br");ot.setAttribute("role","presentation"),this._container.append(ot)}}_render(){const nt=new F.PromiseCapability;let Et=Object.create(null);if(this._isReadableStream){const ot=()=>{this._reader.read().then(({value:K,done:q})=>{if(q){nt.resolve();return}Object.assign(Et,K.styles),this._processItems(K.items,Et),ot()},nt.reject)};this._reader=this._textContentSource.getReader(),ot()}else if(this._textContentSource){const{items:ot,styles:K}=this._textContentSource;this._processItems(ot,K),nt.resolve()}else throw new Error('No "textContentSource" parameter specified.');nt.promise.then(()=>{Et=null,at(this)},this._capability.reject)}}w.TextLayerRenderTask=ct;function mt(Z){!Z.textContentSource&&(Z.textContent||Z.textContentStream)&&((0,O.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),Z.textContentSource=Z.textContent||Z.textContentStream);const{container:nt,viewport:Et}=Z,ot=getComputedStyle(nt),K=ot.getPropertyValue("visibility"),q=parseFloat(ot.getPropertyValue("--scale-factor"));K==="visible"&&(!q||Math.abs(q-Et.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const U=new ct(Z);return U._render(),U}function st({container:Z,viewport:nt,textDivs:Et,textDivProperties:ot,isOffscreenCanvasSupported:K,mustRotate:q=!0,mustRescale:U=!0}){if(q&&(0,O.setLayerDimensions)(Z,{rotation:nt.rotation}),U){const rt=pt(0,K),Rt={prevFontSize:null,prevFontFamily:null,div:null,scale:nt.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:rt};for(const Q of Et)Rt.properties=ot.get(Q),Rt.div=Q,Ct(Rt)}}},(Y,w,W)=>{var tt,_t,Ct,at,ct,mt,st,Z,nt,Et,ot,Ls,cs,Os,Ns;Object.defineProperty(w,"__esModule",{value:!0}),w.AnnotationEditorLayer=void 0;var F=W(1),O=W(4),ut=W(28),lt=W(33),Yt=W(6),vt=W(34);const J=class J{constructor({uiManager:Q,pageIndex:ft,div:Tt,accessibilityManager:Xt,annotationLayer:Ot,viewport:Bt,l10n:Mt}){Ht(this,ot);Ht(this,tt);Ht(this,_t,!1);Ht(this,Ct,null);Ht(this,at,this.pointerup.bind(this));Ht(this,ct,this.pointerdown.bind(this));Ht(this,mt,new Map);Ht(this,st,!1);Ht(this,Z,!1);Ht(this,nt,!1);Ht(this,Et);const Vt=[ut.FreeTextEditor,lt.InkEditor,vt.StampEditor];if(!J._initialized){J._initialized=!0;for(const xt of Vt)xt.initialize(Mt)}Q.registerEditorTypes(Vt),zt(this,Et,Q),this.pageIndex=ft,this.div=Tt,zt(this,tt,Xt),zt(this,Ct,Ot),this.viewport=Bt,D(this,Et).addLayer(this)}get isEmpty(){return D(this,mt).size===0}updateToolbar(Q){D(this,Et).updateToolbar(Q)}updateMode(Q=D(this,Et).getMode()){Ft(this,ot,Ns).call(this),Q===F.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),Q!==F.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",Q===F.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",Q===F.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",Q===F.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(Q){if(!Q&&D(this,Et).getMode()!==F.AnnotationEditorType.INK)return;if(!Q){for(const Tt of D(this,mt).values())if(Tt.isEmpty()){Tt.setInBackground();return}}Ft(this,ot,cs).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(Q){D(this,Et).setEditingState(Q)}addCommands(Q){D(this,Et).addCommands(Q)}enable(){this.div.style.pointerEvents="auto";const Q=new Set;for(const Tt of D(this,mt).values())Tt.enableEditing(),Tt.annotationElementId&&Q.add(Tt.annotationElementId);if(!D(this,Ct))return;const ft=D(this,Ct).getEditableAnnotations();for(const Tt of ft){if(Tt.hide(),D(this,Et).isDeletedAnnotationElement(Tt.data.id)||Q.has(Tt.data.id))continue;const Xt=this.deserialize(Tt);Xt&&(this.addOrRebuild(Xt),Xt.enableEditing())}}disable(){zt(this,nt,!0),this.div.style.pointerEvents="none";const Q=new Set;for(const ft of D(this,mt).values()){if(ft.disableEditing(),!ft.annotationElementId||ft.serialize()!==null){Q.add(ft.annotationElementId);continue}this.getEditableAnnotation(ft.annotationElementId)?.show(),ft.remove()}if(D(this,Ct)){const ft=D(this,Ct).getEditableAnnotations();for(const Tt of ft){const{id:Xt}=Tt.data;Q.has(Xt)||D(this,Et).isDeletedAnnotationElement(Xt)||Tt.show()}}Ft(this,ot,Ns).call(this),this.isEmpty&&(this.div.hidden=!0),zt(this,nt,!1)}getEditableAnnotation(Q){return D(this,Ct)?.getEditableAnnotation(Q)||null}setActiveEditor(Q){D(this,Et).getActive()!==Q&&D(this,Et).setActiveEditor(Q)}enableClick(){this.div.addEventListener("pointerdown",D(this,ct)),this.div.addEventListener("pointerup",D(this,at))}disableClick(){this.div.removeEventListener("pointerdown",D(this,ct)),this.div.removeEventListener("pointerup",D(this,at))}attach(Q){D(this,mt).set(Q.id,Q);const{annotationElementId:ft}=Q;ft&&D(this,Et).isDeletedAnnotationElement(ft)&&D(this,Et).removeDeletedAnnotationElement(Q)}detach(Q){D(this,mt).delete(Q.id),D(this,tt)?.removePointerInTextLayer(Q.contentDiv),!D(this,nt)&&Q.annotationElementId&&D(this,Et).addDeletedAnnotationElement(Q)}remove(Q){this.detach(Q),D(this,Et).removeEditor(Q),Q.div.contains(document.activeElement)&&setTimeout(()=>{D(this,Et).focusMainContainer()},0),Q.div.remove(),Q.isAttachedToDOM=!1,D(this,Z)||this.addInkEditorIfNeeded(!1)}changeParent(Q){Q.parent!==this&&(Q.annotationElementId&&(D(this,Et).addDeletedAnnotationElement(Q.annotationElementId),O.AnnotationEditor.deleteAnnotationElement(Q),Q.annotationElementId=null),this.attach(Q),Q.parent?.detach(Q),Q.setParent(this),Q.div&&Q.isAttachedToDOM&&(Q.div.remove(),this.div.append(Q.div)))}add(Q){if(this.changeParent(Q),D(this,Et).addEditor(Q),this.attach(Q),!Q.isAttachedToDOM){const ft=Q.render();this.div.append(ft),Q.isAttachedToDOM=!0}Q.fixAndSetPosition(),Q.onceAdded(),D(this,Et).addToAnnotationStorage(Q)}moveEditorInDOM(Q){if(!Q.isAttachedToDOM)return;const{activeElement:ft}=document;Q.div.contains(ft)&&(Q._focusEventsAllowed=!1,setTimeout(()=>{Q.div.contains(document.activeElement)?Q._focusEventsAllowed=!0:(Q.div.addEventListener("focusin",()=>{Q._focusEventsAllowed=!0},{once:!0}),ft.focus())},0)),Q._structTreeParentId=D(this,tt)?.moveElementInDOM(this.div,Q.div,Q.contentDiv,!0)}addOrRebuild(Q){Q.needsToBeRebuilt()?Q.rebuild():this.add(Q)}addUndoableEditor(Q){const ft=()=>Q._uiManager.rebuild(Q),Tt=()=>{Q.remove()};this.addCommands({cmd:ft,undo:Tt,mustExec:!1})}getNextId(){return D(this,Et).getId()}pasteEditor(Q,ft){D(this,Et).updateToolbar(Q),D(this,Et).updateMode(Q);const{offsetX:Tt,offsetY:Xt}=Ft(this,ot,Os).call(this),Ot=this.getNextId(),Bt=Ft(this,ot,Ls).call(this,{parent:this,id:Ot,x:Tt,y:Xt,uiManager:D(this,Et),isCentered:!0,...ft});Bt&&this.add(Bt)}deserialize(Q){switch(Q.annotationType??Q.annotationEditorType){case F.AnnotationEditorType.FREETEXT:return ut.FreeTextEditor.deserialize(Q,this,D(this,Et));case F.AnnotationEditorType.INK:return lt.InkEditor.deserialize(Q,this,D(this,Et));case F.AnnotationEditorType.STAMP:return vt.StampEditor.deserialize(Q,this,D(this,Et))}return null}addNewEditor(){Ft(this,ot,cs).call(this,Ft(this,ot,Os).call(this),!0)}setSelected(Q){D(this,Et).setSelected(Q)}toggleSelected(Q){D(this,Et).toggleSelected(Q)}isSelected(Q){return D(this,Et).isSelected(Q)}unselect(Q){D(this,Et).unselect(Q)}pointerup(Q){const{isMac:ft}=F.FeatureTest.platform;if(!(Q.button!==0||Q.ctrlKey&&ft)&&Q.target===this.div&&D(this,st)){if(zt(this,st,!1),!D(this,_t)){zt(this,_t,!0);return}if(D(this,Et).getMode()===F.AnnotationEditorType.STAMP){D(this,Et).unselectAll();return}Ft(this,ot,cs).call(this,Q,!1)}}pointerdown(Q){if(D(this,st)){zt(this,st,!1);return}const{isMac:ft}=F.FeatureTest.platform;if(Q.button!==0||Q.ctrlKey&&ft||Q.target!==this.div)return;zt(this,st,!0);const Tt=D(this,Et).getActive();zt(this,_t,!Tt||Tt.isEmpty())}findNewParent(Q,ft,Tt){const Xt=D(this,Et).findParent(ft,Tt);return Xt===null||Xt===this?!1:(Xt.changeParent(Q),!0)}destroy(){D(this,Et).getActive()?.parent===this&&(D(this,Et).commitOrRemove(),D(this,Et).setActiveEditor(null));for(const Q of D(this,mt).values())D(this,tt)?.removePointerInTextLayer(Q.contentDiv),Q.setParent(null),Q.isAttachedToDOM=!1,Q.div.remove();this.div=null,D(this,mt).clear(),D(this,Et).removeLayer(this)}render({viewport:Q}){this.viewport=Q,(0,Yt.setLayerDimensions)(this.div,Q);for(const ft of D(this,Et).getEditors(this.pageIndex))this.add(ft);this.updateMode()}update({viewport:Q}){D(this,Et).commitOrRemove(),this.viewport=Q,(0,Yt.setLayerDimensions)(this.div,{rotation:Q.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:Q,pageHeight:ft}=this.viewport.rawDims;return[Q,ft]}};tt=new WeakMap,_t=new WeakMap,Ct=new WeakMap,at=new WeakMap,ct=new WeakMap,mt=new WeakMap,st=new WeakMap,Z=new WeakMap,nt=new WeakMap,Et=new WeakMap,ot=new WeakSet,Ls=function(Q){switch(D(this,Et).getMode()){case F.AnnotationEditorType.FREETEXT:return new ut.FreeTextEditor(Q);case F.AnnotationEditorType.INK:return new lt.InkEditor(Q);case F.AnnotationEditorType.STAMP:return new vt.StampEditor(Q)}return null},cs=function(Q,ft){const Tt=this.getNextId(),Xt=Ft(this,ot,Ls).call(this,{parent:this,id:Tt,x:Q.offsetX,y:Q.offsetY,uiManager:D(this,Et),isCentered:ft});return Xt&&this.add(Xt),Xt},Os=function(){const{x:Q,y:ft,width:Tt,height:Xt}=this.div.getBoundingClientRect(),Ot=Math.max(0,Q),Bt=Math.max(0,ft),Mt=Math.min(window.innerWidth,Q+Tt),Vt=Math.min(window.innerHeight,ft+Xt),xt=(Ot+Mt)/2-Q,Dt=(Bt+Vt)/2-ft,[Nt,dt]=this.viewport.rotation%180===0?[xt,Dt]:[Dt,xt];return{offsetX:Nt,offsetY:dt}},Ns=function(){zt(this,Z,!0);for(const Q of D(this,mt).values())Q.isEmpty()&&Q.remove();zt(this,Z,!1)},Le(J,"_initialized",!1);let pt=J;w.AnnotationEditorLayer=pt},(Y,w,W)=>{var vt,pt,tt,_t,Ct,at,ct,mt,st,Z,ui,pi,fi,ts,$s,gi,Us;Object.defineProperty(w,"__esModule",{value:!0}),w.FreeTextEditor=void 0;var F=W(1),O=W(5),ut=W(4),lt=W(29);const J=class J extends ut.AnnotationEditor{constructor(ft){super({...ft,name:"freeTextEditor"});Ht(this,Z);Ht(this,vt,this.editorDivBlur.bind(this));Ht(this,pt,this.editorDivFocus.bind(this));Ht(this,tt,this.editorDivInput.bind(this));Ht(this,_t,this.editorDivKeydown.bind(this));Ht(this,Ct);Ht(this,at,"");Ht(this,ct,`${this.id}-editor`);Ht(this,mt);Ht(this,st,null);zt(this,Ct,ft.color||J._defaultColor||ut.AnnotationEditor._defaultLineColor),zt(this,mt,ft.fontSize||J._defaultFontSize)}static get _keyboardManager(){const ft=J.prototype,Tt=Bt=>Bt.isEmpty(),Xt=O.AnnotationEditorUIManager.TRANSLATE_SMALL,Ot=O.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,F.shadow)(this,"_keyboardManager",new O.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],ft.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],ft.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],ft._translateEmpty,{args:[-Xt,0],checker:Tt}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],ft._translateEmpty,{args:[-Ot,0],checker:Tt}],[["ArrowRight","mac+ArrowRight"],ft._translateEmpty,{args:[Xt,0],checker:Tt}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],ft._translateEmpty,{args:[Ot,0],checker:Tt}],[["ArrowUp","mac+ArrowUp"],ft._translateEmpty,{args:[0,-Xt],checker:Tt}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],ft._translateEmpty,{args:[0,-Ot],checker:Tt}],[["ArrowDown","mac+ArrowDown"],ft._translateEmpty,{args:[0,Xt],checker:Tt}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],ft._translateEmpty,{args:[0,Ot],checker:Tt}]]))}static initialize(ft){ut.AnnotationEditor.initialize(ft,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const Tt=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(Tt.getPropertyValue("--freetext-padding"))}static updateDefaultParams(ft,Tt){switch(ft){case F.AnnotationEditorParamsType.FREETEXT_SIZE:J._defaultFontSize=Tt;break;case F.AnnotationEditorParamsType.FREETEXT_COLOR:J._defaultColor=Tt;break}}updateParams(ft,Tt){switch(ft){case F.AnnotationEditorParamsType.FREETEXT_SIZE:Ft(this,Z,ui).call(this,Tt);break;case F.AnnotationEditorParamsType.FREETEXT_COLOR:Ft(this,Z,pi).call(this,Tt);break}}static get defaultPropertiesToUpdate(){return[[F.AnnotationEditorParamsType.FREETEXT_SIZE,J._defaultFontSize],[F.AnnotationEditorParamsType.FREETEXT_COLOR,J._defaultColor||ut.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[F.AnnotationEditorParamsType.FREETEXT_SIZE,D(this,mt)],[F.AnnotationEditorParamsType.FREETEXT_COLOR,D(this,Ct)]]}_translateEmpty(ft,Tt){this._uiManager.translateSelectedEditors(ft,Tt,!0)}getInitialTranslation(){const ft=this.parentScale;return[-J._internalPadding*ft,-(J._internalPadding+D(this,mt))*ft]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(F.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",D(this,_t)),this.editorDiv.addEventListener("focus",D(this,pt)),this.editorDiv.addEventListener("blur",D(this,vt)),this.editorDiv.addEventListener("input",D(this,tt)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",D(this,ct)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",D(this,_t)),this.editorDiv.removeEventListener("focus",D(this,pt)),this.editorDiv.removeEventListener("blur",D(this,vt)),this.editorDiv.removeEventListener("input",D(this,tt)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(ft){this._focusEventsAllowed&&(super.focusin(ft),ft.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){if(this.width){Ft(this,Z,Us).call(this);return}this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const ft=D(this,at),Tt=zt(this,at,Ft(this,Z,fi).call(this).trimEnd());if(ft===Tt)return;const Xt=Ot=>{if(zt(this,at,Ot),!Ot){this.remove();return}Ft(this,Z,$s).call(this),this._uiManager.rebuild(this),Ft(this,Z,ts).call(this)};this.addCommands({cmd:()=>{Xt(Tt)},undo:()=>{Xt(ft)},mustExec:!1}),Ft(this,Z,ts).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(ft){this.enterInEditMode()}keydown(ft){ft.target===this.div&&ft.key==="Enter"&&(this.enterInEditMode(),ft.preventDefault())}editorDivKeydown(ft){J._keyboardManager.exec(this,ft)}editorDivFocus(ft){this.isEditing=!0}editorDivBlur(ft){this.isEditing=!1}editorDivInput(ft){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let ft,Tt;this.width&&(ft=this.x,Tt=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",D(this,ct)),this.enableEditing(),ut.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(Ot=>this.editorDiv?.setAttribute("aria-label",Ot)),ut.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(Ot=>this.editorDiv?.setAttribute("default-content",Ot)),this.editorDiv.contentEditable=!0;const{style:Xt}=this.editorDiv;if(Xt.fontSize=`calc(${D(this,mt)}px * var(--scale-factor))`,Xt.color=D(this,Ct),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,O.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[Ot,Bt]=this.parentDimensions;if(this.annotationElementId){const{position:Mt}=D(this,st);let[Vt,xt]=this.getInitialTranslation();[Vt,xt]=this.pageTranslationToScreen(Vt,xt);const[Dt,Nt]=this.pageDimensions,[dt,G]=this.pageTranslation;let X,et;switch(this.rotation){case 0:X=ft+(Mt[0]-dt)/Dt,et=Tt+this.height-(Mt[1]-G)/Nt;break;case 90:X=ft+(Mt[0]-dt)/Dt,et=Tt-(Mt[1]-G)/Nt,[Vt,xt]=[xt,-Vt];break;case 180:X=ft-this.width+(Mt[0]-dt)/Dt,et=Tt-(Mt[1]-G)/Nt,[Vt,xt]=[-Vt,-xt];break;case 270:X=ft+(Mt[0]-dt-this.height*Nt)/Dt,et=Tt+(Mt[1]-G-this.width*Dt)/Nt,[Vt,xt]=[-xt,Vt];break}this.setAt(X*Ot,et*Bt,Vt,xt)}else this.setAt(ft*Ot,Tt*Bt,this.width*Ot,this.height*Bt);Ft(this,Z,$s).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(ft,Tt,Xt){let Ot=null;if(ft instanceof lt.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:Mt,fontColor:Vt},rect:xt,rotation:Dt,id:Nt},textContent:dt,textPosition:G,parent:{page:{pageNumber:X}}}=ft;if(!dt||dt.length===0)return null;Ot=ft={annotationType:F.AnnotationEditorType.FREETEXT,color:Array.from(Vt),fontSize:Mt,value:dt.join(`
`),position:G,pageIndex:X-1,rect:xt,rotation:Dt,id:Nt,deleted:!1}}const Bt=super.deserialize(ft,Tt,Xt);return zt(Bt,mt,ft.fontSize),zt(Bt,Ct,F.Util.makeHexColor(...ft.color)),zt(Bt,at,ft.value),Bt.annotationElementId=ft.id||null,zt(Bt,st,Ot),Bt}serialize(ft=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const Tt=J._internalPadding*this.parentScale,Xt=this.getRect(Tt,Tt),Ot=ut.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:D(this,Ct)),Bt={annotationType:F.AnnotationEditorType.FREETEXT,color:Ot,fontSize:D(this,mt),value:D(this,at),pageIndex:this.pageIndex,rect:Xt,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return ft?Bt:this.annotationElementId&&!Ft(this,Z,gi).call(this,Bt)?null:(Bt.id=this.annotationElementId,Bt)}};vt=new WeakMap,pt=new WeakMap,tt=new WeakMap,_t=new WeakMap,Ct=new WeakMap,at=new WeakMap,ct=new WeakMap,mt=new WeakMap,st=new WeakMap,Z=new WeakSet,ui=function(ft){const Tt=Ot=>{this.editorDiv.style.fontSize=`calc(${Ot}px * var(--scale-factor))`,this.translate(0,-(Ot-D(this,mt))*this.parentScale),zt(this,mt,Ot),Ft(this,Z,ts).call(this)},Xt=D(this,mt);this.addCommands({cmd:()=>{Tt(ft)},undo:()=>{Tt(Xt)},mustExec:!0,type:F.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},pi=function(ft){const Tt=D(this,Ct);this.addCommands({cmd:()=>{zt(this,Ct,this.editorDiv.style.color=ft)},undo:()=>{zt(this,Ct,this.editorDiv.style.color=Tt)},mustExec:!0,type:F.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},fi=function(){const ft=this.editorDiv.getElementsByTagName("div");if(ft.length===0)return this.editorDiv.innerText;const Tt=[];for(const Xt of ft)Tt.push(Xt.innerText.replace(/\r\n?|\n/,""));return Tt.join(`
`)},ts=function(){const[ft,Tt]=this.parentDimensions;let Xt;if(this.isAttachedToDOM)Xt=this.div.getBoundingClientRect();else{const{currentLayer:Ot,div:Bt}=this,Mt=Bt.style.display;Bt.style.display="hidden",Ot.div.append(this.div),Xt=Bt.getBoundingClientRect(),Bt.remove(),Bt.style.display=Mt}this.rotation%180===this.parentRotation%180?(this.width=Xt.width/ft,this.height=Xt.height/Tt):(this.width=Xt.height/ft,this.height=Xt.width/Tt),this.fixAndSetPosition()},$s=function(){if(this.editorDiv.replaceChildren(),!!D(this,at))for(const ft of D(this,at).split(`
`)){const Tt=document.createElement("div");Tt.append(ft?document.createTextNode(ft):document.createElement("br")),this.editorDiv.append(Tt)}},gi=function(ft){const{value:Tt,fontSize:Xt,color:Ot,rect:Bt,pageIndex:Mt}=D(this,st);return ft.value!==Tt||ft.fontSize!==Xt||ft.rect.some((Vt,xt)=>Math.abs(Vt-Bt[xt])>=1)||ft.color.some((Vt,xt)=>Vt!==Ot[xt])||ft.pageIndex!==Mt},Us=function(ft=!1){if(!this.annotationElementId)return;if(Ft(this,Z,ts).call(this),!ft&&(this.width===0||this.height===0)){setTimeout(()=>Ft(this,Z,Us).call(this,!0),0);return}const Tt=J._internalPadding*this.parentScale;D(this,st).rect=this.getRect(Tt,Tt)},Le(J,"_freeTextDefaultContent",""),Le(J,"_internalPadding",0),Le(J,"_defaultColor",null),Le(J,"_defaultFontSize",10),Le(J,"_type","freetext");let Yt=J;w.FreeTextEditor=Yt},(Y,w,W)=>{var et,yt,je,mi,Wt,Jt,te,se,ne,ae,$t,Ut,it,St,It,jt,Zt,re,oe,Lt,he,de,bi,hs,Bs,js,we,ke,Re,le,Gt,qt,me,Hs,Te,wt,ie,ue,_i,zs;Object.defineProperty(w,"__esModule",{value:!0}),w.StampAnnotationElement=w.InkAnnotationElement=w.FreeTextAnnotationElement=w.AnnotationLayer=void 0;var F=W(1),O=W(6),ut=W(3),lt=W(30),Yt=W(31),vt=W(32);const pt=1e3,tt=9,_t=new WeakSet;function Ct(ge){return{width:ge[2]-ge[0],height:ge[3]-ge[1]}}class at{static create(gt){switch(gt.data.annotationType){case F.AnnotationType.LINK:return new mt(gt);case F.AnnotationType.TEXT:return new st(gt);case F.AnnotationType.WIDGET:switch(gt.data.fieldType){case"Tx":return new nt(gt);case"Btn":return gt.data.radioButton?new K(gt):gt.data.checkBox?new ot(gt):new q(gt);case"Ch":return new U(gt);case"Sig":return new Et(gt)}return new Z(gt);case F.AnnotationType.POPUP:return new rt(gt);case F.AnnotationType.FREETEXT:return new Rt(gt);case F.AnnotationType.LINE:return new Q(gt);case F.AnnotationType.SQUARE:return new ft(gt);case F.AnnotationType.CIRCLE:return new Tt(gt);case F.AnnotationType.POLYLINE:return new Xt(gt);case F.AnnotationType.CARET:return new Bt(gt);case F.AnnotationType.INK:return new Mt(gt);case F.AnnotationType.POLYGON:return new Ot(gt);case F.AnnotationType.HIGHLIGHT:return new Vt(gt);case F.AnnotationType.UNDERLINE:return new xt(gt);case F.AnnotationType.SQUIGGLY:return new Dt(gt);case F.AnnotationType.STRIKEOUT:return new Nt(gt);case F.AnnotationType.STAMP:return new dt(gt);case F.AnnotationType.FILEATTACHMENT:return new G(gt);default:return new ct(gt)}}}const bt=class bt{constructor(gt,{isRenderable:ht=!1,ignoreBorder:Pt=!1,createQuadrilaterals:Kt=!1}={}){Ht(this,et,!1);this.isRenderable=ht,this.data=gt.data,this.layer=gt.layer,this.linkService=gt.linkService,this.downloadManager=gt.downloadManager,this.imageResourcesPath=gt.imageResourcesPath,this.renderForms=gt.renderForms,this.svgFactory=gt.svgFactory,this.annotationStorage=gt.annotationStorage,this.enableScripting=gt.enableScripting,this.hasJSActions=gt.hasJSActions,this._fieldObjects=gt.fieldObjects,this.parent=gt.parent,ht&&(this.container=this._createContainer(Pt)),Kt&&this._createQuadrilaterals()}static _hasPopupData({titleObj:gt,contentsObj:ht,richText:Pt}){return!!(gt?.str||ht?.str||Pt?.str)}get hasPopupData(){return bt._hasPopupData(this.data)}_createContainer(gt){const{data:ht,parent:{page:Pt,viewport:Kt}}=this,Qt=document.createElement("section");Qt.setAttribute("data-annotation-id",ht.id),this instanceof Z||(Qt.tabIndex=pt),Qt.style.zIndex=this.parent.zIndex++,this.data.popupRef&&Qt.setAttribute("aria-haspopup","dialog"),ht.noRotate&&Qt.classList.add("norotate");const{pageWidth:ee,pageHeight:ce,pageX:pe,pageY:Se}=Kt.rawDims;if(!ht.rect||this instanceof rt){const{rotation:Pe}=ht;return!ht.hasOwnCanvas&&Pe!==0&&this.setRotation(Pe,Qt),Qt}const{width:ve,height:fe}=Ct(ht.rect),_e=F.Util.normalizeRect([ht.rect[0],Pt.view[3]-ht.rect[1]+Pt.view[1],ht.rect[2],Pt.view[3]-ht.rect[3]+Pt.view[1]]);if(!gt&&ht.borderStyle.width>0){Qt.style.borderWidth=`${ht.borderStyle.width}px`;const Pe=ht.borderStyle.horizontalCornerRadius,Ie=ht.borderStyle.verticalCornerRadius;if(Pe>0||Ie>0){const Oe=`calc(${Pe}px * var(--scale-factor)) / calc(${Ie}px * var(--scale-factor))`;Qt.style.borderRadius=Oe}else if(this instanceof K){const Oe=`calc(${ve}px * var(--scale-factor)) / calc(${fe}px * var(--scale-factor))`;Qt.style.borderRadius=Oe}switch(ht.borderStyle.style){case F.AnnotationBorderStyleType.SOLID:Qt.style.borderStyle="solid";break;case F.AnnotationBorderStyleType.DASHED:Qt.style.borderStyle="dashed";break;case F.AnnotationBorderStyleType.BEVELED:(0,F.warn)("Unimplemented border style: beveled");break;case F.AnnotationBorderStyleType.INSET:(0,F.warn)("Unimplemented border style: inset");break;case F.AnnotationBorderStyleType.UNDERLINE:Qt.style.borderBottomStyle="solid";break}const De=ht.borderColor||null;De?(zt(this,et,!0),Qt.style.borderColor=F.Util.makeHexColor(De[0]|0,De[1]|0,De[2]|0)):Qt.style.borderWidth=0}Qt.style.left=`${100*(_e[0]-pe)/ee}%`,Qt.style.top=`${100*(_e[1]-Se)/ce}%`;const{rotation:xe}=ht;return ht.hasOwnCanvas||xe===0?(Qt.style.width=`${100*ve/ee}%`,Qt.style.height=`${100*fe/ce}%`):this.setRotation(xe,Qt),Qt}setRotation(gt,ht=this.container){if(!this.data.rect)return;const{pageWidth:Pt,pageHeight:Kt}=this.parent.viewport.rawDims,{width:Qt,height:ee}=Ct(this.data.rect);let ce,pe;gt%180===0?(ce=100*Qt/Pt,pe=100*ee/Kt):(ce=100*ee/Pt,pe=100*Qt/Kt),ht.style.width=`${ce}%`,ht.style.height=`${pe}%`,ht.setAttribute("data-main-rotation",(360-gt)%360)}get _commonActions(){const gt=(ht,Pt,Kt)=>{const Qt=Kt.detail[ht],ee=Qt[0],ce=Qt.slice(1);Kt.target.style[Pt]=lt.ColorConverters[`${ee}_HTML`](ce),this.annotationStorage.setValue(this.data.id,{[Pt]:lt.ColorConverters[`${ee}_rgb`](ce)})};return(0,F.shadow)(this,"_commonActions",{display:ht=>{const{display:Pt}=ht.detail,Kt=Pt%2===1;this.container.style.visibility=Kt?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:Kt,noPrint:Pt===1||Pt===2})},print:ht=>{this.annotationStorage.setValue(this.data.id,{noPrint:!ht.detail.print})},hidden:ht=>{const{hidden:Pt}=ht.detail;this.container.style.visibility=Pt?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:Pt,noView:Pt})},focus:ht=>{setTimeout(()=>ht.target.focus({preventScroll:!1}),0)},userName:ht=>{ht.target.title=ht.detail.userName},readonly:ht=>{ht.target.disabled=ht.detail.readonly},required:ht=>{this._setRequired(ht.target,ht.detail.required)},bgColor:ht=>{gt("bgColor","backgroundColor",ht)},fillColor:ht=>{gt("fillColor","backgroundColor",ht)},fgColor:ht=>{gt("fgColor","color",ht)},textColor:ht=>{gt("textColor","color",ht)},borderColor:ht=>{gt("borderColor","borderColor",ht)},strokeColor:ht=>{gt("strokeColor","borderColor",ht)},rotation:ht=>{const Pt=ht.detail.rotation;this.setRotation(Pt),this.annotationStorage.setValue(this.data.id,{rotation:Pt})}})}_dispatchEventFromSandbox(gt,ht){const Pt=this._commonActions;for(const Kt of Object.keys(ht.detail))(gt[Kt]||Pt[Kt])?.(ht)}_setDefaultPropertiesFromJS(gt){if(!this.enableScripting)return;const ht=this.annotationStorage.getRawValue(this.data.id);if(!ht)return;const Pt=this._commonActions;for(const[Kt,Qt]of Object.entries(ht)){const ee=Pt[Kt];if(ee){const ce={detail:{[Kt]:Qt},target:gt};ee(ce),delete ht[Kt]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:gt}=this.data;if(!gt)return;const[ht,Pt,Kt,Qt]=this.data.rect;if(gt.length===1){const[,{x:Ie,y:De},{x:Oe,y:Ue}]=gt[0];if(Kt===Ie&&Qt===De&&ht===Oe&&Pt===Ue)return}const{style:ee}=this.container;let ce;if(D(this,et)){const{borderColor:Ie,borderWidth:De}=ee;ee.borderWidth=0,ce=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${Ie}" stroke-width="${De}">`],this.container.classList.add("hasBorder")}const pe=Kt-ht,Se=Qt-Pt,{svgFactory:ve}=this,fe=ve.createElement("svg");fe.classList.add("quadrilateralsContainer"),fe.setAttribute("width",0),fe.setAttribute("height",0);const _e=ve.createElement("defs");fe.append(_e);const xe=ve.createElement("clipPath"),Pe=`clippath_${this.data.id}`;xe.setAttribute("id",Pe),xe.setAttribute("clipPathUnits","objectBoundingBox"),_e.append(xe);for(const[,{x:Ie,y:De},{x:Oe,y:Ue}]of gt){const Ne=ve.createElement("rect"),Ve=(Oe-ht)/pe,Xe=(Qt-De)/Se,Js=(Ie-Oe)/pe,Zs=(De-Ue)/Se;Ne.setAttribute("x",Ve),Ne.setAttribute("y",Xe),Ne.setAttribute("width",Js),Ne.setAttribute("height",Zs),xe.append(Ne),ce?.push(`<rect vector-effect="non-scaling-stroke" x="${Ve}" y="${Xe}" width="${Js}" height="${Zs}"/>`)}D(this,et)&&(ce.push("</g></svg>')"),ee.backgroundImage=ce.join("")),this.container.append(fe),this.container.style.clipPath=`url(#${Pe})`}_createPopup(){const{container:gt,data:ht}=this;gt.setAttribute("aria-haspopup","dialog");const Pt=new rt({data:{color:ht.color,titleObj:ht.titleObj,modificationDate:ht.modificationDate,contentsObj:ht.contentsObj,richText:ht.richText,parentRect:ht.rect,borderStyle:0,id:`popup_${ht.id}`,rotation:ht.rotation},parent:this.parent,elements:[this]});this.parent.div.append(Pt.render())}render(){(0,F.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(gt,ht=null){const Pt=[];if(this._fieldObjects){const Kt=this._fieldObjects[gt];if(Kt)for(const{page:Qt,id:ee,exportValues:ce}of Kt){if(Qt===-1||ee===ht)continue;const pe=typeof ce=="string"?ce:null,Se=document.querySelector(`[data-element-id="${ee}"]`);if(Se&&!_t.has(Se)){(0,F.warn)(`_getElementsByName - element not allowed: ${ee}`);continue}Pt.push({id:ee,exportValue:pe,domElement:Se})}return Pt}for(const Kt of document.getElementsByName(gt)){const{exportValue:Qt}=Kt,ee=Kt.getAttribute("data-element-id");ee!==ht&&_t.has(Kt)&&Pt.push({id:ee,exportValue:Qt,domElement:Kt})}return Pt}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const gt=this.getElementsToTriggerPopup();if(Array.isArray(gt))for(const ht of gt)ht.classList.add("highlightArea");else gt.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:gt,data:{id:ht}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:gt,editId:ht})})}};et=new WeakMap;let ct=bt;class mt extends ct{constructor(ht,Pt=null){super(ht,{isRenderable:!0,ignoreBorder:!!Pt?.ignoreBorder,createQuadrilaterals:!0});Ht(this,yt);this.isTooltipOnly=ht.data.isTooltipOnly}render(){const{data:ht,linkService:Pt}=this,Kt=document.createElement("a");Kt.setAttribute("data-element-id",ht.id);let Qt=!1;return ht.url?(Pt.addLinkAttributes(Kt,ht.url,ht.newWindow),Qt=!0):ht.action?(this._bindNamedAction(Kt,ht.action),Qt=!0):ht.attachment?(this._bindAttachment(Kt,ht.attachment),Qt=!0):ht.setOCGState?(Ft(this,yt,mi).call(this,Kt,ht.setOCGState),Qt=!0):ht.dest?(this._bindLink(Kt,ht.dest),Qt=!0):(ht.actions&&(ht.actions.Action||ht.actions["Mouse Up"]||ht.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(Kt,ht),Qt=!0),ht.resetForm?(this._bindResetFormAction(Kt,ht.resetForm),Qt=!0):this.isTooltipOnly&&!Qt&&(this._bindLink(Kt,""),Qt=!0)),this.container.classList.add("linkAnnotation"),Qt&&this.container.append(Kt),this.container}_bindLink(ht,Pt){ht.href=this.linkService.getDestinationHash(Pt),ht.onclick=()=>(Pt&&this.linkService.goToDestination(Pt),!1),(Pt||Pt==="")&&Ft(this,yt,je).call(this)}_bindNamedAction(ht,Pt){ht.href=this.linkService.getAnchorUrl(""),ht.onclick=()=>(this.linkService.executeNamedAction(Pt),!1),Ft(this,yt,je).call(this)}_bindAttachment(ht,Pt){ht.href=this.linkService.getAnchorUrl(""),ht.onclick=()=>(this.downloadManager?.openOrDownloadData(this.container,Pt.content,Pt.filename),!1),Ft(this,yt,je).call(this)}_bindJSAction(ht,Pt){ht.href=this.linkService.getAnchorUrl("");const Kt=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const Qt of Object.keys(Pt.actions)){const ee=Kt.get(Qt);ee&&(ht[ee]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Pt.id,name:Qt}}),!1))}ht.onclick||(ht.onclick=()=>!1),Ft(this,yt,je).call(this)}_bindResetFormAction(ht,Pt){const Kt=ht.onclick;if(Kt||(ht.href=this.linkService.getAnchorUrl("")),Ft(this,yt,je).call(this),!this._fieldObjects){(0,F.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),Kt||(ht.onclick=()=>!1);return}ht.onclick=()=>{Kt?.();const{fields:Qt,refs:ee,include:ce}=Pt,pe=[];if(Qt.length!==0||ee.length!==0){const fe=new Set(ee);for(const _e of Qt){const xe=this._fieldObjects[_e]||[];for(const{id:Pe}of xe)fe.add(Pe)}for(const _e of Object.values(this._fieldObjects))for(const xe of _e)fe.has(xe.id)===ce&&pe.push(xe)}else for(const fe of Object.values(this._fieldObjects))pe.push(...fe);const Se=this.annotationStorage,ve=[];for(const fe of pe){const{id:_e}=fe;switch(ve.push(_e),fe.type){case"text":{const Pe=fe.defaultValue||"";Se.setValue(_e,{value:Pe});break}case"checkbox":case"radiobutton":{const Pe=fe.defaultValue===fe.exportValues;Se.setValue(_e,{value:Pe});break}case"combobox":case"listbox":{const Pe=fe.defaultValue||"";Se.setValue(_e,{value:Pe});break}default:continue}const xe=document.querySelector(`[data-element-id="${_e}"]`);if(xe){if(!_t.has(xe)){(0,F.warn)(`_bindResetFormAction - element not allowed: ${_e}`);continue}}else continue;xe.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:ve,name:"ResetForm"}}),!1}}}yt=new WeakSet,je=function(){this.container.setAttribute("data-internal-link","")},mi=function(ht,Pt){ht.href=this.linkService.getAnchorUrl(""),ht.onclick=()=>(this.linkService.executeSetOCGState(Pt),!1),Ft(this,yt,je).call(this)};class st extends ct{constructor(gt){super(gt,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const gt=document.createElement("img");return gt.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",gt.alt="[{{type}} Annotation]",gt.dataset.l10nId="text_annotation_type",gt.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(gt),this.container}}class Z extends ct{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(gt){this.data.hasOwnCanvas&&(gt.previousSibling?.nodeName==="CANVAS"&&(gt.previousSibling.hidden=!0),gt.hidden=!1)}_getKeyModifier(gt){const{isWin:ht,isMac:Pt}=F.FeatureTest.platform;return ht&&gt.ctrlKey||Pt&&gt.metaKey}_setEventListener(gt,ht,Pt,Kt,Qt){Pt.includes("mouse")?gt.addEventListener(Pt,ee=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:Kt,value:Qt(ee),shift:ee.shiftKey,modifier:this._getKeyModifier(ee)}})}):gt.addEventListener(Pt,ee=>{if(Pt==="blur"){if(!ht.focused||!ee.relatedTarget)return;ht.focused=!1}else if(Pt==="focus"){if(ht.focused)return;ht.focused=!0}Qt&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:Kt,value:Qt(ee)}})})}_setEventListeners(gt,ht,Pt,Kt){for(const[Qt,ee]of Pt)(ee==="Action"||this.data.actions?.[ee])&&((ee==="Focus"||ee==="Blur")&&(ht||(ht={focused:!1})),this._setEventListener(gt,ht,Qt,ee,Kt),ee==="Focus"&&!this.data.actions?.Blur?this._setEventListener(gt,ht,"blur","Blur",null):ee==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(gt,ht,"focus","Focus",null))}_setBackgroundColor(gt){const ht=this.data.backgroundColor||null;gt.style.backgroundColor=ht===null?"transparent":F.Util.makeHexColor(ht[0],ht[1],ht[2])}_setTextStyle(gt){const ht=["left","center","right"],{fontColor:Pt}=this.data.defaultAppearanceData,Kt=this.data.defaultAppearanceData.fontSize||tt,Qt=gt.style;let ee;const ce=2,pe=Se=>Math.round(10*Se)/10;if(this.data.multiLine){const Se=Math.abs(this.data.rect[3]-this.data.rect[1]-ce),ve=Math.round(Se/(F.LINE_FACTOR*Kt))||1,fe=Se/ve;ee=Math.min(Kt,pe(fe/F.LINE_FACTOR))}else{const Se=Math.abs(this.data.rect[3]-this.data.rect[1]-ce);ee=Math.min(Kt,pe(Se/F.LINE_FACTOR))}Qt.fontSize=`calc(${ee}px * var(--scale-factor))`,Qt.color=F.Util.makeHexColor(Pt[0],Pt[1],Pt[2]),this.data.textAlignment!==null&&(Qt.textAlign=ht[this.data.textAlignment])}_setRequired(gt,ht){ht?gt.setAttribute("required",!0):gt.removeAttribute("required"),gt.setAttribute("aria-required",ht)}}class nt extends Z{constructor(gt){const ht=gt.renderForms||!gt.data.hasAppearance&&!!gt.data.fieldValue;super(gt,{isRenderable:ht})}setPropertyOnSiblings(gt,ht,Pt,Kt){const Qt=this.annotationStorage;for(const ee of this._getElementsByName(gt.name,gt.id))ee.domElement&&(ee.domElement[ht]=Pt),Qt.setValue(ee.id,{[Kt]:Pt})}render(){const gt=this.annotationStorage,ht=this.data.id;this.container.classList.add("textWidgetAnnotation");let Pt=null;if(this.renderForms){const Kt=gt.getValue(ht,{value:this.data.fieldValue});let Qt=Kt.value||"";const ee=gt.getValue(ht,{charLimit:this.data.maxLen}).charLimit;ee&&Qt.length>ee&&(Qt=Qt.slice(0,ee));let ce=Kt.formattedValue||this.data.textContent?.join(`
`)||null;ce&&this.data.comb&&(ce=ce.replaceAll(/\s+/g,""));const pe={userValue:Qt,formattedValue:ce,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(Pt=document.createElement("textarea"),Pt.textContent=ce??Qt,this.data.doNotScroll&&(Pt.style.overflowY="hidden")):(Pt=document.createElement("input"),Pt.type="text",Pt.setAttribute("value",ce??Qt),this.data.doNotScroll&&(Pt.style.overflowX="hidden")),this.data.hasOwnCanvas&&(Pt.hidden=!0),_t.add(Pt),Pt.setAttribute("data-element-id",ht),Pt.disabled=this.data.readOnly,Pt.name=this.data.fieldName,Pt.tabIndex=pt,this._setRequired(Pt,this.data.required),ee&&(Pt.maxLength=ee),Pt.addEventListener("input",ve=>{gt.setValue(ht,{value:ve.target.value}),this.setPropertyOnSiblings(Pt,"value",ve.target.value,"value"),pe.formattedValue=null}),Pt.addEventListener("resetform",ve=>{const fe=this.data.defaultFieldValue??"";Pt.value=pe.userValue=fe,pe.formattedValue=null});let Se=ve=>{const{formattedValue:fe}=pe;fe!=null&&(ve.target.value=fe),ve.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){Pt.addEventListener("focus",fe=>{if(pe.focused)return;const{target:_e}=fe;pe.userValue&&(_e.value=pe.userValue),pe.lastCommittedValue=_e.value,pe.commitKey=1,pe.focused=!0}),Pt.addEventListener("updatefromsandbox",fe=>{this.showElementAndHideCanvas(fe.target);const _e={value(xe){pe.userValue=xe.detail.value??"",gt.setValue(ht,{value:pe.userValue.toString()}),xe.target.value=pe.userValue},formattedValue(xe){const{formattedValue:Pe}=xe.detail;pe.formattedValue=Pe,Pe!=null&&xe.target!==document.activeElement&&(xe.target.value=Pe),gt.setValue(ht,{formattedValue:Pe})},selRange(xe){xe.target.setSelectionRange(...xe.detail.selRange)},charLimit:xe=>{const{charLimit:Pe}=xe.detail,{target:Ie}=xe;if(Pe===0){Ie.removeAttribute("maxLength");return}Ie.setAttribute("maxLength",Pe);let De=pe.userValue;!De||De.length<=Pe||(De=De.slice(0,Pe),Ie.value=pe.userValue=De,gt.setValue(ht,{value:De}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ht,name:"Keystroke",value:De,willCommit:!0,commitKey:1,selStart:Ie.selectionStart,selEnd:Ie.selectionEnd}}))}};this._dispatchEventFromSandbox(_e,fe)}),Pt.addEventListener("keydown",fe=>{pe.commitKey=1;let _e=-1;if(fe.key==="Escape"?_e=0:fe.key==="Enter"&&!this.data.multiLine?_e=2:fe.key==="Tab"&&(pe.commitKey=3),_e===-1)return;const{value:xe}=fe.target;pe.lastCommittedValue!==xe&&(pe.lastCommittedValue=xe,pe.userValue=xe,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ht,name:"Keystroke",value:xe,willCommit:!0,commitKey:_e,selStart:fe.target.selectionStart,selEnd:fe.target.selectionEnd}}))});const ve=Se;Se=null,Pt.addEventListener("blur",fe=>{if(!pe.focused||!fe.relatedTarget)return;pe.focused=!1;const{value:_e}=fe.target;pe.userValue=_e,pe.lastCommittedValue!==_e&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ht,name:"Keystroke",value:_e,willCommit:!0,commitKey:pe.commitKey,selStart:fe.target.selectionStart,selEnd:fe.target.selectionEnd}}),ve(fe)}),this.data.actions?.Keystroke&&Pt.addEventListener("beforeinput",fe=>{pe.lastCommittedValue=null;const{data:_e,target:xe}=fe,{value:Pe,selectionStart:Ie,selectionEnd:De}=xe;let Oe=Ie,Ue=De;switch(fe.inputType){case"deleteWordBackward":{const Ne=Pe.substring(0,Ie).match(/\w*[^\w]*$/);Ne&&(Oe-=Ne[0].length);break}case"deleteWordForward":{const Ne=Pe.substring(Ie).match(/^[^\w]*\w*/);Ne&&(Ue+=Ne[0].length);break}case"deleteContentBackward":Ie===De&&(Oe-=1);break;case"deleteContentForward":Ie===De&&(Ue+=1);break}fe.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ht,name:"Keystroke",value:Pe,change:_e||"",willCommit:!1,selStart:Oe,selEnd:Ue}})}),this._setEventListeners(Pt,pe,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],fe=>fe.target.value)}if(Se&&Pt.addEventListener("blur",Se),this.data.comb){const fe=(this.data.rect[2]-this.data.rect[0])/ee;Pt.classList.add("comb"),Pt.style.letterSpacing=`calc(${fe}px * var(--scale-factor) - 1ch)`}}else Pt=document.createElement("div"),Pt.textContent=this.data.fieldValue,Pt.style.verticalAlign="middle",Pt.style.display="table-cell";return this._setTextStyle(Pt),this._setBackgroundColor(Pt),this._setDefaultPropertiesFromJS(Pt),this.container.append(Pt),this.container}}class Et extends Z{constructor(gt){super(gt,{isRenderable:!!gt.data.hasOwnCanvas})}}class ot extends Z{constructor(gt){super(gt,{isRenderable:gt.renderForms})}render(){const gt=this.annotationStorage,ht=this.data,Pt=ht.id;let Kt=gt.getValue(Pt,{value:ht.exportValue===ht.fieldValue}).value;typeof Kt=="string"&&(Kt=Kt!=="Off",gt.setValue(Pt,{value:Kt})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const Qt=document.createElement("input");return _t.add(Qt),Qt.setAttribute("data-element-id",Pt),Qt.disabled=ht.readOnly,this._setRequired(Qt,this.data.required),Qt.type="checkbox",Qt.name=ht.fieldName,Kt&&Qt.setAttribute("checked",!0),Qt.setAttribute("exportValue",ht.exportValue),Qt.tabIndex=pt,Qt.addEventListener("change",ee=>{const{name:ce,checked:pe}=ee.target;for(const Se of this._getElementsByName(ce,Pt)){const ve=pe&&Se.exportValue===ht.exportValue;Se.domElement&&(Se.domElement.checked=ve),gt.setValue(Se.id,{value:ve})}gt.setValue(Pt,{value:pe})}),Qt.addEventListener("resetform",ee=>{const ce=ht.defaultFieldValue||"Off";ee.target.checked=ce===ht.exportValue}),this.enableScripting&&this.hasJSActions&&(Qt.addEventListener("updatefromsandbox",ee=>{const ce={value(pe){pe.target.checked=pe.detail.value!=="Off",gt.setValue(Pt,{value:pe.target.checked})}};this._dispatchEventFromSandbox(ce,ee)}),this._setEventListeners(Qt,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ee=>ee.target.checked)),this._setBackgroundColor(Qt),this._setDefaultPropertiesFromJS(Qt),this.container.append(Qt),this.container}}class K extends Z{constructor(gt){super(gt,{isRenderable:gt.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const gt=this.annotationStorage,ht=this.data,Pt=ht.id;let Kt=gt.getValue(Pt,{value:ht.fieldValue===ht.buttonValue}).value;typeof Kt=="string"&&(Kt=Kt!==ht.buttonValue,gt.setValue(Pt,{value:Kt}));const Qt=document.createElement("input");if(_t.add(Qt),Qt.setAttribute("data-element-id",Pt),Qt.disabled=ht.readOnly,this._setRequired(Qt,this.data.required),Qt.type="radio",Qt.name=ht.fieldName,Kt&&Qt.setAttribute("checked",!0),Qt.tabIndex=pt,Qt.addEventListener("change",ee=>{const{name:ce,checked:pe}=ee.target;for(const Se of this._getElementsByName(ce,Pt))gt.setValue(Se.id,{value:!1});gt.setValue(Pt,{value:pe})}),Qt.addEventListener("resetform",ee=>{const ce=ht.defaultFieldValue;ee.target.checked=ce!=null&&ce===ht.buttonValue}),this.enableScripting&&this.hasJSActions){const ee=ht.buttonValue;Qt.addEventListener("updatefromsandbox",ce=>{const pe={value:Se=>{const ve=ee===Se.detail.value;for(const fe of this._getElementsByName(Se.target.name)){const _e=ve&&fe.id===Pt;fe.domElement&&(fe.domElement.checked=_e),gt.setValue(fe.id,{value:_e})}}};this._dispatchEventFromSandbox(pe,ce)}),this._setEventListeners(Qt,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ce=>ce.target.checked)}return this._setBackgroundColor(Qt),this._setDefaultPropertiesFromJS(Qt),this.container.append(Qt),this.container}}class q extends mt{constructor(gt){super(gt,{ignoreBorder:gt.data.hasAppearance})}render(){const gt=super.render();gt.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(gt.title=this.data.alternativeText);const ht=gt.lastChild;return this.enableScripting&&this.hasJSActions&&ht&&(this._setDefaultPropertiesFromJS(ht),ht.addEventListener("updatefromsandbox",Pt=>{this._dispatchEventFromSandbox({},Pt)})),gt}}class U extends Z{constructor(gt){super(gt,{isRenderable:gt.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const gt=this.annotationStorage,ht=this.data.id,Pt=gt.getValue(ht,{value:this.data.fieldValue}),Kt=document.createElement("select");_t.add(Kt),Kt.setAttribute("data-element-id",ht),Kt.disabled=this.data.readOnly,this._setRequired(Kt,this.data.required),Kt.name=this.data.fieldName,Kt.tabIndex=pt;let Qt=this.data.combo&&this.data.options.length>0;this.data.combo||(Kt.size=this.data.options.length,this.data.multiSelect&&(Kt.multiple=!0)),Kt.addEventListener("resetform",ve=>{const fe=this.data.defaultFieldValue;for(const _e of Kt.options)_e.selected=_e.value===fe});for(const ve of this.data.options){const fe=document.createElement("option");fe.textContent=ve.displayValue,fe.value=ve.exportValue,Pt.value.includes(ve.exportValue)&&(fe.setAttribute("selected",!0),Qt=!1),Kt.append(fe)}let ee=null;if(Qt){const ve=document.createElement("option");ve.value=" ",ve.setAttribute("hidden",!0),ve.setAttribute("selected",!0),Kt.prepend(ve),ee=()=>{ve.remove(),Kt.removeEventListener("input",ee),ee=null},Kt.addEventListener("input",ee)}const ce=ve=>{const fe=ve?"value":"textContent",{options:_e,multiple:xe}=Kt;return xe?Array.prototype.filter.call(_e,Pe=>Pe.selected).map(Pe=>Pe[fe]):_e.selectedIndex===-1?null:_e[_e.selectedIndex][fe]};let pe=ce(!1);const Se=ve=>{const fe=ve.target.options;return Array.prototype.map.call(fe,_e=>({displayValue:_e.textContent,exportValue:_e.value}))};return this.enableScripting&&this.hasJSActions?(Kt.addEventListener("updatefromsandbox",ve=>{const fe={value(_e){ee?.();const xe=_e.detail.value,Pe=new Set(Array.isArray(xe)?xe:[xe]);for(const Ie of Kt.options)Ie.selected=Pe.has(Ie.value);gt.setValue(ht,{value:ce(!0)}),pe=ce(!1)},multipleSelection(_e){Kt.multiple=!0},remove(_e){const xe=Kt.options,Pe=_e.detail.remove;xe[Pe].selected=!1,Kt.remove(Pe),xe.length>0&&Array.prototype.findIndex.call(xe,De=>De.selected)===-1&&(xe[0].selected=!0),gt.setValue(ht,{value:ce(!0),items:Se(_e)}),pe=ce(!1)},clear(_e){for(;Kt.length!==0;)Kt.remove(0);gt.setValue(ht,{value:null,items:[]}),pe=ce(!1)},insert(_e){const{index:xe,displayValue:Pe,exportValue:Ie}=_e.detail.insert,De=Kt.children[xe],Oe=document.createElement("option");Oe.textContent=Pe,Oe.value=Ie,De?De.before(Oe):Kt.append(Oe),gt.setValue(ht,{value:ce(!0),items:Se(_e)}),pe=ce(!1)},items(_e){const{items:xe}=_e.detail;for(;Kt.length!==0;)Kt.remove(0);for(const Pe of xe){const{displayValue:Ie,exportValue:De}=Pe,Oe=document.createElement("option");Oe.textContent=Ie,Oe.value=De,Kt.append(Oe)}Kt.options.length>0&&(Kt.options[0].selected=!0),gt.setValue(ht,{value:ce(!0),items:Se(_e)}),pe=ce(!1)},indices(_e){const xe=new Set(_e.detail.indices);for(const Pe of _e.target.options)Pe.selected=xe.has(Pe.index);gt.setValue(ht,{value:ce(!0)}),pe=ce(!1)},editable(_e){_e.target.disabled=!_e.detail.editable}};this._dispatchEventFromSandbox(fe,ve)}),Kt.addEventListener("input",ve=>{const fe=ce(!0);gt.setValue(ht,{value:fe}),ve.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ht,name:"Keystroke",value:pe,changeEx:fe,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(Kt,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],ve=>ve.target.value)):Kt.addEventListener("input",function(ve){gt.setValue(ht,{value:ce(!0)})}),this.data.combo&&this._setTextStyle(Kt),this._setBackgroundColor(Kt),this._setDefaultPropertiesFromJS(Kt),this.container.append(Kt),this.container}}class rt extends ct{constructor(gt){const{data:ht,elements:Pt}=gt;super(gt,{isRenderable:ct._hasPopupData(ht)}),this.elements=Pt}render(){this.container.classList.add("popupAnnotation");const gt=new J({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),ht=[];for(const Pt of this.elements)Pt.popup=gt,ht.push(Pt.data.id),Pt.addHighlightArea();return this.container.setAttribute("aria-controls",ht.map(Pt=>`${F.AnnotationPrefix}${Pt}`).join(",")),this.container}}class J{constructor({container:gt,color:ht,elements:Pt,titleObj:Kt,modificationDate:Qt,contentsObj:ee,richText:ce,parent:pe,rect:Se,parentRect:ve,open:fe}){Ht(this,de);Ht(this,Wt,null);Ht(this,Jt,Ft(this,de,bi).bind(this));Ht(this,te,Ft(this,de,js).bind(this));Ht(this,se,Ft(this,de,Bs).bind(this));Ht(this,ne,Ft(this,de,hs).bind(this));Ht(this,ae,null);Ht(this,$t,null);Ht(this,Ut,null);Ht(this,it,null);Ht(this,St,null);Ht(this,It,null);Ht(this,jt,!1);Ht(this,Zt,null);Ht(this,re,null);Ht(this,oe,null);Ht(this,Lt,null);Ht(this,he,!1);zt(this,$t,gt),zt(this,Lt,Kt),zt(this,Ut,ee),zt(this,oe,ce),zt(this,St,pe),zt(this,ae,ht),zt(this,re,Se),zt(this,It,ve),zt(this,it,Pt);const _e=O.PDFDateString.toDateObject(Qt);_e&&zt(this,Wt,pe.l10n.get("annotation_date_string",{date:_e.toLocaleDateString(),time:_e.toLocaleTimeString()})),this.trigger=Pt.flatMap(xe=>xe.getElementsToTriggerPopup());for(const xe of this.trigger)xe.addEventListener("click",D(this,ne)),xe.addEventListener("mouseenter",D(this,se)),xe.addEventListener("mouseleave",D(this,te)),xe.classList.add("popupTriggerArea");for(const xe of Pt)xe.container?.addEventListener("keydown",D(this,Jt));D(this,$t).hidden=!0,fe&&Ft(this,de,hs).call(this)}render(){if(D(this,Zt))return;const{page:{view:gt},viewport:{rawDims:{pageWidth:ht,pageHeight:Pt,pageX:Kt,pageY:Qt}}}=D(this,St),ee=zt(this,Zt,document.createElement("div"));if(ee.className="popup",D(this,ae)){const Ne=ee.style.outlineColor=F.Util.makeHexColor(...D(this,ae));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?ee.style.backgroundColor=`color-mix(in srgb, ${Ne} 30%, white)`:ee.style.backgroundColor=F.Util.makeHexColor(...D(this,ae).map(Xe=>Math.floor(.7*(255-Xe)+Xe)))}const ce=document.createElement("span");ce.className="header";const pe=document.createElement("h1");if(ce.append(pe),{dir:pe.dir,str:pe.textContent}=D(this,Lt),ee.append(ce),D(this,Wt)){const Ne=document.createElement("span");Ne.classList.add("popupDate"),D(this,Wt).then(Ve=>{Ne.textContent=Ve}),ce.append(Ne)}const Se=D(this,Ut),ve=D(this,oe);if(ve?.str&&(!Se?.str||Se.str===ve.str))vt.XfaLayer.render({xfaHtml:ve.html,intent:"richText",div:ee}),ee.lastChild.classList.add("richText","popupContent");else{const Ne=this._formatContents(Se);ee.append(Ne)}let fe=!!D(this,It),_e=fe?D(this,It):D(this,re);for(const Ne of D(this,it))if(!_e||F.Util.intersect(Ne.data.rect,_e)!==null){_e=Ne.data.rect,fe=!0;break}const xe=F.Util.normalizeRect([_e[0],gt[3]-_e[1]+gt[1],_e[2],gt[3]-_e[3]+gt[1]]),Ie=fe?_e[2]-_e[0]+5:0,De=xe[0]+Ie,Oe=xe[1],{style:Ue}=D(this,$t);Ue.left=`${100*(De-Kt)/ht}%`,Ue.top=`${100*(Oe-Qt)/Pt}%`,D(this,$t).append(ee)}_formatContents({str:gt,dir:ht}){const Pt=document.createElement("p");Pt.classList.add("popupContent"),Pt.dir=ht;const Kt=gt.split(/(?:\r\n?|\n)/);for(let Qt=0,ee=Kt.length;Qt<ee;++Qt){const ce=Kt[Qt];Pt.append(document.createTextNode(ce)),Qt<ee-1&&Pt.append(document.createElement("br"))}return Pt}forceHide(){zt(this,he,this.isVisible),D(this,he)&&(D(this,$t).hidden=!0)}maybeShow(){D(this,he)&&(zt(this,he,!1),D(this,$t).hidden=!1)}get isVisible(){return D(this,$t).hidden===!1}}Wt=new WeakMap,Jt=new WeakMap,te=new WeakMap,se=new WeakMap,ne=new WeakMap,ae=new WeakMap,$t=new WeakMap,Ut=new WeakMap,it=new WeakMap,St=new WeakMap,It=new WeakMap,jt=new WeakMap,Zt=new WeakMap,re=new WeakMap,oe=new WeakMap,Lt=new WeakMap,he=new WeakMap,de=new WeakSet,bi=function(gt){gt.altKey||gt.shiftKey||gt.ctrlKey||gt.metaKey||(gt.key==="Enter"||gt.key==="Escape"&&D(this,jt))&&Ft(this,de,hs).call(this)},hs=function(){zt(this,jt,!D(this,jt)),D(this,jt)?(Ft(this,de,Bs).call(this),D(this,$t).addEventListener("click",D(this,ne)),D(this,$t).addEventListener("keydown",D(this,Jt))):(Ft(this,de,js).call(this),D(this,$t).removeEventListener("click",D(this,ne)),D(this,$t).removeEventListener("keydown",D(this,Jt)))},Bs=function(){D(this,Zt)||this.render(),this.isVisible?D(this,jt)&&D(this,$t).classList.add("focused"):(D(this,$t).hidden=!1,D(this,$t).style.zIndex=parseInt(D(this,$t).style.zIndex)+1e3)},js=function(){D(this,$t).classList.remove("focused"),!(D(this,jt)||!this.isVisible)&&(D(this,$t).hidden=!0,D(this,$t).style.zIndex=parseInt(D(this,$t).style.zIndex)-1e3)};class Rt extends ct{constructor(gt){super(gt,{isRenderable:!0,ignoreBorder:!0}),this.textContent=gt.data.textContent,this.textPosition=gt.data.textPosition,this.annotationEditorType=F.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const gt=document.createElement("div");gt.classList.add("annotationTextContent"),gt.setAttribute("role","comment");for(const ht of this.textContent){const Pt=document.createElement("span");Pt.textContent=ht,gt.append(Pt)}this.container.append(gt)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}w.FreeTextAnnotationElement=Rt;class Q extends ct{constructor(ht){super(ht,{isRenderable:!0,ignoreBorder:!0});Ht(this,we,null)}render(){this.container.classList.add("lineAnnotation");const ht=this.data,{width:Pt,height:Kt}=Ct(ht.rect),Qt=this.svgFactory.create(Pt,Kt,!0),ee=zt(this,we,this.svgFactory.createElement("svg:line"));return ee.setAttribute("x1",ht.rect[2]-ht.lineCoordinates[0]),ee.setAttribute("y1",ht.rect[3]-ht.lineCoordinates[1]),ee.setAttribute("x2",ht.rect[2]-ht.lineCoordinates[2]),ee.setAttribute("y2",ht.rect[3]-ht.lineCoordinates[3]),ee.setAttribute("stroke-width",ht.borderStyle.width||1),ee.setAttribute("stroke","transparent"),ee.setAttribute("fill","transparent"),Qt.append(ee),this.container.append(Qt),!ht.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return D(this,we)}addHighlightArea(){this.container.classList.add("highlightArea")}}we=new WeakMap;class ft extends ct{constructor(ht){super(ht,{isRenderable:!0,ignoreBorder:!0});Ht(this,ke,null)}render(){this.container.classList.add("squareAnnotation");const ht=this.data,{width:Pt,height:Kt}=Ct(ht.rect),Qt=this.svgFactory.create(Pt,Kt,!0),ee=ht.borderStyle.width,ce=zt(this,ke,this.svgFactory.createElement("svg:rect"));return ce.setAttribute("x",ee/2),ce.setAttribute("y",ee/2),ce.setAttribute("width",Pt-ee),ce.setAttribute("height",Kt-ee),ce.setAttribute("stroke-width",ee||1),ce.setAttribute("stroke","transparent"),ce.setAttribute("fill","transparent"),Qt.append(ce),this.container.append(Qt),!ht.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return D(this,ke)}addHighlightArea(){this.container.classList.add("highlightArea")}}ke=new WeakMap;class Tt extends ct{constructor(ht){super(ht,{isRenderable:!0,ignoreBorder:!0});Ht(this,Re,null)}render(){this.container.classList.add("circleAnnotation");const ht=this.data,{width:Pt,height:Kt}=Ct(ht.rect),Qt=this.svgFactory.create(Pt,Kt,!0),ee=ht.borderStyle.width,ce=zt(this,Re,this.svgFactory.createElement("svg:ellipse"));return ce.setAttribute("cx",Pt/2),ce.setAttribute("cy",Kt/2),ce.setAttribute("rx",Pt/2-ee/2),ce.setAttribute("ry",Kt/2-ee/2),ce.setAttribute("stroke-width",ee||1),ce.setAttribute("stroke","transparent"),ce.setAttribute("fill","transparent"),Qt.append(ce),this.container.append(Qt),!ht.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return D(this,Re)}addHighlightArea(){this.container.classList.add("highlightArea")}}Re=new WeakMap;class Xt extends ct{constructor(ht){super(ht,{isRenderable:!0,ignoreBorder:!0});Ht(this,le,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const ht=this.data,{width:Pt,height:Kt}=Ct(ht.rect),Qt=this.svgFactory.create(Pt,Kt,!0);let ee=[];for(const pe of ht.vertices){const Se=pe.x-ht.rect[0],ve=ht.rect[3]-pe.y;ee.push(Se+","+ve)}ee=ee.join(" ");const ce=zt(this,le,this.svgFactory.createElement(this.svgElementName));return ce.setAttribute("points",ee),ce.setAttribute("stroke-width",ht.borderStyle.width||1),ce.setAttribute("stroke","transparent"),ce.setAttribute("fill","transparent"),Qt.append(ce),this.container.append(Qt),!ht.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return D(this,le)}addHighlightArea(){this.container.classList.add("highlightArea")}}le=new WeakMap;class Ot extends Xt{constructor(gt){super(gt),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Bt extends ct{constructor(gt){super(gt,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Mt extends ct{constructor(ht){super(ht,{isRenderable:!0,ignoreBorder:!0});Ht(this,Gt,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=F.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const ht=this.data,{width:Pt,height:Kt}=Ct(ht.rect),Qt=this.svgFactory.create(Pt,Kt,!0);for(const ee of ht.inkLists){let ce=[];for(const Se of ee){const ve=Se.x-ht.rect[0],fe=ht.rect[3]-Se.y;ce.push(`${ve},${fe}`)}ce=ce.join(" ");const pe=this.svgFactory.createElement(this.svgElementName);D(this,Gt).push(pe),pe.setAttribute("points",ce),pe.setAttribute("stroke-width",ht.borderStyle.width||1),pe.setAttribute("stroke","transparent"),pe.setAttribute("fill","transparent"),!ht.popupRef&&this.hasPopupData&&this._createPopup(),Qt.append(pe)}return this.container.append(Qt),this.container}getElementsToTriggerPopup(){return D(this,Gt)}addHighlightArea(){this.container.classList.add("highlightArea")}}Gt=new WeakMap,w.InkAnnotationElement=Mt;class Vt extends ct{constructor(gt){super(gt,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class xt extends ct{constructor(gt){super(gt,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Dt extends ct{constructor(gt){super(gt,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Nt extends ct{constructor(gt){super(gt,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class dt extends ct{constructor(gt){super(gt,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}w.StampAnnotationElement=dt;class G extends ct{constructor(ht){super(ht,{isRenderable:!0});Ht(this,me);Ht(this,qt,null);const{filename:Pt,content:Kt}=this.data.file;this.filename=(0,O.getFilenameFromUrl)(Pt,!0),this.content=Kt,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:Pt,content:Kt})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:ht,data:Pt}=this;let Kt;Pt.hasAppearance||Pt.fillAlpha===0?Kt=document.createElement("div"):(Kt=document.createElement("img"),Kt.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(Pt.name)?"paperclip":"pushpin"}.svg`,Pt.fillAlpha&&Pt.fillAlpha<1&&(Kt.style=`filter: opacity(${Math.round(Pt.fillAlpha*100)}%);`)),Kt.addEventListener("dblclick",Ft(this,me,Hs).bind(this)),zt(this,qt,Kt);const{isMac:Qt}=F.FeatureTest.platform;return ht.addEventListener("keydown",ee=>{ee.key==="Enter"&&(Qt?ee.metaKey:ee.ctrlKey)&&Ft(this,me,Hs).call(this)}),!Pt.popupRef&&this.hasPopupData?this._createPopup():Kt.classList.add("popupTriggerArea"),ht.append(Kt),ht}getElementsToTriggerPopup(){return D(this,qt)}addHighlightArea(){this.container.classList.add("highlightArea")}}qt=new WeakMap,me=new WeakSet,Hs=function(){this.downloadManager?.openOrDownloadData(this.container,this.content,this.filename)};class X{constructor({div:gt,accessibilityManager:ht,annotationCanvasMap:Pt,l10n:Kt,page:Qt,viewport:ee}){Ht(this,ue);Ht(this,Te,null);Ht(this,wt,null);Ht(this,ie,new Map);this.div=gt,zt(this,Te,ht),zt(this,wt,Pt),this.l10n=Kt,this.page=Qt,this.viewport=ee,this.zIndex=0,this.l10n||(this.l10n=Yt.NullL10n)}async render(gt){const{annotations:ht}=gt,Pt=this.div;(0,O.setLayerDimensions)(Pt,this.viewport);const Kt=new Map,Qt={data:null,layer:Pt,linkService:gt.linkService,downloadManager:gt.downloadManager,imageResourcesPath:gt.imageResourcesPath||"",renderForms:gt.renderForms!==!1,svgFactory:new O.DOMSVGFactory,annotationStorage:gt.annotationStorage||new ut.AnnotationStorage,enableScripting:gt.enableScripting===!0,hasJSActions:gt.hasJSActions,fieldObjects:gt.fieldObjects,parent:this,elements:null};for(const ee of ht){if(ee.noHTML)continue;const ce=ee.annotationType===F.AnnotationType.POPUP;if(ce){const ve=Kt.get(ee.id);if(!ve)continue;Qt.elements=ve}else{const{width:ve,height:fe}=Ct(ee.rect);if(ve<=0||fe<=0)continue}Qt.data=ee;const pe=at.create(Qt);if(!pe.isRenderable)continue;if(!ce&&ee.popupRef){const ve=Kt.get(ee.popupRef);ve?ve.push(pe):Kt.set(ee.popupRef,[pe])}pe.annotationEditorType>0&&D(this,ie).set(pe.data.id,pe);const Se=pe.render();ee.hidden&&(Se.style.visibility="hidden"),Ft(this,ue,_i).call(this,Se,ee.id)}Ft(this,ue,zs).call(this),await this.l10n.translate(Pt)}update({viewport:gt}){const ht=this.div;this.viewport=gt,(0,O.setLayerDimensions)(ht,{rotation:gt.rotation}),Ft(this,ue,zs).call(this),ht.hidden=!1}getEditableAnnotations(){return Array.from(D(this,ie).values())}getEditableAnnotation(gt){return D(this,ie).get(gt)}}Te=new WeakMap,wt=new WeakMap,ie=new WeakMap,ue=new WeakSet,_i=function(gt,ht){const Pt=gt.firstChild||gt;Pt.id=`${F.AnnotationPrefix}${ht}`,this.div.append(gt),D(this,Te)?.moveElementInDOM(this.div,gt,Pt,!1)},zs=function(){if(!D(this,wt))return;const gt=this.div;for(const[ht,Pt]of D(this,wt)){const Kt=gt.querySelector(`[data-annotation-id="${ht}"]`);if(!Kt)continue;const{firstChild:Qt}=Kt;Qt?Qt.nodeName==="CANVAS"?Qt.replaceWith(Pt):Qt.before(Pt):Kt.append(Pt)}D(this,wt).clear()},w.AnnotationLayer=X},(Y,w)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.ColorConverters=void 0;function W(ut){return Math.floor(Math.max(0,Math.min(1,ut))*255).toString(16).padStart(2,"0")}function F(ut){return Math.max(0,Math.min(255,255*ut))}class O{static CMYK_G([lt,Yt,vt,pt]){return["G",1-Math.min(1,.3*lt+.59*vt+.11*Yt+pt)]}static G_CMYK([lt]){return["CMYK",0,0,0,1-lt]}static G_RGB([lt]){return["RGB",lt,lt,lt]}static G_rgb([lt]){return lt=F(lt),[lt,lt,lt]}static G_HTML([lt]){const Yt=W(lt);return`#${Yt}${Yt}${Yt}`}static RGB_G([lt,Yt,vt]){return["G",.3*lt+.59*Yt+.11*vt]}static RGB_rgb(lt){return lt.map(F)}static RGB_HTML(lt){return`#${lt.map(W).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([lt,Yt,vt,pt]){return["RGB",1-Math.min(1,lt+pt),1-Math.min(1,vt+pt),1-Math.min(1,Yt+pt)]}static CMYK_rgb([lt,Yt,vt,pt]){return[F(1-Math.min(1,lt+pt)),F(1-Math.min(1,vt+pt)),F(1-Math.min(1,Yt+pt))]}static CMYK_HTML(lt){const Yt=this.CMYK_RGB(lt).slice(1);return this.RGB_HTML(Yt)}static RGB_CMYK([lt,Yt,vt]){const pt=1-lt,tt=1-Yt,_t=1-vt,Ct=Math.min(pt,tt,_t);return["CMYK",pt,tt,_t,Ct]}}w.ColorConverters=O},(Y,w)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.NullL10n=void 0,w.getL10nFallback=F;const W={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};W.print_progress_percent="{{progress}}%";function F(lt,Yt){switch(lt){case"find_match_count":lt=`find_match_count[${Yt.total===1?"one":"other"}]`;break;case"find_match_count_limit":lt=`find_match_count_limit[${Yt.limit===1?"one":"other"}]`;break}return W[lt]||""}function O(lt,Yt){return Yt?lt.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(vt,pt)=>pt in Yt?Yt[pt]:"{{"+pt+"}}"):lt}const ut={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(lt,Yt=null,vt=F(lt,Yt)){return O(vt,Yt)},async translate(lt){}};w.NullL10n=ut},(Y,w,W)=>{Object.defineProperty(w,"__esModule",{value:!0}),w.XfaLayer=void 0;var F=W(25);class O{static setupStorage(lt,Yt,vt,pt,tt){const _t=pt.getValue(Yt,{value:null});switch(vt.name){case"textarea":if(_t.value!==null&&(lt.textContent=_t.value),tt==="print")break;lt.addEventListener("input",Ct=>{pt.setValue(Yt,{value:Ct.target.value})});break;case"input":if(vt.attributes.type==="radio"||vt.attributes.type==="checkbox"){if(_t.value===vt.attributes.xfaOn?lt.setAttribute("checked",!0):_t.value===vt.attributes.xfaOff&&lt.removeAttribute("checked"),tt==="print")break;lt.addEventListener("change",Ct=>{pt.setValue(Yt,{value:Ct.target.checked?Ct.target.getAttribute("xfaOn"):Ct.target.getAttribute("xfaOff")})})}else{if(_t.value!==null&&lt.setAttribute("value",_t.value),tt==="print")break;lt.addEventListener("input",Ct=>{pt.setValue(Yt,{value:Ct.target.value})})}break;case"select":if(_t.value!==null){lt.setAttribute("value",_t.value);for(const Ct of vt.children)Ct.attributes.value===_t.value?Ct.attributes.selected=!0:Ct.attributes.hasOwnProperty("selected")&&delete Ct.attributes.selected}lt.addEventListener("input",Ct=>{const at=Ct.target.options,ct=at.selectedIndex===-1?"":at[at.selectedIndex].value;pt.setValue(Yt,{value:ct})});break}}static setAttributes({html:lt,element:Yt,storage:vt=null,intent:pt,linkService:tt}){const{attributes:_t}=Yt,Ct=lt instanceof HTMLAnchorElement;_t.type==="radio"&&(_t.name=`${_t.name}-${pt}`);for(const[at,ct]of Object.entries(_t))if(ct!=null)switch(at){case"class":ct.length&&lt.setAttribute(at,ct.join(" "));break;case"dataId":break;case"id":lt.setAttribute("data-element-id",ct);break;case"style":Object.assign(lt.style,ct);break;case"textContent":lt.textContent=ct;break;default:(!Ct||at!=="href"&&at!=="newWindow")&&lt.setAttribute(at,ct)}Ct&&tt.addLinkAttributes(lt,_t.href,_t.newWindow),vt&&_t.dataId&&this.setupStorage(lt,_t.dataId,Yt,vt)}static render(lt){const Yt=lt.annotationStorage,vt=lt.linkService,pt=lt.xfaHtml,tt=lt.intent||"display",_t=document.createElement(pt.name);pt.attributes&&this.setAttributes({html:_t,element:pt,intent:tt,linkService:vt});const Ct=[[pt,-1,_t]],at=lt.div;if(at.append(_t),lt.viewport){const mt=`matrix(${lt.viewport.transform.join(",")})`;at.style.transform=mt}tt!=="richText"&&at.setAttribute("class","xfaLayer xfaFont");const ct=[];for(;Ct.length>0;){const[mt,st,Z]=Ct.at(-1);if(st+1===mt.children.length){Ct.pop();continue}const nt=mt.children[++Ct.at(-1)[1]];if(nt===null)continue;const{name:Et}=nt;if(Et==="#text"){const K=document.createTextNode(nt.value);ct.push(K),Z.append(K);continue}const ot=nt?.attributes?.xmlns?document.createElementNS(nt.attributes.xmlns,Et):document.createElement(Et);if(Z.append(ot),nt.attributes&&this.setAttributes({html:ot,element:nt,storage:Yt,intent:tt,linkService:vt}),nt.children&&nt.children.length>0)Ct.push([nt,-1,ot]);else if(nt.value){const K=document.createTextNode(nt.value);F.XfaText.shouldBuildText(Et)&&ct.push(K),ot.append(K)}}for(const mt of at.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))mt.setAttribute("readOnly",!0);return{textDivs:ct}}static update(lt){const Yt=`matrix(${lt.viewport.transform.join(",")})`;lt.div.style.transform=Yt,lt.div.hidden=!1}}w.XfaLayer=O},(Y,w,W)=>{var pt,tt,_t,Ct,at,ct,mt,st,Z,nt,Et,ot,K,q,U,yi,vi,Ai,Si,Ws,xi,qs,Ei,wi,Ci,Ti,Pi,Be,Gs,ds,us,qe,Vs,ps,yt,ki,Xs,Mi,Fi,Ys,fs,Ge;Object.defineProperty(w,"__esModule",{value:!0}),w.InkEditor=void 0;var F=W(1),O=W(4),ut=W(29),lt=W(6),Yt=W(5);const ae=class ae extends O.AnnotationEditor{constructor(it){super({...it,name:"inkEditor"});Ht(this,U);Ht(this,pt,0);Ht(this,tt,0);Ht(this,_t,this.canvasPointermove.bind(this));Ht(this,Ct,this.canvasPointerleave.bind(this));Ht(this,at,this.canvasPointerup.bind(this));Ht(this,ct,this.canvasPointerdown.bind(this));Ht(this,mt,new Path2D);Ht(this,st,!1);Ht(this,Z,!1);Ht(this,nt,!1);Ht(this,Et,null);Ht(this,ot,0);Ht(this,K,0);Ht(this,q,null);this.color=it.color||null,this.thickness=it.thickness||null,this.opacity=it.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(it){O.AnnotationEditor.initialize(it,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(it,St){switch(it){case F.AnnotationEditorParamsType.INK_THICKNESS:ae._defaultThickness=St;break;case F.AnnotationEditorParamsType.INK_COLOR:ae._defaultColor=St;break;case F.AnnotationEditorParamsType.INK_OPACITY:ae._defaultOpacity=St/100;break}}updateParams(it,St){switch(it){case F.AnnotationEditorParamsType.INK_THICKNESS:Ft(this,U,yi).call(this,St);break;case F.AnnotationEditorParamsType.INK_COLOR:Ft(this,U,vi).call(this,St);break;case F.AnnotationEditorParamsType.INK_OPACITY:Ft(this,U,Ai).call(this,St);break}}static get defaultPropertiesToUpdate(){return[[F.AnnotationEditorParamsType.INK_THICKNESS,ae._defaultThickness],[F.AnnotationEditorParamsType.INK_COLOR,ae._defaultColor||O.AnnotationEditor._defaultLineColor],[F.AnnotationEditorParamsType.INK_OPACITY,Math.round(ae._defaultOpacity*100)]]}get propertiesToUpdate(){return[[F.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||ae._defaultThickness],[F.AnnotationEditorParamsType.INK_COLOR,this.color||ae._defaultColor||O.AnnotationEditor._defaultLineColor],[F.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??ae._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(Ft(this,U,ds).call(this),Ft(this,U,us).call(this)),this.isAttachedToDOM||(this.parent.add(this),Ft(this,U,qe).call(this)),Ft(this,U,Ge).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,D(this,Et).disconnect(),zt(this,Et,null),super.remove())}setParent(it){!this.parent&&it?this._uiManager.removeShouldRescale(this):this.parent&&it===null&&this._uiManager.addShouldRescale(this),super.setParent(it)}onScaleChanging(){const[it,St]=this.parentDimensions,It=this.width*it,jt=this.height*St;this.setDimensions(It,jt)}enableEditMode(){D(this,st)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",D(this,ct)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",D(this,ct)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){D(this,st)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),zt(this,st,!0),this.div.classList.add("disabled"),Ft(this,U,Ge).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(it){this._focusEventsAllowed&&(super.focusin(it),this.enableEditMode())}canvasPointerdown(it){it.button!==0||!this.isInEditMode()||D(this,st)||(this.setInForeground(),it.preventDefault(),it.type!=="mouse"&&this.div.focus(),Ft(this,U,xi).call(this,it.offsetX,it.offsetY))}canvasPointermove(it){it.preventDefault(),Ft(this,U,qs).call(this,it.offsetX,it.offsetY)}canvasPointerup(it){it.preventDefault(),Ft(this,U,Gs).call(this,it)}canvasPointerleave(it){Ft(this,U,Gs).call(this,it)}get isResizable(){return!this.isEmpty()&&D(this,st)}render(){if(this.div)return this.div;let it,St;this.width&&(it=this.x,St=this.y),super.render(),O.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(oe=>this.div?.setAttribute("aria-label",oe));const[It,jt,Zt,re]=Ft(this,U,Si).call(this);if(this.setAt(It,jt,0,0),this.setDims(Zt,re),Ft(this,U,ds).call(this),this.width){const[oe,Lt]=this.parentDimensions;this.setAspectRatio(this.width*oe,this.height*Lt),this.setAt(it*oe,St*Lt,this.width*oe,this.height*Lt),zt(this,nt,!0),Ft(this,U,qe).call(this),this.setDims(this.width*oe,this.height*Lt),Ft(this,U,Be).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return Ft(this,U,us).call(this),this.div}setDimensions(it,St){const It=Math.round(it),jt=Math.round(St);if(D(this,ot)===It&&D(this,K)===jt)return;zt(this,ot,It),zt(this,K,jt),this.canvas.style.visibility="hidden";const[Zt,re]=this.parentDimensions;this.width=it/Zt,this.height=St/re,this.fixAndSetPosition(),D(this,st)&&Ft(this,U,Vs).call(this,it,St),Ft(this,U,qe).call(this),Ft(this,U,Be).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(it,St,It){var we,ke,Re;if(it instanceof ut.InkAnnotationElement)return null;const jt=super.deserialize(it,St,It);jt.thickness=it.thickness,jt.color=F.Util.makeHexColor(...it.color),jt.opacity=it.opacity;const[Zt,re]=jt.pageDimensions,oe=jt.width*Zt,Lt=jt.height*re,he=jt.parentScale,de=it.thickness/2;zt(jt,st,!0),zt(jt,ot,Math.round(oe)),zt(jt,K,Math.round(Lt));const{paths:Ce,rect:Ee,rotation:Fe}=it;for(let{bezier:le}of Ce){le=Ft(we=ae,yt,Mi).call(we,le,Ee,Fe);const Gt=[];jt.paths.push(Gt);let qt=he*(le[0]-de),me=he*(le[1]-de);for(let Te=2,wt=le.length;Te<wt;Te+=6){const ie=he*(le[Te]-de),ue=he*(le[Te+1]-de),ye=he*(le[Te+2]-de),Ae=he*(le[Te+3]-de),ge=he*(le[Te+4]-de),gt=he*(le[Te+5]-de);Gt.push([[qt,me],[ie,ue],[ye,Ae],[ge,gt]]),qt=ge,me=gt}const Me=Ft(this,yt,ki).call(this,Gt);jt.bezierPath2D.push(Me)}const be=Ft(ke=jt,U,Ys).call(ke);return zt(jt,tt,Math.max(O.AnnotationEditor.MIN_SIZE,be[2]-be[0])),zt(jt,pt,Math.max(O.AnnotationEditor.MIN_SIZE,be[3]-be[1])),Ft(Re=jt,U,Vs).call(Re,oe,Lt),jt}serialize(){if(this.isEmpty())return null;const it=this.getRect(0,0),St=O.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:F.AnnotationEditorType.INK,color:St,thickness:this.thickness,opacity:this.opacity,paths:Ft(this,U,Fi).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,it),pageIndex:this.pageIndex,rect:it,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};pt=new WeakMap,tt=new WeakMap,_t=new WeakMap,Ct=new WeakMap,at=new WeakMap,ct=new WeakMap,mt=new WeakMap,st=new WeakMap,Z=new WeakMap,nt=new WeakMap,Et=new WeakMap,ot=new WeakMap,K=new WeakMap,q=new WeakMap,U=new WeakSet,yi=function(it){const St=this.thickness;this.addCommands({cmd:()=>{this.thickness=it,Ft(this,U,Ge).call(this)},undo:()=>{this.thickness=St,Ft(this,U,Ge).call(this)},mustExec:!0,type:F.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},vi=function(it){const St=this.color;this.addCommands({cmd:()=>{this.color=it,Ft(this,U,Be).call(this)},undo:()=>{this.color=St,Ft(this,U,Be).call(this)},mustExec:!0,type:F.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Ai=function(it){it/=100;const St=this.opacity;this.addCommands({cmd:()=>{this.opacity=it,Ft(this,U,Be).call(this)},undo:()=>{this.opacity=St,Ft(this,U,Be).call(this)},mustExec:!0,type:F.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},Si=function(){const{parentRotation:it,parentDimensions:[St,It]}=this;switch(it){case 90:return[0,It,It,St];case 180:return[St,It,St,It];case 270:return[St,0,It,St];default:return[0,0,St,It]}},Ws=function(){const{ctx:it,color:St,opacity:It,thickness:jt,parentScale:Zt,scaleFactor:re}=this;it.lineWidth=jt*Zt/re,it.lineCap="round",it.lineJoin="round",it.miterLimit=10,it.strokeStyle=`${St}${(0,Yt.opacityToHex)(It)}`},xi=function(it,St){this.canvas.addEventListener("contextmenu",lt.noContextMenu),this.canvas.addEventListener("pointerleave",D(this,Ct)),this.canvas.addEventListener("pointermove",D(this,_t)),this.canvas.addEventListener("pointerup",D(this,at)),this.canvas.removeEventListener("pointerdown",D(this,ct)),this.isEditing=!0,D(this,nt)||(zt(this,nt,!0),Ft(this,U,qe).call(this),this.thickness||(this.thickness=ae._defaultThickness),this.color||(this.color=ae._defaultColor||O.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=ae._defaultOpacity)),this.currentPath.push([it,St]),zt(this,Z,!1),Ft(this,U,Ws).call(this),zt(this,q,()=>{Ft(this,U,Ci).call(this),D(this,q)&&window.requestAnimationFrame(D(this,q))}),window.requestAnimationFrame(D(this,q))},qs=function(it,St){const[It,jt]=this.currentPath.at(-1);if(this.currentPath.length>1&&it===It&&St===jt)return;const Zt=this.currentPath;let re=D(this,mt);if(Zt.push([it,St]),zt(this,Z,!0),Zt.length<=2){re.moveTo(...Zt[0]),re.lineTo(it,St);return}Zt.length===3&&(zt(this,mt,re=new Path2D),re.moveTo(...Zt[0])),Ft(this,U,Ti).call(this,re,...Zt.at(-3),...Zt.at(-2),it,St)},Ei=function(){if(this.currentPath.length===0)return;const it=this.currentPath.at(-1);D(this,mt).lineTo(...it)},wi=function(it,St){zt(this,q,null),it=Math.min(Math.max(it,0),this.canvas.width),St=Math.min(Math.max(St,0),this.canvas.height),Ft(this,U,qs).call(this,it,St),Ft(this,U,Ei).call(this);let It;if(this.currentPath.length!==1)It=Ft(this,U,Pi).call(this);else{const Lt=[it,St];It=[[Lt,Lt.slice(),Lt.slice(),Lt]]}const jt=D(this,mt),Zt=this.currentPath;this.currentPath=[],zt(this,mt,new Path2D);const re=()=>{this.allRawPaths.push(Zt),this.paths.push(It),this.bezierPath2D.push(jt),this.rebuild()},oe=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(Ft(this,U,ds).call(this),Ft(this,U,us).call(this)),Ft(this,U,Ge).call(this))};this.addCommands({cmd:re,undo:oe,mustExec:!0})},Ci=function(){if(!D(this,Z))return;zt(this,Z,!1);const it=Math.ceil(this.thickness*this.parentScale),St=this.currentPath.slice(-3),It=St.map(re=>re[0]),jt=St.map(re=>re[1]);Math.min(...It)-it,Math.max(...It)+it,Math.min(...jt)-it,Math.max(...jt)+it;const{ctx:Zt}=this;Zt.save(),Zt.clearRect(0,0,this.canvas.width,this.canvas.height);for(const re of this.bezierPath2D)Zt.stroke(re);Zt.stroke(D(this,mt)),Zt.restore()},Ti=function(it,St,It,jt,Zt,re,oe){const Lt=(St+jt)/2,he=(It+Zt)/2,de=(jt+re)/2,Ce=(Zt+oe)/2;it.bezierCurveTo(Lt+2*(jt-Lt)/3,he+2*(Zt-he)/3,de+2*(jt-de)/3,Ce+2*(Zt-Ce)/3,de,Ce)},Pi=function(){const it=this.currentPath;if(it.length<=2)return[[it[0],it[0],it.at(-1),it.at(-1)]];const St=[];let It,[jt,Zt]=it[0];for(It=1;It<it.length-2;It++){const[Ee,Fe]=it[It],[be,we]=it[It+1],ke=(Ee+be)/2,Re=(Fe+we)/2,le=[jt+2*(Ee-jt)/3,Zt+2*(Fe-Zt)/3],Gt=[ke+2*(Ee-ke)/3,Re+2*(Fe-Re)/3];St.push([[jt,Zt],le,Gt,[ke,Re]]),[jt,Zt]=[ke,Re]}const[re,oe]=it[It],[Lt,he]=it[It+1],de=[jt+2*(re-jt)/3,Zt+2*(oe-Zt)/3],Ce=[Lt+2*(re-Lt)/3,he+2*(oe-he)/3];return St.push([[jt,Zt],de,Ce,[Lt,he]]),St},Be=function(){if(this.isEmpty()){Ft(this,U,ps).call(this);return}Ft(this,U,Ws).call(this);const{canvas:it,ctx:St}=this;St.setTransform(1,0,0,1,0,0),St.clearRect(0,0,it.width,it.height),Ft(this,U,ps).call(this);for(const It of this.bezierPath2D)St.stroke(It)},Gs=function(it){this.canvas.removeEventListener("pointerleave",D(this,Ct)),this.canvas.removeEventListener("pointermove",D(this,_t)),this.canvas.removeEventListener("pointerup",D(this,at)),this.canvas.addEventListener("pointerdown",D(this,ct)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",lt.noContextMenu)},10),Ft(this,U,wi).call(this,it.offsetX,it.offsetY),this.addToAnnotationStorage(),this.setInBackground()},ds=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",O.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(it=>this.canvas?.setAttribute("aria-label",it)),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},us=function(){zt(this,Et,new ResizeObserver(it=>{const St=it[0].contentRect;St.width&&St.height&&this.setDimensions(St.width,St.height)})),D(this,Et).observe(this.div)},qe=function(){if(!D(this,nt))return;const[it,St]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*it),this.canvas.height=Math.ceil(this.height*St),Ft(this,U,ps).call(this)},Vs=function(it,St){const It=Ft(this,U,fs).call(this),jt=(it-It)/D(this,tt),Zt=(St-It)/D(this,pt);this.scaleFactor=Math.min(jt,Zt)},ps=function(){const it=Ft(this,U,fs).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+it,this.translationY*this.scaleFactor+it)},yt=new WeakSet,ki=function(it){const St=new Path2D;for(let It=0,jt=it.length;It<jt;It++){const[Zt,re,oe,Lt]=it[It];It===0&&St.moveTo(...Zt),St.bezierCurveTo(re[0],re[1],oe[0],oe[1],Lt[0],Lt[1])}return St},Xs=function(it,St,It){const[jt,Zt,re,oe]=St;switch(It){case 0:for(let Lt=0,he=it.length;Lt<he;Lt+=2)it[Lt]+=jt,it[Lt+1]=oe-it[Lt+1];break;case 90:for(let Lt=0,he=it.length;Lt<he;Lt+=2){const de=it[Lt];it[Lt]=it[Lt+1]+jt,it[Lt+1]=de+Zt}break;case 180:for(let Lt=0,he=it.length;Lt<he;Lt+=2)it[Lt]=re-it[Lt],it[Lt+1]+=Zt;break;case 270:for(let Lt=0,he=it.length;Lt<he;Lt+=2){const de=it[Lt];it[Lt]=re-it[Lt+1],it[Lt+1]=oe-de}break;default:throw new Error("Invalid rotation")}return it},Mi=function(it,St,It){const[jt,Zt,re,oe]=St;switch(It){case 0:for(let Lt=0,he=it.length;Lt<he;Lt+=2)it[Lt]-=jt,it[Lt+1]=oe-it[Lt+1];break;case 90:for(let Lt=0,he=it.length;Lt<he;Lt+=2){const de=it[Lt];it[Lt]=it[Lt+1]-Zt,it[Lt+1]=de-jt}break;case 180:for(let Lt=0,he=it.length;Lt<he;Lt+=2)it[Lt]=re-it[Lt],it[Lt+1]-=Zt;break;case 270:for(let Lt=0,he=it.length;Lt<he;Lt+=2){const de=it[Lt];it[Lt]=oe-it[Lt+1],it[Lt+1]=re-de}break;default:throw new Error("Invalid rotation")}return it},Fi=function(it,St,It,jt){var he,de;const Zt=[],re=this.thickness/2,oe=it*St+re,Lt=it*It+re;for(const Ce of this.paths){const Ee=[],Fe=[];for(let be=0,we=Ce.length;be<we;be++){const[ke,Re,le,Gt]=Ce[be],qt=it*ke[0]+oe,me=it*ke[1]+Lt,Me=it*Re[0]+oe,Te=it*Re[1]+Lt,wt=it*le[0]+oe,ie=it*le[1]+Lt,ue=it*Gt[0]+oe,ye=it*Gt[1]+Lt;be===0&&(Ee.push(qt,me),Fe.push(qt,me)),Ee.push(Me,Te,wt,ie,ue,ye),Fe.push(Me,Te),be===we-1&&Fe.push(ue,ye)}Zt.push({bezier:Ft(he=ae,yt,Xs).call(he,Ee,jt,this.rotation),points:Ft(de=ae,yt,Xs).call(de,Fe,jt,this.rotation)})}return Zt},Ys=function(){let it=1/0,St=-1/0,It=1/0,jt=-1/0;for(const Zt of this.paths)for(const[re,oe,Lt,he]of Zt){const de=F.Util.bezierBoundingBox(...re,...oe,...Lt,...he);it=Math.min(it,de[0]),It=Math.min(It,de[1]),St=Math.max(St,de[2]),jt=Math.max(jt,de[3])}return[it,It,St,jt]},fs=function(){return D(this,st)?Math.ceil(this.thickness*this.parentScale):0},Ge=function(it=!1){if(this.isEmpty())return;if(!D(this,st)){Ft(this,U,Be).call(this);return}const St=Ft(this,U,Ys).call(this),It=Ft(this,U,fs).call(this);zt(this,tt,Math.max(O.AnnotationEditor.MIN_SIZE,St[2]-St[0])),zt(this,pt,Math.max(O.AnnotationEditor.MIN_SIZE,St[3]-St[1]));const jt=Math.ceil(It+D(this,tt)*this.scaleFactor),Zt=Math.ceil(It+D(this,pt)*this.scaleFactor),[re,oe]=this.parentDimensions;this.width=jt/re,this.height=Zt/oe,this.setAspectRatio(jt,Zt);const Lt=this.translationX,he=this.translationY;this.translationX=-St[0],this.translationY=-St[1],Ft(this,U,qe).call(this),Ft(this,U,Be).call(this),zt(this,ot,jt),zt(this,K,Zt),this.setDims(jt,Zt);const de=it?It/this.scaleFactor/2:0;this.translate(Lt-this.translationX-de,he-this.translationY-de)},Ht(ae,yt),Le(ae,"_defaultColor",null),Le(ae,"_defaultOpacity",1),Le(ae,"_defaultThickness",1),Le(ae,"_type","ink");let vt=ae;w.InkEditor=vt},(Y,w,W)=>{var vt,pt,tt,_t,Ct,at,ct,mt,st,Z,nt,es,ss,gs,Ks,Ri,Di,Qs,ms,Ii;Object.defineProperty(w,"__esModule",{value:!0}),w.StampEditor=void 0;var F=W(1),O=W(4),ut=W(6),lt=W(29);const ft=class ft extends O.AnnotationEditor{constructor(Ot){super({...Ot,name:"stampEditor"});Ht(this,nt);Ht(this,vt,null);Ht(this,pt,null);Ht(this,tt,null);Ht(this,_t,null);Ht(this,Ct,null);Ht(this,at,null);Ht(this,ct,null);Ht(this,mt,null);Ht(this,st,!1);Ht(this,Z,!1);zt(this,_t,Ot.bitmapUrl),zt(this,Ct,Ot.bitmapFile)}static initialize(Ot){O.AnnotationEditor.initialize(Ot)}static get supportedTypes(){const Ot=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,F.shadow)(this,"supportedTypes",Ot.map(Bt=>`image/${Bt}`))}static get supportedTypesStr(){return(0,F.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(Ot){return this.supportedTypes.includes(Ot)}static paste(Ot,Bt){Bt.pasteEditor(F.AnnotationEditorType.STAMP,{bitmapFile:Ot.getAsFile()})}remove(){D(this,pt)&&(zt(this,vt,null),this._uiManager.imageManager.deleteId(D(this,pt)),D(this,at)?.remove(),zt(this,at,null),D(this,ct)?.disconnect(),zt(this,ct,null)),super.remove()}rebuild(){if(!this.parent){D(this,pt)&&Ft(this,nt,gs).call(this);return}super.rebuild(),this.div!==null&&(D(this,pt)&&Ft(this,nt,gs).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(D(this,tt)||D(this,vt)||D(this,_t)||D(this,Ct))}get isResizable(){return!0}render(){if(this.div)return this.div;let Ot,Bt;if(this.width&&(Ot=this.x,Bt=this.y),super.render(),this.div.hidden=!0,D(this,vt)?Ft(this,nt,Ks).call(this):Ft(this,nt,gs).call(this),this.width){const[Mt,Vt]=this.parentDimensions;this.setAt(Ot*Mt,Bt*Vt,this.width*Mt,this.height*Vt)}return this.div}static deserialize(Ot,Bt,Mt){if(Ot instanceof lt.StampAnnotationElement)return null;const Vt=super.deserialize(Ot,Bt,Mt),{rect:xt,bitmapUrl:Dt,bitmapId:Nt,isSvg:dt,accessibilityData:G}=Ot;Nt&&Mt.imageManager.isValidId(Nt)?zt(Vt,pt,Nt):zt(Vt,_t,Dt),zt(Vt,st,dt);const[X,et]=Vt.pageDimensions;return Vt.width=(xt[2]-xt[0])/X,Vt.height=(xt[3]-xt[1])/et,G&&(Vt.altTextData=G),Vt}serialize(Ot=!1,Bt=null){if(this.isEmpty())return null;const Mt={annotationType:F.AnnotationEditorType.STAMP,bitmapId:D(this,pt),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:D(this,st),structTreeParentId:this._structTreeParentId};if(Ot)return Mt.bitmapUrl=Ft(this,nt,ms).call(this,!0),Mt.accessibilityData=this.altTextData,Mt;const{decorative:Vt,altText:xt}=this.altTextData;if(!Vt&&xt&&(Mt.accessibilityData={type:"Figure",alt:xt}),Bt===null)return Mt;Bt.stamps||(Bt.stamps=new Map);const Dt=D(this,st)?(Mt.rect[2]-Mt.rect[0])*(Mt.rect[3]-Mt.rect[1]):null;if(!Bt.stamps.has(D(this,pt)))Bt.stamps.set(D(this,pt),{area:Dt,serialized:Mt}),Mt.bitmap=Ft(this,nt,ms).call(this,!1);else if(D(this,st)){const Nt=Bt.stamps.get(D(this,pt));Dt>Nt.area&&(Nt.area=Dt,Nt.serialized.bitmap.close(),Nt.serialized.bitmap=Ft(this,nt,ms).call(this,!1))}return Mt}};vt=new WeakMap,pt=new WeakMap,tt=new WeakMap,_t=new WeakMap,Ct=new WeakMap,at=new WeakMap,ct=new WeakMap,mt=new WeakMap,st=new WeakMap,Z=new WeakMap,nt=new WeakSet,es=function(Ot,Bt=!1){if(!Ot){this.remove();return}zt(this,vt,Ot.bitmap),Bt||(zt(this,pt,Ot.id),zt(this,st,Ot.isSvg)),Ft(this,nt,Ks).call(this)},ss=function(){zt(this,tt,null),this._uiManager.enableWaiting(!1),D(this,at)&&this.div.focus()},gs=function(){if(D(this,pt)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(D(this,pt)).then(Bt=>Ft(this,nt,es).call(this,Bt,!0)).finally(()=>Ft(this,nt,ss).call(this));return}if(D(this,_t)){const Bt=D(this,_t);zt(this,_t,null),this._uiManager.enableWaiting(!0),zt(this,tt,this._uiManager.imageManager.getFromUrl(Bt).then(Mt=>Ft(this,nt,es).call(this,Mt)).finally(()=>Ft(this,nt,ss).call(this)));return}if(D(this,Ct)){const Bt=D(this,Ct);zt(this,Ct,null),this._uiManager.enableWaiting(!0),zt(this,tt,this._uiManager.imageManager.getFromFile(Bt).then(Mt=>Ft(this,nt,es).call(this,Mt)).finally(()=>Ft(this,nt,ss).call(this)));return}const Ot=document.createElement("input");Ot.type="file",Ot.accept=ft.supportedTypesStr,zt(this,tt,new Promise(Bt=>{Ot.addEventListener("change",async()=>{if(!Ot.files||Ot.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const Mt=await this._uiManager.imageManager.getFromFile(Ot.files[0]);Ft(this,nt,es).call(this,Mt)}Bt()}),Ot.addEventListener("cancel",()=>{this.remove(),Bt()})}).finally(()=>Ft(this,nt,ss).call(this))),Ot.click()},Ks=function(){const{div:Ot}=this;let{width:Bt,height:Mt}=D(this,vt);const[Vt,xt]=this.pageDimensions,Dt=.75;if(this.width)Bt=this.width*Vt,Mt=this.height*xt;else if(Bt>Dt*Vt||Mt>Dt*xt){const X=Math.min(Dt*Vt/Bt,Dt*xt/Mt);Bt*=X,Mt*=X}const[Nt,dt]=this.parentDimensions;this.setDims(Bt*Nt/Vt,Mt*dt/xt),this._uiManager.enableWaiting(!1);const G=zt(this,at,document.createElement("canvas"));Ot.append(G),Ot.hidden=!1,Ft(this,nt,Qs).call(this,Bt,Mt),Ft(this,nt,Ii).call(this),D(this,Z)||(this.parent.addUndoableEditor(this),zt(this,Z,!0)),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()},Ri=function(Ot,Bt){const[Mt,Vt]=this.parentDimensions;this.width=Ot/Mt,this.height=Bt/Vt,this.setDims(Ot,Bt),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,D(this,mt)!==null&&clearTimeout(D(this,mt)),zt(this,mt,setTimeout(()=>{zt(this,mt,null),Ft(this,nt,Qs).call(this,Ot,Bt)},200))},Di=function(Ot,Bt){const{width:Mt,height:Vt}=D(this,vt);let xt=Mt,Dt=Vt,Nt=D(this,vt);for(;xt>2*Ot||Dt>2*Bt;){const dt=xt,G=Dt;xt>2*Ot&&(xt=xt>=16384?Math.floor(xt/2)-1:Math.ceil(xt/2)),Dt>2*Bt&&(Dt=Dt>=16384?Math.floor(Dt/2)-1:Math.ceil(Dt/2));const X=new OffscreenCanvas(xt,Dt);X.getContext("2d").drawImage(Nt,0,0,dt,G,0,0,xt,Dt),Nt=X.transferToImageBitmap()}return Nt},Qs=function(Ot,Bt){Ot=Math.ceil(Ot),Bt=Math.ceil(Bt);const Mt=D(this,at);if(!Mt||Mt.width===Ot&&Mt.height===Bt)return;Mt.width=Ot,Mt.height=Bt;const Vt=D(this,st)?D(this,vt):Ft(this,nt,Di).call(this,Ot,Bt),xt=Mt.getContext("2d");xt.filter=this._uiManager.hcmFilter,xt.drawImage(Vt,0,0,Vt.width,Vt.height,0,0,Ot,Bt)},ms=function(Ot){if(Ot){if(D(this,st)){const Vt=this._uiManager.imageManager.getSvgUrl(D(this,pt));if(Vt)return Vt}const Bt=document.createElement("canvas");return{width:Bt.width,height:Bt.height}=D(this,vt),Bt.getContext("2d").drawImage(D(this,vt),0,0),Bt.toDataURL()}if(D(this,st)){const[Bt,Mt]=this.pageDimensions,Vt=Math.round(this.width*Bt*ut.PixelsPerInch.PDF_TO_CSS_UNITS),xt=Math.round(this.height*Mt*ut.PixelsPerInch.PDF_TO_CSS_UNITS),Dt=new OffscreenCanvas(Vt,xt);return Dt.getContext("2d").drawImage(D(this,vt),0,0,D(this,vt).width,D(this,vt).height,0,0,Vt,xt),Dt.transferToImageBitmap()}return structuredClone(D(this,vt))},Ii=function(){zt(this,ct,new ResizeObserver(Ot=>{const Bt=Ot[0].contentRect;Bt.width&&Bt.height&&Ft(this,nt,Ri).call(this,Bt.width,Bt.height)})),D(this,ct).observe(this.div)},Le(ft,"_type","stamp");let Yt=ft;w.StampEditor=Yt}],__webpack_module_cache__={};function __w_pdfjs_require__(Y){var w=__webpack_module_cache__[Y];if(w!==void 0)return w.exports;var W=__webpack_module_cache__[Y]={exports:{}};return __webpack_modules__[Y](W,W.exports,__w_pdfjs_require__),W.exports}var __webpack_exports__={};return(()=>{var Y=__webpack_exports__;Object.defineProperty(Y,"__esModule",{value:!0}),Object.defineProperty(Y,"AbortException",{enumerable:!0,get:function(){return w.AbortException}}),Object.defineProperty(Y,"AnnotationEditorLayer",{enumerable:!0,get:function(){return ut.AnnotationEditorLayer}}),Object.defineProperty(Y,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return w.AnnotationEditorParamsType}}),Object.defineProperty(Y,"AnnotationEditorType",{enumerable:!0,get:function(){return w.AnnotationEditorType}}),Object.defineProperty(Y,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return lt.AnnotationEditorUIManager}}),Object.defineProperty(Y,"AnnotationLayer",{enumerable:!0,get:function(){return Yt.AnnotationLayer}}),Object.defineProperty(Y,"AnnotationMode",{enumerable:!0,get:function(){return w.AnnotationMode}}),Object.defineProperty(Y,"CMapCompressionType",{enumerable:!0,get:function(){return w.CMapCompressionType}}),Object.defineProperty(Y,"DOMSVGFactory",{enumerable:!0,get:function(){return F.DOMSVGFactory}}),Object.defineProperty(Y,"FeatureTest",{enumerable:!0,get:function(){return w.FeatureTest}}),Object.defineProperty(Y,"GlobalWorkerOptions",{enumerable:!0,get:function(){return vt.GlobalWorkerOptions}}),Object.defineProperty(Y,"ImageKind",{enumerable:!0,get:function(){return w.ImageKind}}),Object.defineProperty(Y,"InvalidPDFException",{enumerable:!0,get:function(){return w.InvalidPDFException}}),Object.defineProperty(Y,"MissingPDFException",{enumerable:!0,get:function(){return w.MissingPDFException}}),Object.defineProperty(Y,"OPS",{enumerable:!0,get:function(){return w.OPS}}),Object.defineProperty(Y,"PDFDataRangeTransport",{enumerable:!0,get:function(){return W.PDFDataRangeTransport}}),Object.defineProperty(Y,"PDFDateString",{enumerable:!0,get:function(){return F.PDFDateString}}),Object.defineProperty(Y,"PDFWorker",{enumerable:!0,get:function(){return W.PDFWorker}}),Object.defineProperty(Y,"PasswordResponses",{enumerable:!0,get:function(){return w.PasswordResponses}}),Object.defineProperty(Y,"PermissionFlag",{enumerable:!0,get:function(){return w.PermissionFlag}}),Object.defineProperty(Y,"PixelsPerInch",{enumerable:!0,get:function(){return F.PixelsPerInch}}),Object.defineProperty(Y,"PromiseCapability",{enumerable:!0,get:function(){return w.PromiseCapability}}),Object.defineProperty(Y,"RenderingCancelledException",{enumerable:!0,get:function(){return F.RenderingCancelledException}}),Object.defineProperty(Y,"SVGGraphics",{enumerable:!0,get:function(){return W.SVGGraphics}}),Object.defineProperty(Y,"UnexpectedResponseException",{enumerable:!0,get:function(){return w.UnexpectedResponseException}}),Object.defineProperty(Y,"Util",{enumerable:!0,get:function(){return w.Util}}),Object.defineProperty(Y,"VerbosityLevel",{enumerable:!0,get:function(){return w.VerbosityLevel}}),Object.defineProperty(Y,"XfaLayer",{enumerable:!0,get:function(){return pt.XfaLayer}}),Object.defineProperty(Y,"build",{enumerable:!0,get:function(){return W.build}}),Object.defineProperty(Y,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return w.createValidAbsoluteUrl}}),Object.defineProperty(Y,"getDocument",{enumerable:!0,get:function(){return W.getDocument}}),Object.defineProperty(Y,"getFilenameFromUrl",{enumerable:!0,get:function(){return F.getFilenameFromUrl}}),Object.defineProperty(Y,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return F.getPdfFilenameFromUrl}}),Object.defineProperty(Y,"getXfaPageViewport",{enumerable:!0,get:function(){return F.getXfaPageViewport}}),Object.defineProperty(Y,"isDataScheme",{enumerable:!0,get:function(){return F.isDataScheme}}),Object.defineProperty(Y,"isPdfFile",{enumerable:!0,get:function(){return F.isPdfFile}}),Object.defineProperty(Y,"loadScript",{enumerable:!0,get:function(){return F.loadScript}}),Object.defineProperty(Y,"noContextMenu",{enumerable:!0,get:function(){return F.noContextMenu}}),Object.defineProperty(Y,"normalizeUnicode",{enumerable:!0,get:function(){return w.normalizeUnicode}}),Object.defineProperty(Y,"renderTextLayer",{enumerable:!0,get:function(){return O.renderTextLayer}}),Object.defineProperty(Y,"setLayerDimensions",{enumerable:!0,get:function(){return F.setLayerDimensions}}),Object.defineProperty(Y,"shadow",{enumerable:!0,get:function(){return w.shadow}}),Object.defineProperty(Y,"updateTextLayer",{enumerable:!0,get:function(){return O.updateTextLayer}}),Object.defineProperty(Y,"version",{enumerable:!0,get:function(){return W.version}});var w=__w_pdfjs_require__(1),W=__w_pdfjs_require__(2),F=__w_pdfjs_require__(6),O=__w_pdfjs_require__(26),ut=__w_pdfjs_require__(27),lt=__w_pdfjs_require__(5),Yt=__w_pdfjs_require__(29),vt=__w_pdfjs_require__(14),pt=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports,__defProp$9=Object.defineProperty,__getOwnPropDesc$9=Object.getOwnPropertyDescriptor,__decorateClass$9=(Y,w,W,F)=>{for(var O=F>1?void 0:F?__getOwnPropDesc$9(w,W):w,ut=Y.length-1,lt;ut>=0;ut--)(lt=Y[ut])&&(O=(F?lt(w,W,O):lt(O))||O);return F&&O&&__defProp$9(w,W,O),O};pdfExports.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";let PdfViewer=class extends i{constructor(){super(...arguments),this.pdfUrl="",this.scale=1.5,this.numPages=0,this.loading=!0,this.error="",this.currentPage=1,this.renderingPages=new Set,this.renderTasks=new Map}async firstUpdated(){this.pdfUrl&&await this.loadPDF()}async updated(Y){Y.has("pdfUrl")&&this.pdfUrl&&await this.loadPDF(),Y.has("scale")&&this.pdf&&await this.rerenderVisiblePages()}async loadPDF(){this.loading=!0,this.error="";try{const Y=pdfExports.getDocument(this.pdfUrl);this.pdf=await Y.promise,this.numPages=this.pdf.numPages,this.loading=!1,await this.updateComplete,this.setupIntersectionObserver()}catch(Y){console.error("Error loading PDF:",Y),this.error="Failed to load PDF. Please try again.",this.loading=!1}}setupIntersectionObserver(){this.intersectionObserver&&this.intersectionObserver.disconnect(),this.intersectionObserver=new IntersectionObserver(w=>{w.forEach(W=>{if(W.isIntersecting){const F=parseInt(W.target.dataset.page||"0");F>0&&this.renderPage(F)}})},{root:this.shadowRoot?.querySelector(".pdf-container"),rootMargin:"500px",threshold:.01}),this.shadowRoot?.querySelectorAll(".page")?.forEach(w=>{this.intersectionObserver?.observe(w)})}async renderPage(Y){if(!this.pdf||this.renderingPages.has(Y))return;const w=this.renderTasks.get(Y);w&&(w.cancel(),this.renderTasks.delete(Y)),this.renderingPages.add(Y);try{const W=await this.pdf.getPage(Y),F=W.getViewport({scale:this.scale}),O=this.shadowRoot?.querySelector(`.page[data-page="${Y}"]`);if(!O)return;const ut=O.querySelector("canvas"),lt=O.querySelector(".textLayer");if(!ut||!lt)return;ut.width=F.width,ut.height=F.height;const Yt=ut.getContext("2d");if(Yt){const pt=W.render({canvasContext:Yt,viewport:F});this.renderTasks.set(Y,pt);try{await pt.promise}catch(tt){if(tt.name==="RenderingCancelledException")return;throw tt}}const vt=await W.getTextContent();lt.innerHTML="",lt.style.width=F.width+"px",lt.style.height=F.height+"px",vt.items.forEach(pt=>{if(pt.str){const tt=document.createElement("span");tt.textContent=pt.str;const _t=pdfExports.Util.transform(F.transform,pt.transform),Ct=Math.atan2(_t[1],_t[0]),at=Math.sqrt(_t[2]*_t[2]+_t[3]*_t[3]);tt.style.left=_t[4]+"px",tt.style.top=_t[5]-at+"px",tt.style.fontSize=at+"px",tt.style.fontFamily=pt.fontName||"sans-serif",Ct!==0&&(tt.style.transform=`rotate(${Ct}rad)`),lt.appendChild(tt)}}),lt.addEventListener("mouseup",()=>this.handleTextSelection(Y))}catch(W){console.error(`Error rendering page ${Y}:`,W)}finally{this.renderingPages.delete(Y),this.renderTasks.delete(Y)}}async rerenderVisiblePages(){this.renderTasks.forEach(w=>{w.cancel()}),this.renderTasks.clear(),this.renderingPages.clear(),this.shadowRoot?.querySelectorAll(".page")?.forEach(w=>{const W=parseInt(w.dataset.page||"0");W>0&&this.renderPage(W)})}handleTextSelection(Y){const W=window.getSelection()?.toString().trim();if(W){const F={text:W,page:Y};this.dispatchEvent(new CustomEvent("text-selected",{detail:F,bubbles:!0,composed:!0}))}}zoomIn(){this.scale=Math.min(this.scale+.25,3)}zoomOut(){this.scale=Math.max(this.scale-.25,.5)}resetZoom(){this.scale=1.5}goToPage(Y){if(Y<1||Y>this.numPages)return;const w=this.shadowRoot?.querySelector(`.page[data-page="${Y}"]`);w&&(w.scrollIntoView({behavior:"smooth",block:"start"}),this.currentPage=Y)}scrollToPage(Y){this.goToPage(Y)}nextPage(){this.goToPage(this.currentPage+1)}prevPage(){this.goToPage(this.currentPage-1)}render(){return this.loading?x`<div class="loading">Loading PDF...</div>`:this.error?x`<div class="error">${this.error}</div>`:this.pdf?x`
      <div class="toolbar">
        <div class="toolbar-section">
          <button @click=${this.prevPage} ?disabled=${this.currentPage===1}>
            Previous
          </button>
          <span class="page-info">
            Page ${this.currentPage} / ${this.numPages}
          </span>
          <button @click=${this.nextPage} ?disabled=${this.currentPage===this.numPages}>
            Next
          </button>
        </div>

        <div class="toolbar-section">
          <button @click=${this.zoomOut} ?disabled=${this.scale<=.5}>
            Zoom Out
          </button>
          <span class="page-info">${Math.round(this.scale*100)}%</span>
          <button @click=${this.zoomIn} ?disabled=${this.scale>=3}>
            Zoom In
          </button>
          <button @click=${this.resetZoom}>
            Reset
          </button>
        </div>
      </div>

      <div class="pdf-container">
        <div class="pages">
          ${Array.from({length:this.numPages},(Y,w)=>w+1).map(Y=>x`
              <div class="page" data-page="${Y}">
                <canvas></canvas>
                <div class="textLayer"></div>
              </div>
            `)}
        </div>
      </div>
    `:x`<div class="loading">No PDF loaded</div>`}disconnectedCallback(){super.disconnectedCallback(),this.intersectionObserver&&this.intersectionObserver.disconnect()}};PdfViewer.styles=i$3`
    :host {
      display: flex;
      flex-direction: column;
      height: 100%;
      background: #525659;
    }

    .toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: #323639;
      color: white;
      border-bottom: 1px solid #000;
    }

    .toolbar-section {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .toolbar button {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .toolbar button:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .toolbar button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .page-info {
      font-size: 14px;
    }

    .pdf-container {
      flex: 1;
      overflow-y: auto;
      overflow-x: auto;
      padding: 20px;
    }

    .pages {
      display: flex;
      flex-direction: column;
      gap: 20px;
      align-items: center;
      margin: 0 auto;
      width: fit-content;
      min-width: 100%;
    }

    .page {
      position: relative;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      background: white;
    }

    .page canvas {
      display: block;
    }

    .textLayer {
      position: absolute;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      overflow: hidden;
      opacity: 0.2;
      line-height: 1.0;
      user-select: text;
    }

    .textLayer > span {
      color: transparent;
      position: absolute;
      white-space: pre;
      cursor: text;
      transform-origin: 0% 0%;
    }

    .textLayer ::selection {
      background: rgba(26, 115, 232, 0.3);
    }

    .loading,
    .error {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: white;
      font-size: 16px;
    }

    .error {
      color: #ff6b6b;
    }

    .page-placeholder {
      width: 800px;
      height: 1100px;
      background: rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(255, 255, 255, 0.5);
    }
  `;__decorateClass$9([n({type:String})],PdfViewer.prototype,"pdfUrl",2);__decorateClass$9([n({type:Number})],PdfViewer.prototype,"scale",2);__decorateClass$9([r()],PdfViewer.prototype,"pdf",2);__decorateClass$9([r()],PdfViewer.prototype,"numPages",2);__decorateClass$9([r()],PdfViewer.prototype,"loading",2);__decorateClass$9([r()],PdfViewer.prototype,"error",2);__decorateClass$9([r()],PdfViewer.prototype,"currentPage",2);PdfViewer=__decorateClass$9([t("pdf-viewer")],PdfViewer);var __defProp$8=Object.defineProperty,__getOwnPropDesc$8=Object.getOwnPropertyDescriptor,__decorateClass$8=(Y,w,W,F)=>{for(var O=F>1?void 0:F?__getOwnPropDesc$8(w,W):w,ut=Y.length-1,lt;ut>=0;ut--)(lt=Y[ut])&&(O=(F?lt(w,W,O):lt(O))||O);return F&&O&&__defProp$8(w,W,O),O};let ConversationItem=class extends i{constructor(){super(...arguments),this.flagged=!1,this.expanded=!1}handleFlag(){this.dispatchEvent(new CustomEvent("flag-toggle",{detail:{exchangeId:this.assistantMessage.id},bubbles:!0,composed:!0}))}async handleCopy(){try{await navigator.clipboard.writeText(this.assistantMessage.content)}catch(Y){console.error("Failed to copy:",Y)}}formatTimestamp(Y){return new Date(Y).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}getModelName(Y){return Y?Y.includes("sonnet")?"Sonnet":Y.includes("haiku")?"Haiku":Y.includes("opus")?"Opus":"Claude":""}toggleExpand(){this.expanded=!this.expanded}renderUserQuery(){if(!this.userMessage)return"";const Y=this.userMessage.content,w=Y.split(`
`),W=w.length>1||Y.length>100;if(!W||this.expanded)return x`
        <span class="user-query user-query-full" @click=${this.toggleExpand}>
          ${Y}
        </span>
        ${W?x`
              <div class="expand-indicator" @click=${this.toggleExpand}>
                Click to collapse
              </div>
            `:""}
      `;const F=w[0],O=w.length>1?w[1]:Y.substring(F.length);return x`
      <span class="user-query user-query-preview" @click=${this.toggleExpand}>
        <span class="user-query-first-line">${F}</span>
        ${O?x`<span class="user-query-rest">${O}</span>`:""}
      </span>
      <div class="expand-indicator" @click=${this.toggleExpand}>
        Click to expand
      </div>
    `}render(){return!this.userMessage||!this.assistantMessage?x``:x`
      <div class="exchange">
        <div class="question-section">
          ${this.userMessage.highlighted_text?x`
                <div class="highlighted-text">
                  ${this.userMessage.highlighted_text}
                </div>
              `:""}
          <div class="question-row">
            <span class="question-label">Question: </span>${this.renderUserQuery()}
          </div>
          ${this.userMessage.page?x`
                <div class="page-indicator">Page ${this.userMessage.page}</div>
              `:""}
        </div>

        <div class="response-section">
          <div class="assistant-response">${this.assistantMessage.content}</div>

          <div class="message-footer">
            <div class="meta">
              ${this.assistantMessage.model?x`
                    <span class="model-badge">
                      ${this.getModelName(this.assistantMessage.model)}
                    </span>
                  `:""}
              <span class="timestamp">
                ${this.formatTimestamp(this.assistantMessage.timestamp)}
              </span>
            </div>
            <div class="actions">
              <button
                class="flag-btn ${this.flagged?"flagged":""}"
                @click=${this.handleFlag}
                title="${this.flagged?"Unflag":"Flag important"}"
              >
                ${this.flagged?"★":"☆"}
              </button>
              <button
                class="copy-btn"
                @click=${this.handleCopy}
                title="Copy response"
              >
                📋
              </button>
            </div>
          </div>
        </div>
      </div>
    `}};ConversationItem.styles=i$3`
    :host {
      display: block;
      margin-bottom: 16px;
    }

    .exchange {
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .question-section {
      background: #f5f0e6;
      padding: 12px;
      border-bottom: 1px solid #e8e0d0;
    }

    .question-label {
      font-weight: 700;
      color: #333;
      font-size: 13px;
      display: inline;
    }

    .question-row {
      margin-bottom: 0;
    }

    .highlighted-text {
      background: rgba(255, 235, 59, 0.4);
      padding: 8px;
      border-radius: 4px;
      margin-bottom: 8px;
      font-size: 13px;
      color: #5d4e00;
      border-left: 3px solid #ffc107;
    }

    .highlighted-text::before {
      content: '"';
    }

    .highlighted-text::after {
      content: '"';
    }

    .user-query {
      color: #4a4a4a;
      font-weight: 500;
      font-size: 14px;
      line-height: 1.5;
      display: inline;
    }

    .user-query-block {
      display: block;
    }

    .user-query-preview {
      cursor: pointer;
    }

    .user-query-first-line {
      display: block;
    }

    .user-query-rest {
      display: block;
      color: #6b7280;
      opacity: 0.6;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-weight: 400;
    }

    .user-query-full {
      white-space: pre-wrap;
    }

    .expand-indicator {
      font-size: 12px;
      color: #6b7280;
      margin-top: 4px;
      cursor: pointer;
    }

    .expand-indicator:hover {
      color: #1a73e8;
    }

    .page-indicator {
      color: #666;
      font-size: 12px;
      margin-top: 4px;
    }

    .response-section {
      padding: 12px;
    }

    .assistant-response {
      color: #333;
      font-size: 14px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .message-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid #f0f0f0;
      font-size: 12px;
      color: #999;
    }

    .meta {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .model-badge {
      background: #ede9fe;
      color: #7c4dff;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    }

    .timestamp {
      color: #999;
    }

    .actions {
      display: flex;
      gap: 8px;
    }

    .flag-btn,
    .copy-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 16px;
      padding: 4px;
      opacity: 0.6;
      transition: opacity 0.2s;
    }

    .flag-btn:hover,
    .copy-btn:hover {
      opacity: 1;
    }

    .flag-btn.flagged {
      opacity: 1;
      color: #f4b400;
    }

    .copy-btn {
      font-size: 14px;
    }
  `;__decorateClass$8([n({type:Object})],ConversationItem.prototype,"userMessage",2);__decorateClass$8([n({type:Object})],ConversationItem.prototype,"assistantMessage",2);__decorateClass$8([n({type:Boolean})],ConversationItem.prototype,"flagged",2);__decorateClass$8([r()],ConversationItem.prototype,"expanded",2);ConversationItem=__decorateClass$8([t("conversation-item")],ConversationItem);var __defProp$7=Object.defineProperty,__getOwnPropDesc$7=Object.getOwnPropertyDescriptor,__decorateClass$7=(Y,w,W,F)=>{for(var O=F>1?void 0:F?__getOwnPropDesc$7(w,W):w,ut=Y.length-1,lt;ut>=0;ut--)(lt=Y[ut])&&(O=(F?lt(w,W,O):lt(O))||O);return F&&O&&__defProp$7(w,W,O),O};let QueryInput=class extends i{constructor(){super(...arguments),this.selectedText="",this.disabled=!1,this.loading=!1,this.queryText=""}handleClearSelection(){this.dispatchEvent(new CustomEvent("clear-selection",{bubbles:!0,composed:!0}))}handleSubmit(){const Y=this.queryText.trim();Y&&(this.dispatchEvent(new CustomEvent("submit-query",{detail:{query:Y,highlighted_text:this.selectedText||void 0,page:this.selectedPage},bubbles:!0,composed:!0})),this.queryText="",this.textarea&&(this.textarea.style.height="auto"),this.selectedText&&this.dispatchEvent(new CustomEvent("clear-selection",{bubbles:!0,composed:!0})))}handleKeyDown(Y){Y.key==="Enter"&&!Y.shiftKey&&(Y.preventDefault(),this.handleSubmit())}handleInput(Y){const w=Y.target;this.queryText=w.value,w.style.height="auto",w.style.height=w.scrollHeight+"px"}render(){const Y=this.queryText.length,w=Y>500;return x`
      ${this.selectedText?x`
            <div class="selected-text-preview">
              <div class="preview-content">
                <div class="preview-label">
                  Selected text${this.selectedPage?` (Page ${this.selectedPage})`:""}:
                </div>
                <div class="preview-text">"${this.selectedText}"</div>
              </div>
              <button
                class="clear-selection"
                @click=${this.handleClearSelection}
                title="Clear selection"
              >
                ×
              </button>
            </div>
          `:""}

      <div class="input-area">
        <textarea
          placeholder="Ask a question about the paper..."
          .value=${this.queryText}
          @input=${this.handleInput}
          @keydown=${this.handleKeyDown}
          ?disabled=${this.disabled||this.loading}
        ></textarea>
      </div>

      <div class="footer">
        <div class="hint">
          ${this.loading?"Thinking...":"Enter to send · Shift+Enter for new line"}
          ${Y>0?x`
                <span class="char-count ${w?"warning":""}">
                  · ${Y} chars
                </span>
              `:""}
        </div>
        <div class="actions">
          <button
            class="submit-btn"
            @click=${this.handleSubmit}
            ?disabled=${this.disabled||this.loading||!this.queryText.trim()}
          >
            ${this.loading?"Thinking...":"Ask"}
          </button>
        </div>
      </div>
    `}};QueryInput.styles=i$3`
    :host {
      display: block;
      background: white;
      border-top: 1px solid #e0e0e0;
      padding: 16px;
    }

    .selected-text-preview {
      background: rgba(255, 235, 59, 0.4);
      border: 1px solid #ffc107;
      border-radius: 4px;
      padding: 8px 12px;
      margin-bottom: 12px;
      font-size: 13px;
      color: #5d4e00;
      display: flex;
      justify-content: space-between;
      align-items: start;
      gap: 8px;
    }

    .preview-content {
      flex: 1;
      line-height: 1.4;
    }

    .preview-label {
      font-weight: 500;
      margin-bottom: 4px;
    }

    .preview-text {
      font-style: italic;
      max-height: 60px;
      overflow-y: auto;
    }

    .clear-selection {
      background: none;
      border: none;
      color: #5d4e00;
      cursor: pointer;
      font-size: 18px;
      padding: 0;
      opacity: 0.6;
      line-height: 1;
    }

    .clear-selection:hover {
      opacity: 1;
    }

    .input-area {
      position: relative;
    }

    textarea {
      width: 100%;
      min-height: 80px;
      max-height: 200px;
      padding: 12px;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
      resize: vertical;
      box-sizing: border-box;
    }

    textarea:focus {
      outline: none;
      border-color: #1a73e8;
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }

    textarea:disabled {
      background: #f5f5f5;
      cursor: not-allowed;
    }

    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
    }

    .hint {
      font-size: 12px;
      color: #999;
    }

    .actions {
      display: flex;
      gap: 8px;
    }

    .submit-btn {
      padding: 8px 20px;
      background: #1a73e8;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }

    .submit-btn:hover:not(:disabled) {
      background: #1557b0;
    }

    .submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .model-toggle {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: #666;
    }

    .model-toggle input {
      cursor: pointer;
    }

    .char-count {
      font-size: 12px;
      color: #999;
    }

    .char-count.warning {
      color: #f4b400;
    }
  `;__decorateClass$7([n({type:String})],QueryInput.prototype,"selectedText",2);__decorateClass$7([n({type:Number})],QueryInput.prototype,"selectedPage",2);__decorateClass$7([n({type:Boolean})],QueryInput.prototype,"disabled",2);__decorateClass$7([n({type:Boolean})],QueryInput.prototype,"loading",2);__decorateClass$7([r()],QueryInput.prototype,"queryText",2);__decorateClass$7([e("textarea")],QueryInput.prototype,"textarea",2);QueryInput=__decorateClass$7([t("query-input")],QueryInput);var __defProp$6=Object.defineProperty,__getOwnPropDesc$6=Object.getOwnPropertyDescriptor,__decorateClass$6=(Y,w,W,F)=>{for(var O=F>1?void 0:F?__getOwnPropDesc$6(w,W):w,ut=Y.length-1,lt;ut>=0;ut--)(lt=Y[ut])&&(O=(F?lt(w,W,O):lt(O))||O);return F&&O&&__defProp$6(w,W,O),O};let LoadingSpinner=class extends i{constructor(){super(...arguments),this.message="Loading...",this.size="medium",this.light=!1}render(){return x`
      <div class="spinner ${this.size}"></div>
      ${this.message?x`<div class="message ${this.light?"light":""}">${this.message}</div>`:""}
    `}};LoadingSpinner.styles=i$3`
    :host {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    .spinner {
      border: 3px solid rgba(26, 115, 232, 0.1);
      border-top-color: #1a73e8;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    .spinner.small {
      width: 20px;
      height: 20px;
      border-width: 2px;
    }

    .spinner.medium {
      width: 32px;
      height: 32px;
      border-width: 3px;
    }

    .spinner.large {
      width: 48px;
      height: 48px;
      border-width: 4px;
    }

    .message {
      color: #666;
      font-size: 14px;
    }

    .message.light {
      color: white;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  `;__decorateClass$6([n({type:String})],LoadingSpinner.prototype,"message",2);__decorateClass$6([n({type:String})],LoadingSpinner.prototype,"size",2);__decorateClass$6([n({type:Boolean})],LoadingSpinner.prototype,"light",2);LoadingSpinner=__decorateClass$6([t("loading-spinner")],LoadingSpinner);var __defProp$5=Object.defineProperty,__getOwnPropDesc$5=Object.getOwnPropertyDescriptor,__decorateClass$5=(Y,w,W,F)=>{for(var O=F>1?void 0:F?__getOwnPropDesc$5(w,W):w,ut=Y.length-1,lt;ut>=0;ut--)(lt=Y[ut])&&(O=(F?lt(w,W,O):lt(O))||O);return F&&O&&__defProp$5(w,W,O),O};let ErrorMessage=class extends i{constructor(){super(...arguments),this.message="An error occurred",this.dismissible=!1}handleDismiss(){this.dispatchEvent(new CustomEvent("dismiss",{bubbles:!0,composed:!0}))}render(){return x`
      <div class="error">
        <div class="icon">⚠️</div>
        <div class="content">${this.message}</div>
        ${this.dismissible?x`<button class="dismiss" @click=${this.handleDismiss}>×</button>`:""}
      </div>
    `}};ErrorMessage.styles=i$3`
    :host {
      display: block;
    }

    .error {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 6px;
      padding: 12px 16px;
      color: #991b1b;
      font-size: 14px;
      line-height: 1.5;
      display: flex;
      align-items: start;
      gap: 12px;
    }

    .icon {
      flex-shrink: 0;
      font-size: 18px;
    }

    .content {
      flex: 1;
    }

    .dismiss {
      background: none;
      border: none;
      color: #991b1b;
      cursor: pointer;
      font-size: 20px;
      padding: 0;
      line-height: 1;
      opacity: 0.6;
    }

    .dismiss:hover {
      opacity: 1;
    }
  `;__decorateClass$5([n({type:String})],ErrorMessage.prototype,"message",2);__decorateClass$5([n({type:Boolean})],ErrorMessage.prototype,"dismissible",2);ErrorMessage=__decorateClass$5([t("error-message")],ErrorMessage);var __defProp$4=Object.defineProperty,__getOwnPropDesc$4=Object.getOwnPropertyDescriptor,__decorateClass$4=(Y,w,W,F)=>{for(var O=F>1?void 0:F?__getOwnPropDesc$4(w,W):w,ut=Y.length-1,lt;ut>=0;ut--)(lt=Y[ut])&&(O=(F?lt(w,W,O):lt(O))||O);return F&&O&&__defProp$4(w,W,O),O};let AskTab=class extends i{constructor(){super(...arguments),this.sessionId="",this.conversation=[],this.flags=[],this.selectedText="",this.loading=!1,this.error=""}async handleSubmitQuery(Y){if(this.sessionId){this.loading=!0,this.error="";try{const w=await api.query(this.sessionId,Y.detail),W={id:w.exchange_id,role:"user",content:Y.detail.query,highlighted_text:Y.detail.highlighted_text,page:Y.detail.page,timestamp:new Date().toISOString()},F={id:w.exchange_id+1,role:"assistant",content:w.response,model:w.model_used,timestamp:new Date().toISOString()};this.conversation=[...this.conversation,W,F],this.dispatchEvent(new CustomEvent("conversation-updated",{detail:{conversation:this.conversation},bubbles:!0,composed:!0})),await this.updateComplete,this.scrollToBottom()}catch(w){w instanceof ApiError?this.error=w.message:this.error="Failed to send query. Please try again.",console.error("Query error:",w)}finally{this.loading=!1}}}async handleFlagToggle(Y){if(!this.sessionId)return;const{exchangeId:w}=Y.detail,W=this.flags.includes(w);W?this.flags=this.flags.filter(F=>F!==w):this.flags=[...this.flags,w],this.dispatchEvent(new CustomEvent("flags-updated",{detail:{flags:this.flags},bubbles:!0,composed:!0})),this.requestUpdate();try{W?await api.unflag(this.sessionId,w):await api.toggleFlag(this.sessionId,w)}catch(F){console.error("Flag toggle error:",F)}}handleClearSelection(){this.dispatchEvent(new CustomEvent("clear-selection",{bubbles:!0,composed:!0}))}scrollToBottom(){this.conversationContainer&&(this.conversationContainer.scrollTop=this.conversationContainer.scrollHeight)}renderConversation(){const Y=this.conversation.slice(2);if(Y.length===0)return x`
        <div class="empty-state">
          <h3>No questions yet</h3>
          <p>
            Type a question below, or select text in the PDF to ask about specific passages.
          </p>
        </div>
      `;const w=[];for(let W=0;W<Y.length;W+=2){const F=Y[W],O=Y[W+1];F&&O&&F.role==="user"&&O.role==="assistant"&&w.push({user:F,assistant:O})}return w.map(W=>x`
        <conversation-item
          .userMessage=${W.user}
          .assistantMessage=${W.assistant}
          .flagged=${this.flags.includes(W.assistant.id)}
          @flag-toggle=${this.handleFlagToggle}
        ></conversation-item>
      `)}renderInitialAnalysis(){const Y=this.conversation.find(ut=>ut.id===1&&ut.role==="assistant");if(!Y)return"";let w="",W=Y.content;const F=W.match(/^#\s*(.+?)[\r\n]/);if(F){const ut=F[1].trim(),lt=ut.match(/^(?:Review Summary|Critical Review|5-Bullet Summary):\s*(.+)$/i);lt?w=lt[1].trim():w=ut,W=W.substring(F[0].length).trim()}const O=this.formatAnalysisContent(W);return x`
      <div class="initial-analysis">
        ${w?x`<div class="initial-analysis-title">${w}</div>`:""}
        <div class="initial-analysis-subtitle">Review Summary</div>
        <div class="initial-analysis-content">${O}</div>
      </div>
    `}formatAnalysisContent(Y){const w=Y.split(`
`),W=[];for(let F=0;F<w.length;F++){const O=w[F],ut=O.match(/^(•?\s*)\*\*([^*]+)\*\*(:.*)?$/),lt=O.match(/^(•?\s*)([A-Z][A-Za-z\s]+)(:)(.*)$/);if(ut){const[,Yt,vt,pt]=ut;W.push(x`${Yt}<span class="section-header">${vt}</span>${pt||""}`)}else if(lt&&lt[2].length<30){const[,Yt,vt,pt,tt]=lt;W.push(x`${Yt}<span class="section-header">${vt}</span>${pt}${tt}`)}else W.push(O);F<w.length-1&&W.push(`
`)}return W}render(){return this.sessionId?x`
      <div class="conversation-container">
        ${this.renderInitialAnalysis()} ${this.renderConversation()}
        ${this.loading?x`
              <div class="loading-overlay">
                <loading-spinner message="Thinking..."></loading-spinner>
              </div>
            `:""}
        ${this.error?x`
              <div class="error-container">
                <error-message
                  .message=${this.error}
                  dismissible
                  @dismiss=${()=>this.error=""}
                ></error-message>
              </div>
            `:""}
      </div>

      <query-input
        .selectedText=${this.selectedText}
        .selectedPage=${this.selectedPage}
        .loading=${this.loading}
        @submit-query=${this.handleSubmitQuery}
        @clear-selection=${this.handleClearSelection}
      ></query-input>
    `:x`
        <div class="empty-state">
          <h3>No paper loaded</h3>
          <p>Upload a PDF to start asking questions.</p>
        </div>
      `}};AskTab.styles=i$3`
    :host {
      display: flex;
      flex-direction: column;
      height: 100%;
      background: #f8f9fa;
    }

    .conversation-container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
      text-align: center;
      color: #666;
    }

    .empty-state h3 {
      margin: 0 0 8px 0;
      font-size: 16px;
      color: #333;
    }

    .empty-state p {
      margin: 0;
      font-size: 14px;
      line-height: 1.5;
    }

    .initial-analysis {
      background: white;
      border: 1px solid #9e9e9e;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .initial-analysis-title {
      font-weight: 700;
      color: #333;
      margin-bottom: 4px;
      font-size: 15px;
    }

    .initial-analysis-subtitle {
      font-weight: 600;
      color: #666;
      margin-bottom: 12px;
      font-size: 13px;
    }

    .initial-analysis-content {
      color: #444;
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .initial-analysis-content .section-header {
      font-weight: 700;
      color: #333;
    }

    .error-container {
      padding: 16px;
    }

    .loading-overlay {
      display: flex;
      justify-content: center;
      padding: 20px;
    }

    query-input {
      flex-shrink: 0;
    }
  `;__decorateClass$4([n({type:String})],AskTab.prototype,"sessionId",2);__decorateClass$4([n({type:Array})],AskTab.prototype,"conversation",2);__decorateClass$4([n({type:Array})],AskTab.prototype,"flags",2);__decorateClass$4([n({type:String})],AskTab.prototype,"selectedText",2);__decorateClass$4([n({type:Number})],AskTab.prototype,"selectedPage",2);__decorateClass$4([r()],AskTab.prototype,"loading",2);__decorateClass$4([r()],AskTab.prototype,"error",2);__decorateClass$4([e(".conversation-container")],AskTab.prototype,"conversationContainer",2);AskTab=__decorateClass$4([t("ask-tab")],AskTab);var __defProp$3=Object.defineProperty,__getOwnPropDesc$3=Object.getOwnPropertyDescriptor,__decorateClass$3=(Y,w,W,F)=>{for(var O=F>1?void 0:F?__getOwnPropDesc$3(w,W):w,ut=Y.length-1,lt;ut>=0;ut--)(lt=Y[ut])&&(O=(F?lt(w,W,O):lt(O))||O);return F&&O&&__defProp$3(w,W,O),O};let ConceptsTab=class extends i{constructor(){super(...arguments),this.concepts=[],this.sessionId="",this.loading=!1,this.error="",this.localConcepts=[],this.searchQuery=""}connectedCallback(){super.connectedCallback(),this.sessionId&&this.concepts.length===0&&this.loadConcepts()}updated(Y){Y.has("concepts")&&this.concepts.length>0&&(this.localConcepts=this.concepts),Y.has("sessionId")&&this.sessionId&&(this.error="",this.localConcepts.length===0&&this.loadConcepts())}async loadConcepts(){if(this.sessionId){this.loading=!0,this.error="";try{const Y=await api.getConcepts(this.sessionId);this.localConcepts=Y}catch(Y){console.error("Failed to load concepts:",Y),this.error="Failed to load key concepts"}finally{this.loading=!1}}}handleSearchInput(Y){const w=Y.target;this.searchQuery=w.value.toLowerCase()}handleConceptClick(Y){this.selectedConcept?.term===Y.term?this.selectedConcept=void 0:(this.selectedConcept=Y,this.dispatchEvent(new CustomEvent("highlight-concept",{detail:{concept:Y},bubbles:!0,composed:!0})))}handlePageClick(Y,w){w.stopPropagation(),this.dispatchEvent(new CustomEvent("navigate-to-page",{detail:{page:Y},bubbles:!0,composed:!0}))}getFilteredConcepts(){const Y=this.localConcepts.length>0?this.localConcepts:this.concepts;return this.searchQuery?Y.filter(w=>w.term.toLowerCase().includes(this.searchQuery)):Y}renderConceptItem(Y){const w=this.selectedConcept?.term===Y.term;return x`
      <div
        class="concept-item ${w?"selected":""}"
        @click=${()=>this.handleConceptClick(Y)}
      >
        <div class="concept-info">
          <div class="concept-term">${Y.term}</div>
          <div class="concept-meta">
            ${Y.pages.length} ${Y.pages.length===1?"page":"pages"}
          </div>
          ${w&&Y.pages.length>0?x`
                <div class="pages-list">
                  <div class="pages-title">Found on pages:</div>
                  <div class="page-links">
                    ${Y.pages.map(W=>x`
                        <button
                          class="page-link"
                          @click=${F=>this.handlePageClick(W,F)}
                        >
                          ${W}
                        </button>
                      `)}
                  </div>
                </div>
              `:""}
        </div>
        <span class="concept-frequency">${Y.frequency}x</span>
      </div>
    `}render(){if(!this.sessionId)return x`
        <div class="empty-state">
          <h3>No paper loaded</h3>
          <p>Upload a PDF to view key concepts.</p>
        </div>
      `;if(this.loading)return x`
        <div class="loading-container">
          <loading-spinner message="Extracting concepts..."></loading-spinner>
        </div>
      `;if(this.error)return x`
        <div class="error-message">${this.error}</div>
      `;if((this.localConcepts.length>0?this.localConcepts:this.concepts).length===0)return x`
        <div class="empty-state">
          <h3>No concepts extracted</h3>
          <p>Key concepts couldn't be extracted from this document.</p>
        </div>
      `;const w=this.getFilteredConcepts();return x`
      <div class="search-container">
        <input
          type="text"
          class="search-input"
          placeholder="Search concepts..."
          .value=${this.searchQuery}
          @input=${this.handleSearchInput}
        />
      </div>

      <div class="concepts-container">
        ${w.length===0?x`<div class="no-results">No concepts match your search</div>`:w.map(W=>this.renderConceptItem(W))}
      </div>
    `}};ConceptsTab.styles=i$3`
    :host {
      display: flex;
      flex-direction: column;
      height: 100%;
      background: #f8f9fa;
      overflow: hidden;
    }

    .search-container {
      padding: 12px 16px;
      background: white;
      border-bottom: 1px solid #e0e0e0;
      flex-shrink: 0;
    }

    .search-input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 13px;
      outline: none;
      box-sizing: border-box;
    }

    .search-input:focus {
      border-color: #1a73e8;
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }

    .concepts-container {
      flex: 1;
      overflow-y: auto;
      padding: 12px 16px;
    }

    .concept-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      margin-bottom: 8px;
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .concept-item:hover {
      border-color: #1a73e8;
      background: #f8fbff;
    }

    .concept-item.selected {
      border-color: #1a73e8;
      background: #e8f0fe;
    }

    .concept-info {
      flex: 1;
      min-width: 0;
    }

    .concept-term {
      font-weight: 500;
      font-size: 13px;
      color: #333;
      margin-bottom: 4px;
    }

    .concept-meta {
      font-size: 11px;
      color: #666;
    }

    .concept-frequency {
      background: #f0f0f0;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      color: #555;
      font-weight: 500;
      flex-shrink: 0;
      margin-left: 12px;
    }

    .pages-list {
      margin-top: 8px;
      padding: 8px;
      background: #f5f5f5;
      border-radius: 4px;
    }

    .pages-title {
      font-size: 11px;
      color: #666;
      margin-bottom: 6px;
    }

    .page-links {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .page-link {
      padding: 2px 6px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 3px;
      font-size: 11px;
      color: #1a73e8;
      cursor: pointer;
      transition: all 0.15s;
    }

    .page-link:hover {
      background: #e8f0fe;
      border-color: #1a73e8;
    }

    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 32px;
      text-align: center;
      color: #666;
      height: 100%;
    }

    .empty-state h3 {
      margin: 0 0 8px 0;
      font-size: 16px;
      color: #333;
    }

    .empty-state p {
      margin: 0;
      font-size: 14px;
      line-height: 1.5;
    }

    .loading-container {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px;
    }

    .error-message {
      padding: 16px;
      margin: 16px;
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 6px;
      color: #dc2626;
      font-size: 13px;
    }

    .no-results {
      text-align: center;
      padding: 24px;
      color: #666;
      font-size: 13px;
    }
  `;__decorateClass$3([n({type:Array})],ConceptsTab.prototype,"concepts",2);__decorateClass$3([n({type:String})],ConceptsTab.prototype,"sessionId",2);__decorateClass$3([r()],ConceptsTab.prototype,"loading",2);__decorateClass$3([r()],ConceptsTab.prototype,"error",2);__decorateClass$3([r()],ConceptsTab.prototype,"localConcepts",2);__decorateClass$3([r()],ConceptsTab.prototype,"searchQuery",2);__decorateClass$3([r()],ConceptsTab.prototype,"selectedConcept",2);ConceptsTab=__decorateClass$3([t("concepts-tab")],ConceptsTab);var __defProp$2=Object.defineProperty,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__decorateClass$2=(Y,w,W,F)=>{for(var O=F>1?void 0:F?__getOwnPropDesc$2(w,W):w,ut=Y.length-1,lt;ut>=0;ut--)(lt=Y[ut])&&(O=(F?lt(w,W,O):lt(O))||O);return F&&O&&__defProp$2(w,W,O),O};let LeftPanel=class extends i{constructor(){super(...arguments),this.sessionId="",this.filename="",this.conversation=[],this.flags=[],this.concepts=[],this.selectedText="",this.activeTab="ask"}handleTabClick(Y){this.activeTab=Y,this.dispatchEvent(new CustomEvent("tab-change",{detail:{tab:Y},bubbles:!0,composed:!0}))}handleNavigateToPage(Y){this.dispatchEvent(new CustomEvent("navigate-to-page",{detail:Y.detail,bubbles:!0,composed:!0}))}handleHighlightConcept(Y){this.dispatchEvent(new CustomEvent("highlight-concept",{detail:Y.detail,bubbles:!0,composed:!0}))}render(){return x`
      <div class="panel-header">
        <h1>Paper Companion</h1>
        ${this.filename?x`<p class="filename" title="${this.filename}">${this.filename}</p>`:""}
      </div>

      ${this.sessionId?x`
            <div class="tabs">
              <button
                class="tab-button ${this.activeTab==="concepts"?"active":""}"
                @click=${()=>this.handleTabClick("concepts")}
              >
                Concepts
              </button>
              <button
                class="tab-button ${this.activeTab==="ask"?"active":""}"
                @click=${()=>this.handleTabClick("ask")}
              >
                Ask
              </button>
            </div>
          `:""}

      <div class="tab-content">
        <concepts-tab
          class="${this.activeTab==="concepts"?"active":""}"
          .concepts=${this.concepts}
          .sessionId=${this.sessionId}
          @navigate-to-page=${this.handleNavigateToPage}
          @highlight-concept=${this.handleHighlightConcept}
        ></concepts-tab>

        <ask-tab
          class="${this.activeTab==="ask"?"active":""}"
          .sessionId=${this.sessionId}
          .conversation=${this.conversation}
          .flags=${this.flags}
          .selectedText=${this.selectedText}
          .selectedPage=${this.selectedPage}
          @conversation-updated=${Y=>this.dispatchEvent(new CustomEvent("conversation-updated",{detail:Y.detail,bubbles:!0,composed:!0}))}
          @flags-updated=${Y=>this.dispatchEvent(new CustomEvent("flags-updated",{detail:Y.detail,bubbles:!0,composed:!0}))}
          @clear-selection=${()=>this.dispatchEvent(new CustomEvent("clear-selection",{bubbles:!0,composed:!0}))}
        ></ask-tab>
      </div>
    `}};LeftPanel.styles=i$3`
    :host {
      display: flex;
      flex-direction: column;
      height: 100%;
      background: #f8f9fa;
    }

    .panel-header {
      padding: 16px;
      background: white;
      border-bottom: 1px solid #e0e0e0;
      flex-shrink: 0;
    }

    .panel-header h1 {
      margin: 0 0 4px 0;
      font-size: 18px;
      color: #333;
    }

    .panel-header .filename {
      margin: 0;
      font-size: 13px;
      color: #666;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .tabs {
      display: flex;
      background: white;
      border-bottom: 1px solid #e0e0e0;
      flex-shrink: 0;
    }

    .tab-button {
      flex: 1;
      padding: 12px 16px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      color: #666;
      transition: all 0.2s;
      position: relative;
    }

    .tab-button:hover {
      background: #f5f5f5;
      color: #333;
    }

    .tab-button.active {
      color: #1a73e8;
    }

    .tab-button.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: #1a73e8;
    }

    .tab-content {
      flex: 1;
      min-height: 0;
      overflow: hidden;
    }

    .tab-content > * {
      height: 100%;
    }

    /* Hide inactive tabs */
    .tab-content > :not(.active) {
      display: none;
    }
  `;__decorateClass$2([n({type:String})],LeftPanel.prototype,"sessionId",2);__decorateClass$2([n({type:String})],LeftPanel.prototype,"filename",2);__decorateClass$2([n({type:Array})],LeftPanel.prototype,"conversation",2);__decorateClass$2([n({type:Array})],LeftPanel.prototype,"flags",2);__decorateClass$2([n({type:Array})],LeftPanel.prototype,"concepts",2);__decorateClass$2([n({type:String})],LeftPanel.prototype,"selectedText",2);__decorateClass$2([n({type:Number})],LeftPanel.prototype,"selectedPage",2);__decorateClass$2([r()],LeftPanel.prototype,"activeTab",2);LeftPanel=__decorateClass$2([t("left-panel")],LeftPanel);var __defProp$1=Object.defineProperty,__getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__decorateClass$1=(Y,w,W,F)=>{for(var O=F>1?void 0:F?__getOwnPropDesc$1(w,W):w,ut=Y.length-1,lt;ut>=0;ut--)(lt=Y[ut])&&(O=(F?lt(w,W,O):lt(O))||O);return F&&O&&__defProp$1(w,W,O),O};let SessionList=class extends i{constructor(){super(...arguments),this.visible=!1,this.sessions=[],this.loading=!0,this.error="",this.searchQuery=""}connectedCallback(){super.connectedCallback(),this.loadSessions()}updated(Y){Y.has("visible")&&this.visible&&this.loadSessions()}async loadSessions(){this.loading=!0,this.error="";try{this.sessions=await api.listSessions()}catch(Y){console.error("Failed to load sessions:",Y),Y instanceof ApiError?this.error=Y.message:this.error="Failed to load sessions"}finally{this.loading=!1}}handleSearchInput(Y){const w=Y.target;this.searchQuery=w.value.toLowerCase()}handleSessionClick(Y){this.dispatchEvent(new CustomEvent("session-selected",{detail:{session:Y},bubbles:!0,composed:!0}))}async handleDeleteClick(Y,w){if(w.stopPropagation(),!!confirm(`Delete session for "${Y.filename}"? This cannot be undone.`)){this.deletingId=Y.session_id;try{await api.deleteSession(Y.session_id),this.sessions=this.sessions.filter(W=>W.session_id!==Y.session_id)}catch(W){console.error("Failed to delete session:",W),alert("Failed to delete session")}finally{this.deletingId=void 0}}}handleClose(){this.dispatchEvent(new CustomEvent("close",{bubbles:!0,composed:!0}))}handleUploadNew(){this.dispatchEvent(new CustomEvent("upload-new",{bubbles:!0,composed:!0}))}getFilteredSessions(){return this.searchQuery?this.sessions.filter(Y=>Y.filename.toLowerCase().includes(this.searchQuery)):this.sessions}formatDate(Y){return new Date(Y).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}renderSessionItem(Y){const w=this.deletingId===Y.session_id;return x`
      <div class="session-item" @click=${()=>this.handleSessionClick(Y)}>
        <div class="session-info">
          <div class="session-filename" title="${Y.filename}">
            ${Y.filename}
          </div>
          <div class="session-meta">${this.formatDate(Y.created_at)}</div>
        </div>
        <div class="session-actions">
          <button
            class="delete-btn"
            @click=${W=>this.handleDeleteClick(Y,W)}
            ?disabled=${w}
          >
            ${w?"Deleting...":"Delete"}
          </button>
        </div>
      </div>
    `}render(){if(!this.visible)return null;const Y=this.getFilteredSessions();return x`
      <div class="session-picker" @click=${w=>{w.target===w.currentTarget&&this.handleClose()}}>
        <div class="picker-content">
          <div class="picker-header">
            <h2>Your Papers</h2>
            <input
              type="text"
              class="search-input"
              placeholder="Search papers..."
              .value=${this.searchQuery}
              @input=${this.handleSearchInput}
            />
          </div>

          <div class="picker-body">
            ${this.error?x`<div class="error-message">${this.error}</div>`:""}

            ${this.loading?x`
                  <div class="loading-container">
                    <loading-spinner message="Loading sessions..."></loading-spinner>
                  </div>
                `:this.sessions.length===0?x`
                  <div class="empty-state">
                    <h3>No papers yet</h3>
                    <p>Upload a PDF to get started.</p>
                  </div>
                `:Y.length===0?x`<div class="no-results">No papers match your search</div>`:Y.map(w=>this.renderSessionItem(w))}
          </div>

          <div class="picker-footer">
            <button class="btn btn-secondary" @click=${this.handleClose}>
              Cancel
            </button>
            <button class="btn btn-primary" @click=${this.handleUploadNew}>
              Upload New PDF
            </button>
          </div>
        </div>
      </div>
    `}};SessionList.styles=i$3`
    :host {
      display: block;
    }

    .session-picker {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .picker-content {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .picker-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e0e0e0;
      flex-shrink: 0;
    }

    .picker-header h2 {
      margin: 0 0 16px 0;
      font-size: 20px;
      color: #333;
    }

    .search-input {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      outline: none;
      box-sizing: border-box;
    }

    .search-input:focus {
      border-color: #1a73e8;
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }

    .picker-body {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    .session-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      margin-bottom: 8px;
      background: #f8f9fa;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .session-item:hover {
      background: #e8f0fe;
      border-color: #1a73e8;
    }

    .session-item:last-child {
      margin-bottom: 0;
    }

    .session-info {
      flex: 1;
      min-width: 0;
    }

    .session-filename {
      font-weight: 500;
      font-size: 14px;
      color: #333;
      margin-bottom: 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .session-meta {
      font-size: 12px;
      color: #666;
    }

    .session-actions {
      flex-shrink: 0;
      margin-left: 12px;
    }

    .delete-btn {
      padding: 6px 10px;
      background: transparent;
      border: 1px solid #dc2626;
      border-radius: 4px;
      color: #dc2626;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.15s;
    }

    .delete-btn:hover {
      background: #fef2f2;
    }

    .delete-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .picker-footer {
      padding: 16px 24px;
      border-top: 1px solid #e0e0e0;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      flex-shrink: 0;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
    }

    .btn-secondary {
      background: white;
      border: 1px solid #ddd;
      color: #333;
    }

    .btn-secondary:hover {
      background: #f5f5f5;
    }

    .btn-primary {
      background: #1a73e8;
      border: 1px solid #1a73e8;
      color: white;
    }

    .btn-primary:hover {
      background: #1557b0;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #666;
    }

    .empty-state h3 {
      margin: 0 0 8px 0;
      font-size: 16px;
      color: #333;
    }

    .empty-state p {
      margin: 0;
      font-size: 14px;
    }

    .loading-container {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
    }

    .error-message {
      padding: 16px;
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 6px;
      color: #dc2626;
      font-size: 13px;
      margin-bottom: 16px;
    }

    .no-results {
      text-align: center;
      padding: 24px;
      color: #666;
      font-size: 14px;
    }
  `;__decorateClass$1([n({type:Boolean})],SessionList.prototype,"visible",2);__decorateClass$1([r()],SessionList.prototype,"sessions",2);__decorateClass$1([r()],SessionList.prototype,"loading",2);__decorateClass$1([r()],SessionList.prototype,"error",2);__decorateClass$1([r()],SessionList.prototype,"searchQuery",2);__decorateClass$1([r()],SessionList.prototype,"deletingId",2);SessionList=__decorateClass$1([t("session-list")],SessionList);var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=(Y,w,W,F)=>{for(var O=F>1?void 0:F?__getOwnPropDesc(w,W):w,ut=Y.length-1,lt;ut>=0;ut--)(lt=Y[ut])&&(O=(F?lt(w,W,O):lt(O))||O);return F&&O&&__defProp(w,W,O),O};let AppRoot=class extends i{constructor(){super(...arguments),this.sessionId="",this.filename="",this.pdfUrl="",this.conversation=[],this.flags=[],this.concepts=[],this.selectedText="",this.loading=!1,this.error="",this.showSessionPicker=!1,this.boundKeydownHandler=this.handleKeydown.bind(this)}connectedCallback(){super.connectedCallback(),document.addEventListener("keydown",this.boundKeydownHandler);const Y=sessionStorage.getPdfZoom();this.pdfViewer&&Y&&(this.pdfViewer.scale=Y)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("keydown",this.boundKeydownHandler)}handleKeydown(Y){const W=navigator.platform.toUpperCase().indexOf("MAC")>=0?Y.metaKey:Y.ctrlKey,F=Y.target,O=F.tagName==="INPUT"||F.tagName==="TEXTAREA"||F.isContentEditable;if(W&&Y.key==="k"){Y.preventDefault(),this.focusQueryInput();return}if(W&&Y.shiftKey&&Y.key==="F"){Y.preventDefault(),this.flagLastExchange();return}if(Y.key==="Escape"){this.showSessionPicker?this.showSessionPicker=!1:this.selectedText&&this.handleClearSelection();return}if(!O&&!W&&!Y.shiftKey&&!Y.altKey){if(Y.key==="1"){Y.preventDefault(),this.switchTab("concepts");return}if(Y.key==="2"){Y.preventDefault(),this.switchTab("ask");return}}}focusQueryInput(){const Y=this.shadowRoot?.querySelector("left-panel");if(Y){const w=Y.shadowRoot?.querySelector("ask-tab");if(w){const W=w.shadowRoot?.querySelector("query-input");if(W){const F=W.shadowRoot?.querySelector("textarea");F&&F.focus()}}}}async flagLastExchange(){if(!this.sessionId||this.conversation.length<2)return;const Y=[...this.conversation].reverse().find(w=>w.role==="assistant");if(Y&&Y.id>1){const w=this.flags.includes(Y.id);try{w?(await api.unflag(this.sessionId,Y.id),this.flags=this.flags.filter(W=>W!==Y.id)):(await api.toggleFlag(this.sessionId,Y.id),this.flags=[...this.flags,Y.id])}catch(W){console.error("Failed to toggle flag:",W)}}}switchTab(Y){this.leftPanel&&(this.leftPanel.activeTab=Y,sessionStorage.setActiveTab(Y))}async handleFileUpload(Y){const w=Y.target,W=w.files?.[0];if(!W||W.type!=="application/pdf"){this.error="Please select a valid PDF file";return}this.loading=!0,this.error="";try{const F=await api.createSession(W);this.sessionId=F.session_id,this.filename=F.filename,this.pdfUrl=URL.createObjectURL(W),sessionStorage.setLastSessionId(F.session_id),this.conversation=[{id:0,role:"user",content:"Initial analysis",timestamp:F.created_at},{id:1,role:"assistant",content:F.initial_analysis,timestamp:F.created_at}],this.loading=!1}catch(F){console.error("Upload error:",F),F instanceof ApiError?this.error=F.message:this.error="Failed to upload PDF. Please try again.",this.loading=!1}w.value=""}handleTextSelection(Y){const{text:w,page:W}=Y.detail;this.selectedText=w,this.selectedPage=W}handleClearSelection(){this.selectedText="",this.selectedPage=void 0}handleNavigateToPage(Y){this.pdfViewer&&this.pdfViewer.scrollToPage(Y.detail.page)}handleHighlightConcept(Y){const w=Y.detail.concept;w.pages.length>0&&this.pdfViewer&&this.pdfViewer.scrollToPage(w.pages[0])}handleShowSessionPicker(){this.showSessionPicker=!0}handleCloseSessionPicker(){this.showSessionPicker=!1}async handleSessionSelected(Y){const{session:w}=Y.detail;this.showSessionPicker=!1,this.loading=!0,this.error="";try{const W=await api.getSession(w.session_id);this.sessionId=W.session_id,this.filename=W.filename,this.flags=W.flags||[];const F=[];W.initial_analysis&&(F.push({id:0,role:"user",content:"Initial analysis",timestamp:W.created_at}),F.push({id:1,role:"assistant",content:W.initial_analysis,timestamp:W.created_at}));const O=(W.conversation||[]).map(ut=>({id:ut.exchange_id,role:ut.role,content:ut.content,model:ut.model,highlighted_text:ut.highlighted_text,page:ut.page_number,timestamp:ut.timestamp}));this.conversation=[...F,...O],sessionStorage.setLastSessionId(W.session_id),this.pdfUrl=`/sessions/${W.session_id}/pdf`,this.loading=!1}catch(W){console.error("Failed to load session:",W),W instanceof ApiError?this.error=W.message:this.error="Failed to load session",this.loading=!1}}handleUploadNewFromPicker(){this.showSessionPicker=!1;const Y=this.shadowRoot?.querySelector('input[type="file"]');Y&&Y.click()}renderEmptyState(){return x`
      <div class="empty-state">
        <h2>Paper Companion</h2>
        <p>
          Upload a PDF to get started, or load a previous session.
        </p>
        <div class="empty-state-actions">
          <label class="upload-btn">
            Upload PDF
            <input type="file" accept=".pdf" @change=${this.handleFileUpload} />
          </label>
          <button class="secondary-btn" @click=${this.handleShowSessionPicker}>
            Load Previous Session
          </button>
        </div>
      </div>
    `}renderLoadingScreen(){return x`
      <div class="loading-screen">
        <loading-spinner
          size="large"
          message="Analyzing paper..."
          light
        ></loading-spinner>
      </div>
    `}renderErrorScreen(){return x`
      <div class="error-screen">
        <error-message .message=${this.error}></error-message>
        <label class="upload-btn">
          Try Again
          <input type="file" accept=".pdf" @change=${this.handleFileUpload} />
        </label>
      </div>
    `}render(){return x`
      <div class="left-panel">
        <left-panel
          .sessionId=${this.sessionId}
          .filename=${this.filename}
          .conversation=${this.conversation}
          .flags=${this.flags}
          .concepts=${this.concepts}
          .selectedText=${this.selectedText}
          .selectedPage=${this.selectedPage}
          @conversation-updated=${Y=>this.conversation=Y.detail.conversation}
          @flags-updated=${Y=>this.flags=Y.detail.flags}
          @clear-selection=${this.handleClearSelection}
          @navigate-to-page=${this.handleNavigateToPage}
          @highlight-concept=${this.handleHighlightConcept}
        ></left-panel>
      </div>

      <div class="center-pane">
        ${this.loading?this.renderLoadingScreen():this.error?this.renderErrorScreen():this.pdfUrl?x`
              <pdf-viewer
                .pdfUrl=${this.pdfUrl}
                @text-selected=${this.handleTextSelection}
              ></pdf-viewer>
            `:this.renderEmptyState()}
      </div>

      <session-list
        .visible=${this.showSessionPicker}
        @session-selected=${this.handleSessionSelected}
        @close=${this.handleCloseSessionPicker}
        @upload-new=${this.handleUploadNewFromPicker}
      ></session-list>
    `}};AppRoot.styles=i$3`
    :host {
      display: flex;
      height: 100vh;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .left-panel {
      width: 450px;
      min-width: 450px;
      flex-shrink: 0;
      border-right: 1px solid #e0e0e0;
      display: flex;
      flex-direction: column;
      background: #f8f9fa;
    }

    left-panel {
      height: 100%;
    }

    .center-pane {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      background: #525659;
      color: white;
      padding: 40px;
      text-align: center;
    }

    .empty-state h2 {
      margin: 0 0 16px 0;
      font-size: 32px;
    }

    .empty-state p {
      margin: 0 0 32px 0;
      color: rgba(255, 255, 255, 0.8);
      font-size: 16px;
      max-width: 400px;
    }

    .upload-btn {
      padding: 14px 28px;
      background: #1a73e8;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: background 0.2s;
    }

    .upload-btn:hover {
      background: #1557b0;
    }

    .secondary-btn {
      padding: 14px 28px;
      background: transparent;
      color: white;
      border: 2px solid white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .secondary-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .empty-state-actions {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      justify-content: center;
    }

    input[type='file'] {
      display: none;
    }

    .loading-screen {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      background: #525659;
    }

    .error-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      background: #525659;
      padding: 40px;
    }

    .error-screen error-message {
      max-width: 500px;
      margin-bottom: 20px;
    }
  `;__decorateClass([r()],AppRoot.prototype,"sessionId",2);__decorateClass([r()],AppRoot.prototype,"filename",2);__decorateClass([r()],AppRoot.prototype,"pdfUrl",2);__decorateClass([r()],AppRoot.prototype,"conversation",2);__decorateClass([r()],AppRoot.prototype,"flags",2);__decorateClass([r()],AppRoot.prototype,"concepts",2);__decorateClass([r()],AppRoot.prototype,"selectedText",2);__decorateClass([r()],AppRoot.prototype,"selectedPage",2);__decorateClass([r()],AppRoot.prototype,"loading",2);__decorateClass([r()],AppRoot.prototype,"error",2);__decorateClass([r()],AppRoot.prototype,"showSessionPicker",2);__decorateClass([e("pdf-viewer")],AppRoot.prototype,"pdfViewer",2);__decorateClass([e("left-panel")],AppRoot.prototype,"leftPanel",2);AppRoot=__decorateClass([t("app-root")],AppRoot);
